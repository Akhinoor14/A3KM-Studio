<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Content Upload Manager - A3KM Studio</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      position: relative;
    }

    .back-btn {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(102, 126, 234, 0.1);
      border: 2px solid #667eea;
      padding: 10px 20px;
      border-radius: 10px;
      color: #667eea;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }

    .back-btn:hover {
      background: #667eea;
      color: white;
      transform: translateX(-3px);
    }

    h1 {
      color: #667eea;
      margin-bottom: 10px;
      margin-top: 20px;
      font-size: 32px;
    }

    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }

    .form-group {
      margin-bottom: 25px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      color: #333;
      font-weight: 600;
      font-size: 14px;
    }

    input, select, textarea {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 14px;
      transition: all 0.3s;
      font-family: inherit;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    textarea {
      resize: vertical;
      min-height: 100px;
    }

    .file-upload {
      position: relative;
      overflow: hidden;
      display: inline-block;
      width: 100%;
    }

    .file-upload input[type=file] {
      position: absolute;
      left: -9999px;
    }

    .file-upload-label {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      border: 2px dashed #667eea;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      background: #f8f9ff;
    }

    .file-upload-label:hover {
      background: #eef1ff;
      border-color: #764ba2;
    }

    .file-upload-label i {
      margin-right: 10px;
      font-size: 24px;
    }

    .file-info {
      margin-top: 10px;
      padding: 10px;
      background: #f0f0f0;
      border-radius: 5px;
      font-size: 13px;
      display: none;
    }

    .file-info.active {
      display: block;
    }

    .btn {
      padding: 15px 30px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      width: 100%;
      margin-top: 20px;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
    }

    .btn-primary:active {
      transform: translateY(0);
    }

    .youtube-toggle {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
      padding: 15px;
      background: #f8f9ff;
      border-radius: 10px;
    }

    .youtube-toggle input[type="checkbox"] {
      width: auto;
      transform: scale(1.3);
      cursor: pointer;
    }

    .youtube-toggle label {
      margin: 0;
      cursor: pointer;
      font-weight: 500;
    }

    .progress {
      margin-top: 20px;
      display: none;
    }

    .progress.active {
      display: block;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: #e0e0e0;
      border-radius: 10px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      width: 0%;
      transition: width 0.3s;
    }

    .progress-text {
      text-align: center;
      margin-top: 10px;
      color: #666;
      font-size: 14px;
    }

    .success-message {
      display: none;
      padding: 20px;
      background: #4caf50;
      color: white;
      border-radius: 10px;
      margin-top: 20px;
      text-align: center;
    }

    .success-message.active {
      display: block;
      animation: slideIn 0.3s;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .preview-area {
      margin-top: 20px;
      display: none;
    }

    .preview-area.active {
      display: block;
    }

    .preview-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }

    .preview-card {
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      padding: 10px;
      text-align: center;
    }

    .preview-card img {
      max-width: 100%;
      border-radius: 5px;
      margin-bottom: 10px;
    }

    .preview-card h4 {
      font-size: 12px;
      color: #666;
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="../only-boss-dashboard.html" class="back-btn">
      ‚Üê Back to Dashboard
    </a>
    
    <h1>üì§ Content Upload Manager</h1>
    <p class="subtitle">Upload books, videos, papers, or posts with automatic cover generation</p>

    <!-- Info Banner -->
    <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.15)); border: 2px solid rgba(102, 126, 234, 0.3); border-radius: 15px; padding: 20px; margin-bottom: 30px;">
      <h3 style="color: #667eea; margin-bottom: 10px; font-size: 18px;">‚ú® Premium Features</h3>
      <ul style="color: rgba(255,255,255,0.85); line-height: 2; margin-left: 20px;">
        <li>üé® <strong>Automatic SVG Cover Generation</strong> - Premium quality covers from 9 templates</li>
        <li>üìÅ <strong>Smart Folder Organization</strong> - Auto-creates category/content folder structure</li>
        <li>üñºÔ∏è <strong>Thumbnail Processing</strong> - Optimizes images in 3 sizes (small/medium/large)</li>
        <li>‚ñ∂Ô∏è <strong>YouTube Integration</strong> - Auto-fetches thumbnails from YouTube CDN</li>
        <li>üíæ <strong>Metadata Management</strong> - Saves structured JSON for each content</li>
      </ul>
    </div>

    <form id="uploadForm">
      <!-- Content Type -->
      <div class="form-group">
        <label for="contentType">Content Type</label>
        <select id="contentType" required>
          <option value="">Select content type...</option>
          <option value="books-pdfs">üìö Books & PDFs</option>
          <option value="educational-videos">üéì Educational Videos</option>
          <option value="research-papers">üìÑ Research Papers</option>
          <option value="video-content">üé¨ Video Blogs</option>
          <option value="written-posts">‚úçÔ∏è Written Posts</option>
        </select>
      </div>

      <!-- Category -->
      <div class="form-group">
        <label for="category">Category</label>
        <select id="category" required>
          <option value="">Select category...</option>
        </select>
      </div>

      <!-- Title -->
      <div class="form-group">
        <label for="title">Title</label>
        <input type="text" id="title" placeholder="Enter content title..." required>
      </div>

      <!-- Description -->
      <div class="form-group">
        <label for="description">Description</label>
        <textarea id="description" placeholder="Enter description..."></textarea>
      </div>

      <!-- YouTube Toggle -->
      <div class="youtube-toggle" id="youtubeToggle" style="display: none;">
        <input type="checkbox" id="isYoutube">
        <label for="isYoutube">This is a YouTube video</label>
      </div>

      <!-- YouTube URL -->
      <div class="form-group" id="youtubeUrlGroup" style="display: none;">
        <label for="youtubeUrl">YouTube URL</label>
        <input type="url" id="youtubeUrl" placeholder="https://youtu.be/VIDEO_ID or https://www.youtube.com/watch?v=VIDEO_ID">
      </div>

      <!-- Content File -->
      <div class="form-group" id="contentFileGroup">
        <label>Content File</label>
        <div class="file-upload">
          <input type="file" id="contentFile" accept=".pdf,.epub">
          <label for="contentFile" class="file-upload-label">
            <span>üìÅ Choose file or drag here</span>
          </label>
        </div>
        <div class="file-info" id="contentFileInfo"></div>
      </div>

      <!-- Thumbnail File -->
      <div class="form-group" id="thumbnailGroup">
        <label>Thumbnail (Optional - auto-generated if not provided)</label>
        <div class="file-upload">
          <input type="file" id="thumbnailFile" accept="image/*">
          <label for="thumbnailFile" class="file-upload-label">
            <span>üñºÔ∏è Choose thumbnail image</span>
          </label>
        </div>
        <div class="file-info" id="thumbnailFileInfo"></div>
      </div>

      <!-- Additional Metadata -->
      <div class="form-group">
        <label for="author">Author / Creator</label>
        <input type="text" id="author" placeholder="Enter author name...">
      </div>

      <div class="form-group">
        <label for="tags">Tags (comma-separated)</label>
        <input type="text" id="tags" placeholder="e.g., arduino, programming, guide">
      </div>

      <!-- Submit Button -->
      <button type="submit" class="btn btn-primary">
        üöÄ Upload Content
      </button>

      <!-- Progress -->
      <div class="progress" id="progress">
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text" id="progressText">Processing...</div>
      </div>

      <!-- Success Message -->
      <div class="success-message" id="successMessage">
        ‚úÖ Content uploaded successfully!
      </div>
    </form>

    <!-- Preview Area -->
    <div class="preview-area" id="previewArea">
      <h3>üìã Upload Summary</h3>
      <div class="preview-grid" id="previewGrid"></div>
    </div>
  </div>

  <script src="svg-generator.js"></script>
  <script src="content-upload-manager.js"></script>
  <script src="thumbnail-handler.js"></script>
  <script>
    // Initialize managers
    const svgGenerator = new SVGCoverGenerator();
    const uploader = new ContentUploadManager();
    const thumbnailHandler = new ThumbnailHandler();

    // JSON paths for category loading
    const categoryFiles = {
      'books-pdfs': '../../Content Studio/books-pdfs/books.json',
      'educational-videos': '../../Content Studio/educational-videos/courses.json',
      'research-papers': '../../Content Studio/research-papers/papers.json',
      'video-content': '../../Content Studio/video-content/videos.json',
      'written-posts': '../../Content Studio/written-posts/posts.json'
    };

    // Category data cache
    let categoriesCache = {};

    // Load categories from JSON
    async function loadCategories(contentType) {
      try {
        if (categoriesCache[contentType]) {
          return categoriesCache[contentType];
        }

        const response = await fetch(categoryFiles[contentType]);
        const data = await response.json();
        
        let categories = [];
        
        // Extract categories from categoryGroups structure
        if (data.categoryGroups) {
          // Handle videos.json hybrid structure
          if (contentType === 'video-content' && typeof data.categoryGroups === 'object') {
            // Combine video-blog and educational categories
            Object.values(data.categoryGroups).forEach(groupArray => {
              if (Array.isArray(groupArray)) {
                groupArray.forEach(group => {
                  if (group.categories) {
                    categories.push(...group.categories);
                  }
                });
              }
            });
          } else if (Array.isArray(data.categoryGroups)) {
            // Handle standard structure (books, courses, papers, posts)
            data.categoryGroups.forEach(group => {
              if (group.categories) {
                categories.push(...group.categories);
              }
            });
          }
        }
        
        categoriesCache[contentType] = categories;
        return categories;
      } catch (error) {
        console.error('Failed to load categories:', error);
        return [];
      }
    }

    // Category data (load from JSON in production)
    const categories = {
      'literature-language': ['Fiction - Novels', 'Poetry & Verse', 'Drama & Plays'],
      'arts-culture': ['Music Theory & Composition', 'Visual Arts & Painting'],
      'engineering-technology': ['Arduino & Microcontrollers', 'Circuit Design', '3D Modeling & CAD'],
      // Add all categories...
    };

    // Event listeners
    document.getElementById('contentType').addEventListener('change', async function() {
      const contentType = this.value;
      const categorySelect = document.getElementById('category');
      
      // Show YouTube toggle for video content
      if (contentType === 'video-content' || contentType === 'educational-videos') {
        document.getElementById('youtubeToggle').style.display = 'flex';
      } else {
        document.getElementById('youtubeToggle').style.display = 'none';
        document.getElementById('isYoutube').checked = false;
      }
      
      // Load categories from JSON
      categorySelect.innerHTML = '<option value="">Loading categories...</option>';
      const categories = await loadCategories(contentType);
      
      categorySelect.innerHTML = '<option value="">Select category...</option>';
      categories.forEach(cat => {
        const option = document.createElement('option');
        option.value = cat;
        option.textContent = cat;
        categorySelect.appendChild(option);
      });
    });

    document.getElementById('isYoutube').addEventListener('change', function() {
      const isYoutube = this.checked;
      document.getElementById('youtubeUrlGroup').style.display = isYoutube ? 'block' : 'none';
      document.getElementById('contentFileGroup').style.display = isYoutube ? 'none' : 'block';
      document.getElementById('thumbnailGroup').querySelector('label').textContent = 
        isYoutube ? 'Thumbnail (Auto-fetched from YouTube)' : 'Thumbnail (Optional)';
    });

    // File input handlers
    document.getElementById('contentFile').addEventListener('change', function() {
      const file = this.files[0];
      if (file) {
        const info = document.getElementById('contentFileInfo');
        info.textContent = `üìÑ ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`;
        info.classList.add('active');
      }
    });

    document.getElementById('thumbnailFile').addEventListener('change', function() {
      const file = this.files[0];
      if (file) {
        const validation = thumbnailHandler.validateThumbnail(file);
        const info = document.getElementById('thumbnailFileInfo');
        
        if (validation.valid) {
          info.textContent = `üñºÔ∏è ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)`;
          info.style.color = '#4caf50';
        } else {
          info.textContent = `‚ùå ${validation.errors.join(', ')}`;
          info.style.color = '#f44336';
        }
        info.classList.add('active');
      }
    });

    // Form submission
    document.getElementById('uploadForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const progress = document.getElementById('progress');
      const progressFill = document.getElementById('progressFill');
      const progressText = document.getElementById('progressText');
      const successMessage = document.getElementById('successMessage');
      
      progress.classList.add('active');
      successMessage.classList.remove('active');
      
      // Simulate upload process
      const steps = [
        'Creating folder structure...',
        'Generating category cover...',
        'Uploading content file...',
        'Processing thumbnail...',
        'Saving metadata...',
        'Updating database...',
        'Complete!'
      ];
      
      for (let i = 0; i < steps.length; i++) {
        progressText.textContent = steps[i];
        progressFill.style.width = `${((i + 1) / steps.length) * 100}%`;
        await new Promise(resolve => setTimeout(resolve, 500));
      }
      
      // Show success
      progress.classList.remove('active');
      successMessage.classList.add('active');
      
      // Reset form after 3 seconds
      setTimeout(() => {
        this.reset();
        successMessage.classList.remove('active');
        document.querySelectorAll('.file-info').forEach(el => el.classList.remove('active'));
      }, 3000);
    });
  </script>
</body>
</html>
