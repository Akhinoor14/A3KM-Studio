<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#000000">
    <meta name="description" content="View research papers and academic publications">
    <title>Paper Viewer - A3KM Studio</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="../../manifest.json">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="../../shared/mobile-common.css">
    <link rel="stylesheet" href="../../shared/mobile-navbar.css">
    <style>
        body { padding-bottom: 70px; }
        .paper-header { position: sticky; top: 0; z-index: 100; padding: 12px 16px; background: rgba(0,0,0,0.98); backdrop-filter: blur(10px); border-bottom: 1px solid var(--border-primary); display: flex; justify-content: space-between; align-items: center; }
        .back-btn { display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px; background: linear-gradient(135deg, rgba(139, 0, 0, 0.25), rgba(0, 0, 0, 0.5)); border: 1px solid rgba(139, 0, 0, 0.4); border-top: 1px solid rgba(255, 255, 255, 0.12); border-radius: 6px; color: #8B0000; font-size: 13px; font-weight: 600; text-decoration: none; box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.08), 0 2px 6px rgba(0, 0, 0, 0.3); }
        .back-btn:active { background: linear-gradient(135deg, rgba(204, 0, 0, 0.25), rgba(0, 0, 0, 0.4)); }
        .header-btn { padding: 8px 10px; background: linear-gradient(135deg, rgba(139, 0, 0, 0.2), rgba(0, 0, 0, 0.5)); border: 1px solid rgba(139, 0, 0, 0.4); border-top: 1px solid rgba(255, 255, 255, 0.1); border-radius: 6px; color: #8B0000; font-size: 14px; cursor: pointer; box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.08); }
        .paper-container { max-width: 700px; margin: 0 auto; padding: 24px 16px; }
        .paper-title { font-size: 24px; font-weight: 900; line-height: 1.3; margin-bottom: 16px; color: var(--text-primary); }
        .paper-meta { display: flex; flex-wrap: wrap; gap: 12px; font-size: 13px; color: var(--text-dim); margin-bottom: 16px; padding-bottom: 16px; border-bottom: 1px solid var(--border-primary); }
        .paper-status { padding: 4px 12px; background: linear-gradient(135deg, rgba(204, 0, 0, 0.2), rgba(204, 0, 0, 0.1)); border: 1px solid rgba(204, 0, 0, 0.4); border-top: 1px solid rgba(255, 255, 255, 0.12); border-radius: 12px; font-size: 11px; font-weight: 700; color: #CC0000; text-transform: uppercase; box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.08), 0 2px 6px rgba(204, 0, 0, 0.2); }
        .paper-abstract { padding: 16px; background: linear-gradient(135deg, rgba(204, 0, 0, 0.12), rgba(0, 0, 0, 0.3)); border-left: 3px solid #CC0000; border-top: 1px solid rgba(255, 255, 255, 0.08); border-radius: 8px; margin: 20px 0; box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.05); }
        .paper-abstract h3 { font-size: 16px; font-weight: 700; margin-bottom: 8px; color: var(--text-primary); }
        .paper-abstract p { font-size: 14px; line-height: 1.6; color: var(--text-secondary); }
        .paper-info-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin: 20px 0; }
        .info-item { padding: 12px; background: var(--bg-card); border: 1px solid var(--border-primary); border-radius: 8px; }
        .info-label { font-size: 11px; font-weight: 600; color: var(--text-dim); text-transform: uppercase; margin-bottom: 4px; }
        .info-value { font-size: 14px; font-weight: 700; color: var(--text-primary); }
        .download-btn { width: 100%; padding: 14px 20px; background: linear-gradient(135deg, rgba(204, 0, 0, 0.35), rgba(204, 0, 0, 0.25)); border: 1px solid rgba(204, 0, 0, 0.6); border-top: 2px solid rgba(255, 255, 255, 0.15); border-radius: 12px; color: #fff; font-size: 15px; font-weight: 700; display: flex; align-items: center; justify-content: center; gap: 10px; cursor: pointer; margin-top: 20px; box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.15), 0 4px 12px rgba(204, 0, 0, 0.25); }
        .download-btn:active { transform: scale(0.98); }
        .loading-container { padding: 60px 20px; text-align: center; }
        .loading-spinner { width: 40px; height: 40px; border: 3px solid rgba(204, 0, 0, 0.15); border-top-color: #CC0000; border-radius: 50%; animation: spin 0.8s linear infinite; margin: 0 auto 16px; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <header class="paper-header">
        <a href="paper-listing.html" class="back-btn"><i class="fas fa-arrow-left"></i> <span>Back</span></a>
        <div style="display:flex;gap:8px;">
            <button class="header-btn" id="citeBtn" title="Cite"><i class="fas fa-quote-right"></i></button>
            <button class="header-btn" id="shareBtn" title="Share"><i class="fas fa-share-alt"></i></button>
        </div>
    </header>
    <div class="paper-container" id="paperContainer">
        <div class="loading-container"><div class="loading-spinner"></div><p style="color:var(--text-dim);">Loading paper...</p></div>
    </div>
    
    <!-- Mobile Bottom Navigation -->
    <nav class="mobile-bottom-nav" role="navigation" aria-label="Main mobile navigation">
        <div class="mobile-nav-container">
            <a href="../../home/index.html" class="mobile-nav-item" aria-label="Home">
                <i class="fas fa-home" aria-hidden="true"></i>
                <span class="mobile-nav-label">Home</span>
            </a>
            <a href="../../about/about.html" class="mobile-nav-item" aria-label="About">
                <i class="fas fa-user-circle" aria-hidden="true"></i>
                <span class="mobile-nav-label">About</span>
            </a>
            <a href="../../projects/projects.html" class="mobile-nav-item" aria-label="Projects">
                <i class="fas fa-folder-open" aria-hidden="true"></i>
                <span class="mobile-nav-label">Projects</span>
            </a>
            <a href="../../content-studio/hub.html" class="mobile-nav-item" aria-label="Content Studio">
                <i class="fas fa-layer-group" aria-hidden="true"></i>
                <span class="mobile-nav-label">Studio</span>
            </a>
            <a href="../../contact/contact.html" class="mobile-nav-item" aria-label="Contact">
                <i class="fas fa-envelope" aria-hidden="true"></i>
                <span class="mobile-nav-label">Contact</span>
            </a>
        </div>
    </nav>

    <div id="mobileNavbar"></div>
    <script src="../../shared/mobile-navbar.js"></script>
    <script src="../../shared/pdf-viewer.js"></script>
    <script>
(function(){
let allPapers=[];
let currentPaper=null;
const paperContainer=document.getElementById('paperContainer');
const citeBtn=document.getElementById('citeBtn');
const shareBtn=document.getElementById('shareBtn');
const downloadBtn=document.getElementById('downloadBtn');

async function loadPapersData(){
try{
const response=await fetch('../../../Content Studio/research-papers/papers.json');
const data=await response.json();
allPapers=data.papers||[];
loadPaper();
}catch(error){
console.error('Error loading papers:',error);
paperContainer.innerHTML='<div style="padding:60px 20px;text-align:center;"><i class="fas fa-exclamation-triangle" style="font-size:56px;color:var(--primary-red);margin-bottom:20px;"></i><h3>Error Loading Papers</h3><p style="color:var(--text-dim);margin-top:12px;">Please try refreshing the page</p></div>';
}
}

function getPaperIdFromUrl(){
const urlParams=new URLSearchParams(window.location.search);
const id=urlParams.get('id');
return id||allPapers[0]?.id;
}

function loadPaper(){
const paperId=getPaperIdFromUrl();
currentPaper=allPapers.find(p=>p.id===paperId);
if(!currentPaper){
paperContainer.innerHTML='<div style="padding:60px 20px;text-align:center;"><i class="fas fa-exclamation-circle" style="font-size:56px;color:var(--primary-red);margin-bottom:20px;"></i><h3>Paper Not Found</h3><a href="paper-listing.html" style="display:inline-block;margin-top:16px;padding:10px 20px;background:var(--primary-red);color:#fff;border-radius:8px;text-decoration:none;font-weight:600;">Back to Papers</a></div>';
return;
}

const authors=Array.isArray(currentPaper.authors)?currentPaper.authors.join(', '):currentPaper.authors||'Unknown Author';
const date=new Date(currentPaper.date);
const formattedDate=date.toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'});

paperContainer.innerHTML=`
<span class="paper-status">${currentPaper.status||'Published'}</span>
<h1 class="paper-title">${currentPaper.title}</h1>
<div class="paper-meta">
<span><i class="fas fa-user-graduate"></i> ${authors}</span>
<span><i class="fas fa-university"></i> ${currentPaper.institution||'N/A'}</span>
<span><i class="fas fa-calendar"></i> ${formattedDate}</span>
<span><i class="fas fa-quote-right"></i> ${currentPaper.citations||0} citations</span>
</div>
<div class="paper-abstract">
<h3>Abstract</h3>
<p>${currentPaper.abstract||currentPaper.summary||'No abstract available'}</p>
</div>
<div class="paper-info-grid">
<div class="info-item"><div class="info-label">DOI</div><div class="info-value">${currentPaper.doi||'N/A'}</div></div>
<div class="info-item"><div class="info-label">Pages</div><div class="info-value">${currentPaper.pages||'N/A'}</div></div>
<div class="info-item"><div class="info-label">Year</div><div class="info-value">${new Date(currentPaper.date).getFullYear()}</div></div>
<div class="info-item"><div class="info-label">Downloads</div><div class="info-value">${currentPaper.downloads||0}</div></div>
</div>
`;

if(currentPaper.pdfUrl&&currentPaper.pdfUrl!=='#'){
paperContainer.innerHTML+=`
<button class="download-btn" id="viewBtn" style="background: linear-gradient(135deg, rgba(220, 20, 60, 0.4), rgba(204, 0, 0, 0.3)); margin-bottom: 12px;"><i class="fas fa-book-open"></i><span>Read Full Paper</span></button>
<button class="download-btn" id="downloadBtn" style="background: linear-gradient(135deg, rgba(178, 34, 34, 0.25), rgba(139, 0, 0, 0.15));"><i class="fas fa-download"></i><span>Download PDF</span></button>
`;
const viewBtn=document.getElementById('viewBtn');
const dlBtn=document.getElementById('downloadBtn');
if(viewBtn){
viewBtn.addEventListener('click',()=>{
if(navigator.vibrate)navigator.vibrate(20);
if(typeof openUniversalPDFViewer==='function'){
openUniversalPDFViewer({
filePath:currentPaper.pdfUrl,
title:`ðŸ“„ ${currentPaper.title}`,
downloadName:`${currentPaper.title.replace(/[^a-z0-9]/gi,'_')}.pdf`,
showDownload:true,
allowZoom:true
});
}else{window.open(currentPaper.pdfUrl,'_blank');}
});
viewBtn.addEventListener('touchstart',()=>{if(navigator.vibrate)navigator.vibrate(10);});
}
if(dlBtn){
dlBtn.addEventListener('click',()=>{
if(navigator.vibrate)navigator.vibrate(20);
const link=document.createElement('a');
link.href=currentPaper.pdfUrl;
link.download=`${currentPaper.title.replace(/[^a-z0-9]/gi,'_')}.pdf`;
link.click();
showToast('Downloading PDF...');
});
dlBtn.addEventListener('touchstart',()=>{if(navigator.vibrate)navigator.vibrate(10);});
}
}else{
paperContainer.innerHTML+=`
<div style="margin-top:20px;padding:20px;background:linear-gradient(135deg,rgba(178,34,34,0.15),rgba(139,0,0,0.05));border:2px solid rgba(178,34,34,0.3);border-radius:12px;text-align:center;">
<i class="fas fa-info-circle" style="font-size:36px;color:#B22222;margin-bottom:12px;"></i>
<h3 style="color:var(--text-primary);margin-bottom:8px;font-size:16px;">PDF Not Available</h3>
<p style="color:var(--text-secondary);font-size:13px;line-height:1.6;margin-bottom:16px;">This paper's PDF needs to be uploaded through the Only-Boss Manager.</p>
<p style="color:var(--text-dim);font-size:12px;">Contact admin to upload research papers.</p>
</div>
`;
}
}

function handleCite(){
if(navigator.vibrate)navigator.vibrate(10);
if(!currentPaper)return;
const authors=Array.isArray(currentPaper.authors)?currentPaper.authors.join(', '):currentPaper.authors;
const year=new Date(currentPaper.date).getFullYear();
const citation=`${authors}. (${year}). ${currentPaper.title}. ${currentPaper.institution||''}. DOI: ${currentPaper.doi||'N/A'}`;
const textarea=document.createElement('textarea');
textarea.value=citation;
textarea.style.position='fixed';
textarea.style.opacity='0';
document.body.appendChild(textarea);
textarea.select();
try{
document.execCommand('copy');
showToast('Citation copied!');
}catch(err){alert('Citation:\n\n'+citation);}
document.body.removeChild(textarea);
}

function handleShare(){
if(navigator.vibrate)navigator.vibrate(10);
if(!currentPaper)return;
if(navigator.share){
navigator.share({
title:currentPaper.title,
text:`Research Paper: ${currentPaper.title}`,
url:window.location.href
}).catch(()=>{});
}else{
showToast('Sharing...');
}
}

function showToast(msg){
const toast=document.createElement('div');
toast.textContent=msg;
toast.style.cssText='position:fixed;bottom:90px;left:50%;transform:translateX(-50%);padding:12px 24px;background:rgba(205,92,92,0.95);color:#fff;border-radius:8px;font-size:13px;font-weight:600;z-index:10000;';
document.body.appendChild(toast);
setTimeout(()=>toast.remove(),2000);
}

function init(){
loadPapersData();
if(citeBtn)citeBtn.addEventListener('click',handleCite);
if(shareBtn)shareBtn.addEventListener('click',handleShare);
[citeBtn,shareBtn,document.querySelector('.back-btn')].forEach(btn=>{
if(btn)btn.addEventListener('touchstart',()=>{if(navigator.vibrate)navigator.vibrate(10);});
});
}

if(document.readyState==='loading'){
document.addEventListener('DOMContentLoaded',init);
}else{
init();
}
})();
    </script>
    <script src="../../pwa-init.js"></script>
</body>
</html>
