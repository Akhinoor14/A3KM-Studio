<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <title>PDF Reader - Mobile</title>
    
    <link rel="icon" type="image/svg+xml" href="../../../images/favicon.svg">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="../../../Optimization/mobile-system/mobile-universal-styles.css">
    <link rel="stylesheet" href="../../../Optimization/mobile-system/mobile-navbar.css">
    <link rel="stylesheet" href="../../../Optimization/mobile-system/mobile-grid-background.css">
    
    <!-- PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    
    <style>
        body {
            overflow: hidden;
        }
        
        .reader-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(180deg, rgba(10,10,10,0.98), rgba(26,0,0,0.95));
            border-bottom: 2px solid var(--primary-red);
            padding: 15px 20px;
            z-index: 100;
        }
        
        .header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .back-btn {
            padding: 10px 16px;
            background: rgba(204, 0, 0, 0.2);
            border: 2px solid var(--primary-red);
            border-radius: 10px;
            color: white;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .back-btn:active {
            transform: scale(0.95);
        }
        
        .header-actions {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            width: 40px;
            height: 40px;
            background: rgba(204, 0, 0, 0.2);
            border: 2px solid var(--primary-red);
            border-radius: 10px;
            color: white;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .action-btn:active {
            transform: scale(0.95);
        }
        
        .book-title {
            font-size: 16px;
            font-weight: 700;
            color: white;
            margin-bottom: 5px;
        }
        
        .page-info {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.7);
        }
        
        .pdf-container {
            position: fixed;
            top: 90px;
            left: 0;
            right: 0;
            bottom: 130px;
            overflow-y: auto;
            background: #1a0000;
        }
        
        .pdf-canvas-wrapper {
            display: flex;
            justify-content: center;
            padding: 20px;
        }
        
        #pdfCanvas {
            max-width: 100%;
            border: 2px solid var(--primary-red);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(204, 0, 0, 0.3);
        }
        
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(10, 10, 10, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .loading-overlay.hidden {
            display: none;
        }
        
        .loading-spinner {
            font-size: 50px;
            color: var(--primary-red);
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            margin-top: 20px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 16px;
        }
        
        .controls-bar {
            position: fixed;
            bottom: 60px;
            left: 0;
            right: 0;
            background: linear-gradient(0deg, rgba(10,10,10,0.98), transparent);
            padding: 15px 20px;
            z-index: 50;
        }
        
        .zoom-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 12px;
        }
        
        .zoom-btn {
            flex: 1;
            padding: 12px;
            background: rgba(204, 0, 0, 0.2);
            border: 2px solid var(--primary-red);
            border-radius: 10px;
            color: white;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        .zoom-btn:active {
            transform: scale(0.95);
            background: rgba(204, 0, 0, 0.4);
        }
        
        .page-controls {
            display: flex;
            gap: 10px;
        }
        
        .page-btn {
            flex: 1;
            padding: 14px;
            background: var(--primary-red);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 15px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .page-btn:active {
            transform: scale(0.97);
            background: #990000;
        }
        
        .page-btn:disabled {
            opacity: 0.5;
            pointer-events: none;
        }
        
        .page-input-wrapper {
            flex: 1;
            position: relative;
        }
        
        .page-input {
            width: 100%;
            padding: 14px;
            background: rgba(10, 10, 10, 0.8);
            border: 2px solid var(--primary-red);
            border-radius: 12px;
            color: white;
            font-size: 15px;
            text-align: center;
            font-weight: 700;
        }
    </style>
</head>
<body>
    <div class="mobile-grid-background"></div>
    
    <div class="loading-overlay" id="loadingOverlay">
        <i class="fas fa-spinner loading-spinner"></i>
        <p class="loading-text">Loading PDF...</p>
    </div>
    
    <div class="reader-header">
        <div class="header-top">
            <button class="back-btn" onclick="history.back()">
                <i class="fas fa-arrow-left"></i>
                <span>Back</span>
            </button>
            
            <div class="header-actions">
                <button class="action-btn" onclick="downloadPDF()" title="Download">
                    <i class="fas fa-download"></i>
                </button>
                <button class="action-btn" onclick="sharePDF()" title="Share">
                    <i class="fas fa-share-alt"></i>
                </button>
            </div>
        </div>
        
        <h1 class="book-title" id="bookTitle">Loading...</h1>
        <p class="page-info">
            Page <span id="currentPage">1</span> of <span id="totalPages">--</span>
        </p>
    </div>
    
    <div class="pdf-container" id="pdfContainer">
        <div class="pdf-canvas-wrapper">
            <canvas id="pdfCanvas"></canvas>
        </div>
    </div>
    
    <div class="controls-bar">
        <div class="zoom-controls">
            <button class="zoom-btn" onclick="zoomOut()">
                <i class="fas fa-search-minus"></i>
                Zoom Out
            </button>
            <button class="zoom-btn" onclick="resetZoom()">
                <i class="fas fa-compress"></i>
                Fit
            </button>
            <button class="zoom-btn" onclick="zoomIn()">
                <i class="fas fa-search-plus"></i>
                Zoom In
            </button>
        </div>
        
        <div class="page-controls">
            <button class="page-btn" id="prevBtn" onclick="prevPage()">
                <i class="fas fa-chevron-left"></i>
                Prev
            </button>
            <div class="page-input-wrapper">
                <input type="number" class="page-input" id="pageInput" min="1" value="1">
            </div>
            <button class="page-btn" id="nextBtn" onclick="nextPage()">
                Next
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>
    
    <nav class="mobile-bottom-nav">
        <a href="../../../Home/mobile/index-mobile.html" class="nav-item">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </a>
        <a href="../../../About me/mobile/about-mobile.html" class="nav-item">
            <i class="fas fa-user"></i>
            <span>About</span>
        </a>
        <a href="../../../Projects Code/mobile/projects-mobile.html" class="nav-item">
            <i class="fas fa-code"></i>
            <span>Projects</span>
        </a>
        <a href="../../mobile/hub-mobile.html" class="nav-item active">
            <i class="fas fa-book"></i>
            <span>Studio</span>
        </a>
        <a href="../../../Contact/mobile/contact-mobile.html" class="nav-item">
            <i class="fas fa-envelope"></i>
            <span>Contact</span>
        </a>
    </nav>
    
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        
        let pdfDoc = null;
        let currentPage = 1;
        let totalPages = 0;
        let scale = 1.5;
        const canvas = document.getElementById('pdfCanvas');
        const ctx = canvas.getContext('2d');
        
        // Get book ID from URL
        const urlParams = new URLSearchParams(window.location.search);
        const bookId = urlParams.get('id');
        const bookTitle = urlParams.get('title') || 'Book Title';
        const pdfUrl = urlParams.get('pdf') || '../sample-book.pdf';
        
        document.getElementById('bookTitle').textContent = bookTitle;
        
        // Load PDF
        async function loadPDF() {
            try {
                const loadingTask = pdfjsLib.getDocument(pdfUrl);
                pdfDoc = await loadingTask.promise;
                totalPages = pdfDoc.numPages;
                document.getElementById('totalPages').textContent = totalPages;
                document.getElementById('loadingOverlay').classList.add('hidden');
                renderPage(currentPage);
                updateButtons();
            } catch (error) {
                console.error('Error loading PDF:', error);
                document.querySelector('.loading-text').textContent = 'Failed to load PDF';
            }
        }
        
        // Render page
        async function renderPage(num) {
            const page = await pdfDoc.getPage(num);
            const viewport = page.getViewport({ scale });
            
            canvas.height = viewport.height;
            canvas.width = viewport.width;
            
            const renderContext = {
                canvasContext: ctx,
                viewport: viewport
            };
            
            await page.render(renderContext).promise;
            
            currentPage = num;
            document.getElementById('currentPage').textContent = currentPage;
            document.getElementById('pageInput').value = currentPage;
        }
        
        function prevPage() {
            if (currentPage <= 1) return;
            if (navigator.vibrate) navigator.vibrate(5);
            renderPage(--currentPage);
            updateButtons();
            document.getElementById('pdfContainer').scrollTop = 0;
        }
        
        function nextPage() {
            if (currentPage >= totalPages) return;
            if (navigator.vibrate) navigator.vibrate(5);
            renderPage(++currentPage);
            updateButtons();
            document.getElementById('pdfContainer').scrollTop = 0;
        }
        
        function updateButtons() {
            document.getElementById('prevBtn').disabled = currentPage <= 1;
            document.getElementById('nextBtn').disabled = currentPage >= totalPages;
        }
        
        function zoomIn() {
            if (navigator.vibrate) navigator.vibrate(5);
            scale += 0.3;
            renderPage(currentPage);
        }
        
        function zoomOut() {
            if (navigator.vibrate) navigator.vibrate(5);
            if (scale > 0.5) {
                scale -= 0.3;
                renderPage(currentPage);
            }
        }
        
        function resetZoom() {
            if (navigator.vibrate) navigator.vibrate(5);
            scale = 1.5;
            renderPage(currentPage);
        }
        
        function downloadPDF() {
            if (navigator.vibrate) navigator.vibrate(15);
            window.open(pdfUrl, '_blank');
        }
        
        function sharePDF() {
            if (navigator.vibrate) navigator.vibrate(10);
            if (navigator.share) {
                navigator.share({
                    title: bookTitle,
                    text: 'Check out this book!',
                    url: window.location.href
                });
            } else {
                alert('Link copied!');
            }
        }
        
        // Page input
        document.getElementById('pageInput').addEventListener('change', (e) => {
            let num = parseInt(e.target.value);
            if (num >= 1 && num <= totalPages) {
                renderPage(num);
                updateButtons();
            } else {
                e.target.value = currentPage;
            }
        });
        
        // Initialize
        loadPDF();
    </script>
</body>
</html>
