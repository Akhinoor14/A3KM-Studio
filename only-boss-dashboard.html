<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Only Boss Dashboard</title>
    <!-- Global site styles for navbar consistency -->
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="mobile-clean.css">
    <link rel="stylesheet" href="mobile-boss-dashboard-fix.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #0a0a0a 0%, #1a0000 100%); color: #ffffff; min-height: 100vh; }
        .header { background: linear-gradient(135deg, rgba(30, 0, 0, 0.8), rgba(10, 0, 0, 0.9)); border-bottom: 2px solid rgba(204, 0, 0, 0.3); padding: 20px 40px; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { color: #cc0000; font-size: 1.8rem; }
        .header-info { display: flex; gap: 20px; align-items: center; }
        .session-info { font-size: 0.85rem; color: rgba(255, 255, 255, 0.6); }
        .logout-btn { padding: 10px 20px; background: linear-gradient(135deg, #cc0000, #990000); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; }
        .logout-btn:hover { background: linear-gradient(135deg, #dd0000, #aa0000); transform: translateY(-2px); }
        .container { padding: 40px; max-width: 1400px; margin: 0 auto; }
        .admin-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin-top: 30px; }
        .admin-card { background: linear-gradient(135deg, rgba(30, 0, 0, 0.6), rgba(10, 0, 0, 0.8)); border: 2px solid rgba(204, 0, 0, 0.3); border-radius: 15px; padding: 30px; cursor: pointer; transition: all 0.3s ease; }
        .admin-card:hover { border-color: #cc0000; transform: translateY(-5px); box-shadow: 0 10px 30px rgba(204, 0, 0, 0.3); }
        .card-icon { font-size: 3rem; margin-bottom: 15px; }
        .card-title { color: #cc0000; font-size: 1.4rem; margin-bottom: 10px; }
        .card-description { color: rgba(255, 255, 255, 0.7); font-size: 0.9rem; line-height: 1.6; }
        .security-panel { background: rgba(204, 0, 0, 0.1); border: 1px solid rgba(204, 0, 0, 0.3); border-radius: 15px; padding: 25px; margin-top: 30px; }
        .security-panel h2 { color: #cc0000; margin-bottom: 15px; }
        .security-status { display: flex; flex-wrap: wrap; gap: 20px; margin-top: 15px; }
        .status-item { background: rgba(0, 0, 0, 0.3); padding: 15px 20px; border-radius: 10px; border-left: 4px solid #00cc00; }
        .status-item.warning { border-left-color: #ff9900; }
        .status-label { color: rgba(255, 255, 255, 0.6); font-size: 0.85rem; margin-bottom: 5px; }
        .status-value { color: #00cc00; font-size: 1.1rem; font-weight: 600; }
        .status-value.warning { color: #ff9900; }
        .boss-icon { font-size: 2.2rem; margin-right: 8px; vertical-align: -4px; text-shadow: 0 0 8px rgba(255, 215, 0, 0.9), 0 0 16px rgba(255, 215, 0, 0.6); }

        /* Security Settings Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 1000; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background: linear-gradient(135deg, rgba(30, 0, 0, 0.95), rgba(10, 0, 0, 0.98)); border: 2px solid rgba(204, 0, 0, 0.4); border-radius: 20px; padding: 40px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .modal-title { color: #cc0000; font-size: 1.6rem; }
        .close-btn { background: none; border: none; color: rgba(255, 255, 255, 0.6); font-size: 2rem; cursor: pointer; transition: all 0.3s ease; }
        .close-btn:hover { color: #cc0000; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; color: rgba(255, 255, 255, 0.7); font-size: 0.9rem; }
        .form-group input { width: 100%; padding: 12px 18px; background: rgba(20, 0, 0, 0.4); border: 2px solid rgba(204, 0, 0, 0.3); border-radius: 10px; color: #fff; font-size: 1rem; }
        .form-group input:focus { outline: none; border-color: #cc0000; box-shadow: 0 0 15px rgba(204, 0, 0, 0.3); }
        .btn { padding: 12px 24px; border: none; border-radius: 10px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; margin-right: 10px; }
        .btn-primary { background: linear-gradient(135deg, #cc0000, #990000); color: white; }
        .btn-primary:hover { background: linear-gradient(135deg, #dd0000, #aa0000); }
        .btn-secondary { background: rgba(255, 255, 255, 0.1); color: white; }
        .success-msg, .error-msg { padding: 12px; border-radius: 8px; margin-top: 15px; display: none; }
        .success-msg { background: rgba(0, 200, 0, 0.2); border: 1px solid rgba(0, 200, 0, 0.4); color: #00ff00; }
        .error-msg { background: rgba(200, 0, 0, 0.2); border: 1px solid rgba(200, 0, 0, 0.4); color: #ff6666; }

        @media (max-width: 768px) { .header { flex-direction: column; gap: 15px; text-align: center; } .container { padding: 20px; } .admin-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <!-- Global Navbar added so the top bar is always visible -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <!-- ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶∏‡¶æ‡¶á‡¶ü‡ßá‡¶∞ ‡¶≤‡ßã‡¶ó‡ßã ‡¶†‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø logo.svg ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá -->
                <a href="index.html">
                    <img src="images/logo.svg" alt="‡¶ì‡ßü‡ßá‡¶¨‡¶∏‡¶æ‡¶á‡¶ü ‡¶≤‡ßã‡¶ó‡ßã" class="brand-logo" width="40" height="40" style="vertical-align:middle; margin-right:8px;" />
                    <span style="font-size:1.2rem; color:#cc0000; vertical-align:middle;">Home</span>
                </a>
            </div>
            <!-- Mobile quick icons -->
            <div class="nav-quick-icons" aria-label="Quick navigation">
                <a href="index.html" class="nav-icon" aria-label="Home" title="Home"><i class="fas fa-house"></i></a>
                <a href="about.html" class="nav-icon" aria-label="About" title="About"><i class="fas fa-user"></i></a>
                <a href="projects.html" class="nav-icon" aria-label="Projects" title="Projects"><i class="fas fa-diagram-project"></i></a>
                <a href="contact.html" class="nav-icon" aria-label="Contact" title="Contact"><i class="fas fa-envelope"></i></a>
                <a href="only-boss.html" class="nav-icon nav-crown" aria-label="Only Boss" title="Only Boss"><i class="fas fa-crown"></i></a>
            </div>
            <ul class="nav-menu">
                <li class="nav-item"><a href="about.html" class="nav-link">About</a></li>
                <li class="nav-item"><a href="projects.html" class="nav-link">Projects</a></li>
                <li class="nav-item"><a href="contact.html" class="nav-link">Contact</a></li>
                <li class="nav-item">
                    <a href="only-boss.html" class="nav-link nav-crown" title="Only Boss Portal" aria-label="Only Boss Portal">
                        <i class="fas fa-crown" aria-hidden="true"></i>
                        <span>Only Boss</span>
                    </a>
                </li>
                    <li class="nav-item">
                        <button id="dashboardLogoutBtn" class="logout-btn" style="margin-left: 10px;">üö™ Logout</button>
                    </li>
            </ul>
            <div class="hamburger"><span class="bar"></span><span class="bar"></span><span class="bar"></span></div>
        </div>
    </nav>

    <div class="header">
        <h1><span class="boss-icon" aria-hidden="true">üëë</span> Only Boss Dashboard</h1>
        <div class="header-info">
            <div class="session-info">Session Active | Last Login: <span id="lastLogin">--</span></div>
            <button class="logout-btn" id="logoutBtn" style="margin-left: 10px;">üö™ Logout</button>
        </div>
    </div>
    <div class="container">
        <h2 style="color: rgba(255, 255, 255, 0.8); margin-bottom: 10px;">Welcome, Administrator</h2>
        <p style="color: rgba(255, 255, 255, 0.5);">Manage your website content and settings from here</p>
        <div class="admin-grid">
            <div class="admin-card" onclick="window.location.href='./backend-token-manager.html'">
                <div class="card-icon">üîê</div>
                <h3 class="card-title">Backend Token Manager</h3>
                <p class="card-description">Manage encrypted GitHub API tokens for backend proxy server. Configure multiple tokens for unlimited access. Admin authentication required.</p>
            </div>
            <div class="admin-card" onclick="window.location.href='./project-management-hub.html'">
                <div class="card-icon">üì¶</div>
                <h3 class="card-title">Project Management</h3>
                <p class="card-description">SOLIDWORKS CW/HW/Solo projects - Upload, Update, Delete with GitHub sync and auto README generation.</p>
            </div>
            <div class="admin-card" id="uploadModelCard">
                <div class="card-icon">üéØ</div>
                <h3 class="card-title">Upload 3D Model (GLB/GLTF)</h3>
                <p class="card-description">Upload SOLIDWORKS 3D models to CW/HW/Solo projects. Auto-detection on mobile pages with View 3D button.</p>
            </div>
            <div class="admin-card" onclick="alert('CV Manager - Coming Soon')">
                <div class="card-icon">üìÑ</div>
                <h3 class="card-title">CV Manager</h3>
                <p class="card-description">Upload and update your CV/Resume. Manage different versions.</p>
            </div>
            <div class="admin-card" onclick="alert('Projects Manager - Coming Soon')">
                <div class="card-icon">üöÄ</div>
                <h3 class="card-title">Projects</h3>
                <p class="card-description">Add, edit, or remove project entries. Manage GitHub sync.</p>
            </div>
            <div class="admin-card" onclick="alert('Content Editor - Coming Soon')">
                <div class="card-icon">‚úèÔ∏è</div>
                <h3 class="card-title">Content Editor</h3>
                <p class="card-description">Edit website text, descriptions, and about section.</p>
            </div>
            <div class="admin-card" id="securityCard">
                <div class="card-icon">üîí</div>
                <h3 class="card-title">Security Settings</h3>
                <p class="card-description">Change passwords, manage two-step authentication.</p>
            </div>
            <div class="admin-card" onclick="alert('Analytics - Coming Soon')">
                <div class="card-icon">üìä</div>
                <h3 class="card-title">Analytics</h3>
                <p class="card-description">View visitor statistics and engagement metrics.</p>
            </div>
        </div>
        <div class="security-panel">
            <h2>üõ°Ô∏è Security Status</h2>
            <div class="security-status">
                <div class="status-item"><div class="status-label">Authentication Method</div><div class="status-value">Two-Step (SHA-256)</div></div>
                <div class="status-item"><div class="status-label">Session Status</div><div class="status-value">Active</div></div>
                <div class="status-item"><div class="status-label">Last Password Change</div><div class="status-value" id="lastPwdChange">Never</div></div>
                <div class="status-item warning"><div class="status-label">Auto-Logout Timer</div><div class="status-value warning">30 minutes</div></div>
            </div>
        </div>
    </div>

    <!-- Security Settings Modal -->
    <div class="modal" id="securityModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">üîí Security Settings</h2>
                <button class="close-btn" id="closeModal">&times;</button>
            </div>

            <h3 style="color: #cc0000; margin-bottom: 15px;">Change Primary Password</h3>
            <div class="form-group">
                <label>Current Primary Password:</label>
                <input type="password" id="currentPrimary" placeholder="Enter current password">
            </div>
            <div class="form-group">
                <label>New Primary Password:</label>
                <input type="password" id="newPrimary" placeholder="Enter new password (min 6 characters)">
            </div>
            <div class="form-group">
                <label>Confirm New Primary Password:</label>
                <input type="password" id="confirmPrimary" placeholder="Confirm new password">
            </div>

            <hr style="border: 1px solid rgba(204, 0, 0, 0.2); margin: 30px 0;">

            <h3 style="color: #cc0000; margin-bottom: 15px;">Change Secondary Password</h3>
            <div class="form-group">
                <label>Current Secondary Password:</label>
                <input type="password" id="currentSecondary" placeholder="Enter current password">
            </div>
            <div class="form-group">
                <label>New Secondary Password:</label>
                <input type="password" id="newSecondary" placeholder="Enter new password (min 6 characters)">
            </div>
            <div class="form-group">
                <label>Confirm New Secondary Password:</label>
                <input type="password" id="confirmSecondary" placeholder="Confirm new password">
            </div>

            <div style="margin-top: 25px;">
                <button class="btn btn-primary" id="savePrimaryBtn">Save Primary Password</button>
                <button class="btn btn-primary" id="saveSecondaryBtn">Save Secondary Password</button>
                <button class="btn btn-secondary" id="cancelBtn">Cancel</button>
            </div>

            <div class="success-msg" id="successMsg"></div>
            <div class="error-msg" id="errorMsg"></div>

            <div style="margin-top: 30px; padding: 15px; background: rgba(204, 0, 0, 0.1); border-radius: 10px;">
                <h4 style="color: #cc0000; margin-bottom: 10px;">üîê Password Reset Guide</h4>
                <p style="color: rgba(255, 255, 255, 0.7); font-size: 0.85rem; line-height: 1.6;">
                    If you forget your password, open Browser Console (F12) and run:<br>
                    <code style="background: rgba(0,0,0,0.3); padding: 5px 10px; border-radius: 5px; display: inline-block; margin-top: 5px;">
                        localStorage.clear(); location.reload();
                    </code>
                </p>
            </div>
        </div>
    </div>

    <!-- 3D Model Upload Modal -->
    <div class="modal" id="uploadModelModal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2 class="modal-title">üéØ Upload 3D Model to SOLIDWORKS Projects</h2>
                <button class="close-btn" id="closeUploadModal">&times;</button>
            </div>

            <div style="background: rgba(204, 0, 0, 0.1); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                <h4 style="color: #cc0000; margin-bottom: 8px;">üìã How It Works:</h4>
                <ul style="color: rgba(255, 255, 255, 0.7); font-size: 0.85rem; line-height: 1.8; padding-left: 20px;">
                    <li>Export your SOLIDWORKS model as <strong>GLB</strong> or <strong>GLTF</strong> format</li>
                    <li>Select project type (CW/HW/Solo) and fill in details</li>
                    <li>Upload GLB file ‚Üí Auto-uploaded to GitHub repo</li>
                    <li><strong>View 3D</strong> button automatically appears on mobile pages!</li>
                </ul>
            </div>

            <div class="form-group">
                <label>Project Type:</label>
                <select id="uploadProjectType" style="width: 100%; padding: 12px 18px; background: rgba(20, 0, 0, 0.4); border: 2px solid rgba(204, 0, 0, 0.3); border-radius: 10px; color: #fff; font-size: 1rem;">
                    <option value="CW">Class Work (CW)</option>
                    <option value="HW">Home Work (HW)</option>
                    <option value="Solo">Solo Projects</option>
                </select>
            </div>

            <div id="cwHwFields">
                <div class="form-group">
                    <label>Day Number:</label>
                    <input type="number" id="uploadDay" placeholder="e.g., 6" min="1" max="99">
                </div>
                <div class="form-group">
                    <label>Work Number:</label>
                    <input type="number" id="uploadNumber" placeholder="e.g., 1" min="1" max="99">
                </div>
            </div>

            <div id="soloFields" style="display: none;">
                <div class="form-group">
                    <label>Project Name:</label>
                    <input type="text" id="uploadProjectName" placeholder="e.g., Robotic Arm">
                </div>
            </div>

            <div class="form-group">
                <label>3D Model File (GLB/GLTF):</label>
                <input type="file" id="uploadGLBFile" accept=".glb,.gltf" style="width: 100%; padding: 12px 18px; background: rgba(20, 0, 0, 0.4); border: 2px solid rgba(204, 0, 0, 0.3); border-radius: 10px; color: #fff; font-size: 1rem;">
                <small style="color: rgba(255, 255, 255, 0.5); display: block; margin-top: 5px;">Recommended: GLB format (smaller file size, better performance)</small>
            </div>

            <div class="form-group">
                <label>GitHub Personal Access Token (PAT):</label>
                <div style="display: flex; gap: 10px; align-items: flex-start;">
                    <div style="flex: 1;">
                        <input type="password" id="uploadGitToken" placeholder="ghp_xxxxxxxxxxxx" style="width: 100%;">
                        <small style="color: rgba(255, 255, 255, 0.5); display: block; margin-top: 5px;">
                            Need a token? <a href="https://github.com/settings/tokens" target="_blank" style="color: #cc0000;">Create one here</a> with <code style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 3px;">repo</code> scope
                        </small>
                    </div>
                    <button type="button" class="btn btn-secondary" onclick="saveGitHubToken()" style="white-space: nowrap;">
                        <i class="fas fa-save"></i> Save Token
                    </button>
                </div>
                <div id="tokenStatus" style="margin-top: 8px; padding: 8px 12px; border-radius: 6px; display: none;">
                    <i class="fas fa-check-circle"></i> <span id="tokenStatusText"></span>
                </div>
            </div>

            <div style="margin-top: 25px;">
                <button class="btn btn-primary" id="uploadModelBtn">
                    <i class="fas fa-upload"></i> Upload 3D Model
                </button>
                <button class="btn btn-secondary" id="cancelUploadBtn">Cancel</button>
            </div>

            <div id="uploadProgress" style="display: none; margin-top: 20px;">
                <div style="background: rgba(0, 0, 0, 0.3); border-radius: 10px; padding: 15px;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <i class="fas fa-spinner fa-spin" style="color: #cc0000; font-size: 1.2rem;"></i>
                        <span id="uploadStatusText" style="color: rgba(255, 255, 255, 0.8);">Uploading...</span>
                    </div>
                    <div style="background: rgba(255, 255, 255, 0.1); height: 8px; border-radius: 4px; overflow: hidden;">
                        <div id="uploadProgressBar" style="background: linear-gradient(90deg, #cc0000, #ff4444); height: 100%; width: 0%; transition: width 0.3s;"></div>
                    </div>
                </div>
            </div>

            <div class="success-msg" id="uploadSuccessMsg"></div>
            <div class="error-msg" id="uploadErrorMsg"></div>

            <div style="margin-top: 30px; padding: 15px; background: rgba(204, 0, 0, 0.1); border-radius: 10px;">
                <h4 style="color: #cc0000; margin-bottom: 10px;">üí° SOLIDWORKS to GLB Conversion:</h4>
                <ul style="color: rgba(255, 255, 255, 0.7); font-size: 0.85rem; line-height: 1.8; padding-left: 20px;">
                    <li><strong>Method 1:</strong> Use SOLIDWORKS add-in or export plugin (if available)</li>
                    <li><strong>Method 2:</strong> Upload SLDPRT to <a href="https://www.tinyglb.com/" target="_blank" style="color: #cc0000;">TinyGLB</a> or <a href="https://www.clooned.com/" target="_blank" style="color: #cc0000;">Clooned</a> ‚Üí Get GLB URL</li>
                    <li><strong>Method 3:</strong> Use third-party converter (Aspose, FreeCAD, Sketchfab)</li>
                    <li><strong>File Size:</strong> Keep under 5 MB for best mobile performance</li>
                </ul>
            </div>
        </div>
    </div>

    <script src="github-uploader.js"></script>
    <script src="only-boss-dashboard.js"></script>
    <script>
    // 3D Model Upload Modal Logic
    document.addEventListener('DOMContentLoaded', function() {
        const uploadModelCard = document.getElementById('uploadModelCard');
        const uploadModelModal = document.getElementById('uploadModelModal');
        const closeUploadModal = document.getElementById('closeUploadModal');
        const cancelUploadBtn = document.getElementById('cancelUploadBtn');
        const uploadProjectType = document.getElementById('uploadProjectType');
        const cwHwFields = document.getElementById('cwHwFields');
        const soloFields = document.getElementById('soloFields');
        const uploadModelBtn = document.getElementById('uploadModelBtn');
        const uploadProgress = document.getElementById('uploadProgress');
        const uploadSuccessMsg = document.getElementById('uploadSuccessMsg');
        const uploadErrorMsg = document.getElementById('uploadErrorMsg');

        // Open modal
        if (uploadModelCard) {
            uploadModelCard.addEventListener('click', function() {
                uploadModelModal.classList.add('active');
                loadSavedToken();
            });
        }

        // Close modal
        if (closeUploadModal) {
            closeUploadModal.addEventListener('click', function() {
                uploadModelModal.classList.remove('active');
                resetUploadForm();
            });
        }

        if (cancelUploadBtn) {
            cancelUploadBtn.addEventListener('click', function() {
                uploadModelModal.classList.remove('active');
                resetUploadForm();
            });
        }

        // Toggle fields based on project type
        if (uploadProjectType) {
            uploadProjectType.addEventListener('change', function() {
                if (this.value === 'Solo') {
                    cwHwFields.style.display = 'none';
                    soloFields.style.display = 'block';
                } else {
                    cwHwFields.style.display = 'block';
                    soloFields.style.display = 'none';
                }
            });
        }

        // Upload button handler
        if (uploadModelBtn) {
            uploadModelBtn.addEventListener('click', async function() {
                uploadSuccessMsg.style.display = 'none';
                uploadErrorMsg.style.display = 'none';

                const projectType = uploadProjectType.value;
                const glbFile = document.getElementById('uploadGLBFile').files[0];
                const gitToken = document.getElementById('uploadGitToken').value.trim();

                // Validation
                if (!glbFile) {
                    showError('Please select a GLB/GLTF file');
                    return;
                }

                // Validate file size (100 MB GitHub limit)
                const maxSize = 100 * 1024 * 1024; // 100 MB
                if (glbFile.size > maxSize) {
                    showError(`File too large: ${(glbFile.size / 1024 / 1024).toFixed(2)} MB. Maximum allowed: 100 MB`);
                    return;
                }

                if (!gitToken) {
                    showError('Please enter your GitHub Personal Access Token');
                    return;
                }

                let folderPath;
                let projectName;

                if (projectType === 'Solo') {
                    projectName = document.getElementById('uploadProjectName').value.trim();
                    if (!projectName) {
                        showError('Please enter a project name');
                        return;
                    }
                    // Validate project name
                    const validNameRegex = /^[a-zA-Z0-9_-]+(\s+[a-zA-Z0-9_-]+)*$/;
                    if (!validNameRegex.test(projectName)) {
                        showError('Invalid project name. Use only letters, numbers, spaces, dash, or underscore');
                        return;
                    }
                    folderPath = `Solo/${projectName}`;
                } else {
                    const day = document.getElementById('uploadDay').value;
                    const number = document.getElementById('uploadNumber').value;

                    if (!day || !number) {
                        showError('Please enter day and work number');
                        return;
                    }

                    // Validate numbers
                    if (day < 1 || day > 99 || number < 1 || number > 99) {
                        showError('Day and work number must be between 1 and 99');
                        return;
                    }

                    // Use GitHubUploader format: CW/Day 06/cw 01 day 6
                    const dayStr = String(day).padStart(2, '0');
                    const numStr = String(number).padStart(2, '0');
                    const workType = projectType.toLowerCase();
                    folderPath = `${projectType}/Day ${dayStr}/${workType} ${numStr} day ${day}`;
                    projectName = `${projectType} ${number} - Day ${day}`;
                }

                try {
                    // Show progress
                    uploadProgress.style.display = 'block';
                    uploadModelBtn.disabled = true;
                    updateProgress(10, 'Validating token...');

                    // Create GitHubUploader instance
                    const uploader = new GitHubUploader('Akhinoor14', 'SOLIDWORKS-Projects', gitToken);

                    // Validate token
                    updateProgress(20, 'Checking repository access...');
                    const isValid = await uploader.validateAccess();
                    if (!isValid) {
                        throw new Error('Invalid token or no repository access');
                    }

                    // Generate proper filename based on project type
                    updateProgress(30, 'Preparing file...');
                    const fileExt = glbFile.name.split('.').pop();
                    let newFileName;
                    
                    if (projectType === 'Solo') {
                        // Solo: projectname.glb (e.g., robotic-arm.glb)
                        newFileName = `${projectName.toLowerCase().replace(/\s+/g, '-')}.${fileExt}`;
                    } else {
                        // CW/HW: type-number-day.glb (e.g., cw-01-day-6.glb)
                        const numStr = String(number).padStart(2, '0');
                        newFileName = `${projectType.toLowerCase()}-${numStr}-day-${day}.${fileExt}`;
                    }

                    // Check if file already exists
                    updateProgress(35, 'Checking for existing files...');
                    try {
                        const checkPath = `${folderPath}/${newFileName}`;
                        const existingFile = await fetch(
                            `https://api.github.com/repos/Akhinoor14/SOLIDWORKS-Projects/contents/${checkPath}`,
                            {
                                headers: {
                                    'Authorization': `token ${gitToken}`,
                                    'Accept': 'application/vnd.github.v3+json'
                                }
                            }
                        );
                        
                        if (existingFile.ok) {
                            const proceed = confirm(`‚ö†Ô∏è File "${newFileName}" already exists in ${folderPath}.\n\nDo you want to overwrite it?`);
                            if (!proceed) {
                                uploadProgress.style.display = 'none';
                                uploadModelBtn.disabled = false;
                                return;
                            }
                        }
                    } catch (e) {
                        // 404 means file doesn't exist - that's fine
                    }

                    // Upload GLB file with proper name
                    updateProgress(45, `Uploading ${newFileName}...`);
                    const fileContent = await readFileAsBase64(glbFile);
                    const glbPath = `${folderPath}/${newFileName}`;
                    
                    await uploader.uploadFile(glbPath, fileContent, `Add 3D model: ${newFileName}`);
                    updateProgress(75, 'Creating README...');

                    // Generate README
                    const readmePath = `${folderPath}/README.md`;
                    const readmeContent = generateREADME(projectName, newFileName, projectType, folderPath, glbFile.size);
                    await uploader.uploadTextFile(readmePath, readmeContent, 'Add/update README with 3D model info');

                    updateProgress(100, 'Upload complete!');

                    // Save token on successful upload
                    localStorage.setItem('dashboard_github_token', gitToken);

                    // Success
                    setTimeout(() => {
                        showSuccess(`‚úÖ Successfully uploaded as "${newFileName}" to ${folderPath}!\n\nThe "View 3D" button will appear automatically on mobile pages.`);
                        uploadProgress.style.display = 'none';
                        uploadModelBtn.disabled = false;
                        resetUploadForm();
                    }, 1000);

                } catch (error) {
                    console.error('Upload error:', error);
                    
                    let errorMsg = 'Upload failed: ';
                    if (!navigator.onLine) {
                        errorMsg += 'No internet connection. Please check your network.';
                    } else if (error.message.includes('token') || error.message.includes('401')) {
                        errorMsg += 'Invalid GitHub token. Please check your token and try again.';
                    } else if (error.message.includes('404')) {
                        errorMsg += 'Repository not found. Please verify repository name.';
                    } else if (error.message.includes('403')) {
                        errorMsg += 'Access denied. Please check token permissions (repo scope required).';
                    } else {
                        errorMsg += error.message;
                    }
                    
                    showError(errorMsg);
                    uploadProgress.style.display = 'none';
                    uploadModelBtn.disabled = false;
                }
            });
        }

        function updateProgress(percent, text) {
            document.getElementById('uploadProgressBar').style.width = percent + '%';
            document.getElementById('uploadStatusText').textContent = text;
        }

        function showSuccess(message) {
            uploadSuccessMsg.textContent = message;
            uploadSuccessMsg.style.display = 'block';
            setTimeout(() => {
                uploadSuccessMsg.style.display = 'none';
            }, 8000);
        }

        function showError(message) {
            uploadErrorMsg.textContent = message;
            uploadErrorMsg.style.display = 'block';
            setTimeout(() => {
                uploadErrorMsg.style.display = 'none';
            }, 6000);
        }

        function saveGitHubToken() {
            const tokenInput = document.getElementById('uploadGitToken');
            const token = tokenInput.value.trim();
            
            if (!token) {
                showError('Please enter a token first');
                return;
            }
            
            // Basic token format validation
            if (!token.startsWith('ghp_') && !token.startsWith('github_pat_')) {
                if (!confirm('‚ö†Ô∏è Token format looks unusual. GitHub tokens usually start with "ghp_" or "github_pat_". Continue anyway?')) {
                    return;
                }
            }
            
            localStorage.setItem('dashboard_github_token', token);
            
            const statusDiv = document.getElementById('tokenStatus');
            const statusText = document.getElementById('tokenStatusText');
            statusDiv.style.display = 'block';
            statusDiv.style.background = 'rgba(0, 204, 0, 0.1)';
            statusDiv.style.border = '1px solid rgba(0, 204, 0, 0.3)';
            statusDiv.style.color = '#00cc00';
            statusText.textContent = 'Token saved successfully! It will be auto-filled next time.';
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 4000);
        }
        
        function loadSavedToken() {
            const savedToken = localStorage.getItem('dashboard_github_token');
            if (savedToken) {
                document.getElementById('uploadGitToken').value = savedToken;
                const statusDiv = document.getElementById('tokenStatus');
                const statusText = document.getElementById('tokenStatusText');
                statusDiv.style.display = 'block';
                statusDiv.style.background = 'rgba(0, 204, 0, 0.1)';
                statusDiv.style.border = '1px solid rgba(0, 204, 0, 0.3)';
                statusDiv.style.color = '#00cc00';
                statusText.textContent = 'Saved token loaded automatically';
                
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 3000);
            }
        }

        function resetUploadForm() {
            document.getElementById('uploadGLBFile').value = '';
            document.getElementById('uploadDay').value = '';
            document.getElementById('uploadNumber').value = '';
            document.getElementById('uploadProjectName').value = '';
            uploadProgress.style.display = 'none';
            uploadSuccessMsg.style.display = 'none';
            uploadErrorMsg.style.display = 'none';
        }

        function readFileAsBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => {
                    const base64 = reader.result.split(',')[1];
                    resolve(base64);
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        function generateREADME(projectName, fileName, projectType, folderPath, fileSize) {
            const date = new Date().toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            const sizeMB = fileSize ? (fileSize / (1024 * 1024)).toFixed(2) : 'N/A';
            
            return `# ${projectName}

**Project Type:** ${projectType}  
**Upload Date:** ${date}  
**Location:** \`${folderPath}\`  
**Status:** ‚úÖ Complete

## üì¶ Files

### 3D Model
- **Filename:** \`${fileName}\`
- **Format:** ${fileName.endsWith('.glb') ? 'GLB (Binary glTF)' : 'GLTF (JSON glTF)'}
- **Size:** ${sizeMB} MB
- **Features:**
  - ‚úÖ Interactive 3D viewer on mobile
  - ‚úÖ AR support (Android/iOS)
  - ‚úÖ Camera controls (rotate, zoom, pan)
  - ‚úÖ Full-screen immersive mode

## üéØ Viewer Features

- **Renderer:** Google Model Viewer (WebGL)
- **Mobile:** Touch-optimized controls
- **Desktop:** Mouse/trackpad support  
- **AR Mode:** WebXR (Android) + Quick Look (iOS)
- **Performance:** Auto-optimized, lazy-loaded

## üì± How to View

1. **Open mobile page:**
   - CW ‚Üí Class Work ‚Üí Expand day
   - HW ‚Üí Home Work ‚Üí Expand day
   - Solo ‚Üí Solo Projects ‚Üí Find project
2. **Look for cube icon** (üéØ)
3. **Tap to open** 3D viewer
4. **Interact:**
   - Drag to rotate
   - Pinch to zoom
   - Two fingers to pan
5. **Try AR mode** on compatible devices!

## üõ†Ô∏è Technical Details

- **Repository:** [SOLIDWORKS-Projects](https://github.com/Akhinoor14/SOLIDWORKS-Projects)
- **Full Path:** \`${folderPath}/${fileName}\`
- **Auto-Detection:** ‚úÖ Enabled
- **Caching:** Service worker optimized
- **CDN:** GitHub raw content delivery

---

**Uploaded via:** A3KM Studio Only Boss Dashboard  
**System:** Automated 3D Model Pipeline v2.0  
**Date:** ${date}
`;
        }

        // Dashboard logout button logic
        var logoutBtn = document.getElementById('dashboardLogoutBtn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', function() {
                sessionStorage.removeItem('bossAuth');
                localStorage.removeItem('bossAuth');
                window.location.href = 'only-boss.html';
            });
        }
    });
    </script>
    </body>
    </html>
