<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Educational Videos Manager - A3KM Studio</title>
  <link rel="stylesheet" href="../../../Optimization/mobile-universal.css">
  <script src="../../../Optimization/mobile-universal.js" defer></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #1a1a1a; background-image: linear-gradient(rgba(200, 0, 0, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(200, 0, 0, 0.05) 1px, transparent 1px); background-size: 100px 100px; min-height: 100vh; }
    .container { display: flex; min-height: 100vh; background: white; }
    .sidebar { width: 280px; background: linear-gradient(180deg, #1a1a1a 0%, #2d2d2d 100%); padding: 0; position: sticky; top: 0; height: 100vh; overflow-y: auto; border-right: 4px solid #8B0000; }
    .sidebar-header { background: linear-gradient(135deg, #8B0000, #C80000); padding: 30px 20px; color: white; }
    .sidebar-header h1 { font-size: 22px; margin-bottom: 5px; }
    .sidebar-header p { font-size: 12px; opacity: 0.9; }
    .sidebar-nav { padding: 20px 0; }
    .tab-item { display: flex; align-items: center; gap: 12px; padding: 15px 25px; color: #ccc; cursor: pointer; transition: all 0.3s; border-left: 4px solid transparent; font-weight: 600; font-size: 14px; }
    .tab-item:hover { background: rgba(139, 0, 0, 0.1); color: white; }
    .tab-item.active { background: rgba(139, 0, 0, 0.2); color: white; border-left-color: #8B0000; }
    .quick-stats { padding: 20px; background: rgba(139, 0, 0, 0.1); margin: 20px; border-radius: 10px; }
    .quick-stats h3 { color: #ccc; font-size: 12px; text-transform: uppercase; margin-bottom: 15px; letter-spacing: 1px; }
    .stat-item { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; color: #fff; }
    .stat-value { font-weight: 700; color: #8B0000; font-size: 18px; }
    .main-content { flex: 1; background: #f8f9fa; padding: 40px; overflow-y: auto; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; background: white; padding: 25px 30px; border-radius: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .back-btn { background: rgba(139, 0, 0, 0.1); border: 2px solid #8B0000; padding: 10px 20px; border-radius: 10px; color: #8B0000; font-weight: 600; cursor: pointer; text-decoration: none; }
    .back-btn:hover { background: #8B0000; color: white; }
    h1 { color: #8B0000; font-size: 32px; margin-bottom: 10px; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .form-group { margin-bottom: 20px; }
    label { display: block; margin-bottom: 8px; color: #333; font-weight: 600; font-size: 14px; }
    input, select, textarea { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 14px; font-family: inherit; }
    input:focus, select:focus, textarea:focus { outline: none; border-color: #8B0000; }
    textarea { resize: vertical; min-height: 100px; }
    .btn-primary { padding: 15px 30px; background: linear-gradient(135deg, #8B0000, #C80000); color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; width: 100%; margin-top: 20px; }
    .btn-primary:hover { opacity: 0.9; }
    .bulk-actions { display: flex; gap: 10px; margin-bottom: 20px; align-items: center; padding: 15px; background: white; border-radius: 10px; }
    .bulk-actions button { padding: 10px 20px; border: 2px solid #8B0000; background: white; color: #8B0000; border-radius: 8px; cursor: pointer; font-weight: 600; }
    .bulk-actions button:hover { background: #8B0000; color: white; }
    .bulk-actions .selected-count { color: #8B0000; font-weight: 700; margin-left: auto; }
    .content-card { position: relative; border: 2px solid #e0e0e0; border-radius: 12px; overflow: hidden; transition: all 0.3s; background: white; }
    .content-card:hover { border-color: #8B0000; box-shadow: 0 4px 12px rgba(139, 0, 0, 0.2); }
    .content-card input[type="checkbox"] { position: absolute; top: 10px; left: 10px; width: 20px; height: 20px; cursor: pointer; z-index: 10; }
    .content-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
    .card-thumbnail { width: 100%; height: 180px; object-fit: cover; background: linear-gradient(135deg, #8B0000, #C80000); }
    .card-body { padding: 15px; }
    .card-title { font-weight: 600; color: #333; margin-bottom: 8px; font-size: 16px; }
    .card-meta { font-size: 12px; color: #666; margin-bottom: 10px; line-height: 1.6; }
    .card-actions { display: flex; gap: 8px; }
    .card-actions button { flex: 1; padding: 8px; border: 1px solid #e0e0e0; background: white; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 600; }
    .card-actions button:hover { background: #8B0000; color: white; border-color: #8B0000; }
    .pagination { display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 30px; }
    .pagination button { padding: 10px 20px; border: 2px solid #8B0000; background: white; color: #8B0000; border-radius: 8px; cursor: pointer; font-weight: 600; }
    .pagination button:hover:not(:disabled) { background: #8B0000; color: white; }
    .pagination button:disabled { opacity: 0.5; cursor: not-allowed; border-color: #ccc; color: #ccc; }
    .pagination .page-info { color: #666; font-weight: 600; }
    .course-badge { display: inline-block; padding: 4px 8px; border-radius: 5px; font-size: 11px; font-weight: 600; margin-right: 5px; }
    .badge-episodes { background: #2196f3; color: white; }
    .badge-duration { background: #ff9800; color: white; }
    .badge-enrolled { background: #4caf50; color: white; }
    .badge-views { background: #9c27b0; color: white; }
    .badge-beginner { background: #4caf50; color: white; }
    .badge-intermediate { background: #ff9800; color: white; }
    .badge-advanced { background: #f44336; color: white; }
    .filter-group { display: flex; gap: 10px; margin-bottom: 20px; }
    .filter-group select, .filter-group input { padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; flex: 1; }
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; overflow-y: auto; }
    .modal.active { display: block; }
    .modal-content { max-width: 900px; margin: 40px auto; background: white; border-radius: 20px; padding: 40px; position: relative; }
    .modal-close { position: absolute; top: 20px; right: 20px; background: #f44336; color: white; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 20px; }
    .modal-close:hover { background: #d32f2f; }
    .playlist-section { margin-top: 20px; padding: 20px; background: #f5f5f5; border-radius: 10px; }
    .playlist-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
    .episode-item { background: white; padding: 15px; margin-bottom: 10px; border-radius: 8px; border: 2px solid #e0e0e0; display: flex; justify-content: space-between; align-items: center; }
    .episode-actions { display: flex; gap: 8px; }
    .episode-actions button { padding: 6px 12px; border: 1px solid #e0e0e0; background: white; border-radius: 6px; cursor: pointer; font-size: 12px; }
    .episode-actions button:hover { background: #8B0000; color: white; }
    .episode-serial {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 32px;
      height: 32px;
      background: linear-gradient(135deg, #8B0000, #DC143C);
      color: white;
      border-radius: 50%;
      font-weight: bold;
      font-size: 14px;
      margin-right: 12px;
      box-shadow: 0 2px 5px rgba(139, 0, 0, 0.2);
    }
    .btn-fetch {
      transition: all 0.3s ease;
    }
    .btn-fetch:hover {
      background: #cc0000 !important;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(255, 0, 0, 0.3);
    }
    .btn-fetch:disabled {
      background: #999 !important;
      cursor: not-allowed;
      transform: none;
    }
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px; }
    .stat-card { background: linear-gradient(135deg, #8B0000, #C80000); color: white; padding: 20px; border-radius: 12px; text-align: center; }
    .stat-card h3 { font-size: 32px; margin-bottom: 5px; }
    .stat-card p { font-size: 14px; opacity: 0.9; }
    .progress { margin-top: 20px; display: none; }
    .progress.active { display: block; }
    .progress-bar { width: 100%; height: 8px; background: #f0f0f0; border-radius: 4px; overflow: hidden; margin-bottom: 10px; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, #8B0000, #C80000); width: 0%; transition: width 0.3s; }
    .progress-text { text-align: center; color: #8B0000; font-size: 14px; font-weight: 600; }
    
    /* JSON Editor */
    .json-editor-container { display: flex; flex-direction: column; gap: 15px; }
    .json-actions { display: flex; gap: 10px; }
    .json-actions button { padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s; border: 2px solid; }
    .btn-validate { background: rgba(33, 150, 243, 0.1); border-color: #2196F3; color: #2196F3; }
    .btn-validate:hover { background: #2196F3; color: white; }
    .btn-format { background: rgba(255, 152, 0, 0.1); border-color: #FF9800; color: #FF9800; }
    .btn-format:hover { background: #FF9800; color: white; }
    .btn-save-json { background: rgba(76, 175, 80, 0.1); border-color: #4CAF50; color: #4CAF50; }
    .btn-save-json:hover { background: #4CAF50; color: white; }
    #jsonEditor { min-height: 500px; font-family: 'Consolas', 'Monaco', monospace; font-size: 13px; line-height: 1.6; }
  </style>
</head>
<body>
  <div class="container">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <h1>üéì Educational Videos</h1>
        <p>Course Management System</p>
      </div>
      <div class="sidebar-nav">
        <div class="tab-item active" onclick="switchTab('dashboard')">üìä Dashboard</div>
        <div class="tab-item" onclick="switchTab('upload')">üì§ Upload Course</div>
        <div class="tab-item" onclick="switchTab('manage')">üìã Manage Courses</div>
        <div class="tab-item" onclick="switchTab('stats')">üìà Statistics</div>
        <div class="tab-item" onclick="switchTab('json')">‚öôÔ∏è JSON Editor</div>
      </div>
      <div class="quick-stats">
        <h3>Quick Stats</h3>
        <div class="stat-item">
          <span>Total Courses</span>
          <span class="stat-value" id="quickTotalCourses">0</span>
        </div>
        <div class="stat-item">
          <span>Total Episodes</span>
          <span class="stat-value" id="quickTotalEpisodes">0</span>
        </div>
        <div class="stat-item">
          <span>Total Enrolled</span>
          <span class="stat-value" id="quickTotalEnrolled">0</span>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <div class="header">
        <div>
          <h1>Educational Videos Manager</h1>
          <p style="color: #666;">Manage educational courses and learning content</p>
        </div>
        <a href="content-hub.html" class="back-btn">‚Üê Back to Hub</a>
      </div>

      <!-- DASHBOARD TAB -->
      <div id="dashboardTab" class="tab-content active">
        <div class="stats-grid">
          <div class="stat-card">
            <h3 id="dashTotalCourses">0</h3>
            <p>Total Courses</p>
          </div>
          <div class="stat-card">
            <h3 id="dashTotalEpisodes">0</h3>
            <p>Total Episodes</p>
          </div>
          <div class="stat-card">
            <h3 id="dashTotalEnrolled">0</h3>
            <p>Total Enrolled</p>
          </div>
          <div class="stat-card">
            <h3 id="dashTotalViews">0</h3>
            <p>Total Views</p>
          </div>
        </div>
        <div style="background: white; padding: 30px; border-radius: 15px;">
          <h2 style="color: #8B0000; margin-bottom: 20px;">üìö Quick Guide</h2>
          <ul style="line-height: 2; color: #666;">
            <li><strong>Upload Course:</strong> Create new educational course with episodes and playlists</li>
            <li><strong>Manage Courses:</strong> Edit, delete, or update existing courses and episodes</li>
            <li><strong>Bulk Operations:</strong> Select multiple courses for bulk actions</li>
            <li><strong>Playlist Editor:</strong> Add, edit, or reorder course episodes</li>
            <li><strong>Advanced Filters:</strong> Filter by difficulty, episodes, duration, or enrollment</li>
          </ul>
        </div>
      </div>

      <!-- UPLOAD TAB -->
      <div id="uploadTab" class="tab-content">
        <form id="uploadForm">
          <div class="form-group">
            <label>Category</label>
            <select id="category" required>
              <option value="">Select category...</option>
            </select>
          </div>

          <div class="form-group">
            <label>Course Title</label>
            <input type="text" id="title" placeholder="Complete Arduino Programming Course" required>
          </div>

          <div class="form-group">
            <label>Course Summary</label>
            <textarea id="summary" placeholder="Detailed course description..." rows="4" required></textarea>
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div class="form-group">
              <label>Number of Episodes</label>
              <input type="number" id="episodes" placeholder="0" min="0" readonly style="background: #f5f5f5; cursor: not-allowed;">
              <small style="color: #999; font-size: 12px;">Auto-calculated from playlist</small>
            </div>
            <div class="form-group">
              <label>Total Duration</label>
              <input type="text" id="duration" placeholder="0h 0m" readonly style="background: #f5f5f5; cursor: not-allowed;">
              <small style="color: #999; font-size: 12px;">Auto-calculated from episodes</small>
            </div>
          </div>

          <!-- Upload Playlist Section -->
          <div class="playlist-section" style="margin-top: 30px;">
            <div class="playlist-header">
              <h3 style="color: #8B0000;">üìö Course Playlist (Add Episodes)</h3>
              <button type="button" onclick="addUploadEpisode()" style="padding: 8px 16px; background: #8B0000; color: white; border: none; border-radius: 6px; cursor: pointer;">+ Add Episode</button>
            </div>
            <div id="uploadPlaylistContainer">
              <p style="text-align: center; color: #999; padding: 20px;">No episodes yet. Click "Add Episode" to start building your course.</p>
            </div>
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div class="form-group">
              <label>Difficulty Level</label>
              <select id="difficulty" required>
                <option value="Beginner">üü¢ Beginner</option>
                <option value="Intermediate">üü† Intermediate</option>
                <option value="Beginner to Intermediate">üü¢üü† Beginner to Intermediate</option>
                <option value="Advanced">üî¥ Advanced</option>
              </select>
            </div>
            <div class="form-group">
              <label>Language</label>
              <select id="language" required>
                <option value="en" selected>üá¨üáß English</option>
                <option value="bn">üáßüá© Bengali (‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ)</option>
                <option value="bn-en">üáßüá©üá¨üáß Bengali-English Mix</option>
                <option value="hi">üáÆüá≥ Hindi (‡§π‡§ø‡§®‡•ç‡§¶‡•Ä)</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>Institution/Platform</label>
            <input type="text" id="institution" placeholder="A3KM Studio" value="A3KM Studio" required>
          </div>

          <div class="form-group">
            <label>Tags (comma-separated)</label>
            <input type="text" id="tags" placeholder="arduino, programming, embedded, tutorial">
          </div>

          <div class="form-group">
            <label>Thumbnail</label>
            <input type="file" id="thumbnail" accept="image/*">
          </div>

          <button type="submit" class="btn-primary">üì§ Upload Course</button>

          <div class="progress" id="progress">
            <div class="progress-bar">
              <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">Processing...</div>
          </div>
        </form>
      </div>

      <!-- MANAGE TAB -->
      <div id="manageTab" class="tab-content">
        <div class="bulk-actions">
          <button onclick="selectAll()">‚úÖ Select All</button>
          <button onclick="deselectAll()">‚ùå Deselect All</button>
          <button onclick="bulkDelete()" style="background: #f44336; color: white; border-color: #f44336;">üóëÔ∏è Delete Selected</button>
          <span class="selected-count">Selected: <span id="selectedCount">0</span></span>
        </div>

        <div class="filter-group">
          <input type="text" id="searchInput" placeholder="üîç Search courses..." onkeyup="filterContent()">
          <select id="filterDifficulty" onchange="filterContent()">
            <option value="">All Difficulties</option>
            <option value="Beginner">üü¢ Beginner</option>
            <option value="Intermediate">üü† Intermediate</option>
            <option value="Beginner to Intermediate">üü¢üü† Beginner to Intermediate</option>
            <option value="Advanced">üî¥ Advanced</option>
          </select>
          <select id="sortBy" onchange="filterContent()">
            <option value="date">Newest First</option>
            <option value="title">Title A-Z</option>
            <option value="episodes">Most Episodes</option>
            <option value="enrolled">Most Enrolled</option>
            <option value="views">Most Viewed</option>
          </select>
        </div>

        <div class="content-grid" id="contentGrid">
          <p style="text-align: center; padding: 40px; color: #999;">Loading courses...</p>
        </div>

        <div class="pagination">
          <button id="prevPage" onclick="changePage(-1)">‚Üê Previous</button>
          <span class="page-info">Page <span id="currentPage">1</span> of <span id="totalPages">1</span></span>
          <button id="nextPage" onclick="changePage(1)">Next ‚Üí</button>
        </div>
      </div>

      <!-- STATISTICS TAB -->
      <div id="statsTab" class="tab-content">
        <div class="stats-grid">
          <div class="stat-card">
            <h3 id="totalCourses">0</h3>
            <p>Total Courses</p>
          </div>
          <div class="stat-card">
            <h3 id="totalCategories">0</h3>
            <p>Categories</p>
          </div>
          <div class="stat-card">
            <h3 id="avgEpisodes">0</h3>
            <p>Avg Episodes/Course</p>
          </div>
          <div class="stat-card">
            <h3 id="totalDuration">0h</h3>
            <p>Total Duration</p>
          </div>
        </div>
      </div>

      <!-- JSON EDITOR TAB -->
      <div id="jsonTab" class="tab-content">
        <h2 style="color: #8B0000; font-size: 1.8rem; margin-bottom: 20px;">‚öôÔ∏è JSON Editor</h2>
        <p style="color: #666; margin-bottom: 20px;">‚ö†Ô∏è <strong>Advanced Users Only:</strong> Direct JSON manipulation. Invalid JSON will break the system!</p>
        
        <div class="json-editor-container">
          <div class="json-actions">
            <button class="btn-validate" onclick="validateJSON()">‚úì Validate JSON</button>
            <button class="btn-format" onclick="formatJSON()">‚ú® Format JSON</button>
            <button class="btn-save-json" onclick="saveJSON()">üíæ Save Changes</button>
          </div>
          <textarea id="jsonEditor" placeholder="Loading JSON data..."></textarea>
        </div>
      </div>

      <!-- JSON EDITOR TAB -->
      <div id="jsonTab" class="tab-content">
        <h2 style="color: #8B0000; font-size: 1.8rem; margin-bottom: 20px;">‚öôÔ∏è JSON Editor</h2>
        <p style="color: #666; margin-bottom: 20px;">‚ö†Ô∏è <strong>Advanced Users Only:</strong> Direct JSON manipulation. Invalid JSON will break the system!</p>
        
        <div class="json-editor-container">
          <div class="json-actions">
            <button class="btn-validate" onclick="validateJSON()">‚úì Validate JSON</button>
            <button class="btn-format" onclick="formatJSON()">‚ú® Format JSON</button>
            <button class="btn-save-json" onclick="saveJSON()">üíæ Save Changes</button>
          </div>
          <textarea id="jsonEditor" placeholder="Loading JSON data..."></textarea>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Modal -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeEditModal()">√ó</button>
      <h2 style="color: #8B0000; margin-bottom: 20px;">‚úèÔ∏è Edit Course</h2>
      <form id="editForm">
        <input type="hidden" id="editCourseId">

        <div class="form-group">
          <label>Category</label>
          <select id="editCategory" required>
            <option value="">Loading categories...</option>
          </select>
        </div>

        <div class="form-group">
          <label>Course Title</label>
          <input type="text" id="editTitle" required>
        </div>

        <div class="form-group">
          <label>Summary</label>
          <textarea id="editSummary" rows="3" required></textarea>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
          <div class="form-group">
            <label>Episodes</label>
            <input type="number" id="editEpisodes" min="1" required>
          </div>
          <div class="form-group">
            <label>Duration</label>
            <input type="text" id="editDuration" placeholder="3h 45m" required>
          </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
          <div class="form-group">
            <label>Difficulty</label>
            <select id="editDifficulty" required>
              <option value="Beginner">üü¢ Beginner</option>
              <option value="Intermediate">üü† Intermediate</option>
              <option value="Beginner to Intermediate">üü¢üü† Beginner to Intermediate</option>
              <option value="Advanced">üî¥ Advanced</option>
            </select>
          </div>
          <div class="form-group">
            <label>Language</label>
            <select id="editLanguage" required>
              <option value="en">üá¨üáß English</option>
              <option value="bn">üáßüá© Bengali</option>
              <option value="bn-en">üáßüá©üá¨üáß Mixed</option>
              <option value="hi">üáÆüá≥ Hindi</option>
            </select>
          </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
          <div class="form-group">
            <label>Views</label>
            <input type="number" id="editViews" min="0">
          </div>
          <div class="form-group">
            <label>Enrolled</label>
            <input type="number" id="editEnrolled" min="0">
          </div>
        </div>

        <div class="form-group">
          <label>Institution</label>
          <input type="text" id="editInstitution" required>
        </div>

        <div class="form-group">
          <label>Tags (comma-separated)</label>
          <input type="text" id="editTags">
        </div>

        <!-- Playlist Section -->
        <div class="playlist-section">
          <div class="playlist-header">
            <h3 style="color: #8B0000;">üìö Course Playlist</h3>
            <button type="button" onclick="addEpisode()" style="padding: 8px 16px; background: #8B0000; color: white; border: none; border-radius: 6px; cursor: pointer;">+ Add Episode</button>
          </div>
          <div id="playlistContainer">
            <!-- Episodes will be loaded here -->
          </div>
        </div>

        <button type="submit" class="btn-primary">üíæ Update Course</button>
      </form>
    </div>
  </div>

  <!-- Episode Modal -->
  <div id="episodeModal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
      <button class="modal-close" onclick="closeEpisodeModal()">√ó</button>
      <h2 style="color: #8B0000; margin-bottom: 20px;" id="episodeModalTitle">Add Episode</h2>
      <form id="episodeForm">
        <input type="hidden" id="episodeIndex">
        
        <div class="form-group">
          <label>Episode Number</label>
          <input type="number" id="episodeNo" min="1" required>
        </div>
        
        <div class="form-group">
          <label>Episode Title</label>
          <input type="text" id="episodeTitle" placeholder="Introduction to Arduino" required>
        </div>
        
        <div class="form-group">
          <label>Episode Description (Optional)</label>
          <textarea id="episodeDescription" placeholder="Brief episode description..." rows="2"></textarea>
        </div>
        
        <div class="form-group">
          <label>Duration (MM:SS or HH:MM:SS)</label>
          <input type="text" id="episodeDuration" placeholder="15:30" pattern="^\d{1,2}:\d{2}(:\d{2})?$" required>
          <small style="color: #999; font-size: 12px;">Format: 15:30 or 1:30:45</small>
        </div>
        
        <div class="form-group">
          <label>YouTube URL (Optional)</label>
          <div style="display: flex; gap: 10px;">
            <input type="url" id="episodeYoutubeUrl" placeholder="https://youtu.be/VIDEO_ID" style="flex: 1;">
            <button type="button" onclick="fetchYouTubeData()" class="btn-fetch" style="padding: 10px 20px; background: #ff0000; color: white; border: none; border-radius: 6px; cursor: pointer; white-space: nowrap;">üì∫ Fetch Data</button>
          </div>
          <small style="color: #999; font-size: 12px;">Auto-fetch video details from YouTube</small>
        </div>
        
        <div class="form-group">
          <label>Video ID</label>
          <input type="text" id="episodeVideoId" placeholder="video-001" required>
        </div>
        
        <div class="form-group">
          <label>Episode Tags (comma-separated, optional)</label>
          <input type="text" id="episodeTags" placeholder="basics, introduction, setup">
        </div>
        
        <button type="submit" class="btn-primary">üíæ Save Episode</button>
      </form>
    </div>
  </div>

  <script src="github-content-uploader.js"></script>
  <script src="content-manager.js"></script>
  <script src="youtube-integration.js"></script>
  <script>
    const GITHUB_TOKEN = 'YOUR_GITHUB_TOKEN_HERE';
    const CONTENT_TYPE = 'educational-videos';
    
    const githubUploader = new GitHubContentUploader({
      token: GITHUB_TOKEN,
      owner: 'Akhinoor14',
      repo: 'A3KM-Studio',
      onProgress: (data) => { document.getElementById('progressFill').style.width = '60%'; },
      onError: (error) => alert('Error: ' + error.error)
    });
    
    const contentManager = new ContentManager(githubUploader);
    let currentContent = [];
    let filteredContent = [];
    let selectedCourses = new Set();
    let currentPage = 1;
    let currentPlaylist = [];
    const ITEMS_PER_PAGE = 12;

    function switchTab(tabName) {
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab-item').forEach(btn => btn.classList.remove('active'));
      document.getElementById(tabName + 'Tab').classList.add('active');
      event.target.classList.add('active');
      if (tabName === 'manage') { loadManageContent(); resetPagination(); }
      if (tabName === 'stats') loadStatistics();
      if (tabName === 'dashboard') loadDashboard();
      if (tabName === 'json') loadJSONEditor();
    }

    function resetPagination() {
      currentPage = 1;
      selectedCourses.clear();
      updateSelectedCount();
    }

    async function loadCategories() {
      try {
        const data = await contentManager.loadContent(CONTENT_TYPE);
        const categorySelect = document.getElementById('category');
        const editCategorySelect = document.getElementById('editCategory');
        
        categorySelect.innerHTML = '<option value="">Select category...</option>';
        editCategorySelect.innerHTML = '<option value="">Select category...</option>';
        
        if (data.categoryGroups && Array.isArray(data.categoryGroups)) {
          data.categoryGroups.forEach(group => {
            const optgroup = document.createElement('optgroup');
            optgroup.label = `${group.icon} ${group.name}`;
            
            if (group.categories) {
              group.categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                optgroup.appendChild(option);
              });
            }
            categorySelect.appendChild(optgroup.cloneNode(true));
            editCategorySelect.appendChild(optgroup);
          });
        }
      } catch (error) {
        console.error('Failed to load categories:', error);
      }
    }

    async function loadManageContent() {
      const grid = document.getElementById('contentGrid');
      grid.innerHTML = '<p style="text-align: center; padding: 40px; color: #999;">Loading...</p>';
      try {
        const data = await contentManager.loadContent(CONTENT_TYPE);
        currentContent = data.courses || [];
        filterContent();
      } catch (error) {
        grid.innerHTML = '<p style="text-align: center; padding: 40px; color: #f44336;">Failed to load</p>';
      }
    }

    function renderContent(items) {
      const grid = document.getElementById('contentGrid');
      filteredContent = items;
      
      if (items.length === 0) {
        grid.innerHTML = '<p style="text-align: center; padding: 40px; color: #999;">No courses found</p>';
        updatePaginationControls(0);
        return;
      }
      
      const totalPages = Math.ceil(items.length / ITEMS_PER_PAGE);
      const startIdx = (currentPage - 1) * ITEMS_PER_PAGE;
      const endIdx = startIdx + ITEMS_PER_PAGE;
      const pageItems = items.slice(startIdx, endIdx);
      
      grid.innerHTML = '';
      pageItems.forEach(item => {
        const isSelected = selectedCourses.has(item.id);
        const card = document.createElement('div');
        card.className = 'content-card';
        
        const difficultyClass = item.difficulty === 'Beginner' ? 'badge-beginner' : 
                                item.difficulty === 'Intermediate' ? 'badge-intermediate' : 
                                item.difficulty === 'Advanced' ? 'badge-advanced' : 'badge-intermediate';
        
        const badges = [];
        badges.push(`<span class="course-badge badge-episodes">üìö ${item.episodes || 0} episodes</span>`);
        badges.push(`<span class="course-badge badge-duration">‚è±Ô∏è ${item.duration}</span>`);
        badges.push(`<span class="course-badge ${difficultyClass}">${item.difficulty}</span>`);
        if (item.enrolled > 0) badges.push(`<span class="course-badge badge-enrolled">üë• ${item.enrolled}</span>`);
        if (item.views > 0) badges.push(`<span class="course-badge badge-views">üëÅÔ∏è ${item.views}</span>`);
        
        card.innerHTML = `
          <input type="checkbox" ${isSelected ? 'checked' : ''} onchange="toggleSelect('${item.id}')">
          <img src="${item.thumbnail || ''}" class="card-thumbnail" onerror="this.style.background='linear-gradient(135deg, #8B0000, #C80000)'">
          <div class="card-body">
            <div style="margin-bottom: 8px;">${badges.join(' ')}</div>
            <div class="card-title">${item.title}</div>
            <div class="card-meta">
              üìÅ ${item.category}<br>
              üèõÔ∏è ${item.institution}<br>
              üóìÔ∏è ${contentManager.formatDate(item.date)}
            </div>
            <div class="card-actions">
              <button onclick="editCourse('${item.id}')">‚úèÔ∏è Edit</button>
              <button onclick="deleteCourse('${item.id}')" style="color: #f44336;">üóëÔ∏è Delete</button>
            </div>
          </div>
        `;
        grid.appendChild(card);
      });
      
      updatePaginationControls(totalPages);
    }

    function updatePaginationControls(totalPages) {
      document.getElementById('currentPage').textContent = currentPage;
      document.getElementById('totalPages').textContent = totalPages;
      document.getElementById('prevPage').disabled = currentPage === 1;
      document.getElementById('nextPage').disabled = currentPage >= totalPages || totalPages === 0;
    }

    function changePage(delta) {
      const totalPages = Math.ceil(filteredContent.length / ITEMS_PER_PAGE);
      const newPage = currentPage + delta;
      if (newPage >= 1 && newPage <= totalPages) {
        currentPage = newPage;
        renderContent(filteredContent);
      }
    }

    function filterContent() {
      const query = document.getElementById('searchInput').value.toLowerCase();
      const sortBy = document.getElementById('sortBy').value;
      const difficulty = document.getElementById('filterDifficulty').value;
      
      let filtered = currentContent.filter(item => {
        const matchSearch = !query || 
          item.title.toLowerCase().includes(query) ||
          item.summary?.toLowerCase().includes(query) ||
          item.category.toLowerCase().includes(query) ||
          (item.tags && item.tags.some(tag => tag.toLowerCase().includes(query)));
        
        const matchDifficulty = !difficulty || item.difficulty === difficulty;
        
        return matchSearch && matchDifficulty;
      });
      
      filtered.sort((a, b) => {
        if (sortBy === 'date') return new Date(b.date) - new Date(a.date);
        if (sortBy === 'title') return a.title.localeCompare(b.title);
        if (sortBy === 'episodes') return (b.episodes || 0) - (a.episodes || 0);
        if (sortBy === 'enrolled') return (b.enrolled || 0) - (a.enrolled || 0);
        if (sortBy === 'views') return (b.views || 0) - (a.views || 0);
        return 0;
      });
      
      currentPage = 1;
      renderContent(filtered);
    }

    function toggleSelect(id) {
      if (selectedCourses.has(id)) {
        selectedCourses.delete(id);
      } else {
        selectedCourses.add(id);
      }
      updateSelectedCount();
    }

    function selectAll() {
      const startIdx = (currentPage - 1) * ITEMS_PER_PAGE;
      const endIdx = startIdx + ITEMS_PER_PAGE;
      const pageItems = filteredContent.slice(startIdx, endIdx);
      pageItems.forEach(item => selectedCourses.add(item.id));
      updateSelectedCount();
      renderContent(filteredContent);
    }

    function deselectAll() {
      selectedCourses.clear();
      updateSelectedCount();
      renderContent(filteredContent);
    }

    function updateSelectedCount() {
      document.getElementById('selectedCount').textContent = selectedCourses.size;
    }

    async function bulkDelete() {
      if (selectedCourses.size === 0) {
        alert('‚ö†Ô∏è No courses selected!');
        return;
      }
      
      const confirmed = confirm(`‚ö†Ô∏è Delete ${selectedCourses.size} course(s)?\n\nThis action cannot be undone!`);
      if (!confirmed) return;
      
      const progress = document.getElementById('progress');
      const progressText = document.getElementById('progressText');
      const progressFill = document.getElementById('progressFill');
      
      progress.classList.add('active');
      progressText.textContent = `Deleting 0/${selectedCourses.size}...`;
      
      let deleted = 0;
      const coursesToDelete = Array.from(selectedCourses);
      
      for (const id of coursesToDelete) {
        try {
          await contentManager.deleteContent(CONTENT_TYPE, id);
          deleted++;
          progressFill.style.width = `${(deleted / coursesToDelete.length) * 100}%`;
          progressText.textContent = `Deleting ${deleted}/${coursesToDelete.length}...`;
        } catch (err) {
          console.error('Delete failed:', err);
        }
      }
      
      progress.classList.remove('active');
      selectedCourses.clear();
      updateSelectedCount();
      alert(`‚úÖ Deleted ${deleted} course(s)!`);
      loadManageContent();
    }

    function deleteCourse(id) {
      const course = currentContent.find(c => c.id === id);
      const title = course ? course.title : 'this course';
      
      if (confirm(`‚ö†Ô∏è Delete "${title}"?\n\nThis action cannot be undone!`)) {
        contentManager.deleteContent(CONTENT_TYPE, id)
          .then(() => { alert('‚úÖ Course deleted successfully!'); loadManageContent(); })
          .catch(err => alert('‚ùå Delete failed: ' + err.message));
      }
    }
    
    // ==================== YOUTUBE DATA FETCHER ====================
    
    async function fetchYouTubeData() {
      const youtubeUrl = document.getElementById('episodeYoutubeUrl').value;
      if (!youtubeUrl) {
        alert('‚ö†Ô∏è Please enter a YouTube URL first!');
        return;
      }
      
      const videoId = extractVideoId(youtubeUrl);
      if (!videoId) {
        alert('‚ùå Invalid YouTube URL!');
        return;
      }
      
      const btn = event.target;
      const originalText = btn.innerHTML;
      btn.innerHTML = '‚è≥ Fetching...';
      btn.disabled = true;
      
      try {
        // Check if youtube integration is loaded
        if (typeof window.youtubeIntegration === 'undefined') {
          throw new Error('YouTube integration not loaded');
        }
        
        // Fetch from YouTube
        const videoData = await window.youtubeIntegration.fetchFullData(youtubeUrl);
        
        if (!videoData) {
          throw new Error('Failed to fetch video data');
        }
        
        // Auto-populate fields
        if (!document.getElementById('episodeTitle').value) {
          document.getElementById('episodeTitle').value = videoData.title;
        }
        document.getElementById('episodeVideoId').value = videoData.videoId;
        
        if (videoData.duration) {
          document.getElementById('episodeDuration').value = videoData.duration;
        }
        
        alert('‚úÖ Video data fetched successfully!');
        
      } catch (error) {
        console.error('Error fetching YouTube data:', error);
        alert('‚ùå Failed to fetch YouTube data. You can enter details manually.');
      } finally {
        btn.innerHTML = originalText;
        btn.disabled = false;
      }
    }
    
    function extractVideoId(url) {
      const patterns = [
        /(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/,
        /youtube\.com\/embed\/([a-zA-Z0-9_-]{11})/,
        /youtube\.com\/v\/([a-zA-Z0-9_-]{11})/
      ];
      
      for (const pattern of patterns) {
        const match = url.match(pattern);
        if (match) return match[1];
      }
      return null;
    }

    function editCourse(id) {
      const course = currentContent.find(c => c.id === id);
      if (!course) return;
      
      document.getElementById('editCourseId').value = id;
      document.getElementById('editTitle').value = course.title;
      document.getElementById('editSummary').value = course.summary || '';
      document.getElementById('editEpisodes').value = course.episodes || 0;
      document.getElementById('editDuration').value = course.duration || '';
      document.getElementById('editDifficulty').value = course.difficulty || 'Beginner';
      document.getElementById('editLanguage').value = course.language || 'en';
      document.getElementById('editViews').value = course.views || 0;
      document.getElementById('editEnrolled').value = course.enrolled || 0;
      document.getElementById('editInstitution').value = course.institution || 'A3KM Studio';
      document.getElementById('editTags').value = (course.tags || []).join(', ');
      
      loadCategories().then(() => {
        document.getElementById('editCategory').value = course.category;
      });
      
      currentPlaylist = (course.playlist || []).map(ep => ({
        ...ep,
        description: ep.description || '',
        youtubeUrl: ep.youtubeUrl || '',
        tags: ep.tags || []
      }));
      renderPlaylist();
      
      document.getElementById('editModal').classList.add('active');
    }

    function closeEditModal() {
      document.getElementById('editModal').classList.remove('active');
    }

    function renderPlaylist() {
      const container = document.getElementById('playlistContainer');
      if (currentPlaylist.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">No episodes yet. Click "Add Episode" to start.</p>';
        return;
      }
      
      container.innerHTML = '';
      currentPlaylist.forEach((episode, index) => {
        const item = document.createElement('div');
        item.className = 'episode-item';
        
        const tags = episode.tags && episode.tags.length > 0 ? 
          `<br><small style="color: #8B0000;">üè∑Ô∏è ${episode.tags.join(', ')}</small>` : '';
        const description = episode.description ? 
          `<br><small style="color: #666;">${episode.description}</small>` : '';
        const youtubeUrl = episode.youtubeUrl ? 
          `<br><small style="color: #2196f3;">üì∫ <a href="${episode.youtubeUrl}" target="_blank" style="color: #2196f3;">YouTube Link</a></small>` : '';
        
        item.innerHTML = `
          <span class="episode-serial">${episode.episodeNo}</span>
          <div style="flex: 1;">
            <strong>${episode.title}</strong><br>
            <small style="color: #666;">‚è±Ô∏è ${episode.duration} | üé¨ ${episode.videoId}</small>
            ${description}${tags}${youtubeUrl}
          </div>
          <div class="episode-actions">
            ${index > 0 ? `<button onclick="moveEpisode(${index}, -1)" title="Move Up">‚¨ÜÔ∏è</button>` : ''}
            ${index < currentPlaylist.length - 1 ? `<button onclick="moveEpisode(${index}, 1)" title="Move Down">‚¨áÔ∏è</button>` : ''}
            <button onclick="editEpisode(${index})" title="Edit">‚úèÔ∏è</button>
            <button onclick="deleteEpisode(${index})" style="color: #f44336;" title="Delete">üóëÔ∏è</button>
          </div>
        `;
        container.appendChild(item);
      });
      
      updateEpisodeStats();
    }
    
    function updateEpisodeStats() {
      const totalEpisodes = currentPlaylist.length;
      const totalSeconds = currentPlaylist.reduce((sum, ep) => {
        const parts = ep.duration.split(':').map(Number);
        const seconds = parts.length === 2 ? parts[0]*60 + parts[1] : parts[0]*3600 + parts[1]*60 + parts[2];
        return sum + seconds;
      }, 0);
      
      const hours = Math.floor(totalSeconds / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const durationText = hours > 0 ? `${hours}h ${minutes}m` : `${minutes}m`;
      
      document.getElementById('editEpisodes').value = totalEpisodes;
      document.getElementById('editDuration').value = durationText;
    }
    
    function moveEpisode(index, direction) {
      const newIndex = index + direction;
      if (newIndex < 0 || newIndex >= currentPlaylist.length) return;
      
      const temp = currentPlaylist[index];
      currentPlaylist[index] = currentPlaylist[newIndex];
      currentPlaylist[newIndex] = temp;
      
      currentPlaylist[index].episodeNo = index + 1;
      currentPlaylist[newIndex].episodeNo = newIndex + 1;
      
      renderPlaylist();
    }

    let uploadPlaylist = [];
    
    // UPLOAD FORM HANDLER
    const uploadFormElement = document.getElementById('uploadForm');
    if (uploadFormElement) {
      uploadFormElement.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        if (uploadPlaylist.length === 0) {
          alert('‚ö†Ô∏è Please add at least one episode to the course!');
          return;
        }
        
        const course = {
          id: `course-${Date.now()}`,
          category: document.getElementById('category').value,
          type: 'educational',
          title: document.getElementById('title').value,
          summary: document.getElementById('summary').value,
          date: new Date().toISOString().split('T')[0],
          tags: document.getElementById('tags').value.split(',').map(t => t.trim()).filter(t => t),
          thumbnail: document.getElementById('thumbnail').value,
          episodes: uploadPlaylist.length,
          duration: document.getElementById('duration').value,
          difficulty: document.getElementById('difficulty').value,
          playlist: uploadPlaylist.map(ep => ({...ep})),
          views: 0,
          enrolled: 0,
          language: document.getElementById('language').value,
          institution: document.getElementById('institution').value
        };
        
        try {
          await contentManager.uploadContent(CONTENT_TYPE, course);
          alert('‚úÖ Course uploaded successfully!');
          uploadFormElement.reset();
          uploadPlaylist = [];
          renderUploadPlaylist();
        } catch (error) {
          alert('‚ùå Upload failed: ' + error.message);
        }
      });
    }
    
    // uploadPlaylist already declared above
    
    function addUploadEpisode() {
      document.getElementById('episodeModalTitle').textContent = 'Add Episode to Course';
      document.getElementById('episodeIndex').value = '';
      document.getElementById('episodeForm').reset();
      document.getElementById('episodeNo').value = uploadPlaylist.length + 1;
      document.getElementById('episodeModal').classList.add('active');
      
      window.currentEditMode = 'upload';
    }
    
    function addEpisode() {
      document.getElementById('episodeModalTitle').textContent = 'Add Episode';
      document.getElementById('episodeIndex').value = '';
      document.getElementById('episodeForm').reset();
      document.getElementById('episodeNo').value = currentPlaylist.length + 1;
      document.getElementById('episodeModal').classList.add('active');
      
      window.currentEditMode = 'edit';
    }
    
    function renderUploadPlaylist() {
      const container = document.getElementById('uploadPlaylistContainer');
      if (uploadPlaylist.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">No episodes yet. Click "Add Episode" to start building your course.</p>';
        document.getElementById('episodes').value = 0;
        document.getElementById('duration').value = '0h 0m';
        return;
      }
      
      container.innerHTML = '';
      uploadPlaylist.forEach((episode, index) => {
        const item = document.createElement('div');
        item.className = 'episode-item';
        
        const tags = episode.tags && episode.tags.length > 0 ? 
          `<br><small style="color: #8B0000;">üè∑Ô∏è ${episode.tags.join(', ')}</small>` : '';
        const description = episode.description ? 
          `<br><small style="color: #666;">${episode.description}</small>` : '';
        const youtubeUrl = episode.youtubeUrl ? 
          `<br><small style="color: #2196f3;">üì∫ YouTube</small>` : '';
        
        item.innerHTML = `
          <span class="episode-serial">${episode.episodeNo}</span>
          <div style="flex: 1;">
            <strong>${episode.title}</strong><br>
            <small style="color: #666;">‚è±Ô∏è ${episode.duration} | üé¨ ${episode.videoId}</small>
            ${description}${tags}${youtubeUrl}
          </div>
          <div class="episode-actions">
            ${index > 0 ? `<button type="button" onclick="moveUploadEpisode(${index}, -1)">‚¨ÜÔ∏è</button>` : ''}
            ${index < uploadPlaylist.length - 1 ? `<button type="button" onclick="moveUploadEpisode(${index}, 1)">‚¨áÔ∏è</button>` : ''}
            <button type="button" onclick="editUploadEpisode(${index})">‚úèÔ∏è</button>
            <button type="button" onclick="deleteUploadEpisode(${index})" style="color: #f44336;">üóëÔ∏è</button>
          </div>
        `;
        container.appendChild(item);
      });
      
      updateUploadEpisodeStats();
    }
    
    function updateUploadEpisodeStats() {
      const totalEpisodes = uploadPlaylist.length;
      const totalSeconds = uploadPlaylist.reduce((sum, ep) => {
        const parts = ep.duration.split(':').map(Number);
        const seconds = parts.length === 2 ? parts[0]*60 + parts[1] : parts[0]*3600 + parts[1]*60 + parts[2];
        return sum + seconds;
      }, 0);
      
      const hours = Math.floor(totalSeconds / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const durationText = hours > 0 ? `${hours}h ${minutes}m` : `${minutes}m`;
      
      document.getElementById('episodes').value = totalEpisodes;
      document.getElementById('duration').value = durationText;
    }
    
    function moveUploadEpisode(index, direction) {
      const newIndex = index + direction;
      if (newIndex < 0 || newIndex >= uploadPlaylist.length) return;
      
      const temp = uploadPlaylist[index];
      uploadPlaylist[index] = uploadPlaylist[newIndex];
      uploadPlaylist[newIndex] = temp;
      
      uploadPlaylist[index].episodeNo = index + 1;
      uploadPlaylist[newIndex].episodeNo = newIndex + 1;
      
      renderUploadPlaylist();
    }
    
    function editUploadEpisode(index) {
      const episode = uploadPlaylist[index];
      document.getElementById('episodeModalTitle').textContent = 'Edit Episode';
      document.getElementById('episodeIndex').value = index;
      document.getElementById('episodeNo').value = episode.episodeNo;
      document.getElementById('episodeTitle').value = episode.title;
      document.getElementById('episodeDescription').value = episode.description || '';
      document.getElementById('episodeDuration').value = episode.duration;
      document.getElementById('episodeYoutubeUrl').value = episode.youtubeUrl || '';
      document.getElementById('episodeVideoId').value = episode.videoId;
      document.getElementById('episodeTags').value = (episode.tags || []).join(', ');
      document.getElementById('episodeModal').classList.add('active');
      
      window.currentEditMode = 'upload';
    }
    
    function deleteUploadEpisode(index) {
      if (confirm('Delete this episode?')) {
        uploadPlaylist.splice(index, 1);
        uploadPlaylist.forEach((ep, i) => ep.episodeNo = i + 1);
        renderUploadPlaylist();
      }
    }

    function editEpisode(index) {
      const episode = currentPlaylist[index];
      document.getElementById('episodeModalTitle').textContent = 'Edit Episode';
      document.getElementById('episodeIndex').value = index;
      document.getElementById('episodeNo').value = episode.episodeNo;
      document.getElementById('episodeTitle').value = episode.title;
      document.getElementById('episodeDescription').value = episode.description || '';
      document.getElementById('episodeDuration').value = episode.duration;
      document.getElementById('episodeYoutubeUrl').value = episode.youtubeUrl || '';
      document.getElementById('episodeVideoId').value = episode.videoId;
      document.getElementById('episodeTags').value = (episode.tags || []).join(', ');
      document.getElementById('episodeModal').classList.add('active');
      
      window.currentEditMode = 'edit';
    }

    function deleteEpisode(index) {
      if (confirm('Delete this episode?')) {
        currentPlaylist.splice(index, 1);
        renderPlaylist();
      }
    }

    function closeEpisodeModal() {
      document.getElementById('episodeModal').classList.remove('active');
    }

    document.getElementById('episodeForm').addEventListener('submit', (e) => {
      e.preventDefault();
      
      const episode = {
        episodeNo: parseInt(document.getElementById('episodeNo').value),
        title: document.getElementById('episodeTitle').value,
        description: document.getElementById('episodeDescription').value || '',
        duration: document.getElementById('episodeDuration').value,
        youtubeUrl: document.getElementById('episodeYoutubeUrl').value || '',
        videoId: document.getElementById('episodeVideoId').value,
        tags: document.getElementById('episodeTags').value.split(',').map(t => t.trim()).filter(t => t)
      };
      
      const index = document.getElementById('episodeIndex').value;
      const mode = window.currentEditMode || 'edit';
      
      if (mode === 'upload') {
        if (index === '') {
          uploadPlaylist.push(episode);
        } else {
          uploadPlaylist[parseInt(index)] = episode;
        }
        uploadPlaylist.sort((a, b) => a.episodeNo - b.episodeNo);
        renderUploadPlaylist();
      } else {
        if (index === '') {
          currentPlaylist.push(episode);
        } else {
          currentPlaylist[parseInt(index)] = episode;
        }
        currentPlaylist.sort((a, b) => a.episodeNo - b.episodeNo);
        renderPlaylist();
      }
      
      closeEpisodeModal();
    });

    document.getElementById('editForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const id = document.getElementById('editCourseId').value;
      const originalCourse = currentContent.find(c => c.id === id);
      
      const updatedCourse = {
        ...originalCourse,
        id: id,
        category: document.getElementById('editCategory').value,
        title: document.getElementById('editTitle').value,
        summary: document.getElementById('editSummary').value,
        episodes: parseInt(document.getElementById('editEpisodes').value),
        duration: document.getElementById('editDuration').value,
        difficulty: document.getElementById('editDifficulty').value,
        language: document.getElementById('editLanguage').value,
        views: parseInt(document.getElementById('editViews').value) || 0,
        enrolled: parseInt(document.getElementById('editEnrolled').value) || 0,
        institution: document.getElementById('editInstitution').value,
        tags: document.getElementById('editTags').value.split(',').map(t => t.trim()).filter(t => t),
        playlist: currentPlaylist,
        type: 'educational'
      };
      
      try {
        await contentManager.updateContent(CONTENT_TYPE, id, updatedCourse);
        alert('‚úÖ Course updated successfully!');
        closeEditModal();
        loadManageContent();
      } catch (error) {
        alert('‚ùå Update failed: ' + error.message);
      }
    });

    async function loadDashboard() {
      try {
        const data = await contentManager.loadContent(CONTENT_TYPE);
        const courses = data.courses || [];
        
        const totalEpisodes = courses.reduce((sum, c) => sum + (c.episodes || 0), 0);
        const totalEnrolled = courses.reduce((sum, c) => sum + (c.enrolled || 0), 0);
        const totalViews = courses.reduce((sum, c) => sum + (c.views || 0), 0);
        
        document.getElementById('dashTotalCourses').textContent = courses.length;
        document.getElementById('dashTotalEpisodes').textContent = totalEpisodes;
        document.getElementById('dashTotalEnrolled').textContent = totalEnrolled;
        document.getElementById('dashTotalViews').textContent = totalViews;
        
        document.getElementById('quickTotalCourses').textContent = courses.length;
        document.getElementById('quickTotalEpisodes').textContent = totalEpisodes;
        document.getElementById('quickTotalEnrolled').textContent = totalEnrolled;
      } catch (error) {
        console.error('Failed to load dashboard:', error);
      }
    }

    async function loadStatistics() {
      try {
        const data = await contentManager.loadContent(CONTENT_TYPE);
        const courses = data.courses || [];
        
        document.getElementById('totalCourses').textContent = courses.length;
        
        const categories = new Set(courses.map(c => c.category));
        document.getElementById('totalCategories').textContent = categories.size;
        
        const avgEps = courses.length > 0 ? Math.round(courses.reduce((sum, c) => sum + (c.episodes || 0), 0) / courses.length) : 0;
        document.getElementById('avgEpisodes').textContent = avgEps;
        
        const totalDurationHours = courses.reduce((sum, c) => {
          const match = (c.duration || '0h').match(/(\d+)h/);
          return sum + (match ? parseInt(match[1]) : 0);
        }, 0);
        document.getElementById('totalDuration').textContent = totalDurationHours + 'h';
      } catch (error) {
        console.error('Failed to load stats:', error);
      }
    }

    // JSON Editor Functions
    async function loadJSONEditor() {
      try {
        const data = await contentManager.loadContent(CONTENT_TYPE);
        document.getElementById('jsonEditor').value = JSON.stringify(data, null, 2);
      } catch (error) {
        alert(`‚ùå Failed to load JSON: ${error.message}`);
      }
    }

    function validateJSON() {
      try {
        const jsonText = document.getElementById('jsonEditor').value;
        JSON.parse(jsonText);
        alert('‚úÖ JSON is valid!');
      } catch (error) {
        alert(`‚ùå Invalid JSON: ${error.message}`);
      }
    }

    function formatJSON() {
      try {
        const jsonText = document.getElementById('jsonEditor').value;
        const parsed = JSON.parse(jsonText);
        document.getElementById('jsonEditor').value = JSON.stringify(parsed, null, 2);
        alert('‚ú® JSON formatted successfully!');
      } catch (error) {
        alert(`‚ùå Cannot format invalid JSON: ${error.message}`);
      }
    }

    async function saveJSON() {
      try {
        const jsonText = document.getElementById('jsonEditor').value;
        const parsed = JSON.parse(jsonText);
        
        if (!confirm('‚ö†Ô∏è This will overwrite the entire courses.json file. Are you absolutely sure?')) {
          return;
        }
        
        await contentManager.saveContent(CONTENT_TYPE, parsed);
        alert('‚úÖ JSON saved successfully!');
        loadManageContent();
      } catch (error) {
        alert(`‚ùå Save failed: ${error.message}`);
      }
    }

    window.addEventListener('DOMContentLoaded', () => {
      loadCategories();
      loadDashboard();
    });
  </script>
</body>
</html>
