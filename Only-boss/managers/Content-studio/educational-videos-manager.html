<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Educational Videos Manager - A3KM Studio</title>
  <link rel="stylesheet" href="../../../Optimization/mobile-universal.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <script src="../../../Optimization/mobile-universal.js" defer></script>
  <style>
    :root {
      --primary-color: #00897B;
      --primary-dark: #00695C;
      --primary-light: #26A69A;
      --bg-dark: rgba(10, 10, 10, 0.98);
      --text-primary: rgba(255, 255, 255, 0.95);
      --text-secondary: rgba(255, 255, 255, 0.7);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: linear-gradient(135deg, #0a0a0a 0%, #1a0a0a 100%);
      color: var(--text-primary);
      font-family: 'Inter', -apple-system, 'Segoe UI', sans-serif;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }

    /* Engineering Grid Background */
    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background-image: 
        repeating-linear-gradient(0deg, rgba(0, 137, 123, 0.03) 0 1px, transparent 1px 30px),
        repeating-linear-gradient(90deg, rgba(0, 137, 123, 0.03) 0 1px, transparent 1px 30px),
        repeating-linear-gradient(45deg, rgba(0, 137, 123, 0.05) 0 2px, transparent 2px 40px);
      background-size: 30px 30px, 30px 30px, 80px 80px;
      pointer-events: none;
      z-index: 0;
      opacity: 0.6;
    }

    /* Header */
    .header {
      position: relative;
      z-index: 100;
      background: linear-gradient(135deg, rgba(0, 105, 92, 0.98), rgba(0, 137, 123, 0.99));
      border-bottom: 3px solid var(--primary-color);
      box-shadow: 0 6px 25px rgba(0, 137, 123, 0.4);
      padding: 20px 40px;
    }

    .header-container {
      max-width: 1600px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .header-icon {
      width: 70px;
      height: 70px;
      background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.2rem;
      box-shadow: 0 0 40px rgba(0, 137, 123, 0.7);
      animation: iconGlow 2s ease-in-out infinite;
    }

    @keyframes iconGlow {
      0%, 100% { box-shadow: 0 0 40px rgba(0, 137, 123, 0.7); }
      50% { box-shadow: 0 0 60px rgba(38, 166, 154, 0.9); }
    }

    .header-title h1 {
      font-size: 2rem;
      color: white;
      margin-bottom: 5px;
      font-weight: 800;
      text-shadow: 0 0 20px rgba(0, 137, 123, 0.5);
    }

    .header-title p {
      font-size: 0.95rem;
      color: var(--text-secondary);
    }

    .header-actions {
      display: flex;
      gap: 15px;
    }

    .btn, .back-btn, .btn-save {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 12px 24px;
      border: 2px solid transparent;
      border-radius: 10px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      font-size: 14px;
    }

    .back-btn {
      background: rgba(255, 255, 255, 0.08);
      color: white;
      border-color: rgba(255, 255, 255, 0.2);
    }

    .back-btn:hover {
      background: rgba(255, 255, 255, 0.15);
      transform: translateY(-2px);
    }

    .btn-save {
      background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
      color: white;
      border-color: var(--primary-color);
      box-shadow: 0 4px 15px rgba(0, 137, 123, 0.3);
    }

    .btn-save:hover {
      background: linear-gradient(135deg, var(--primary-light), var(--primary-color));
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 137, 123, 0.5);
    }

    /* Main Container */
    .container {
      position: relative;
      z-index: 1;
      max-width: 1600px;
      margin: 40px auto;
      padding: 0 40px;
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: 30px;
    }

    /* Sidebar */
    .sidebar {
      background: linear-gradient(135deg, rgba(0, 105, 92, 0.7), rgba(26, 0, 0, 0.9));
      border: 2px solid rgba(0, 137, 123, 0.3);
      border-radius: 18px;
      padding: 0;
      height: fit-content;
      position: sticky;
      top: 20px;
      overflow: hidden;
    }

    .sidebar-header {
      background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
      padding: 25px 20px;
      border-bottom: 2px solid rgba(0, 137, 123, 0.5);
    }

    .sidebar-header h1 {
      color: white;
      font-size: 1.4rem;
      margin-bottom: 5px;
      font-weight: 800;
    }

    .sidebar-header p {
      color: rgba(255, 255, 255, 0.9);
      font-size: 0.85rem;
    }

    .sidebar-nav {
      padding: 20px 0;
    }

    .tab-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding: 0 15px;
    }

    .tab-item {
      padding: 12px 15px;
      background: rgba(0, 137, 123, 0.05);
      border: 2px solid transparent;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.95rem;
      color: var(--text-secondary);
      font-weight: 600;
    }
      color: var(--primary-color);
      font-size: 1.3rem;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 800;
      padding: 0 20px;
    }

    .quick-stats {
      padding: 20px;
      margin: 20px;
      background: rgba(0, 137, 123, 0.1);
      border-radius: 12px;
      border-top: 2px solid rgba(0, 137, 123, 0.3);
    }

    .quick-stats h3 {
      color: var(--primary-color);
      font-size: 0.9rem;
      text-transform: uppercase;
      margin-bottom: 15px;
      letter-spacing: 1px;
      font-weight: 700;
    }

    .stat-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    .stat-value {
      color: var(--primary-color);
      font-weight: 700;
      font-size: 1.3rem;
    }

    .tab-item:hover {
      background: rgba(0, 137, 123, 0.15);
      border-color: rgba(0, 137, 123, 0.3);
      color: var(--text-primary);
      transform: translateX(5px);
    }

    .tab-item.active {
      background: rgba(0, 137, 123, 0.25);
      border-color: var(--primary-color);
      color: var(--primary-color);
      font-weight: 700;
      box-shadow: 0 0 20px rgba(0, 137, 123, 0.3);
    }

    .tab-item i {
      font-size: 1.1rem;
    }

    /* Stats Panel */
    .stats-panel {
      margin-top: 25px;
      padding-top: 20px;
      border-top: 2px solid rgba(0, 137, 123, 0.3);
    }

    .stats-panel h3 {
      color: var(--primary-color);
      font-size: 1.1rem;
      margin-bottom: 15px;
      font-weight: 700;
    }

    .stat-item-sidebar {
      display: flex;
      justify-content: space-between;
      padding: 10px;
      background: rgba(0, 0, 0, 0.4);
      border-radius: 8px;
      margin-bottom: 8px;
      border-left: 3px solid var(--primary-color);
    }

    .stat-item-sidebar span:first-child {
      color: var(--text-secondary);
      font-size: 0.85rem;
    }

    .stat-item-sidebar span:last-child {
      color: var(--primary-color);
      font-weight: 700;
    }

    /* Content Area */
    .content-area {
      background: linear-gradient(135deg, rgba(26, 0, 0, 0.7), rgba(0, 0, 0, 0.9));
      border: 2px solid rgba(0, 137, 123, 0.25);
      border-radius: 18px;
      padding: 35px;
      min-height: 600px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
    }

    .tab-content {
      display: none;
      animation: fadeIn 0.4s ease;
    }

    .tab-content.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Content Header */
    .content-header {
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid rgba(0, 137, 123, 0.3);
    }

    .content-header h2 {
      color: var(--primary-color);
      font-size: 1.8rem;
      margin-bottom: 8px;
      font-weight: 800;
    }

    .content-header p {
      color: var(--text-secondary);
      font-size: 1rem;
    }

    /* Dashboard Cards */
    .dashboard-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .dashboard-card {
      padding: 30px;
      background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
      color: white;
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.6);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      border: 2px solid var(--primary-light);
    }

    .dashboard-card::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
      animation: pulse 3s ease-in-out infinite;
    }

    .dashboard-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 30px rgba(0, 137, 123, 0.6);
    }

    .dashboard-card h3 {
      font-size: 3rem;
      margin-bottom: 8px;
      font-weight: 800;
      position: relative;
      z-index: 1;
    }

    .dashboard-card p {
      font-size: 1rem;
      opacity: 0.95;
      position: relative;
      z-index: 1;
      font-weight: 600;
    }

    @keyframes pulse {
      0%, 100% { transform: translate(0, 0) scale(1); }
      50% { transform: translate(-10%, -10%) scale(1.1); }
    }

    /* Forms */
    .upload-form, .edit-form {
      display: grid;
      gap: 25px;
    }

    .form-row, .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 20px;
    }

    .form-group.full-width {
      grid-column: 1 / -1;
    }

    .form-group label {
      color: var(--text-primary);
      font-weight: 600;
      font-size: 0.95rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      padding: 12px 15px;
      background: rgba(0, 0, 0, 0.5);
      border: 2px solid rgba(0, 137, 123, 0.3);
      border-radius: 10px;
      color: var(--text-primary);
      font-size: 1rem;
      font-family: inherit;
      transition: all 0.3s ease;
    }

    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 15px rgba(0, 137, 123, 0.3);
      background: rgba(0, 0, 0, 0.7);
    }

    .form-group textarea {
      min-height: 200px;
      resize: vertical;
      font-family: 'Consolas', 'Monaco', monospace;
    }

    .form-group small {
      color: var(--text-secondary);
      font-size: 0.85rem;
    }

    /* File Upload */
    .file-upload-label {
      padding: 40px;
      background: rgba(0, 0, 0, 0.4);
      border: 2px dashed var(--primary-color);
      border-radius: 15px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 10px;
      color: var(--text-secondary);
    }

    .file-upload-label:hover {
      border-color: var(--primary-light);
      background: rgba(0, 137, 123, 0.1);
      box-shadow: 0 0 20px rgba(0, 137, 123, 0.3);
    }

    /* Buttons */
    .btn-primary, .preview-btn {
      padding: 15px 30px;
      background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
      color: white;
      border: 2px solid var(--primary-color);
      border-radius: 10px;
      font-weight: 700;
      cursor: pointer;
      width: 100%;
      margin-top: 20px;
      transition: all 0.3s ease;
      font-size: 16px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .btn-primary:hover, .preview-btn:hover {
      background: linear-gradient(135deg, var(--primary-light), var(--primary-color));
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 137, 123, 0.5);
    }

    .preview-btn {
      background: rgba(0, 0, 0, 0.5);
      color: var(--primary-color);
    }

    .preview-btn:hover {
      background: var(--primary-color);
      color: white;
    }

    /* Search & Filters */
    .search-bar, .filters-bar, .filters-container {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      padding: 20px;
      background: rgba(0, 0, 0, 0.5);
      border-radius: 12px;
      border: 2px solid rgba(0, 137, 123, 0.3);
    }

    .search-bar input,
    .filters-bar input,
    .filters-bar select {
      flex: 1;
      min-width: 150px;
      padding: 12px 15px;
      background: rgba(0, 0, 0, 0.6);
      border: 2px solid rgba(0, 137, 123, 0.3);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 14px;
    }

    .search-bar input:focus,
    .filters-bar input:focus,
    .filters-bar select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 10px rgba(0, 137, 123, 0.3);
    }

    /* Content Grid */
    .content-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .content-card {
      background: rgba(0, 0, 0, 0.6);
      border: 2px solid rgba(0, 137, 123, 0.3);
      border-radius: 12px;
      overflow: hidden;
      transition: all 0.3s ease;
      position: relative;
    }

    .content-card:hover {
      border-color: var(--primary-color);
      box-shadow: 0 8px 25px rgba(0, 137, 123, 0.5);
      transform: translateY(-5px);
    }

    .card-thumbnail {
      width: 100%;
      height: 180px;
      object-fit: cover;
      background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
    }

    .card-body {
      padding: 15px;
    }

    .card-title {
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 8px;
      font-size: 16px;
    }

    .card-meta {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 12px;
    }

    .card-actions {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }

    .card-actions button {
      flex: 1;
      padding: 10px;
      border: 2px solid var(--primary-color);
      background: rgba(0, 0, 0, 0.5);
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      transition: all 0.3s ease;
      color: var(--primary-color);
    }

    .card-actions button:hover {
      background: var(--primary-color);
      color: white;
      transform: translateY(-2px);
    }

    .btn-delete, .btn-danger {
      border-color: #f44336 !important;
      color: #f44336 !important;
    }

    .btn-delete:hover, .btn-danger:hover {
      background: #f44336 !important;
      color: white !important;
    }

    /* Bulk Toolbar */
    .bulk-toolbar {
      display: none;
      background: rgba(0, 0, 0, 0.6);
      border: 2px solid var(--primary-color);
      padding: 15px 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      align-items: center;
      gap: 15px;
      flex-wrap: wrap;
    }

    .bulk-toolbar.active {
      display: flex;
      animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .bulk-toolbar strong {
      color: var(--primary-color);
      font-size: 1.1rem;
    }

    .bulk-toolbar .btn {
      padding: 10px 18px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .bulk-toolbar .btn-select-all {
      background: rgba(33, 150, 243, 0.2);
      border: 2px solid #2196F3;
      color: #2196F3;
    }

    .bulk-toolbar .btn-select-all:hover {
      background: #2196F3;
      color: white;
    }

    .bulk-toolbar .btn-bulk-delete {
      background: rgba(244, 67, 54, 0.2);
      border: 2px solid #f44336;
      color: #f44336;
    }

    .bulk-toolbar .btn-bulk-delete:hover {
      background: #f44336;
      color: white;
    }

    /* Pagination */
    .pagination-controls {
      display: none;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin-top: 30px;
      padding: 20px;
      background: rgba(0, 0, 0, 0.5);
      border: 2px solid rgba(0, 137, 123, 0.3);
      border-radius: 12px;
    }

    .pagination-controls.active {
      display: flex;
    }

    .pagination-controls button {
      padding: 10px 20px;
      background: rgba(0, 0, 0, 0.6);
      border: 2px solid var(--primary-color);
      color: var(--primary-color);
      border-radius: 8px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .pagination-controls button:hover:not(:disabled) {
      background: var(--primary-color);
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0, 137, 123, 0.3);
    }

    .pagination-controls button:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .pagination-controls span {
      color: var(--primary-color);
      font-weight: 700;
    }

    /* Progress & Messages */
    .progress {
      margin-top: 20px;
      display: none;
    }

    .progress.active {
      display: block;
    }

    .progress-bar {
      width: 100%;
      height: 10px;
      background: rgba(0, 0, 0, 0.5);
      border-radius: 5px;
      overflow: hidden;
      border: 1px solid var(--primary-color);
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
      width: 0%;
      transition: width 0.3s ease;
    }

    .progress-text {
      text-align: center;
      color: var(--primary-color);
      font-size: 14px;
      font-weight: 700;
      margin-top: 10px;
    }

    .success-message {
      background: linear-gradient(135deg, #4caf50, #66bb6a);
      color: white;
      padding: 15px 20px;
      border-radius: 12px;
      margin-top: 20px;
      display: none;
      text-align: center;
      font-weight: 600;
    }

    .success-message.active {
      display: block;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      z-index: 9999;
      overflow-y: auto;
    }

    .modal.active {
      display: block;
    }

    .modal-content {
      max-width: 900px;
      margin: 40px auto;
      background: linear-gradient(135deg, rgba(26, 0, 0, 0.98), rgba(0, 0, 0, 0.99));
      border: 2px solid var(--primary-color);
      border-radius: 20px;
      padding: 40px;
      position: relative;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.9);
    }

    .modal-close {
      position: absolute;
      top: 20px;
      right: 20px;
      background: #f44336;
      color: white;
      border: 2px solid #f44336;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 20px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-close:hover {
      background: #d32f2f;
      transform: rotate(90deg);
    }

    /* JSON Editor */
    .json-editor-area {
      background: #1e1e1e;
      border: 2px solid var(--primary-color);
      border-radius: 12px;
      padding: 20px;
      min-height: 500px;
    }

    .json-editor-area textarea {
      width: 100%;
      min-height: 500px;
      background: #1e1e1e;
      color: #d4d4d4;
      border: none;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 14px;
      line-height: 1.6;
      resize: vertical;
    }

    .json-editor-area textarea:focus {
      outline: none;
    }

    .json-toolbar {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .json-toolbar button {
      padding: 12px 20px;
      border: 2px solid;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .json-toolbar .btn-validate {
      background: rgba(76, 175, 80, 0.2);
      border-color: #4CAF50;
      color: #4CAF50;
    }

    .json-toolbar .btn-validate:hover {
      background: #4CAF50;
      color: white;
    }

    .json-toolbar .btn-format {
      background: rgba(33, 150, 243, 0.2);
      border-color: #2196F3;
      color: #2196F3;
    }

    .json-toolbar .btn-format:hover {
      background: #2196F3;
      color: white;
    }

    .json-toolbar .btn-download {
      background: rgba(255, 193, 7, 0.2);
      border-color: #FFC107;
      color: #FFC107;
    }

    .json-toolbar .btn-download:hover {
      background: #FFC107;
      color: #333;
    }

    .json-toolbar .btn-import {
      background: rgba(0, 137, 123, 0.2);
      border-color: var(--primary-color);
      color: var(--primary-color);
    }

    .json-toolbar .btn-import:hover {
      background: var(--primary-color);
      color: white;
    }

    /* Statistics */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
      color: white;
      padding: 25px;
      border-radius: 12px;
      text-align: center;
    }

    .stat-card h3 {
      font-size: 2.5rem;
      margin-bottom: 5px;
      font-weight: 800;
    }

    .stat-card p {
      font-size: 0.95rem;
      opacity: 0.95;
    }

    .breakdown-section {
      margin-top: 30px;
      padding: 25px;
      background: rgba(0, 0, 0, 0.5);
      border-radius: 12px;
      border: 2px solid rgba(0, 137, 123, 0.3);
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <h1>üéì Educational Videos</h1>
        <p>Course Management System</p>
      </div>
      <div class="sidebar-nav">
        <div class="tab-item active" onclick="switchTab('dashboard')">üìä Dashboard</div>
        <div class="tab-item" onclick="switchTab('upload')">üì§ Upload Course</div>
        <div class="tab-item" onclick="switchTab('manage')">üìã Manage Courses</div>
        <div class="tab-item" onclick="switchTab('stats')">üìà Statistics</div>
        <div class="tab-item" onclick="switchTab('json')">‚öôÔ∏è JSON Editor</div>
      </div>
      <div class="quick-stats">
        <h3>Quick Stats</h3>
        <div class="stat-item">
          <span>Total Courses</span>
          <span class="stat-value" id="quickTotalCourses">0</span>
        </div>
        <div class="stat-item">
          <span>Total Episodes</span>
          <span class="stat-value" id="quickTotalEpisodes">0</span>
        </div>
        <div class="stat-item">
          <span>Total Enrolled</span>
          <span class="stat-value" id="quickTotalEnrolled">0</span>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <div class="header">
        <div>
          <h1>Educational Videos Manager</h1>
          <p style="color: #666;">Manage educational courses and learning content</p>
        </div>
        <a href="content-hub.html" class="back-btn">‚Üê Back to Hub</a>
      </div>

      <!-- DASHBOARD TAB -->
      <div id="dashboardTab" class="tab-content active">
        <div class="stats-grid">
          <div class="stat-card">
            <h3 id="dashTotalCourses">0</h3>
            <p>Total Courses</p>
          </div>
          <div class="stat-card">
            <h3 id="dashTotalEpisodes">0</h3>
            <p>Total Episodes</p>
          </div>
          <div class="stat-card">
            <h3 id="dashTotalEnrolled">0</h3>
            <p>Total Enrolled</p>
          </div>
          <div class="stat-card">
            <h3 id="dashTotalViews">0</h3>
            <p>Total Views</p>
          </div>
        </div>
        <div style="background: white; padding: 30px; border-radius: 15px;">
          <h2 style="color: #8B0000; margin-bottom: 20px;">üìö Quick Guide</h2>
          <ul style="line-height: 2; color: #666;">
            <li><strong>Upload Course:</strong> Create new educational course with episodes and playlists</li>
            <li><strong>Manage Courses:</strong> Edit, delete, or update existing courses and episodes</li>
            <li><strong>Bulk Operations:</strong> Select multiple courses for bulk actions</li>
            <li><strong>Playlist Editor:</strong> Add, edit, or reorder course episodes</li>
            <li><strong>Advanced Filters:</strong> Filter by difficulty, episodes, duration, or enrollment</li>
          </ul>
        </div>
      </div>

      <!-- UPLOAD TAB -->
      <div id="uploadTab" class="tab-content">
        <form id="uploadForm">
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div class="form-group">
              <label>üìÇ Category Group/Sector</label>
              <select id="categoryGroup" required onchange="updateVideoCategoriesFromGroup('category')">
                <option value="">Select sector first...</option>
              </select>
            </div>
            <div class="form-group">
              <label>üìÅ Specific Category</label>
              <select id="category" required disabled>
                <option value="">Select sector first...</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>Course Title</label>
            <input type="text" id="title" placeholder="Complete Arduino Programming Course" required>
          </div>

          <div class="form-group">
            <label>Course Summary</label>
            <textarea id="summary" placeholder="Detailed course description..." rows="4" required></textarea>
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div class="form-group">
              <label>Number of Episodes</label>
              <input type="number" id="episodes" placeholder="0" min="0" readonly style="background: #f5f5f5; cursor: not-allowed;">
              <small style="color: #999; font-size: 12px;">Auto-calculated from playlist</small>
            </div>
            <div class="form-group">
              <label>Total Duration</label>
              <input type="text" id="duration" placeholder="0h 0m" readonly style="background: #f5f5f5; cursor: not-allowed;">
              <small style="color: #999; font-size: 12px;">Auto-calculated from episodes</small>
            </div>
          </div>

          <!-- Upload Playlist Section -->
          <div class="playlist-section" style="margin-top: 30px;">
            <div class="playlist-header">
              <h3 style="color: #8B0000;">üìö Course Playlist (Add Episodes)</h3>
              <button type="button" onclick="addUploadEpisode()" style="padding: 8px 16px; background: #8B0000; color: white; border: none; border-radius: 6px; cursor: pointer;">+ Add Episode</button>
            </div>
            <div id="uploadPlaylistContainer">
              <p style="text-align: center; color: #999; padding: 20px;">No episodes yet. Click "Add Episode" to start building your course.</p>
            </div>
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div class="form-group">
              <label>Difficulty Level</label>
              <select id="difficulty" required>
                <option value="Beginner">üü¢ Beginner</option>
                <option value="Intermediate">üü† Intermediate</option>
                <option value="Beginner to Intermediate">üü¢üü† Beginner to Intermediate</option>
                <option value="Advanced">üî¥ Advanced</option>
              </select>
            </div>
            <div class="form-group">
              <label>Language</label>
              <select id="language" required>
                <option value="en" selected>üá¨üáß English</option>
                <option value="bn">üáßüá© Bengali (‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ)</option>
                <option value="bn-en">üáßüá©üá¨üáß Bengali-English Mix</option>
                <option value="hi">üáÆüá≥ Hindi (‡§π‡§ø‡§®‡•ç‡§¶‡•Ä)</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>Institution/Platform</label>
            <input type="text" id="institution" placeholder="A3KM Studio" value="A3KM Studio" required>
          </div>

          <div class="form-group">
            <label>Tags (comma-separated)</label>
            <input type="text" id="tags" placeholder="arduino, programming, embedded, tutorial">
          </div>

          <div class="form-group">
            <label>Thumbnail</label>
            <input type="file" id="thumbnail" accept="image/*">
          </div>

          <button type="submit" class="btn-primary">üì§ Upload Course</button>

          <div class="progress" id="progress">
            <div class="progress-bar">
              <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">Processing...</div>
          </div>
        </form>
      </div>

      <!-- MANAGE TAB -->
      <div id="manageTab" class="tab-content">
        <div class="bulk-actions">
          <button onclick="selectAll()">‚úÖ Select All</button>
          <button onclick="deselectAll()">‚ùå Deselect All</button>
          <button onclick="bulkDelete()" style="background: #f44336; color: white; border-color: #f44336;">üóëÔ∏è Delete Selected</button>
          <span class="selected-count">Selected: <span id="selectedCount">0</span></span>
        </div>

        <div class="filter-group" style="grid-template-columns: 2fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr;">
          <input type="text" id="searchInput" placeholder="üîç Search courses..." onkeyup="filterContent()">
          <select id="filterCategoryGroup" onchange="updateFilterVideoCategoriesFromGroup(); filterContent();">
            <option value="">All Sectors</option>
          </select>
          <select id="filterCategory" onchange="updateSubcategoriesVideos(); filterContent();">
            <option value="">All Categories</option>
          </select>
          <select id="filterSubcategory" onchange="filterContent()">
            <option value="">All Subcategories</option>
          </select>
          <input type="date" id="filterDateFrom" onchange="filterContent()" placeholder="From Date" style="font-size: 12px;">
          <input type="date" id="filterDateTo" onchange="filterContent()" placeholder="To Date" style="font-size: 12px;">
          <select id="filterDifficulty" onchange="filterContent()">
            <option value="">All Difficulties</option>
            <option value="Beginner">üü¢ Beginner</option>
            <option value="Intermediate">üü† Intermediate</option>
            <option value="Beginner to Intermediate">üü¢üü† Beginner to Intermediate</option>
            <option value="Advanced">üî¥ Advanced</option>
          </select>
          <select id="sortBy" onchange="filterContent()">
            <option value="date">Newest First</option>
            <option value="title">Title A-Z</option>
            <option value="category">Category</option>
            <option value="episodes">Most Episodes</option>
            <option value="enrolled">Most Enrolled</option>
            <option value="views">Most Viewed</option>
          </select>
        </div>

        <div class="content-grid" id="contentGrid">
          <p style="text-align: center; padding: 40px; color: #999;">Loading courses...</p>
        </div>

        <div class="pagination">
          <button id="prevPage" onclick="changePage(-1)">‚Üê Previous</button>
          <span class="page-info">Page <span id="currentPage">1</span> of <span id="totalPages">1</span></span>
          <button id="nextPage" onclick="changePage(1)">Next ‚Üí</button>
        </div>
      </div>

      <!-- STATISTICS TAB -->
      <div id="statsTab" class="tab-content">
        <div class="stats-grid">
          <div class="stat-card">
            <h3 id="totalCourses">0</h3>
            <p>Total Courses</p>
          </div>
          <div class="stat-card">
            <h3 id="totalCategories">0</h3>
            <p>Categories</p>
          </div>
          <div class="stat-card">
            <h3 id="avgEpisodes">0</h3>
            <p>Avg Episodes/Course</p>
          </div>
          <div class="stat-card">
            <h3 id="totalDuration">0h</h3>
            <p>Total Duration</p>
          </div>
        </div>
      </div>

      <!-- JSON EDITOR TAB -->
      <div id="jsonTab" class="tab-content">
        <h2 style="color: #8B0000; font-size: 1.8rem; margin-bottom: 20px;">‚öôÔ∏è JSON Editor</h2>
        <p style="color: #666; margin-bottom: 20px;">‚ö†Ô∏è <strong>Advanced Users Only:</strong> Direct JSON manipulation. Invalid JSON will break the system!</p>
        
        <div class="json-editor-container">
          <div class="json-actions">
            <button class="btn-validate" onclick="validateJSON()">‚úì Validate JSON</button>
            <button class="btn-format" onclick="formatJSON()">‚ú® Format JSON</button>
            <button class="btn-save-json" onclick="saveJSON()">üíæ Save Changes</button>
          </div>
          <textarea id="jsonEditor" placeholder="Loading JSON data..."></textarea>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Modal -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeEditModal()">√ó</button>
      <h2 style="color: #8B0000; margin-bottom: 20px;">‚úèÔ∏è Edit Course</h2>
      <form id="editForm">
        <input type="hidden" id="editCourseId">

        <div class="form-group">
          <label>Category</label>
          <select id="editCategory" required>
            <option value="">Loading categories...</option>
          </select>
        </div>

        <div class="form-group">
          <label>Course Title</label>
          <input type="text" id="editTitle" required>
        </div>

        <div class="form-group">
          <label>Summary</label>
          <textarea id="editSummary" rows="3" required></textarea>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
          <div class="form-group">
            <label>Episodes</label>
            <input type="number" id="editEpisodes" min="1" required>
          </div>
          <div class="form-group">
            <label>Duration</label>
            <input type="text" id="editDuration" placeholder="3h 45m" required>
          </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
          <div class="form-group">
            <label>Difficulty</label>
            <select id="editDifficulty" required>
              <option value="Beginner">üü¢ Beginner</option>
              <option value="Intermediate">üü† Intermediate</option>
              <option value="Beginner to Intermediate">üü¢üü† Beginner to Intermediate</option>
              <option value="Advanced">üî¥ Advanced</option>
            </select>
          </div>
          <div class="form-group">
            <label>Language</label>
            <select id="editLanguage" required>
              <option value="en">üá¨üáß English</option>
              <option value="bn">üáßüá© Bengali</option>
              <option value="bn-en">üáßüá©üá¨üáß Mixed</option>
              <option value="hi">üáÆüá≥ Hindi</option>
            </select>
          </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
          <div class="form-group">
            <label>Views</label>
            <input type="number" id="editViews" min="0">
          </div>
          <div class="form-group">
            <label>Enrolled</label>
            <input type="number" id="editEnrolled" min="0">
          </div>
        </div>

        <div class="form-group">
          <label>Institution</label>
          <input type="text" id="editInstitution" required>
        </div>

        <div class="form-group">
          <label>Tags (comma-separated)</label>
          <input type="text" id="editTags">
        </div>

        <!-- Playlist Section -->
        <div class="playlist-section">
          <div class="playlist-header">
            <h3 style="color: #8B0000;">üìö Course Playlist</h3>
            <button type="button" onclick="addEpisode()" style="padding: 8px 16px; background: #8B0000; color: white; border: none; border-radius: 6px; cursor: pointer;">+ Add Episode</button>
          </div>
          <div id="playlistContainer">
            <!-- Episodes will be loaded here -->
          </div>
        </div>

        <button type="submit" class="btn-primary">üíæ Update Course</button>
      </form>
    </div>
  </div>

  <!-- Episode Modal -->
  <div id="episodeModal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
      <button class="modal-close" onclick="closeEpisodeModal()">√ó</button>
      <h2 style="color: #8B0000; margin-bottom: 20px;" id="episodeModalTitle">Add Episode</h2>
      <form id="episodeForm">
        <input type="hidden" id="episodeIndex">
        
        <div class="form-group">
          <label>Episode Number</label>
          <input type="number" id="episodeNo" min="1" required>
        </div>
        
        <div class="form-group">
          <label>Episode Title</label>
          <input type="text" id="episodeTitle" placeholder="Introduction to Arduino" required>
        </div>
        
        <div class="form-group">
          <label>Episode Description (Optional)</label>
          <textarea id="episodeDescription" placeholder="Brief episode description..." rows="2"></textarea>
        </div>
        
        <div class="form-group">
          <label>Duration (MM:SS or HH:MM:SS)</label>
          <input type="text" id="episodeDuration" placeholder="15:30" pattern="^\d{1,2}:\d{2}(:\d{2})?$" required>
          <small style="color: #999; font-size: 12px;">Format: 15:30 or 1:30:45</small>
        </div>
        
        <div class="form-group">
          <label>YouTube URL (Optional)</label>
          <div style="display: flex; gap: 10px;">
            <input type="url" id="episodeYoutubeUrl" placeholder="https://youtu.be/VIDEO_ID" style="flex: 1;">
            <button type="button" onclick="fetchYouTubeData()" class="btn-fetch" style="padding: 10px 20px; background: #ff0000; color: white; border: none; border-radius: 6px; cursor: pointer; white-space: nowrap;">üì∫ Fetch Data</button>
          </div>
          <small style="color: #999; font-size: 12px;">Auto-fetch video details from YouTube</small>
        </div>
        
        <div class="form-group">
          <label>Video ID</label>
          <input type="text" id="episodeVideoId" placeholder="video-001" required>
        </div>
        
        <div class="form-group">
          <label>üìù Class Lecture PDF (Optional)</label>
          <input type="file" id="episodePdfFile" accept=".pdf" onchange="handlePdfSelect(event)">
          <small style="color: #999; font-size: 12px; display: block; margin-top: 5px;">
            üìÅ Upload lecture notes, slides, or study materials in PDF format<br>
            üìã Storage: Content Storage/educational-videos/[category]/[course-id]/lectures/<br>
            üëÅÔ∏è Students can view, read & download the PDF<br>
            üîÑ To replace PDF: Select new file | To delete: Click ‚ùå button
          </small>
          <div id="pdfPreview" style="display: none; margin-top: 10px; padding: 10px; background: rgba(0, 137, 123, 0.1); border-radius: 6px; border-left: 3px solid #00897B;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div>
                <strong style="color: #00897B;">‚úÖ PDF Selected:</strong> <span id="pdfFileName"></span> (<span id="pdfFileSize"></span>)
              </div>
              <button type="button" onclick="removePdfFromEpisode()" style="background: #f44336; color: white; border: none; padding: 5px 12px; border-radius: 6px; cursor: pointer; font-weight: 600;">‚ùå Remove</button>
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label>Episode Tags (comma-separated, optional)</label>
          <input type="text" id="episodeTags" placeholder="basics, introduction, setup">
        </div>
        
        <button type="submit" class="btn-primary">üíæ Save Episode</button>
      </form>
    </div>
  </div>

  <script src="github-content-uploader.js"></script>
  <script src="content-manager.js"></script>
  <script src="youtube-integration.js"></script>
  <script>
    // Hardcoded categories for immediate display
    const VIDEO_CATEGORIES = {
      'Technology & Programming': ['Web Development', 'Mobile Apps', 'AI & Machine Learning', 'Data Science', 'Cybersecurity', 'Cloud Computing'],
      'Engineering': ['Electrical Engineering', 'Mechanical Engineering', 'Civil Engineering', 'Arduino & IoT', 'MATLAB', 'SolidWorks', 'Embedded Systems', 'Robotics'],
      'Science & Mathematics': ['Physics', 'Chemistry', 'Biology', 'Mathematics', 'Statistics', 'Astronomy', 'Environmental Science'],
      'Business & Career': ['Entrepreneurship', 'Marketing', 'Finance', 'Career Development', 'Productivity', 'Leadership'],
      'Creative & Design': ['Graphic Design', 'UI/UX', 'Photography', 'Video Editing', 'Content Writing', '3D Modeling'],
      'Education & Learning': ['Study Tips', 'Online Courses', 'Research Methods', 'Academic Writing', 'Teaching', 'Language Learning']
    };

    const GITHUB_TOKEN = 'YOUR_GITHUB_TOKEN_HERE';
    const CONTENT_TYPE = 'educational-videos';
    
    const githubUploader = new GitHubContentUploader({
      token: GITHUB_TOKEN,
      owner: 'Akhinoor14',
      repo: 'A3KM-Studio',
      onProgress: (data) => { document.getElementById('progressFill').style.width = '60%'; },
      onError: (error) => alert('Error: ' + error.error)
    });
    
    const contentManager = new ContentManager(githubUploader);
    let currentContent = [];
    let filteredContent = [];
    let selectedCourses = new Set();
    let currentPage = 1;
    let currentPlaylist = [];
    const ITEMS_PER_PAGE = 12;

    function switchTab(tabName) {
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab-item').forEach(btn => btn.classList.remove('active'));
      document.getElementById(tabName + 'Tab').classList.add('active');
      event.target.classList.add('active');
      if (tabName === 'manage') { loadManageContent(); resetPagination(); }
      if (tabName === 'stats') loadStatistics();
      if (tabName === 'dashboard') loadDashboard();
      if (tabName === 'json') loadJSONEditor();
    }

    function resetPagination() {
      currentPage = 1;
      selectedCourses.clear();
      updateSelectedCount();
    }

    // Update video categories based on selected group
    function updateVideoCategoriesFromGroup(targetSelectId, editPrefix = '') {
      const groupSelect = document.getElementById(editPrefix + 'categoryGroup');
      const categorySelect = document.getElementById(targetSelectId);
      const selectedGroup = groupSelect.value;
      
      categorySelect.innerHTML = '<option value="">Select category...</option>';
      
      if (selectedGroup && VIDEO_CATEGORIES[selectedGroup]) {
        categorySelect.disabled = false;
        VIDEO_CATEGORIES[selectedGroup].forEach(cat => {
          const option = document.createElement('option');
          option.value = cat;
          option.textContent = cat;
          categorySelect.appendChild(option);
        });
      } else {
        categorySelect.disabled = true;
      }
    }

    function updateFilterVideoCategoriesFromGroup() {
      const groupSelect = document.getElementById('filterCategoryGroup');
      const categorySelect = document.getElementById('filterCategory');
      const selectedGroup = groupSelect.value;
      
      categorySelect.innerHTML = '<option value="">All Categories</option>';
      
      if (selectedGroup && VIDEO_CATEGORIES[selectedGroup]) {
        VIDEO_CATEGORIES[selectedGroup].forEach(cat => {
          const option = document.createElement('option');
          option.value = cat;
          option.textContent = cat;
          categorySelect.appendChild(option);
        });
      } else {
        Object.values(VIDEO_CATEGORIES).flat().sort().forEach(cat => {
          const option = document.createElement('option');
          option.value = cat;
          option.textContent = cat;
          categorySelect.appendChild(option);
        });
      }
    }

    async function loadCategories() {
      const categoryGroupSelects = [
        document.getElementById('categoryGroup'),
        document.getElementById('editCategoryGroup'),
        document.getElementById('filterCategoryGroup')
      ];
      
      const categorySelects = [
        document.getElementById('category'),
        document.getElementById('editCategory'),
        document.getElementById('filterCategory')
      ];
      
      // Populate sector dropdowns
      categoryGroupSelects.forEach((select, index) => {
        if (!select) return;
        const isFilter = index === 2;
        select.innerHTML = isFilter ? '<option value="">All Sectors</option>' : '<option value="">Select sector...</option>';
        
        Object.keys(VIDEO_CATEGORIES).forEach(groupName => {
          const option = document.createElement('option');
          option.value = groupName;
          option.textContent = groupName;
          select.appendChild(option);
        });
      });
      
      // Initialize category selects
      categorySelects.forEach((select, index) => {
        if (!select) return;
        const isFilter = index === 2;
        select.innerHTML = isFilter ? '<option value="">All Categories</option>' : '<option value="">Select sector first...</option>';
        if (!isFilter) select.disabled = true;
      });
      
      // Try to load from GitHub (will fail gracefully if no token)
      try {
        const data = await contentManager.loadContent(CONTENT_TYPE);
        if (data.categoryGroups && Array.isArray(data.categoryGroups)) {
          categorySelects.forEach((select, index) => {
            if (!select) return;
            const isFilter = index === 2;
            select.innerHTML = isFilter ? '<option value="">All Categories</option>' : '<option value="">Select category...</option>';
            
            data.categoryGroups.forEach(group => {
              const optgroup = document.createElement('optgroup');
              optgroup.label = `${group.icon} ${group.name}`;
              
              if (group.categories) {
                group.categories.forEach(cat => {
                  const option = document.createElement('option');
                  option.value = cat;
                  option.textContent = cat;
                  optgroup.appendChild(option);
                });
              }
              select.appendChild(optgroup);
            });
          });
        }
      } catch (error) {
        console.log('Using hardcoded categories (GitHub API unavailable)');
      }
    }

    async function loadManageContent() {
      const grid = document.getElementById('contentGrid');
      grid.innerHTML = '<p style="text-align: center; padding: 40px; color: #999;">Loading...</p>';
      try {
        const data = await contentManager.loadContent(CONTENT_TYPE);
        currentContent = data.courses || [];
        filterContent();
      } catch (error) {
        grid.innerHTML = '<p style="text-align: center; padding: 40px; color: #f44336;">Failed to load</p>';
      }
    }

    function renderContent(items) {
      const grid = document.getElementById('contentGrid');
      filteredContent = items;
      
      if (items.length === 0) {
        grid.innerHTML = '<p style="text-align: center; padding: 40px; color: #999;">No courses found</p>';
        updatePaginationControls(0);
        return;
      }
      
      const totalPages = Math.ceil(items.length / ITEMS_PER_PAGE);
      const startIdx = (currentPage - 1) * ITEMS_PER_PAGE;
      const endIdx = startIdx + ITEMS_PER_PAGE;
      const pageItems = items.slice(startIdx, endIdx);
      
      grid.innerHTML = '';
      pageItems.forEach(item => {
        const isSelected = selectedCourses.has(item.id);
        const card = document.createElement('div');
        card.className = 'content-card';
        
        const difficultyClass = item.difficulty === 'Beginner' ? 'badge-beginner' : 
                                item.difficulty === 'Intermediate' ? 'badge-intermediate' : 
                                item.difficulty === 'Advanced' ? 'badge-advanced' : 'badge-intermediate';
        
        const badges = [];
        badges.push(`<span class="course-badge badge-episodes">üìö ${item.episodes || 0} episodes</span>`);
        badges.push(`<span class="course-badge badge-duration">‚è±Ô∏è ${item.duration}</span>`);
        badges.push(`<span class="course-badge ${difficultyClass}">${item.difficulty}</span>`);
        if (item.enrolled > 0) badges.push(`<span class="course-badge badge-enrolled">üë• ${item.enrolled}</span>`);
        if (item.views > 0) badges.push(`<span class="course-badge badge-views">üëÅÔ∏è ${item.views}</span>`);
        
        card.innerHTML = `
          <input type="checkbox" ${isSelected ? 'checked' : ''} onchange="toggleSelect('${item.id}')">
          <img src="${item.thumbnail || ''}" class="card-thumbnail" onerror="this.style.background='linear-gradient(135deg, #8B0000, #C80000)'">
          <div class="card-body">
            <div style="margin-bottom: 8px;">${badges.join(' ')}</div>
            <div class="card-title">${item.title}</div>
            <div class="card-meta">
              üìÅ ${item.category}<br>
              üèõÔ∏è ${item.institution}<br>
              üóìÔ∏è ${contentManager.formatDate(item.date)}
            </div>
            <div class="card-actions">
              <button onclick="editCourse('${item.id}')">‚úèÔ∏è Edit</button>
              <button onclick="deleteCourse('${item.id}')" style="color: #f44336;">üóëÔ∏è Delete</button>
            </div>
          </div>
        `;
        grid.appendChild(card);
      });
      
      updatePaginationControls(totalPages);
    }

    function updatePaginationControls(totalPages) {
      document.getElementById('currentPage').textContent = currentPage;
      document.getElementById('totalPages').textContent = totalPages;
      document.getElementById('prevPage').disabled = currentPage === 1;
      document.getElementById('nextPage').disabled = currentPage >= totalPages || totalPages === 0;
    }

    function changePage(delta) {
      const totalPages = Math.ceil(filteredContent.length / ITEMS_PER_PAGE);
      const newPage = currentPage + delta;
      if (newPage >= 1 && newPage <= totalPages) {
        currentPage = newPage;
        renderContent(filteredContent);
      }
    }

    function filterContent() {
      const query = document.getElementById('searchInput').value.toLowerCase();
      const category = document.getElementById('filterCategory')?.value || '';
      const subcategory = document.getElementById('filterSubcategory')?.value || '';
      const dateFrom = document.getElementById('filterDateFrom')?.value || '';
      const dateTo = document.getElementById('filterDateTo')?.value || '';
      const sortBy = document.getElementById('sortBy').value;
      const difficulty = document.getElementById('filterDifficulty').value;
      
      let filtered = currentContent.filter(item => {
        const matchSearch = !query || 
          item.title.toLowerCase().includes(query) ||
          item.summary?.toLowerCase().includes(query) ||
          item.category.toLowerCase().includes(query) ||
          (item.tags && item.tags.some(tag => tag.toLowerCase().includes(query)));
        
        const matchCategory = !category || item.category === category;
        const matchSubcategory = !subcategory || item.subcategory === subcategory;
        const matchDifficulty = !difficulty || item.difficulty === difficulty;
        
        // Date range filtering
        let matchDateRange = true;
        if (dateFrom || dateTo) {
          const itemDate = item.date || item.dateAdded || item.id;
          if (dateFrom && itemDate < dateFrom) matchDateRange = false;
          if (dateTo && itemDate > dateTo) matchDateRange = false;
        }
        
        return matchSearch && matchCategory && matchSubcategory && matchDifficulty && matchDateRange;
      });
      
      filtered.sort((a, b) => {
        if (sortBy === 'date') return new Date(b.date) - new Date(a.date);
        if (sortBy === 'title') return a.title.localeCompare(b.title);
        if (sortBy === 'category') return (a.category || '').localeCompare(b.category || '');
        if (sortBy === 'episodes') return (b.episodes || 0) - (a.episodes || 0);
        if (sortBy === 'enrolled') return (b.enrolled || 0) - (a.enrolled || 0);
        if (sortBy === 'views') return (b.views || 0) - (a.views || 0);
        return 0;
      });
      
      currentPage = 1;
      renderContent(filtered);
    }
    
    // Update subcategories for Educational Videos
    function updateSubcategoriesVideos() {
      const categorySelect = document.getElementById('filterCategory');
      const subcategorySelect = document.getElementById('filterSubcategory');
      const selectedCategory = categorySelect?.value;
      
      subcategorySelect.innerHTML = '<option value="">All Subcategories</option>';
      
      if (selectedCategory && currentContent) {
        const subcategories = [...new Set(
          currentContent
            .filter(item => item.category === selectedCategory && item.subcategory)
            .map(item => item.subcategory)
        )].sort();
        
        subcategories.forEach(sub => {
          subcategorySelect.innerHTML += `<option value="${sub}">${sub}</option>`;
        });
      }
    }

    function toggleSelect(id) {
      if (selectedCourses.has(id)) {
        selectedCourses.delete(id);
      } else {
        selectedCourses.add(id);
      }
      updateSelectedCount();
    }

    function selectAll() {
      const startIdx = (currentPage - 1) * ITEMS_PER_PAGE;
      const endIdx = startIdx + ITEMS_PER_PAGE;
      const pageItems = filteredContent.slice(startIdx, endIdx);
      pageItems.forEach(item => selectedCourses.add(item.id));
      updateSelectedCount();
      renderContent(filteredContent);
    }

    function deselectAll() {
      selectedCourses.clear();
      updateSelectedCount();
      renderContent(filteredContent);
    }

    function updateSelectedCount() {
      document.getElementById('selectedCount').textContent = selectedCourses.size;
    }

    async function bulkDelete() {
      if (selectedCourses.size === 0) {
        alert('‚ö†Ô∏è No courses selected!');
        return;
      }
      
      const confirmed = confirm(`‚ö†Ô∏è Delete ${selectedCourses.size} course(s)?\n\nThis action cannot be undone!`);
      if (!confirmed) return;
      
      const progress = document.getElementById('progress');
      const progressText = document.getElementById('progressText');
      const progressFill = document.getElementById('progressFill');
      
      progress.classList.add('active');
      progressText.textContent = `Deleting 0/${selectedCourses.size}...`;
      
      let deleted = 0;
      const coursesToDelete = Array.from(selectedCourses);
      
      for (const id of coursesToDelete) {
        try {
          await contentManager.deleteContent(CONTENT_TYPE, id);
          deleted++;
          progressFill.style.width = `${(deleted / coursesToDelete.length) * 100}%`;
          progressText.textContent = `Deleting ${deleted}/${coursesToDelete.length}...`;
        } catch (err) {
          console.error('Delete failed:', err);
        }
      }
      
      progress.classList.remove('active');
      selectedCourses.clear();
      updateSelectedCount();
      alert(`‚úÖ Deleted ${deleted} course(s)!`);
      loadManageContent();
    }

    function deleteCourse(id) {
      const course = currentContent.find(c => c.id === id);
      const title = course ? course.title : 'this course';
      
      if (confirm(`‚ö†Ô∏è Delete "${title}"?\n\nThis action cannot be undone!`)) {
        contentManager.deleteContent(CONTENT_TYPE, id)
          .then(() => { alert('‚úÖ Course deleted successfully!'); loadManageContent(); })
          .catch(err => alert('‚ùå Delete failed: ' + err.message));
      }
    }
    
    // ==================== YOUTUBE DATA FETCHER ====================
    
    async function fetchYouTubeData() {
      const youtubeUrl = document.getElementById('episodeYoutubeUrl').value;
      if (!youtubeUrl) {
        alert('‚ö†Ô∏è Please enter a YouTube URL first!');
        return;
      }
      
      const videoId = extractVideoId(youtubeUrl);
      if (!videoId) {
        alert('‚ùå Invalid YouTube URL!');
        return;
      }
      
      const btn = event.target;
      const originalText = btn.innerHTML;
      btn.innerHTML = '‚è≥ Fetching...';
      btn.disabled = true;
      
      try {
        // Check if youtube integration is loaded
        if (typeof window.youtubeIntegration === 'undefined') {
          throw new Error('YouTube integration not loaded');
        }
        
        // Fetch from YouTube
        const videoData = await window.youtubeIntegration.fetchFullData(youtubeUrl);
        
        if (!videoData) {
          throw new Error('Failed to fetch video data');
        }
        
        // Auto-populate fields
        if (!document.getElementById('episodeTitle').value) {
          document.getElementById('episodeTitle').value = videoData.title;
        }
        document.getElementById('episodeVideoId').value = videoData.videoId;
        
        if (videoData.duration) {
          document.getElementById('episodeDuration').value = videoData.duration;
        }
        
        alert('‚úÖ Video data fetched successfully!');
        
      } catch (error) {
        console.error('Error fetching YouTube data:', error);
        alert('‚ùå Failed to fetch YouTube data. You can enter details manually.');
      } finally {
        btn.innerHTML = originalText;
        btn.disabled = false;
      }
    }
    
    function extractVideoId(url) {
      const patterns = [
        /(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/,
        /youtube\.com\/embed\/([a-zA-Z0-9_-]{11})/,
        /youtube\.com\/v\/([a-zA-Z0-9_-]{11})/
      ];
      
      for (const pattern of patterns) {
        const match = url.match(pattern);
        if (match) return match[1];
      }
      return null;
    }

    function editCourse(id) {
      const course = currentContent.find(c => c.id === id);
      if (!course) return;
      
      document.getElementById('editCourseId').value = id;
      document.getElementById('editTitle').value = course.title;
      document.getElementById('editSummary').value = course.summary || '';
      document.getElementById('editEpisodes').value = course.episodes || 0;
      document.getElementById('editDuration').value = course.duration || '';
      document.getElementById('editDifficulty').value = course.difficulty || 'Beginner';
      document.getElementById('editLanguage').value = course.language || 'en';
      document.getElementById('editViews').value = course.views || 0;
      document.getElementById('editEnrolled').value = course.enrolled || 0;
      document.getElementById('editInstitution').value = course.institution || 'A3KM Studio';
      document.getElementById('editTags').value = (course.tags || []).join(', ');
      
      loadCategories().then(() => {
        document.getElementById('editCategory').value = course.category;
      });
      
      currentPlaylist = (course.playlist || []).map(ep => ({
        ...ep,
        description: ep.description || '',
        youtubeUrl: ep.youtubeUrl || '',
        tags: ep.tags || []
      }));
      renderPlaylist();
      
      document.getElementById('editModal').classList.add('active');
    }

    function closeEditModal() {
      document.getElementById('editModal').classList.remove('active');
    }

    function renderPlaylist() {
      const container = document.getElementById('playlistContainer');
      if (currentPlaylist.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">No episodes yet. Click "Add Episode" to start.</p>';
        return;
      }
      
      container.innerHTML = '';
      currentPlaylist.forEach((episode, index) => {
        const item = document.createElement('div');
        item.className = 'episode-item';
        
        const tags = episode.tags && episode.tags.length > 0 ? 
          `<br><small style="color: #8B0000;">üè∑Ô∏è ${episode.tags.join(', ')}</small>` : '';
        const description = episode.description ? 
          `<br><small style="color: #666;">${episode.description}</small>` : '';
        const youtubeUrl = episode.youtubeUrl ? 
          `<br><small style="color: #2196f3;">üì∫ <a href="${episode.youtubeUrl}" target="_blank" style="color: #2196f3;">YouTube Link</a></small>` : '';
        const pdfInfo = episode.lecturePdf ? 
          `<br><small style="color: #00897B; font-weight: 600;">üìù PDF: ${episode.lecturePdf.fileName} (${(episode.lecturePdf.size / 1024).toFixed(0)} KB) 
          <a href="${episode.lecturePdf.downloadUrl}" target="_blank" style="color: #00897B; margin-left: 8px;" title="View PDF">üëÅÔ∏è View</a>
          <a href="${episode.lecturePdf.downloadUrl}" download style="color: #00897B; margin-left: 5px;" title="Download PDF">‚¨áÔ∏è Download</a></small>` : '';
        
        item.innerHTML = `
          <span class="episode-serial">${episode.episodeNo}</span>
          <div style="flex: 1;">
            <strong>${episode.title}</strong><br>
            <small style="color: #666;">‚è±Ô∏è ${episode.duration} | üé¨ ${episode.videoId}</small>
            ${description}${tags}${youtubeUrl}${pdfInfo}
          </div>
          <div class="episode-actions">
            ${index > 0 ? `<button onclick="moveEpisode(${index}, -1)" title="Move Up">‚¨ÜÔ∏è</button>` : ''}
            ${index < currentPlaylist.length - 1 ? `<button onclick="moveEpisode(${index}, 1)" title="Move Down">‚¨áÔ∏è</button>` : ''}
            <button onclick="editEpisode(${index})" title="Edit">‚úèÔ∏è</button>
            <button onclick="deleteEpisode(${index})" style="color: #f44336;" title="Delete">üóëÔ∏è</button>
          </div>
        `;
        container.appendChild(item);
      });
      
      updateEpisodeStats();
    }
    
    function updateEpisodeStats() {
      const totalEpisodes = currentPlaylist.length;
      const totalSeconds = currentPlaylist.reduce((sum, ep) => {
        const parts = ep.duration.split(':').map(Number);
        const seconds = parts.length === 2 ? parts[0]*60 + parts[1] : parts[0]*3600 + parts[1]*60 + parts[2];
        return sum + seconds;
      }, 0);
      
      const hours = Math.floor(totalSeconds / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const durationText = hours > 0 ? `${hours}h ${minutes}m` : `${minutes}m`;
      
      document.getElementById('editEpisodes').value = totalEpisodes;
      document.getElementById('editDuration').value = durationText;
    }
    
    function moveEpisode(index, direction) {
      const newIndex = index + direction;
      if (newIndex < 0 || newIndex >= currentPlaylist.length) return;
      
      const temp = currentPlaylist[index];
      currentPlaylist[index] = currentPlaylist[newIndex];
      currentPlaylist[newIndex] = temp;
      
      currentPlaylist[index].episodeNo = index + 1;
      currentPlaylist[newIndex].episodeNo = newIndex + 1;
      
      renderPlaylist();
    }

    // Initialize upload playlist array
    let uploadPlaylist = [];
    let selectedPdfFile = null;
    let pdfToDelete = false; // Track if PDF should be deleted

    // Handle PDF file selection
    function handlePdfSelect(event) {
      const file = event.target.files[0];
      if (file) {
        selectedPdfFile = file;
        pdfToDelete = false;
        const sizeInMB = (file.size / (1024 * 1024)).toFixed(2);
        document.getElementById('pdfFileName').textContent = file.name;
        document.getElementById('pdfFileSize').textContent = sizeInMB + ' MB';
        document.getElementById('pdfPreview').style.display = 'block';
      } else {
        selectedPdfFile = null;
        document.getElementById('pdfPreview').style.display = 'none';
      }
    }
    
    // Remove PDF from episode
    function removePdfFromEpisode() {
      if (confirm('üóëÔ∏è Remove PDF from this episode?')) {
        selectedPdfFile = null;
        pdfToDelete = true;
        document.getElementById('episodePdfFile').value = '';
        document.getElementById('pdfPreview').style.display = 'none';
        alert('‚úÖ PDF will be removed when you save the episode.');
      }
    }

    // Upload PDF to GitHub
    async function uploadLecturePdf(courseId, category, episodeNo, pdfFile) {
      if (!pdfFile) return null;
      
      try {
        const fileName = `lecture-${episodeNo}-${pdfFile.name.replace(/\s+/g, '-')}`;
        const path = `Content Storage/educational-videos/${category}/${courseId}/lectures/${fileName}`;
        
        // Read file as base64
        const reader = new FileReader();
        const base64Content = await new Promise((resolve, reject) => {
          reader.onload = () => resolve(reader.result.split(',')[1]);
          reader.onerror = reject;
          reader.readAsDataURL(pdfFile);
        });
        
        // Upload to GitHub
        const response = await fetch(`https://api.github.com/repos/${githubUploader.config.owner}/${githubUploader.config.repo}/contents/${path}`, {
          method: 'PUT',
          headers: {
            'Authorization': `token ${GITHUB_TOKEN}`,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            message: `Upload lecture PDF for episode ${episodeNo}`,
            content: base64Content
          })
        });
        
        if (!response.ok) throw new Error('PDF upload failed');
        
        const data = await response.json();
        return {
          fileName: fileName,
          path: path,
          downloadUrl: data.content.download_url,
          size: pdfFile.size,
          uploadDate: new Date().toISOString()
        };
      } catch (error) {
        console.error('PDF upload error:', error);
        return null;
      }
    }

    // UPLOAD FORM HANDLER (using the already declared uploadPlaylist variable)
    const uploadFormElement = document.getElementById('uploadForm');
    if (uploadFormElement) {
      uploadFormElement.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        if (uploadPlaylist.length === 0) {
          alert('‚ö†Ô∏è Please add at least one episode to the course!');
          return;
        }
        
        const courseId = `course-${Date.now()}`;
        const category = document.getElementById('category').value;
        
        // Upload PDFs first if any episodes have pending PDFs
        alert('‚è≥ Uploading course and lecture PDFs...');
        
        for (let i = 0; i < uploadPlaylist.length; i++) {
          const episode = uploadPlaylist[i];
          if (episode.lecturePdf && episode.lecturePdf.pendingUpload && episode.lecturePdf.file) {
            const pdfData = await uploadLecturePdf(courseId, category, episode.episodeNo, episode.lecturePdf.file);
            if (pdfData) {
              // Replace pending PDF with uploaded PDF info
              uploadPlaylist[i].lecturePdf = pdfData;
            } else {
              alert(`‚ö†Ô∏è Failed to upload PDF for Episode ${episode.episodeNo}. Continuing...`);
              delete uploadPlaylist[i].lecturePdf;
            }
          }
        }
        
        const course = {
          id: courseId,
          category: category,
          type: 'educational',
          title: document.getElementById('title').value,
          summary: document.getElementById('summary').value,
          date: new Date().toISOString().split('T')[0],
          tags: document.getElementById('tags').value.split(',').map(t => t.trim()).filter(t => t),
          thumbnail: document.getElementById('thumbnail').value,
          episodes: uploadPlaylist.length,
          duration: document.getElementById('duration').value,
          difficulty: document.getElementById('difficulty').value,
          playlist: uploadPlaylist.map(ep => ({...ep})),
          views: 0,
          enrolled: 0,
          language: document.getElementById('language').value,
          institution: document.getElementById('institution').value
        };
        
        try {
          await contentManager.uploadContent(CONTENT_TYPE, course);
          alert('‚úÖ Course uploaded successfully!');
          uploadFormElement.reset();
          uploadPlaylist = [];
          selectedPdfFile = null;
          renderUploadPlaylist();
        } catch (error) {
          alert('‚ùå Upload failed: ' + error.message);
        }
      });
    }
    
    // uploadPlaylist already declared above
    
    function addUploadEpisode() {
      document.getElementById('episodeModalTitle').textContent = 'Add Episode to Course';
      document.getElementById('episodeIndex').value = '';
      document.getElementById('episodeForm').reset();
      document.getElementById('episodeNo').value = uploadPlaylist.length + 1;
      document.getElementById('pdfPreview').style.display = 'none';
      selectedPdfFile = null;
      pdfToDelete = false;
      document.getElementById('episodeModal').classList.add('active');
      
      window.currentEditMode = 'upload';
    }
    
    function addEpisode() {
      document.getElementById('episodeModalTitle').textContent = 'Add Episode';
      document.getElementById('episodeIndex').value = '';
      document.getElementById('episodeForm').reset();
      document.getElementById('episodeNo').value = currentPlaylist.length + 1;
      document.getElementById('pdfPreview').style.display = 'none';
      selectedPdfFile = null;
      pdfToDelete = false;
      document.getElementById('episodeModal').classList.add('active');
      
      window.currentEditMode = 'edit';
    }
    
    function renderUploadPlaylist() {
      const container = document.getElementById('uploadPlaylistContainer');
      if (uploadPlaylist.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">No episodes yet. Click "Add Episode" to start building your course.</p>';
        document.getElementById('episodes').value = 0;
        document.getElementById('duration').value = '0h 0m';
        return;
      }
      
      container.innerHTML = '';
      uploadPlaylist.forEach((episode, index) => {
        const item = document.createElement('div');
        item.className = 'episode-item';
        
        const tags = episode.tags && episode.tags.length > 0 ? 
          `<br><small style="color: #8B0000;">üè∑Ô∏è ${episode.tags.join(', ')}</small>` : '';
        const description = episode.description ? 
          `<br><small style="color: #666;">${episode.description}</small>` : '';
        const youtubeUrl = episode.youtubeUrl ? 
          `<br><small style="color: #2196f3;">üì∫ YouTube</small>` : '';
        const pdfInfo = episode.lecturePdf ? 
          (episode.lecturePdf.pendingUpload ? 
            `<br><small style="color: #FFA726; font-weight: 600;">üìù PDF: ${episode.lecturePdf.fileName} (${(episode.lecturePdf.size / 1024).toFixed(0)} KB) - ‚è≥ Pending Upload</small>` :
            `<br><small style="color: #00897B; font-weight: 600;">üìù PDF: ${episode.lecturePdf.fileName} (${(episode.lecturePdf.size / 1024).toFixed(0)} KB) - ‚úÖ Ready</small>`) : '';
        
        item.innerHTML = `
          <span class="episode-serial">${episode.episodeNo}</span>
          <div style="flex: 1;">
            <strong>${episode.title}</strong><br>
            <small style="color: #666;">‚è±Ô∏è ${episode.duration} | üé¨ ${episode.videoId}</small>
            ${description}${tags}${youtubeUrl}${pdfInfo}
          </div>
          <div class="episode-actions">
            ${index > 0 ? `<button type="button" onclick="moveUploadEpisode(${index}, -1)">‚¨ÜÔ∏è</button>` : ''}
            ${index < uploadPlaylist.length - 1 ? `<button type="button" onclick="moveUploadEpisode(${index}, 1)">‚¨áÔ∏è</button>` : ''}
            <button type="button" onclick="editUploadEpisode(${index})">‚úèÔ∏è</button>
            <button type="button" onclick="deleteUploadEpisode(${index})" style="color: #f44336;">üóëÔ∏è</button>
          </div>
        `;
        container.appendChild(item);
      });
      
      updateUploadEpisodeStats();
    }
    
    function updateUploadEpisodeStats() {
      const totalEpisodes = uploadPlaylist.length;
      const totalSeconds = uploadPlaylist.reduce((sum, ep) => {
        const parts = ep.duration.split(':').map(Number);
        const seconds = parts.length === 2 ? parts[0]*60 + parts[1] : parts[0]*3600 + parts[1]*60 + parts[2];
        return sum + seconds;
      }, 0);
      
      const hours = Math.floor(totalSeconds / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const durationText = hours > 0 ? `${hours}h ${minutes}m` : `${minutes}m`;
      
      document.getElementById('episodes').value = totalEpisodes;
      document.getElementById('duration').value = durationText;
    }
    
    function moveUploadEpisode(index, direction) {
      const newIndex = index + direction;
      if (newIndex < 0 || newIndex >= uploadPlaylist.length) return;
      
      const temp = uploadPlaylist[index];
      uploadPlaylist[index] = uploadPlaylist[newIndex];
      uploadPlaylist[newIndex] = temp;
      
      uploadPlaylist[index].episodeNo = index + 1;
      uploadPlaylist[newIndex].episodeNo = newIndex + 1;
      
      renderUploadPlaylist();
    }
    
    function editUploadEpisode(index) {
      const episode = uploadPlaylist[index];
      document.getElementById('episodeModalTitle').textContent = 'Edit Episode';
      document.getElementById('episodeIndex').value = index;
      document.getElementById('episodeNo').value = episode.episodeNo;
      document.getElementById('episodeTitle').value = episode.title;
      document.getElementById('episodeDescription').value = episode.description || '';
      document.getElementById('episodeDuration').value = episode.duration;
      document.getElementById('episodeYoutubeUrl').value = episode.youtubeUrl || '';
      document.getElementById('episodeVideoId').value = episode.videoId;
      document.getElementById('episodeTags').value = (episode.tags || []).join(', ');
      
      // Reset PDF state
      selectedPdfFile = null;
      pdfToDelete = false;
      document.getElementById('episodePdfFile').value = '';
      
      // Show existing PDF if any
      if (episode.lecturePdf) {
        document.getElementById('pdfPreview').style.display = 'block';
        document.getElementById('pdfFileName').textContent = episode.lecturePdf.fileName;
        document.getElementById('pdfFileSize').textContent = (episode.lecturePdf.size / 1024).toFixed(0) + ' KB';
      } else {
        document.getElementById('pdfPreview').style.display = 'none';
      }
      
      document.getElementById('episodeModal').classList.add('active');
      
      window.currentEditMode = 'upload';
    }
    
    function deleteUploadEpisode(index) {
      if (confirm('Delete this episode?')) {
        uploadPlaylist.splice(index, 1);
        uploadPlaylist.forEach((ep, i) => ep.episodeNo = i + 1);
        renderUploadPlaylist();
      }
    }

    function editEpisode(index) {
      const episode = currentPlaylist[index];
      document.getElementById('episodeModalTitle').textContent = 'Edit Episode';
      document.getElementById('episodeIndex').value = index;
      document.getElementById('episodeNo').value = episode.episodeNo;
      document.getElementById('episodeTitle').value = episode.title;
      document.getElementById('episodeDescription').value = episode.description || '';
      document.getElementById('episodeDuration').value = episode.duration;
      document.getElementById('episodeYoutubeUrl').value = episode.youtubeUrl || '';
      document.getElementById('episodeVideoId').value = episode.videoId;
      document.getElementById('episodeTags').value = (episode.tags || []).join(', ');
      
      // Reset PDF state
      selectedPdfFile = null;
      pdfToDelete = false;
      document.getElementById('episodePdfFile').value = '';
      
      // Show existing PDF if any
      if (episode.lecturePdf) {
        document.getElementById('pdfPreview').style.display = 'block';
        document.getElementById('pdfFileName').textContent = episode.lecturePdf.fileName;
        document.getElementById('pdfFileSize').textContent = (episode.lecturePdf.size / 1024).toFixed(0) + ' KB';
      } else {
        document.getElementById('pdfPreview').style.display = 'none';
      }
      
      document.getElementById('episodeModal').classList.add('active');
      
      window.currentEditMode = 'edit';
    }

    function deleteEpisode(index) {
      if (confirm('Delete this episode?')) {
        currentPlaylist.splice(index, 1);
        renderPlaylist();
      }
    }

    function closeEpisodeModal() {
      document.getElementById('episodeModal').classList.remove('active');
      selectedPdfFile = null;
      pdfToDelete = false;
      document.getElementById('episodePdfFile').value = '';
      document.getElementById('pdfPreview').style.display = 'none';
    }

    document.getElementById('episodeForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const episodeData = {
        episodeNo: parseInt(document.getElementById('episodeNo').value),
        title: document.getElementById('episodeTitle').value,
        description: document.getElementById('episodeDescription').value || '',
        duration: document.getElementById('episodeDuration').value,
        youtubeUrl: document.getElementById('episodeYoutubeUrl').value || '',
        videoId: document.getElementById('episodeVideoId').value,
        tags: document.getElementById('episodeTags').value.split(',').map(t => t.trim()).filter(t => t)
      };
      
      const index = document.getElementById('episodeIndex').value;
      const mode = window.currentEditMode || 'edit';
      
      // Handle PDF - New, Replace, Delete, or Keep existing
      if (pdfToDelete) {
        // User clicked remove - don't include lecturePdf
        delete episodeData.lecturePdf;
      } else if (selectedPdfFile) {
        // New PDF selected (either new episode or replacing existing)
        episodeData.lecturePdf = {
          fileName: selectedPdfFile.name,
          size: selectedPdfFile.size,
          pendingUpload: true,
          file: selectedPdfFile
        };
      } else if (index !== '') {
        // Editing existing episode - keep existing PDF if any
        const existingPlaylist = mode === 'upload' ? uploadPlaylist : currentPlaylist;
        const existingEpisode = existingPlaylist[parseInt(index)];
        if (existingEpisode && existingEpisode.lecturePdf) {
          episodeData.lecturePdf = existingEpisode.lecturePdf;
        }
      }
      
      if (mode === 'upload') {
        if (index === '') {
          uploadPlaylist.push(episodeData);
        } else {
          uploadPlaylist[parseInt(index)] = episodeData;
        }
        uploadPlaylist.sort((a, b) => a.episodeNo - b.episodeNo);
        renderUploadPlaylist();
      } else {
        if (index === '') {
          currentPlaylist.push(episodeData);
        } else {
          currentPlaylist[parseInt(index)] = episodeData;
        }
        currentPlaylist.sort((a, b) => a.episodeNo - b.episodeNo);
        renderPlaylist();
      }
      
      selectedPdfFile = null;
      closeEpisodeModal();
    });

    document.getElementById('editForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const id = document.getElementById('editCourseId').value;
      const originalCourse = currentContent.find(c => c.id === id);
      const category = document.getElementById('editCategory').value;
      
      // Upload any pending PDFs first (for new/replaced PDFs in edited episodes)
      let hasPendingPdfs = false;
      for (let i = 0; i < currentPlaylist.length; i++) {
        const episode = currentPlaylist[i];
        if (episode.lecturePdf && episode.lecturePdf.pendingUpload && episode.lecturePdf.file) {
          hasPendingPdfs = true;
          break;
        }
      }
      
      if (hasPendingPdfs) {
        alert('‚è≥ Uploading new/updated lecture PDFs...');
        for (let i = 0; i < currentPlaylist.length; i++) {
          const episode = currentPlaylist[i];
          if (episode.lecturePdf && episode.lecturePdf.pendingUpload && episode.lecturePdf.file) {
            const pdfData = await uploadLecturePdf(id, category, episode.episodeNo, episode.lecturePdf.file);
            if (pdfData) {
              currentPlaylist[i].lecturePdf = pdfData;
            } else {
              alert(`‚ö†Ô∏è Failed to upload PDF for Episode ${episode.episodeNo}. Continuing...`);
              delete currentPlaylist[i].lecturePdf;
            }
          }
        }
      }
      
      const updatedCourse = {
        ...originalCourse,
        id: id,
        category: category,
        title: document.getElementById('editTitle').value,
        summary: document.getElementById('editSummary').value,
        episodes: parseInt(document.getElementById('editEpisodes').value),
        duration: document.getElementById('editDuration').value,
        difficulty: document.getElementById('editDifficulty').value,
        language: document.getElementById('editLanguage').value,
        views: parseInt(document.getElementById('editViews').value) || 0,
        enrolled: parseInt(document.getElementById('editEnrolled').value) || 0,
        institution: document.getElementById('editInstitution').value,
        tags: document.getElementById('editTags').value.split(',').map(t => t.trim()).filter(t => t),
        playlist: currentPlaylist,
        type: 'educational'
      };
      
      try {
        await contentManager.updateContent(CONTENT_TYPE, id, updatedCourse);
        alert('‚úÖ Course updated successfully!');
        closeEditModal();
        loadManageContent();
      } catch (error) {
        alert('‚ùå Update failed: ' + error.message);
      }
    });

    async function loadDashboard() {
      try {
        const data = await contentManager.loadContent(CONTENT_TYPE);
        const courses = data.courses || [];
        
        const totalEpisodes = courses.reduce((sum, c) => sum + (c.episodes || 0), 0);
        const totalEnrolled = courses.reduce((sum, c) => sum + (c.enrolled || 0), 0);
        const totalViews = courses.reduce((sum, c) => sum + (c.views || 0), 0);
        
        document.getElementById('dashTotalCourses').textContent = courses.length;
        document.getElementById('dashTotalEpisodes').textContent = totalEpisodes;
        document.getElementById('dashTotalEnrolled').textContent = totalEnrolled;
        document.getElementById('dashTotalViews').textContent = totalViews;
        
        document.getElementById('quickTotalCourses').textContent = courses.length;
        document.getElementById('quickTotalEpisodes').textContent = totalEpisodes;
        document.getElementById('quickTotalEnrolled').textContent = totalEnrolled;
      } catch (error) {
        console.error('Failed to load dashboard:', error);
      }
    }

    async function loadStatistics() {
      try {
        const data = await contentManager.loadContent(CONTENT_TYPE);
        const courses = data.courses || [];
        
        document.getElementById('totalCourses').textContent = courses.length;
        
        const categories = new Set(courses.map(c => c.category));
        document.getElementById('totalCategories').textContent = categories.size;
        
        const avgEps = courses.length > 0 ? Math.round(courses.reduce((sum, c) => sum + (c.episodes || 0), 0) / courses.length) : 0;
        document.getElementById('avgEpisodes').textContent = avgEps;
        
        const totalDurationHours = courses.reduce((sum, c) => {
          const match = (c.duration || '0h').match(/(\d+)h/);
          return sum + (match ? parseInt(match[1]) : 0);
        }, 0);
        document.getElementById('totalDuration').textContent = totalDurationHours + 'h';
      } catch (error) {
        console.error('Failed to load stats:', error);
      }
    }

    // JSON Editor Functions
    async function loadJSONEditor() {
      try {
        const data = await contentManager.loadContent(CONTENT_TYPE);
        document.getElementById('jsonEditor').value = JSON.stringify(data, null, 2);
      } catch (error) {
        alert(`‚ùå Failed to load JSON: ${error.message}`);
      }
    }

    function validateJSON() {
      try {
        const jsonText = document.getElementById('jsonEditor').value;
        JSON.parse(jsonText);
        alert('‚úÖ JSON is valid!');
      } catch (error) {
        alert(`‚ùå Invalid JSON: ${error.message}`);
      }
    }

    function formatJSON() {
      try {
        const jsonText = document.getElementById('jsonEditor').value;
        const parsed = JSON.parse(jsonText);
        document.getElementById('jsonEditor').value = JSON.stringify(parsed, null, 2);
        alert('‚ú® JSON formatted successfully!');
      } catch (error) {
        alert(`‚ùå Cannot format invalid JSON: ${error.message}`);
      }
    }

    async function saveJSON() {
      try {
        const jsonText = document.getElementById('jsonEditor').value;
        const parsed = JSON.parse(jsonText);
        
        if (!confirm('‚ö†Ô∏è This will overwrite the entire courses.json file. Are you absolutely sure?')) {
          return;
        }
        
        await contentManager.saveContent(CONTENT_TYPE, parsed);
        alert('‚úÖ JSON saved successfully!');
        loadManageContent();
      } catch (error) {
        alert(`‚ùå Save failed: ${error.message}`);
      }
    }

    window.addEventListener('DOMContentLoaded', () => {
      loadCategories();
      loadDashboard();
    });
  </script>
</body>
</html>
