<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="../../../images/favicon.svg">
  
  <title>Written Posts Manager - A3KM Studio</title>
  
  <!-- Bangla Font Support -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <!-- Load Unified Token Manager -->
  <script src="../shared/unified-token-manager.js"></script>
  <style>
    :root {
      --primary-color: #8B0000;
      --primary-dark: #660000;
      --primary-light: #C80000;
      --bg-dark: rgba(10, 10, 10, 0.98);
      --text-primary: rgba(255, 255, 255, 0.95);
      --text-secondary: rgba(255, 255, 255, 0.7);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: linear-gradient(135deg, #0a0a0a 0%, #1a0a0a 100%);
      color: var(--text-primary);
      font-family: 'Noto Sans Bengali', 'Inter', -apple-system, 'Segoe UI', sans-serif;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }

    /* Engineering Grid Background */
    body::before {
      content: '';
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background-image: 
        repeating-linear-gradient(0deg, rgba(139, 0, 0, 0.03) 0 1px, transparent 1px 30px),
        repeating-linear-gradient(90deg, rgba(139, 0, 0, 0.03) 0 1px, transparent 1px 30px),
        repeating-linear-gradient(45deg, rgba(139, 0, 0, 0.05) 0 2px, transparent 2px 40px);
      background-size: 30px 30px, 30px 30px, 80px 80px;
      pointer-events: none;
      z-index: 0;
      opacity: 0.6;
    }

    /* Header */
    .header {
      position: relative;
      z-index: 100;
      background: linear-gradient(135deg, rgba(102, 0, 0, 0.98), rgba(139, 0, 0, 0.99));
      border-bottom: 3px solid var(--primary-color);
      box-shadow: 0 6px 25px rgba(139, 0, 0, 0.4);
      padding: 20px 40px;
    }

    .header-container {
      max-width: 1600px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .header-icon {
      width: 70px;
      height: 70px;
      background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.2rem;
      box-shadow: 0 0 40px rgba(139, 0, 0, 0.7);
      animation: iconGlow 2s ease-in-out infinite;
    }

    @keyframes iconGlow {
      0%, 100% { box-shadow: 0 0 40px rgba(139, 0, 0, 0.7); }
      50% { box-shadow: 0 0 60px rgba(200, 0, 0, 0.9); }
    }

    .header-title h1 {
      font-size: 2rem;
      color: white;
      margin-bottom: 5px;
      font-weight: 800;
      text-shadow: 0 0 20px rgba(139, 0, 0, 0.5);
    }

    .header-title p {
      font-size: 0.95rem;
      color: var(--text-secondary);
    }

    .header-actions {
      display: flex;
      gap: 15px;
    }

    .btn, .back-btn, .btn-save {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 12px 24px;
      border: 2px solid transparent;
      border-radius: 10px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      font-size: 14px;
    }

    .back-btn {
      background: rgba(255, 255, 255, 0.08);
      color: white;
      border-color: rgba(255, 255, 255, 0.2);
    }

    .back-btn:hover {
      background: rgba(255, 255, 255, 0.15);
      transform: translateY(-2px);
    }

    .btn-save {
      background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
      color: white;
      border-color: var(--primary-color);
      box-shadow: 0 4px 15px rgba(139, 0, 0, 0.3);
    }

    .btn-save:hover {
      background: linear-gradient(135deg, var(--primary-light), var(--primary-color));
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(139, 0, 0, 0.5);
    }

    /* Main Container */
    .container {
      position: relative;
      z-index: 1;
      max-width: 1600px;
      margin: 40px auto;
      padding: 0 40px;
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: 30px;
    }

    /* Sidebar */
    .sidebar {
      background: linear-gradient(135deg, rgba(102, 0, 0, 0.7), rgba(26, 0, 0, 0.9));
      border: 2px solid rgba(139, 0, 0, 0.3);
      border-radius: 18px;
      padding: 25px;
      height: fit-content;
      position: sticky;
      top: 20px;
    }

    .sidebar h2 {
      color: var(--primary-color);
      font-size: 1.3rem;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 800;
    }

    .tab-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .tab-item {
      padding: 12px 15px;
      background: rgba(139, 0, 0, 0.05);
      border: 2px solid transparent;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.95rem;
      color: var(--text-secondary);
      font-weight: 600;
    }

    .tab-item:hover {
      background: rgba(139, 0, 0, 0.15);
      border-color: rgba(139, 0, 0, 0.3);
      color: var(--text-primary);
      transform: translateX(5px);
    }

    .tab-item.active {
      background: rgba(139, 0, 0, 0.25);
      border-color: var(--primary-color);
      color: var(--primary-color);
      font-weight: 700;
      box-shadow: 0 0 20px rgba(139, 0, 0, 0.3);
    }

    .tab-item i {
      font-size: 1.1rem;
    }

    /* Stats Panel */
    .stats-panel {
      margin-top: 25px;
      padding-top: 20px;
      border-top: 2px solid rgba(139, 0, 0, 0.3);
    }

    .stats-panel h3 {
      color: var(--primary-color);
      font-size: 1.1rem;
      margin-bottom: 15px;
      font-weight: 700;
    }

    .stat-item-sidebar {
      display: flex;
      justify-content: space-between;
      padding: 10px;
      background: rgba(0, 0, 0, 0.4);
      border-radius: 8px;
      margin-bottom: 8px;
      border-left: 3px solid var(--primary-color);
    }

    .stat-item-sidebar span:first-child {
      color: var(--text-secondary);
      font-size: 0.85rem;
    }

    .stat-item-sidebar span:last-child {
      color: var(--primary-color);
      font-weight: 700;
    }

    /* Content Area */
    .content-area {
      background: linear-gradient(135deg, rgba(26, 0, 0, 0.7), rgba(0, 0, 0, 0.9));
      border: 2px solid rgba(139, 0, 0, 0.25);
      border-radius: 18px;
      padding: 35px;
      min-height: 600px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
    }

    .tab-content {
      display: none;
      animation: fadeIn 0.4s ease;
    }

    .tab-content.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Content Header */
    .content-header {
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid rgba(139, 0, 0, 0.3);
    }

    .content-header h2 {
      color: var(--primary-color);
      font-size: 1.8rem;
      margin-bottom: 8px;
      font-weight: 800;
    }

    .content-header p {
      color: var(--text-secondary);
      font-size: 1rem;
    }

    /* Dashboard Cards */
    .dashboard-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .dashboard-card {
      padding: 30px;
      background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
      color: white;
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.6);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      border: 2px solid var(--primary-light);
    }

    .dashboard-card::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
      animation: pulse 3s ease-in-out infinite;
    }

    .dashboard-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 30px rgba(139, 0, 0, 0.6);
    }

    .dashboard-card h3 {
      font-size: 3rem;
      margin-bottom: 8px;
      font-weight: 800;
      position: relative;
      z-index: 1;
    }

    .dashboard-card p {
      font-size: 1rem;
      opacity: 0.95;
      position: relative;
      z-index: 1;
      font-weight: 600;
    }

    @keyframes pulse {
      0%, 100% { transform: translate(0, 0) scale(1); }
      50% { transform: translate(-10%, -10%) scale(1.1); }
    }

    /* Forms */
    .upload-form, .edit-form {
      display: grid;
      gap: 25px;
    }

    .form-row, .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 20px;
    }

    .form-group.full-width {
      grid-column: 1 / -1;
    }

    .form-group label {
      color: var(--text-primary);
      font-weight: 600;
      font-size: 0.95rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      padding: 12px 15px;
      background: rgba(0, 0, 0, 0.5);
      border: 2px solid rgba(139, 0, 0, 0.3);
      border-radius: 10px;
      color: var(--text-primary);
      font-size: 1rem;
      font-family: inherit;
      transition: all 0.3s ease;
    }

    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 15px rgba(139, 0, 0, 0.3);
      background: rgba(0, 0, 0, 0.7);
    }

    .form-group textarea {
      min-height: 200px;
      resize: vertical;
      font-family: inherit;
    }

    .form-group small {
      color: var(--text-secondary);
      font-size: 0.85rem;
    }

    /* File Upload */
    .file-upload-label {
      padding: 40px;
      background: rgba(0, 0, 0, 0.4);
      border: 2px dashed var(--primary-color);
      border-radius: 15px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 10px;
      color: var(--text-secondary);
    }

    .file-upload-label:hover {
      border-color: var(--primary-light);
      background: rgba(139, 0, 0, 0.1);
      box-shadow: 0 0 20px rgba(139, 0, 0, 0.3);
    }

    /* Buttons */
    .btn-primary, .preview-btn {
      padding: 15px 30px;
      background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
      color: white;
      border: 2px solid var(--primary-color);
      border-radius: 10px;
      font-weight: 700;
      cursor: pointer;
      width: 100%;
      margin-top: 20px;
      transition: all 0.3s ease;
      font-size: 16px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .btn-primary:hover, .preview-btn:hover {
      background: linear-gradient(135deg, var(--primary-light), var(--primary-color));
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(139, 0, 0, 0.5);
    }

    .preview-btn {
      background: rgba(0, 0, 0, 0.5);
      color: var(--primary-color);
    }

    .preview-btn:hover {
      background: var(--primary-color);
      color: white;
    }

    /* Search & Filters */
    .search-bar, .filters-bar, .filters-container {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      padding: 20px;
      background: rgba(0, 0, 0, 0.5);
      border-radius: 12px;
      border: 2px solid rgba(139, 0, 0, 0.3);
    }

    .search-bar input,
    .filters-bar input,
    .filters-bar select {
      flex: 1;
      min-width: 150px;
      padding: 12px 15px;
      background: rgba(0, 0, 0, 0.6);
      border: 2px solid rgba(139, 0, 0, 0.3);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 14px;
    }

    .search-bar input:focus,
    .filters-bar input:focus,
    .filters-bar select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 10px rgba(139, 0, 0, 0.3);
    }

    /* Content Grid */
    .content-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .content-card {
      background: rgba(0, 0, 0, 0.6);
      border: 2px solid rgba(139, 0, 0, 0.3);
      border-radius: 12px;
      overflow: hidden;
      transition: all 0.3s ease;
      position: relative;
    }

    .content-card:hover {
      border-color: var(--primary-color);
      box-shadow: 0 8px 25px rgba(139, 0, 0, 0.5);
      transform: translateY(-5px);
    }

    .card-thumbnail {
      width: 100%;
      height: 180px;
      object-fit: cover;
      background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
    }

    .card-body {
      padding: 15px;
    }

    .card-title {
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 8px;
      font-size: 16px;
    }

    .card-meta {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 12px;
    }

    .card-actions {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }

    .card-actions button {
      flex: 1;
      padding: 10px;
      border: 2px solid var(--primary-color);
      background: rgba(0, 0, 0, 0.5);
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      transition: all 0.3s ease;
      color: var(--primary-color);
    }

    .card-actions button:hover {
      background: var(--primary-color);
      color: white;
      transform: translateY(-2px);
    }

    .btn-delete, .btn-danger {
      border-color: #f44336 !important;
      color: #f44336 !important;
    }

    .btn-delete:hover, .btn-danger:hover {
      background: #f44336 !important;
      color: white !important;
    }

    /* Bulk Toolbar */
    .bulk-toolbar {
      display: none;
      background: rgba(0, 0, 0, 0.6);
      border: 2px solid var(--primary-color);
      padding: 15px 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      align-items: center;
      gap: 15px;
      flex-wrap: wrap;
    }

    .bulk-toolbar.active {
      display: flex;
      animation: slideDown 0.3s ease;
    }

    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .bulk-toolbar strong {
      color: var(--primary-color);
      font-size: 1.1rem;
    }

    .bulk-toolbar .btn {
      padding: 10px 18px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .bulk-toolbar .btn-select-all {
      background: rgba(33, 150, 243, 0.2);
      border: 2px solid #2196F3;
      color: #2196F3;
    }

    .bulk-toolbar .btn-select-all:hover {
      background: #2196F3;
      color: white;
    }

    .bulk-toolbar .btn-bulk-delete {
      background: rgba(244, 67, 54, 0.2);
      border: 2px solid #f44336;
      color: #f44336;
    }

    .bulk-toolbar .btn-bulk-delete:hover {
      background: #f44336;
      color: white;
    }

    /* Pagination */
    .pagination-controls {
      display: none;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin-top: 30px;
      padding: 20px;
      background: rgba(0, 0, 0, 0.5);
      border: 2px solid rgba(139, 0, 0, 0.3);
      border-radius: 12px;
    }

    .pagination-controls.active {
      display: flex;
    }

    .pagination-controls button {
      padding: 10px 20px;
      background: rgba(0, 0, 0, 0.6);
      border: 2px solid var(--primary-color);
      color: var(--primary-color);
      border-radius: 8px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .pagination-controls button:hover:not(:disabled) {
      background: var(--primary-color);
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(139, 0, 0, 0.3);
    }

    .pagination-controls button:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .pagination-controls span {
      color: var(--primary-color);
      font-weight: 700;
    }

    /* Progress & Messages */
    .progress {
      margin-top: 20px;
      display: none;
    }

    .progress.active {
      display: block;
    }

    .progress-bar {
      width: 100%;
      height: 10px;
      background: rgba(0, 0, 0, 0.5);
      border-radius: 5px;
      overflow: hidden;
      border: 1px solid var(--primary-color);
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
      width: 0%;
      transition: width 0.3s ease;
    }

    .progress-text {
      text-align: center;
      color: var(--primary-color);
      font-size: 14px;
      font-weight: 700;
      margin-top: 10px;
    }

    .success-message {
      background: linear-gradient(135deg, #4caf50, #66bb6a);
      color: white;
      padding: 15px 20px;
      border-radius: 12px;
      margin-top: 20px;
      display: none;
      text-align: center;
      font-weight: 600;
    }

    .success-message.active {
      display: block;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      z-index: 10000;
      overflow-y: auto;
    }

    .modal.active {
      display: block;
    }

    .modal-content {
      max-width: 900px;
      margin: 40px auto;
      background: linear-gradient(135deg, rgba(26, 0, 0, 0.98), rgba(0, 0, 0, 0.99));
      border: 2px solid var(--primary-color);
      border-radius: 20px;
      padding: 40px;
      position: relative;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.9);
    }

    .modal-close {
      position: absolute;
      top: 20px;
      right: 20px;
      background: #f44336;
      color: white;
      border: 2px solid #f44336;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 20px;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-close:hover {
      background: #d32f2f;
      transform: rotate(90deg);
    }

    /* JSON Editor */
    .json-editor-area {
      background: #1e1e1e;
      border: 2px solid var(--primary-color);
      border-radius: 12px;
      padding: 20px;
      min-height: 500px;
    }

    .json-editor-area textarea {
      width: 100%;
      min-height: 500px;
      background: #1e1e1e;
      color: #d4d4d4;
      border: none;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 14px;
      line-height: 1.6;
      resize: vertical;
    }

    .json-editor-area textarea:focus {
      outline: none;
    }

    .json-toolbar {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .json-toolbar button {
      padding: 12px 20px;
      border: 2px solid;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .json-toolbar .btn-validate {
      background: rgba(76, 175, 80, 0.2);
      border-color: #4CAF50;
      color: #4CAF50;
    }

    .json-toolbar .btn-validate:hover {
      background: #4CAF50;
      color: white;
    }

    .json-toolbar .btn-format {
      background: rgba(33, 150, 243, 0.2);
      border-color: #2196F3;
      color: #2196F3;
    }

    .json-toolbar .btn-format:hover {
      background: #2196F3;
      color: white;
    }

    .json-toolbar .btn-download {
      background: rgba(255, 193, 7, 0.2);
      border-color: #FFC107;
      color: #FFC107;
    }

    .json-toolbar .btn-download:hover {
      background: #FFC107;
      color: #333;
    }

    .json-toolbar .btn-import {
      background: rgba(139, 0, 0, 0.2);
      border-color: var(--primary-color);
      color: var(--primary-color);
    }

    .json-toolbar .btn-import:hover {
      background: var(--primary-color);
      color: white;
    }

    /* Statistics */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
      color: white;
      padding: 25px;
      border-radius: 12px;
      text-align: center;
    }

    .stat-card h3 {
      font-size: 2.5rem;
      margin-bottom: 5px;
      font-weight: 800;
    }

    .stat-card p {
      font-size: 0.95rem;
      opacity: 0.95;
    }

    .breakdown-section {
      margin-top: 30px;
      padding: 25px;
      background: rgba(0, 0, 0, 0.5);
      border-radius: 12px;
      border: 2px solid rgba(139, 0, 0, 0.3);
    }

    .breakdown-section h3 {
      color: var(--primary-color);
      margin-bottom: 20px;
      font-size: 1.4rem;
      font-weight: 700;
    }

    .breakdown-item {
      display: flex;
      justify-content: space-between;
      padding: 12px;
      background: rgba(0, 0, 0, 0.4);
      border-radius: 8px;
      margin-bottom: 10px;
      border-left: 4px solid var(--primary-color);
    }

    .breakdown-item strong {
      color: var(--text-primary);
    }

    .breakdown-item span {
      color: var(--primary-color);
      font-weight: 700;
    }

    /* Badges */
    .status-badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      margin-right: 8px;
    }

    .status-draft { background: #FFC107; color: #333; }
    .status-published { background: #4CAF50; color: white; }
    .status-scheduled { background: #2196F3; color: white; }

    .difficulty-indicator {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 5px 10px;
      background: rgba(139, 0, 0, 0.1);
      border-radius: 6px;
      font-size: 12px;
      color: var(--primary-color);
      font-weight: 600;
    }

    .audience-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }

    .audience-tag {
      padding: 6px 12px;
      background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
      color: white;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
    }

    .info-box, .markdown-help {
      background: rgba(139, 0, 0, 0.1);
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      font-size: 13px;
      color: var(--text-secondary);
      border-left: 4px solid var(--primary-color);
    }

    .info-box strong {
      color: var(--primary-color);
    }

    .word-counter {
      display: flex;
      justify-content: space-between;
      padding: 10px 15px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      margin-top: 10px;
      font-size: 13px;
      color: var(--text-secondary);
    }

    .word-counter span {
      font-weight: 600;
      color: var(--primary-color);
    }

    .seo-score {
      display: inline-block;
      padding: 8px 16px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 14px;
    }

    .seo-excellent { background: #4CAF50; color: white; }
    .seo-good { background: #8BC34A; color: white; }
    .seo-fair { background: #FFC107; color: #333; }
    .seo-poor { background: #f44336; color: white; }

    .checkbox-group {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 10px;
      padding: 15px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
    }

    .checkbox-label {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      font-size: 14px;
      color: var(--text-secondary);
    }

    .checkbox-label input {
      cursor: pointer;
      width: 18px;
      height: 18px;
      accent-color: var(--primary-color);
    }

    .btn-icon {
      width: 40px;
      height: 40px;
      flex: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: rgba(139, 0, 0, 0.2);
      border: 2px solid rgba(139, 0, 0, 0.3);
      border-radius: 8px;
      color: var(--primary-color);
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 16px;
      padding: 0;
    }

    .btn-icon:hover {
      background: var(--primary-color);
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(139, 0, 0, 0.4);
    }

    .btn-icon.btn-danger {
      background: rgba(244, 67, 54, 0.2);
      border-color: rgba(244, 67, 54, 0.3);
      color: #f44336;
    }

    .btn-icon.btn-danger:hover {
      background: #f44336;
      color: white;
      border-color: #f44336;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .container {
        grid-template-columns: 1fr;
      }

      .sidebar {
        position: relative;
        top: 0;
      }

      .form-row, .form-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .header {
        padding: 15px 20px;
      }

      .container {
        padding: 0 20px;
        margin: 20px auto;
      }

      .content-area {
        padding: 20px;
      }

      .content-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="header-container">
      <div class="header-left">
        <div class="header-icon">‚úçÔ∏è</div>
        <div class="header-title">
          <h1>Written Posts Manager</h1>
          <p>Professional content management system</p>
        </div>
      </div>
      <div class="header-actions">
        <a href="content-hub.html" class="back-btn">
          <i class="fas fa-arrow-left"></i>
          <span>Back to Hub</span>
        </a>
        <button class="btn-save" onclick="window.location.href='../posts/create-post.html'" style="background: linear-gradient(135deg, #4CAF50, #388E3C); margin-right: 10px;">
          <i class="fas fa-pen-fancy"></i>
          <span>Simple Creator</span>
        </button>
        <button class="btn-save" onclick="saveToGitHub()">
          <i class="fas fa-save"></i>
          <span>Save Changes</span>
        </button>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- Sidebar -->
    <div class="sidebar">
      <h2>
        <i class="fas fa-bars"></i>
        Navigation
      </h2>
      <div class="tab-list">
        <div class="tab-item active" onclick="switchTab('dashboard')">
          <i class="fas fa-chart-line"></i>
          <span>Dashboard</span>
        </div>
        <div class="tab-item" onclick="switchTab('upload')">
          <i class="fas fa-upload"></i>
          <span>Upload New</span>
        </div>
        <div class="tab-item" onclick="switchTab('manage')">
          <i class="fas fa-list"></i>
          <span>Manage Posts</span>
        </div>
        <div class="tab-item" onclick="switchTab('stats')">
          <i class="fas fa-chart-bar"></i>
          <span>Statistics</span>
        </div>
        <div class="tab-item" onclick="switchTab('json')">
          <i class="fas fa-code"></i>
          <span>JSON Editor</span>
        </div>
      </div>

      <div class="stats-panel">
        <h3>
          <i class="fas fa-chart-pie"></i> Quick Stats
        </h3>
        <div class="stat-item-sidebar">
          <span>Total Posts</span>
          <span id="sidebarTotal">0</span>
        </div>
        <div class="stat-item-sidebar">
          <span>Published</span>
          <span id="sidebarPublished">0</span>
        </div>
        <div class="stat-item-sidebar">
          <span>Drafts</span>
          <span id="sidebarDrafts">0</span>
        </div>
        <div class="stat-item-sidebar">
          <span>Total Words</span>
          <span id="sidebarWords">0</span>
        </div>
      </div>
    </div>

    <!-- Content Area -->
    <div class="content-area">

      <!-- Dashboard Tab -->
      <div id="dashboardTab" class="tab-content active">
        <div class="content-header">
          <h2><i class="fas fa-chart-line"></i> Dashboard Overview</h2>
          <p>Summary of your written posts and content analytics</p>
        </div>

        <div class="dashboard-stats">
          <div class="dashboard-card">
            <h3 id="dashTotal">0</h3>
            <p>üìù Total Posts</p>
          </div>
          <div class="dashboard-card" style="background: linear-gradient(135deg, #4CAF50, #388E3C);">
            <h3 id="dashPublished">0</h3>
            <p>‚úÖ Published</p>
          </div>
          <div class="dashboard-card" style="background: linear-gradient(135deg, #FFC107, #FFA000);">
            <h3 id="dashDrafts">0</h3>
            <p>üìù Drafts</p>
          </div>
          <div class="dashboard-card" style="background: linear-gradient(135deg, #2196F3, #1976D2);">
            <h3 id="dashScheduled">0</h3>
            <p>‚è∞ Scheduled</p>
          </div>
        </div>

        <div style="margin-top: 30px; padding: 25px; background: rgba(139, 0, 0, 0.05); border: 2px solid rgba(139, 0, 0, 0.2); border-radius: 15px;">
          <h3 style="color: #8B0000; margin-bottom: 20px;">
            <i class="fas fa-info-circle"></i> Quick Guide
          </h3>
          <ul style="list-style: none; padding: 0;">
            <li style="padding: 12px; margin-bottom: 10px; background: white; border-left: 4px solid #8B0000; border-radius: 8px; color: #333;">
              <strong style="color: #8B0000;">Upload New:</strong> Create new posts with 25+ personalized fields including SEO, difficulty levels, and audience targeting
            </li>
            <li style="padding: 12px; margin-bottom: 10px; background: white; border-left: 4px solid #8B0000; border-radius: 8px; color: #333;">
              <strong style="color: #8B0000;">Manage:</strong> Edit, delete, or organize existing posts with advanced filtering and bulk operations
            </li>
            <li style="padding: 12px; margin-bottom: 10px; background: white; border-left: 4px solid #8B0000; border-radius: 8px; color: #333;">
              <strong style="color: #8B0000;">Statistics:</strong> View comprehensive analytics with difficulty distribution and content type breakdowns
            </li>
            <li style="padding: 12px; background: white; border-left: 4px solid #8B0000; border-radius: 8px; color: #333;">
              <strong style="color: #8B0000;">JSON Editor:</strong> Direct JSON editing with validation, formatting, and import/export capabilities
            </li>
          </ul>
        </div>
      </div>

      <!-- Upload Tab -->
      <div id="uploadTab" class="tab-content">
      <form id="uploadForm">
        <div class="info-box">
          <strong>‚ú® Enhanced Publishing System</strong> - Set status, target audience, difficulty level, and optimize SEO for maximum reach!
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label>üìä Publishing Status</label>
            <select id="status" required>
              <option value="draft">üìù Draft - Work in Progress</option>
              <option value="published" selected>‚úÖ Published - Live Now</option>
              <option value="scheduled">‚è∞ Scheduled - Future Publish</option>
            </select>
          </div>

          <div class="form-group">
            <label>üìÖ Publish Date/Time</label>
            <input type="datetime-local" id="publishDate" value="${new Date().toISOString().slice(0, 16)}">
          </div>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label>ÔøΩ Category Group/Sector</label>
            <select id="categoryGroup" required onchange="updateCategoriesFromGroup('category')">
              <option value="">Select sector first...</option>
            </select>
          </div>

          <div class="form-group">
            <label>üìÅ Specific Category</label>
            <select id="category" required disabled>
              <option value="">Select sector first...</option>
            </select>
          </div>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label>üéØ Difficulty Level</label>
            <select id="difficulty" required>
              <option value="beginner">üü¢ Beginner - Basic Concepts</option>
              <option value="intermediate" selected>üü° Intermediate - Applied Knowledge</option>
              <option value="advanced">üü† Advanced - Expert Level</option>
              <option value="expert">üî¥ Expert - Research/Professional</option>
            </select>
          </div>
        </div>

        <div class="form-group full-width">
          <label>üë• Target Audience (Select all that apply)</label>
          <div class="checkbox-group" id="audienceGroup">
            <label class="checkbox-label"><input type="checkbox" value="students"> üéì Students</label>
            <label class="checkbox-label"><input type="checkbox" value="professionals"> üíº Professionals</label>
            <label class="checkbox-label"><input type="checkbox" value="researchers"> üî¨ Researchers</label>
            <label class="checkbox-label"><input type="checkbox" value="hobbyists"> üõ†Ô∏è Hobbyists</label>
            <label class="checkbox-label"><input type="checkbox" value="beginners"> üå± Beginners</label>
            <label class="checkbox-label"><input type="checkbox" value="educators"> üë®‚Äçüè´ Educators</label>
          </div>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label>üìù Content Type</label>
            <select id="contentType" required>
              <option value="tutorial">üìö Tutorial/Guide</option>
              <option value="article">üì∞ Article/Blog</option>
              <option value="case-study">üîç Case Study</option>
              <option value="review">‚≠ê Review/Analysis</option>
              <option value="opinion">üí≠ Opinion/Commentary</option>
              <option value="technical">‚öôÔ∏è Technical Documentation</option>
              <option value="news">üì¢ News/Update</option>
            </select>
          </div>

          <div class="form-group">
            <label>üíª Code Language (if applicable)</label>
            <select id="codeLanguage">
              <option value="">No code examples</option>
              <option value="javascript">JavaScript</option>
              <option value="python">Python</option>
              <option value="matlab">MATLAB</option>
              <option value="cpp">C/C++</option>
              <option value="java">Java</option>
              <option value="html-css">HTML/CSS</option>
              <option value="sql">SQL</option>
              <option value="other">Other</option>
            </select>
          </div>
        </div>

        <div class="form-group full-width">
          <label>üìå Post Title</label>
          <input type="text" id="title" placeholder="Enter engaging post title..." required>
        </div>

        <div class="form-group full-width">
          <label>üîó Slug (Auto-generated from title)</label>
          <input type="text" id="slug" placeholder="auto-generated-slug" readonly style="background: #f5f5f5;">
        </div>

        <!-- SEO Optimization -->
        <div class="form-group full-width">
          <label>üîç SEO Meta Description (Recommended: 150-160 characters)</label>
          <textarea id="metaDescription" placeholder="Brief description for search engines..." style="min-height: 80px;" maxlength="160"></textarea>
          <div class="word-counter">
            <span>Characters: <span id="metaCharCount">0</span>/160</span>
            <span id="seoScore" class="seo-score seo-poor">SEO: Poor</span>
          </div>
        </div>

        <div class="form-group full-width">
          <label>üè∑Ô∏è Keywords (SEO - comma separated, 5-10 recommended)</label>
          <input type="text" id="keywords" placeholder="engineering, tutorial, guide, MATLAB, projects">
        </div>

        <div class="markdown-help">
          üí° <strong>Markdown Supported:</strong> **bold**, *italic*, # Heading, [link](url), ![image](url), \`code\`, ```code block```, > quote
        </div>

        <div class="form-group full-width">
          <label>‚úçÔ∏è Content (Markdown)</label>
          <textarea id="content" placeholder="Write your post content in Markdown..." required></textarea>
          <div class="word-counter">
            <span>Words: <span id="wordCount">0</span></span>
            <span>Characters: <span id="charCount">0</span></span>
            <span>Estimated Reading: <span id="readTime">0 min</span></span>
          </div>
        </div>

        <div class="form-group full-width">
          <label>üìÑ Excerpt / Summary (Optional)</label>
          <textarea id="description" placeholder="Short summary for post listing..." style="min-height: 80px;"></textarea>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label>‚úçÔ∏è Author</label>
            <input type="text" id="author" placeholder="Your name..." value="Md Akhinoor Islam">
          </div>

          <div class="form-group">
            <label>üë• Co-Authors (Optional)</label>
            <input type="text" id="coAuthors" placeholder="Comma-separated names">
          </div>
        </div>

        <div class="form-group full-width">
          <label>üè∑Ô∏è Tags (comma-separated, for categorization)</label>
          <input type="text" id="tags" placeholder="tutorial, guide, tips, engineering">
        </div>
        
        <div class="form-group full-width">
          <label>üñºÔ∏è Featured Image (Optional)</label>
          <input type="file" id="thumbnail" accept="image/*" style="display: none;">
          <label for="thumbnail" class="file-upload-label">üñºÔ∏è Choose featured image</label>
          <div id="thumbnailInfo" style="margin-top: 10px; color: #666; font-size: 14px;"></div>
        </div>

        <button type="button" class="preview-btn" onclick="previewPost()">üëÅÔ∏è Preview Post</button>
        <button type="submit" class="btn-primary">üì§ Publish Post</button>
        <div class="progress" id="progress">
          <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
          <div class="progress-text" id="progressText">Processing...</div>
        </div>
        <div class="success-message" id="successMessage">‚úÖ Post published successfully!</div>
      </form>
    </div>

    <!-- Manage Posts Tab -->
    <div id="manageTab" class="tab-content">
      <div class="content-header">
        <h2><i class="fas fa-list"></i> Manage Posts</h2>
        <p>Edit, delete, or organize your written posts</p>
      </div>

      <!-- Bulk Operations Toolbar -->
      <div class="bulk-toolbar" id="bulkToolbar">
        <strong><i class="fas fa-check-double"></i> Bulk Actions</strong>
        <span style="flex: 1; color: #666;"><span id="selectedCount">0</span> posts selected</span>
        <button class="btn btn-select-all" onclick="selectAllPosts()">
          <i class="fas fa-check-square"></i> Select All
        </button>
        <button class="btn btn-bulk-delete" onclick="bulkDelete()">
          <i class="fas fa-trash-alt"></i> Delete Selected
        </button>
      </div>

      <div class="search-bar" style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 0.8fr 0.8fr 1fr 1fr 0.8fr; gap: 10px;">
        <input type="text" id="searchInput" placeholder="üîç Search posts..." onkeyup="filterContent()">
        <select id="filterCategoryGroup" onchange="updateFilterCategoriesFromGroup(); filterContent();">
          <option value="">All Sectors</option>
        </select>
        <select id="filterCategory" onchange="updateSubcategoriesPosts(); filterContent();">
          <option value="">All Categories</option>
        </select>
        <select id="filterSubcategory" onchange="filterContent()">
          <option value="">All Subcategories</option>
        </select>
        <input type="date" id="filterDateFrom" onchange="filterContent()" placeholder="From" style="font-size: 12px;">
        <input type="date" id="filterDateTo" onchange="filterContent()" placeholder="To" style="font-size: 12px;">
        <select id="filterStatus" onchange="filterContent()">
          <option value="">All Status</option>
          <option value="published">üìó Published</option>
          <option value="draft">üìô Draft</option>
          <option value="scheduled">üìò Scheduled</option>
        </select>
        <select id="filterDifficulty" onchange="filterContent()">
          <option value="">All Difficulty</option>
          <option value="beginner">üü¢ Beginner</option>
          <option value="intermediate">üü° Intermediate</option>
          <option value="advanced">üü† Advanced</option>
          <option value="expert">üî¥ Expert</option>
        </select>
        <select id="sortBy" onchange="filterContent()">
          <option value="date">Newest First</option>
          <option value="title">Title A-Z</option>
          <option value="category">By Category</option>
          <option value="author">By Author</option>
          <option value="views">Most Viewed</option>
          <option value="words">Most Words</option>
        </select>
      </div>
      
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding: 10px 0;">
        <div style="color: #666; font-size: 14px;">
          Showing <span id="currentPageStart">0</span>-<span id="currentPageEnd">0</span> of <span id="filteredCount">0</span> posts
        </div>
      </div>

      <div class="content-grid" id="contentGrid">
        <p style="text-align: center; padding: 40px; color: #999;">Loading posts...</p>
      </div>

      <!-- Pagination Controls -->
      <div class="pagination-controls" id="paginationControls">
        <button id="prevBtn" onclick="previousPage()" disabled>
          <i class="fas fa-chevron-left"></i> Previous
        </button>
        <span>
          Page <span id="currentPageNum">1</span> of <span id="totalPages">1</span>
        </span>
        <button id="nextBtn" onclick="nextPage()" disabled>
          Next <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>

    <!-- Statistics Tab -->

    <div id="statsTab" class="tab-content">
      <h2 style="color: #8B0000; margin-bottom: 20px;">üìä Content Analytics</h2>
      <div class="stats-grid">
        <div class="stat-card"><h3 id="totalPosts">0</h3><p>Total Posts</p></div>
        <div class="stat-card"><h3 id="publishedPosts">0</h3><p>Published</p></div>
        <div class="stat-card"><h3 id="draftPosts">0</h3><p>Drafts</p></div>
        <div class="stat-card"><h3 id="scheduledPosts">0</h3><p>Scheduled</p></div>
      </div>
      <div class="stats-grid" style="margin-top: 20px;">
        <div class="stat-card" style="background: linear-gradient(135deg, #4CAF50, #45a049);"><h3 id="totalWords">0</h3><p>Total Words</p></div>
        <div class="stat-card" style="background: linear-gradient(135deg, #2196F3, #1976D2);"><h3 id="totalCategories">0</h3><p>Categories Used</p></div>
        <div class="stat-card" style="background: linear-gradient(135deg, #FF9800, #F57C00);"><h3 id="avgReadTime">0</h3><p>Avg Read Time (min)</p></div>
        <div class="stat-card" style="background: linear-gradient(135deg, #9C27B0, #7B1FA2);"><h3 id="totalViews">0</h3><p>Total Views</p></div>
      </div>
      <div style="margin-top: 30px; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        <h3 style="color: #8B0000; margin-bottom: 15px;">üéØ Difficulty Distribution</h3>
        <div class="stats-grid">
          <div style="padding: 15px; background: #f5f5f5; border-radius: 8px; text-align: center;">
            <div style="font-size: 24px; font-weight: 700; color: #4CAF50;" id="beginnerCount">0</div>
            <div style="font-size: 12px; color: #666;">üü¢ Beginner</div>
          </div>
          <div style="padding: 15px; background: #f5f5f5; border-radius: 8px; text-align: center;">
            <div style="font-size: 24px; font-weight: 700; color: #FFC107;" id="intermediateCount">0</div>
            <div style="font-size: 12px; color: #666;">üü° Intermediate</div>
          </div>
          <div style="padding: 15px; background: #f5f5f5; border-radius: 8px; text-align: center;">
            <div style="font-size: 24px; font-weight: 700; color: #FF9800;" id="advancedCount">0</div>
            <div style="font-size: 12px; color: #666;">üü† Advanced</div>
          </div>
          <div style="padding: 15px; background: #f5f5f5; border-radius: 8px; text-align: center;">
            <div style="font-size: 24px; font-weight: 700; color: #f44336;" id="expertCount">0</div>
            <div style="font-size: 12px; color: #666;">üî¥ Expert</div>
          </div>
        </div>
      </div>
      <div style="margin-top: 20px; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        <h3 style="color: #8B0000; margin-bottom: 15px;">üìù Content Types</h3>
        <div id="contentTypesBreakdown" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px;"></div>
      </div>
      <div style="margin-top: 20px; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
        <h3 style="color: #8B0000; margin-bottom: 15px;">üë• Top Categories</h3>
        <div id="topCategories"></div>
      </div>
    </div>

    <!-- JSON Editor Tab -->
    <div id="jsonTab" class="tab-content">
      <div class="content-header">
        <h2><i class="fas fa-code"></i> JSON Editor</h2>
        <p>Direct JSON editing with syntax validation</p>
      </div>

      <div class="json-toolbar">
        <button class="btn-validate" onclick="validateJSON()">
          <i class="fas fa-check-circle"></i> Validate JSON
        </button>
        <button class="btn-format" onclick="formatJSON()">
          <i class="fas fa-indent"></i> Format JSON
        </button>
        <button class="btn-download" onclick="downloadJSON()">
          <i class="fas fa-download"></i> Download JSON
        </button>
        <button class="btn-import" onclick="document.getElementById('jsonImportInput').click()">
          <i class="fas fa-file-import"></i> Import JSON
        </button>
        <input type="file" id="jsonImportInput" accept=".json" style="display: none;" onchange="importJSON(event)">
      </div>

      <div class="json-editor-area">
        <textarea id="jsonEditor" spellcheck="false" placeholder="Loading JSON data..."></textarea>
      </div>

      <div style="margin-top: 15px; padding: 15px; background: rgba(139, 0, 0, 0.05); border-radius: 8px; border-left: 4px solid #8B0000;">
        <strong style="color: #8B0000;"><i class="fas fa-info-circle"></i> JSON Editor Tips:</strong>
        <ul style="margin-top: 10px; padding-left: 20px; color: #666; font-size: 13px;">
          <li>Click "Validate" to check for syntax errors before saving</li>
          <li>Use "Format" to beautify the JSON structure</li>
          <li>Download a backup before making major changes</li>
          <li>Changes here affect the data directly - be careful!</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Edit Modal -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeEditModal()">√ó</button>
      <h2 style="color: #8B0000; margin-bottom: 20px;">‚úèÔ∏è Edit Post</h2>
      <form id="editForm">
        <input type="hidden" id="editPostId">
        
        <div class="form-grid">
          <div class="form-group">
            <label>üìä Publishing Status</label>
            <select id="editStatus" required>
              <option value="draft">üìù Draft</option>
              <option value="published">‚úÖ Published</option>
              <option value="scheduled">‚è∞ Scheduled</option>
            </select>
          </div>
          <div class="form-group">
            <label>üéØ Difficulty Level</label>
            <select id="editDifficulty">
              <option value="beginner">üü¢ Beginner</option>
              <option value="intermediate">üü° Intermediate</option>
              <option value="advanced">üü† Advanced</option>
              <option value="expert">üî¥ Expert</option>
            </select>
          </div>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label>üìÇ Category Group/Sector</label>
            <select id="editCategoryGroup" required onchange="updateCategoriesFromGroup('editCategory', 'edit')">
              <option value="">Select sector...</option>
            </select>
          </div>

          <div class="form-group">
            <label>üìÅ Specific Category</label>
            <select id="editCategory" required disabled>
              <option value="">Select sector first...</option>
            </select>
          </div>
        </div>

        <div class="form-group full-width">
          <label>üìù Content Type</label>
          <select id="editContentType">
            <option value="tutorial">üìö Tutorial/Guide</option>
            <option value="article">üì∞ Article/Blog</option>
            <option value="case-study">üîç Case Study</option>
            <option value="review">‚≠ê Review/Analysis</option>
            <option value="opinion">üí≠ Opinion/Commentary</option>
            <option value="technical">‚öôÔ∏è Technical Documentation</option>
            <option value="news">üì¢ News/Update</option>
          </select>
        </div>

        <div class="form-group full-width">
          <label>Post Title</label>
          <input type="text" id="editTitle" required>
        </div>
        
        <div class="form-group full-width">
          <label>üîç SEO Meta Description</label>
          <textarea id="editMetaDescription" maxlength="160" style="min-height: 60px;"></textarea>
        </div>

        <div class="form-group full-width">
          <label>
            <i class="fas fa-file-code"></i> Content (Markdown)
            <span style="float: right; font-size: 11px; color: #666;" id="mdFileStatus">
              <i class="fas fa-sync fa-spin"></i> Loading from file...
            </span>
          </label>
          <textarea id="editContent" required style="min-height: 300px; font-family: 'Noto Sans Bengali', 'Inter', 'Courier New', monospace;"></textarea>
          <div style="margin-top: 5px; font-size: 11px; color: #666;">
            <i class="fas fa-info-circle"></i> This will update the actual .md file in Content Storage
          </div>
        </div>
        
        <div class="form-group full-width">
          <label>Excerpt</label>
          <textarea id="editDescription" style="min-height: 80px;"></textarea>
        </div>
        
        <div class="form-grid">
          <div class="form-group">
            <label>Author</label>
            <input type="text" id="editAuthor">
          </div>
          <div class="form-group">
            <label>Co-Authors</label>
            <input type="text" id="editCoAuthors" placeholder="Comma-separated">
          </div>
        </div>
        
        <div class="form-grid">
          <div class="form-group">
            <label>Tags (comma-separated)</label>
            <input type="text" id="editTags">
          </div>
          <div class="form-group">
            <label>Keywords (SEO)</label>
            <input type="text" id="editKeywords">
          </div>
        </div>
        
        <div class="form-group full-width">
          <label>üíª Code Language (if applicable)</label>
          <select id="editCodeLanguage">
            <option value="none">None</option>
            <option value="javascript">JavaScript</option>
            <option value="python">Python</option>
            <option value="java">Java</option>
            <option value="cpp">C++</option>
            <option value="csharp">C#</option>
            <option value="php">PHP</option>
            <option value="ruby">Ruby</option>
            <option value="go">Go</option>
          </select>
        </div>
        
        <div class="form-group full-width">
          <label>üë• Target Audience (select all that apply)</label>
          <div class="checkbox-group" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
            <label><input type="checkbox" name="editAudience" value="students"> üéì Students</label>
            <label><input type="checkbox" name="editAudience" value="professionals"> üíº Professionals</label>
            <label><input type="checkbox" name="editAudience" value="researchers"> üî¨ Researchers</label>
            <label><input type="checkbox" name="editAudience" value="hobbyists"> üé® Hobbyists</label>
            <label><input type="checkbox" name="editAudience" value="educators"> üë®‚Äçüè´ Educators</label>
            <label><input type="checkbox" name="editAudience" value="general"> üåç General Public</label>
          </div>
        </div>
        
        <!-- Thumbnail/Cover Image Replacement/Deletion -->
        <div class="form-group full-width" style="background: rgba(139, 0, 0, 0.05); padding: 15px; border-radius: 8px; border: 2px dashed rgba(139, 0, 0, 0.3);">
          <label style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
            <span><i class="fas fa-image"></i> üñºÔ∏è Replace Thumbnail/Cover Image (Optional)</span>
            <button type="button" onclick="deletePostThumbnail()" style="padding: 6px 12px; background: #f44336; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600;">
              <i class="fas fa-trash"></i> Delete Current Image
            </button>
          </label>
          <input type="file" id="edit-thumbnailFile" accept="image/*" onchange="handleEditThumbnailSelect(event)">
          <small style="color: #444; display: block; margin-top: 8px;">
            ‚úÖ Upload new image to replace existing thumbnail | ‚ùå Delete button removes image from storage<br>
            üìã Current: <span id="edit-currentThumbnailPath" style="color: #B71C1C; font-weight: 600;">Loading...</span>
          </small>
          <div id="edit-thumbnailPreview" style="display: none; margin-top: 10px;">
            <img id="edit-thumbnailPreviewImg" src="" alt="Preview" style="max-width: 200px; max-height: 150px; border-radius: 8px; border: 2px solid #8B0000;">
            <button type="button" onclick="removeEditThumbnailSelection()" style="margin-top: 8px; background: #f44336; color: white; border: none; padding: 5px 12px; border-radius: 6px; cursor: pointer; font-weight: 600; display: block;">‚ùå Remove</button>
          </div>
        </div>
        
        <!-- Markdown File Deletion Option -->
        <div class="form-group full-width" style="background: rgba(255, 152, 0, 0.05); padding: 15px; border-radius: 8px; border: 2px dashed rgba(255, 152, 0, 0.3);">
          <label style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 5px;">
            <span><i class="fas fa-file-code"></i> üìÑ Markdown File</span>
            <button type="button" onclick="deletePostMarkdownFile()" style="padding: 6px 12px; background: #f44336; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600;">
              <i class="fas fa-trash"></i> Delete .md File
            </button>
          </label>
          <small style="color: #444; display: block;">
            ‚ö†Ô∏è Delete markdown file will remove the .md file from GitHub storage<br>
            üìã File: <span id="edit-currentMarkdownPath" style="color: #F57C00; font-weight: 600;">Loading...</span>
          </small>
        </div>
        
        <button type="submit" class="btn-primary">üíæ Update Post</button>
      </form>
    </div>
  </div>

  <script src="svg-generator.js"></script>
  <script src="github-content-uploader.js"></script>
  <script src="content-manager.js"></script>
  <script>
    // GitHub token must be set via API Config Manager - no default token for security
    const GITHUB_TOKEN = localStorage.getItem('github_token') || '';
    
    // Token validation on page load
    if (!GITHUB_TOKEN) {
      const userChoice = confirm(
        '‚ö†Ô∏è GitHub Token Not Found!\n\n' +
        'This manager requires a GitHub token to function.\n\n' +
        'Click OK to go to API Config Manager and set your token.\n' +
        'Click Cancel to continue anyway (features will not work).'
      );
      if (userChoice) {
        window.location.href = '../../shared/api-config-manager.html';
      } else {
        console.warn('‚ö†Ô∏è Manager running without GitHub token - upload features disabled');
      }
    }
    
    const CONTENT_TYPE = 'written-posts';
    const svgGenerator = new SVGCoverGenerator();
    const githubUploader = new GitHubContentUploader({ token: GITHUB_TOKEN, owner: 'Akhinoor14', repo: 'A3KM-Studio' });
    const contentManager = new ContentManager(githubUploader);
    let currentContent = [];
    let filteredContent = [];
    let currentPage = 1;
    const postsPerPage = 10;

    // Load category groups from JSON (150+ categories in 9 sectors)
    async function loadCategories() {
      try {
        const data = await contentManager.loadContent(CONTENT_TYPE);
        
        // Populate category group dropdowns (sector selection)
        const groupSelects = ['categoryGroup', 'editCategoryGroup', 'filterCategoryGroup'];
        groupSelects.forEach(selectId => {
          const select = document.getElementById(selectId);
          if (!select) return;
          
          // Clear and add default option
          const isFilter = selectId === 'filterCategoryGroup';
          select.innerHTML = isFilter 
            ? '<option value="">All Sectors</option>' 
            : '<option value="">Select sector first...</option>';
          
          // Sort groups by order and add them
          const sortedGroups = data.categoryGroups.sort((a, b) => (a.order || 0) - (b.order || 0));
          sortedGroups.forEach(group => {
            const option = document.createElement('option');
            option.value = group.id;
            option.textContent = `${group.icon} ${group.name} (${group.categories.length})`;
            option.dataset.categories = JSON.stringify(group.categories);
            select.appendChild(option);
          });
        });
        
        console.log(`‚úÖ Posts Manager: Loaded ${data.categoryGroups.length} sectors with 150+ categories`);
      } catch (error) {
        console.error('Error loading categories:', error);
      }
    }
    
    // Update category dropdown based on selected sector
    function updateCategoriesFromGroup(categorySelectId, mode = 'upload') {
      const groupSelectId = mode === 'edit' ? 'editCategoryGroup' : 'categoryGroup';
      const groupSelect = document.getElementById(groupSelectId);
      const categorySelect = document.getElementById(categorySelectId);
      
      if (!groupSelect || !categorySelect) return;
      
      const selectedOption = groupSelect.options[groupSelect.selectedIndex];
      
      if (!selectedOption || !selectedOption.dataset.categories) {
        categorySelect.innerHTML = '<option value="">Select sector first...</option>';
        categorySelect.disabled = true;
        return;
      }
      
      // Enable and populate category dropdown
      categorySelect.disabled = false;
      categorySelect.innerHTML = '<option value="">Select category...</option>';
      
      const categories = JSON.parse(selectedOption.dataset.categories);
      categories.forEach(cat => {
        const option = document.createElement('option');
        option.value = cat;
        option.textContent = cat;
        categorySelect.appendChild(option);
      });
    }

    // Hardcoded categories for immediate display
    const CATEGORIES = {
      'Technology & Programming': ['Web Development', 'Mobile Apps', 'AI & Machine Learning', 'Data Science', 'Cybersecurity', 'Cloud Computing'],
      'Engineering': ['Electrical Engineering', 'Mechanical Engineering', 'Civil Engineering', 'Arduino & IoT', 'MATLAB', 'SolidWorks'],
      'Science': ['Physics', 'Chemistry', 'Biology', 'Mathematics', 'Astronomy', 'Environmental Science'],
      'Business & Career': ['Entrepreneurship', 'Marketing', 'Finance', 'Career Development', 'Productivity', 'Leadership'],
      'Creative & Design': ['Graphic Design', 'UI/UX', 'Photography', 'Video Editing', 'Content Writing', '3D Modeling'],
      'Education & Learning': ['Study Tips', 'Online Courses', 'Research Methods', 'Academic Writing', 'Teaching', 'Language Learning']
    };

    // Update filter categories when sector changes
    function updateFilterCategoriesFromGroup() {
      const groupSelect = document.getElementById('filterCategoryGroup');
      const categorySelect = document.getElementById('filterCategory');
      const selectedGroup = groupSelect.value;
      
      categorySelect.innerHTML = '<option value="">All Categories</option>';
      
      if (selectedGroup && CATEGORIES[selectedGroup]) {
        CATEGORIES[selectedGroup].forEach(cat => {
          const option = document.createElement('option');
          option.value = cat;
          option.textContent = cat;
          categorySelect.appendChild(option);
        });
      } else {
        // Show all categories from all groups if "All Sectors" selected
        Object.values(CATEGORIES).flat().sort().forEach(cat => {
          const option = document.createElement('option');
          option.value = cat;
          option.textContent = cat;
          categorySelect.appendChild(option);
        });
      }
    }

    // Update categories based on selected group
    function updateCategoriesFromGroup(targetSelectId, editPrefix = '') {
      const groupSelect = document.getElementById(editPrefix + 'categoryGroup');
      const categorySelect = document.getElementById(targetSelectId);
      const selectedGroup = groupSelect.value;
      
      categorySelect.innerHTML = '<option value="">Select category...</option>';
      
      if (selectedGroup && CATEGORIES[selectedGroup]) {
        categorySelect.disabled = false;
        CATEGORIES[selectedGroup].forEach(cat => {
          const option = document.createElement('option');
          option.value = cat;
          option.textContent = cat;
          categorySelect.appendChild(option);
        });
      } else {
        categorySelect.disabled = true;
      }
    }

    // Removed duplicate loadCategories - using the working version at line 1805
    
    // Update subcategories based on selected category
    function updateSubcategoriesPosts() {
      const category = document.getElementById('filterCategory').value;
      const subcategorySelect = document.getElementById('filterSubcategory');
      subcategorySelect.innerHTML = '<option value="">All Subcategories</option>';
      
      if (!category || currentContent.length === 0) return;
      
      // Get unique subcategories for this category
      const subcategories = [...new Set(
        currentContent
          .filter(item => item.category === category && item.subcategory)
          .map(item => item.subcategory)
      )].sort();
      
      subcategories.forEach(sub => {
        const option = document.createElement('option');
        option.value = sub;
        option.textContent = sub;
        subcategorySelect.appendChild(option);
      });
    }
    
    // Filter content function
    function filterContent() {
      if (!currentContent || currentContent.length === 0) return;
      
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const category = document.getElementById('filterCategory').value;
      const subcategory = document.getElementById('filterSubcategory').value;
      const dateFrom = document.getElementById('filterDateFrom').value;
      const dateTo = document.getElementById('filterDateTo').value;
      const status = document.getElementById('filterStatus').value;
      const difficulty = document.getElementById('filterDifficulty').value;
      const sortBy = document.getElementById('sortBy').value;
      
      let filtered = currentContent.filter(item => {
        // Search filter
        if (searchTerm && !item.title.toLowerCase().includes(searchTerm) && 
            !(item.description || '').toLowerCase().includes(searchTerm)) {
          return false;
        }
        
        // Category filter
        if (category && item.category !== category) return false;
        
        // Subcategory filter
        if (subcategory && item.subcategory !== subcategory) return false;
        
        // Date range filter
        if (dateFrom || dateTo) {
          const itemDate = new Date(item.date || item.uploadDate || item.publishDate);
          if (dateFrom && itemDate < new Date(dateFrom)) return false;
          if (dateTo && itemDate > new Date(dateTo)) return false;
        }
        
        // Status filter
        if (status && item.status !== status) return false;
        
        // Difficulty filter
        if (difficulty && item.difficulty !== difficulty) return false;
        
        return true;
      });
      
      // Sorting
      filtered.sort((a, b) => {
        switch(sortBy) {
          case 'title':
            return a.title.localeCompare(b.title);
          case 'category':
            return a.category.localeCompare(b.category);
          case 'author':
            return (a.author || '').localeCompare(b.author || '');
          case 'views':
            return (b.views || 0) - (a.views || 0);
          case 'words':
            return (b.wordCount || 0) - (a.wordCount || 0);
          case 'date':
          default:
            return new Date(b.date || b.uploadDate || 0) - new Date(a.date || a.uploadDate || 0);
        }
      });
      
      currentPage = 1;
      renderContent(filtered);
      
      // Update bulk toolbar
      updateBulkToolbar();
    }
    
    // Update bulk operations toolbar
    function updateBulkToolbar() {
      const checkboxes = document.querySelectorAll('.post-checkbox');
      const checkedCount = document.querySelectorAll('.post-checkbox:checked').length;
      const toolbar = document.getElementById('bulkToolbar');
      
      if (checkedCount > 0) {
        toolbar.classList.add('active');
        document.getElementById('selectedCount').textContent = checkedCount;
      } else {
        toolbar.classList.remove('active');
      }
    }
    
    // Pagination functions
    function nextPage() {
      const totalPages = Math.ceil(filteredContent.length / postsPerPage);
      if (currentPage < totalPages) {
        currentPage++;
        renderContent(filteredContent);
      }
    }
    
    function previousPage() {
      if (currentPage > 1) {
        currentPage--;
        renderContent(filteredContent);
      }
    }

    // Auto-generate slug from title
    document.getElementById('title').addEventListener('input', function() {
      const slug = contentManager.slugify(this.value);
      document.getElementById('slug').value = slug;
    });

    // Live word counter and reading time calculator
    document.getElementById('content').addEventListener('input', function() {
      const text = this.value.trim();
      const words = text ? text.split(/\s+/).length : 0;
      const chars = text.length;
      const readTime = Math.ceil(words / 200); // Average reading speed: 200 words/min
      
      document.getElementById('wordCount').textContent = words;
      document.getElementById('charCount').textContent = chars;
      document.getElementById('readTime').textContent = `${readTime} min`;
    });

    // SEO meta description character counter and scoring
    document.getElementById('metaDescription').addEventListener('input', function() {
      const length = this.value.length;
      const charCount = document.getElementById('metaCharCount');
      const seoScore = document.getElementById('seoScore');
      
      charCount.textContent = length;
      
      // SEO scoring logic
      seoScore.className = 'seo-score';
      if (length === 0) {
        seoScore.textContent = 'SEO: Poor';
        seoScore.classList.add('seo-poor');
      } else if (length < 120) {
        seoScore.textContent = 'SEO: Fair';
        seoScore.classList.add('seo-fair');
      } else if (length >= 120 && length <= 160) {
        seoScore.textContent = 'SEO: Excellent';
        seoScore.classList.add('seo-excellent');
      } else {
        seoScore.textContent = 'SEO: Good';
        seoScore.classList.add('seo-good');
      }
    });

    // Preview post function
    function previewPost() {
      const title = document.getElementById('title').value;
      const content = document.getElementById('content').value;
      const difficulty = document.getElementById('difficulty').value;
      const status = document.getElementById('status').value;
      
      if (!title || !content) {
        alert('‚ö†Ô∏è Please add title and content first!');
        return;
      }
      
      const previewWindow = window.open('', '_blank', 'width=800,height=600');
      previewWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
          <title>Preview: ${title}</title>
          <style>
            body { font-family: 'Segoe UI', sans-serif; max-width: 800px; margin: 40px auto; padding: 20px; background: #f5f5f5; }
            .preview-header { background: white; padding: 30px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
            h1 { color: #8B0000; margin-bottom: 15px; }
            .meta { color: #666; font-size: 14px; margin-bottom: 20px; }
            .badge { display: inline-block; padding: 6px 12px; border-radius: 6px; font-size: 12px; font-weight: 600; margin-right: 8px; }
            .content { background: white; padding: 30px; border-radius: 12px; line-height: 1.8; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
            code { background: #f5f5f5; padding: 2px 6px; border-radius: 4px; font-family: 'Courier New', monospace; }
            pre { background: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 8px; overflow-x: auto; }
          </style>
        </head>
        <body>
          <div class="preview-header">
            <h1>${title}</h1>
            <div class="meta">
              <span class="badge" style="background: ${status === 'published' ? '#4CAF50' : '#FFC107'};">${status.toUpperCase()}</span>
              <span class="badge" style="background: rgba(139, 0, 0, 0.1); color: #8B0000;">${difficulty.toUpperCase()}</span>
            </div>
          </div>
          <div class="content">${content.replace(/\n/g, '<br>')}</div>
        </body>
        </html>
      `);
    }

    document.getElementById('thumbnail').addEventListener('change', function() {
      if (this.files[0]) document.getElementById('thumbnailInfo').textContent = `üñºÔ∏è ${this.files[0].name}`;
    });

    document.getElementById('uploadForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      // Validate GitHub token
      if (GITHUB_TOKEN === 'YOUR_GITHUB_TOKEN_HERE' || !GITHUB_TOKEN) {
        alert('‚ùå Please set your GitHub token first!');
        return;
      }
      
      const progress = document.getElementById('progress');
      const progressFill = document.getElementById('progressFill');
      const progressText = document.getElementById('progressText');
      const successMessage = document.getElementById('successMessage');
      progress.classList.add('active');
      successMessage.classList.remove('active');
      try {
        const title = document.getElementById('title').value;
        const category = document.getElementById('category').value;
        const content = document.getElementById('content').value;
        const slug = document.getElementById('slug').value;
        
        // Get new personalized fields
        const status = document.getElementById('status').value;
        const difficulty = document.getElementById('difficulty').value;
        const contentType = document.getElementById('contentType').value;
        const codeLanguage = document.getElementById('codeLanguage').value;
        const publishDate = document.getElementById('publishDate').value;
        const metaDescription = document.getElementById('metaDescription').value;
        const keywords = document.getElementById('keywords').value;
        const coAuthors = document.getElementById('coAuthors').value;
        
        // Get selected audiences
        const audiences = [];
        document.querySelectorAll('#audienceGroup input:checked').forEach(cb => {
          audiences.push(cb.value);
        });
        
        // Duplicate check
        progressText.textContent = 'Checking for duplicates...';
        progressFill.style.width = '20%';
        const duplicateCheck = await contentManager.checkDuplicates(CONTENT_TYPE, title, category);
        if (duplicateCheck.isDuplicate) {
          const confirm = window.confirm(`‚ö†Ô∏è A post with title "${title}" already exists. Upload anyway?`);
          if (!confirm) {
            progress.classList.remove('active');
            return;
          }
        }
        
        // Calculate reading metrics
        const wordCount = content.trim().split(/\s+/).length;
        const charCount = content.length;
        const readTime = Math.ceil(wordCount / 200);
        
        // Create enhanced markdown file
        progressText.textContent = 'Creating markdown file...';
        progressFill.style.width = '40%';
        const mdContent = `---
title: ${title}
author: ${document.getElementById('author').value}
coAuthors: ${coAuthors || 'None'}
date: ${publishDate || new Date().toISOString()}
status: ${status}
difficulty: ${difficulty}
contentType: ${contentType}
codeLanguage: ${codeLanguage || 'None'}
targetAudience: [${audiences.join(', ')}]
tags: [${document.getElementById('tags').value}]
keywords: ${keywords}
metaDescription: ${metaDescription}
readingTime: ${readTime}
wordCount: ${wordCount}
---

${content}`;
        const mdFile = new File([mdContent], `${slug}.md`, { type: 'text/markdown' });
        
        progressText.textContent = 'Generating cover...';
        progressFill.style.width = '50%';
        const coverSVG = await svgGenerator.generateCover(category, 0);
        
        progressText.textContent = 'Uploading to GitHub...';
        progressFill.style.width = '70%';
        const contentId = `post-${Date.now()}`;
        
        // Upload markdown file to Content Studio/written-posts/
        const mdPath = `Content Studio/written-posts/${slug}.md`;
        await githubUploader.uploadFile(mdPath, mdContent, `Add post: ${title}`, false);
        
        await githubUploader.uploadCompleteContent({
          contentType: CONTENT_TYPE,
          category: category,
          contentId: contentId,
          title: title,
          description: document.getElementById('description').value || metaDescription,
          tags: document.getElementById('tags').value.split(',').map(t => t.trim()),
          author: document.getElementById('author').value,
          contentFile: mdFile,
          thumbnailFile: document.getElementById('thumbnail').files[0],
          coverSVG: coverSVG,
          metadata: {
            slug: slug,
            status: status,
            difficulty: difficulty,
            contentType: contentType,
            codeLanguage: codeLanguage,
            targetAudience: audiences,
            publishDate: publishDate,
            metaDescription: metaDescription,
            keywords: keywords.split(',').map(k => k.trim()),
            coAuthors: coAuthors ? coAuthors.split(',').map(a => a.trim()) : [],
            readTime: readTime,
            views: 0,
            likes: 0,
            wordCount: wordCount,
            charCount: charCount,
            contentPreview: content.substring(0, 200),
            markdownFile: mdPath,
            contentPath: mdPath
          }
        });
        
        progressFill.style.width = '100%';
        progressText.textContent = 'Complete!';
        
        // Update Content Hub counter
        if (typeof ContentHubSync !== 'undefined') {
          ContentHubSync.updateCount('posts', {
            title: title,
            category: category,
            action: 'Uploaded'
          });
        }
        
        // Enhanced success message
        const audienceText = audiences.length > 0 ? audiences.join(', ') : 'General';
        alert(`‚úÖ Post Published Successfully!\n\nüìä Post Details:\n` +
              `üìù Title: ${title}\n` +
              `üéØ Difficulty: ${difficulty.toUpperCase()}\n` +
              `üìÅ Category: ${category}\n` +
              `üë• Audience: ${audienceText}\n` +
              `üìñ Reading Time: ${readTime} min\n` +
              `üìè Words: ${wordCount}\n` +
              `üè∑Ô∏è Content Type: ${contentType}\n` +
              `üìÖ Status: ${status.toUpperCase()}\n` +
              `${codeLanguage ? `üíª Code Language: ${codeLanguage}\n` : ''}` +
              `${metaDescription ? `üîç SEO Optimized: ‚úì\n` : ''}`);
        
        progress.classList.remove('active');
        successMessage.classList.add('active');
        setTimeout(() => { this.reset(); successMessage.classList.remove('active'); }, 3000);
      } catch (error) {
        progress.classList.remove('active');
        alert(`‚ùå Upload failed: ${error.message}`);
      }
    });

    function switchTab(tabName) {
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab-item').forEach(btn => btn.classList.remove('active'));
      document.getElementById(tabName + 'Tab').classList.add('active');
      event.target.classList.add('active');
      if (tabName === 'dashboard') loadDashboardStats();
      if (tabName === 'manage') loadManageContent();
      if (tabName === 'stats') loadStatistics();
      if (tabName === 'json') loadJSONEditor();
    }

    // Dashboard Stats Loading
    async function loadDashboardStats() {
      try {
        const data = await contentManager.loadContent(CONTENT_TYPE);
        const items = contentManager.getItemsFromData(data, CONTENT_TYPE) || [];
        
        console.log('Posts Dashboard - Loaded posts:', items.length, 'items');
        
        const total = items.length;
        const published = items.filter(i => i.status === 'published').length;
        const drafts = items.filter(i => i.status === 'draft').length;
        const scheduled = items.filter(i => i.status === 'scheduled').length;
        const totalWords = items.reduce((sum, item) => sum + (item.wordCount || 0), 0);
        
        // Update dashboard cards
        document.getElementById('dashTotal').textContent = total;
        document.getElementById('dashPublished').textContent = published;
        document.getElementById('dashDrafts').textContent = drafts;
        document.getElementById('dashScheduled').textContent = scheduled;
        
        // Update sidebar quick stats
        document.getElementById('sidebarTotal').textContent = total;
        document.getElementById('sidebarPublished').textContent = published;
        document.getElementById('sidebarDrafts').textContent = drafts;
        document.getElementById('sidebarWords').textContent = totalWords.toLocaleString();
      } catch (error) {
        console.error('Dashboard stats error:', error);
      }
    }

    async function loadManageContent() {
      const grid = document.getElementById('contentGrid');
      grid.innerHTML = '<p style="text-align: center; padding: 40px; color: #999;">Loading...</p>';
      try {
        const data = await contentManager.loadContent(CONTENT_TYPE);
        currentContent = contentManager.getItemsFromData(data, CONTENT_TYPE);
        renderContent(currentContent);
      } catch (error) {
        grid.innerHTML = '<p style="text-align: center; padding: 40px; color: #f44336;">Failed to load posts</p>';
        console.error('Load error:', error);
      }
    }

    function renderContent(items) {
      filteredContent = items;
      const grid = document.getElementById('contentGrid');
      
      if (items.length === 0) { 
        grid.innerHTML = '<p style="text-align: center; padding: 40px; color: #999;">No posts yet</p>'; 
        document.getElementById('paginationControls').classList.remove('active');
        document.getElementById('filteredCount').textContent = '0';
        document.getElementById('currentPageStart').textContent = '0';
        document.getElementById('currentPageEnd').textContent = '0';
        return; 
      }
      
      // Pagination logic
      const totalPages = Math.ceil(items.length / postsPerPage);
      const startIndex = (currentPage - 1) * postsPerPage;
      const endIndex = Math.min(startIndex + postsPerPage, items.length);
      const paginatedItems = items.slice(startIndex, endIndex);
      
      // Update pagination display
      document.getElementById('filteredCount').textContent = items.length;
      document.getElementById('currentPageStart').textContent = startIndex + 1;
      document.getElementById('currentPageEnd').textContent = endIndex;
      document.getElementById('currentPageNum').textContent = currentPage;
      document.getElementById('totalPages').textContent = totalPages;
      
      // Show/hide pagination
      const paginationControls = document.getElementById('paginationControls');
      if (totalPages > 1) {
        paginationControls.classList.add('active');
        document.getElementById('prevBtn').disabled = currentPage === 1;
        document.getElementById('nextBtn').disabled = currentPage === totalPages;
      } else {
        paginationControls.classList.remove('active');
      }
      
      grid.innerHTML = '';
      paginatedItems.forEach(item => {
        const card = document.createElement('div');
        card.className = 'content-card';
        
        // Status badge
        const statusClass = item.status === 'published' ? 'status-published' : item.status === 'draft' ? 'status-draft' : 'status-scheduled';
        const statusText = item.status || 'published';
        
        // Difficulty indicator
        const difficultyIcon = {
          'beginner': 'üü¢',
          'intermediate': 'üü°',
          'advanced': 'üü†',
          'expert': 'üî¥'
        }[item.difficulty] || '‚ö™';
        
        // Target audience display
        const audiences = item.targetAudience || item.audience || [];
        const audienceTags = Array.isArray(audiences) 
          ? audiences.slice(0, 2).map(a => `<span class="audience-tag">${a}</span>`).join('')
          : '';
        
        // Get proper thumbnail URL
        let thumbnailUrl = item.thumbnail || item.thumbnailUrl || item.coverImage;
        if (!thumbnailUrl && item.thumbnailPath) {
          thumbnailUrl = `https://raw.githubusercontent.com/Akhinoor14/A3KM-Studio/main/${item.thumbnailPath}`;
        }
        
        card.innerHTML = `
          <div style="position: absolute; top: 10px; left: 10px; z-index: 10;">
            <input type="checkbox" class="post-checkbox" value="${item.id}" style="width: 18px; height: 18px; cursor: pointer;">
          </div>
          <img src="${thumbnailUrl || 'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22400%22 height=%22300%22%3E%3Crect fill=%22%238B0000%22 width=%22400%22 height=%22300%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 font-size=%2248%22 fill=%22white%22 text-anchor=%22middle%22 dy=%22.3em%22%3Eüìù%3C/text%3E%3C/svg%3E'}" class="card-thumbnail" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22400%22 height=%22300%22%3E%3Crect fill=%22%238B0000%22 width=%22400%22 height=%22300%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 font-size=%2248%22 fill=%22white%22 text-anchor=%22middle%22 dy=%22.3em%22%3Eüìù%3C/text%3E%3C/svg%3E'">
          <div class="card-body">
            <div style="margin-bottom: 10px;">
              <span class="status-badge ${statusClass}">${statusText.toUpperCase()}</span>
              ${item.difficulty ? `<span class="difficulty-indicator">${difficultyIcon} ${item.difficulty}</span>` : ''}
            </div>
            <div class="card-title">${item.title}</div>
            <div class="card-meta">
              üìÅ ${item.category || 'Uncategorized'}<br>
              üë§ ${item.author || 'Unknown'}
              ${item.coAuthors && item.coAuthors.length > 0 ? ` + ${item.coAuthors.length}` : ''}<br>
              üïê ${contentManager.formatDate(item.date)}<br>
              ${item.readTime || item.readingTime ? `üìñ ${item.readTime || item.readingTime} min` : ''}
              ${item.wordCount ? ` ‚Ä¢ ${item.wordCount} words` : ''}
              ${item.contentType ? `<br>üìù ${item.contentType}` : ''}
              ${item.views !== undefined ? `<br>üëÅÔ∏è ${item.views} views` : ''}
            </div>
            ${audienceTags ? `<div class="audience-tags">${audienceTags}</div>` : ''}
            <div class="card-actions">
              <button class="btn-icon" onclick="editPost('${item.id}')" title="Edit Post">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn-icon btn-danger" onclick="deletePost('${item.id}')" title="Delete Post">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
        `;
        grid.appendChild(card);
      });
      
      // Add checkbox change listeners
      document.querySelectorAll('.post-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', updateBulkToolbar);
      });
    }

    // Pagination functions
    function previousPage() {
      if (currentPage > 1) {
        currentPage--;
        renderContent(filteredContent);
      }
    }

    function nextPage() {
      const totalPages = Math.ceil(filteredContent.length / postsPerPage);
      if (currentPage < totalPages) {
        currentPage++;
        renderContent(filteredContent);
      }
    }

    // Bulk operations
    function updateBulkToolbar() {
      const selectedCheckboxes = document.querySelectorAll('.post-checkbox:checked');
      const bulkToolbar = document.getElementById('bulkToolbar');
      const selectedCount = document.getElementById('selectedCount');
      
      selectedCount.textContent = selectedCheckboxes.length;
      
      if (selectedCheckboxes.length > 0) {
        bulkToolbar.classList.add('active');
      } else {
        bulkToolbar.classList.remove('active');
      }
    }

    function filterContent() {
      const query = document.getElementById('searchInput').value.toLowerCase();
      const sortBy = document.getElementById('sortBy').value;
      const statusFilter = document.getElementById('filterStatus')?.value || '';
      const difficultyFilter = document.getElementById('filterDifficulty')?.value || '';
      const category = document.getElementById('filterCategory')?.value || '';
      const subcategory = document.getElementById('filterSubcategory')?.value || '';
      const dateFrom = document.getElementById('filterDateFrom')?.value || '';
      const dateTo = document.getElementById('filterDateTo')?.value || '';
      
      let filtered = currentContent.filter(item => {
        const matchesSearch = !query || 
          item.title.toLowerCase().includes(query) ||
          (item.description || '').toLowerCase().includes(query) ||
          (item.author || '').toLowerCase().includes(query) ||
          (item.tags || []).some(tag => tag.toLowerCase().includes(query));
        
        const matchesStatus = !statusFilter || item.status === statusFilter;
        const matchesDifficulty = !difficultyFilter || item.difficulty === difficultyFilter;
        const matchCategory = !category || item.category === category;
        const matchSubcategory = !subcategory || item.subcategory === subcategory;
        
        let matchDateRange = true;
        if (dateFrom || dateTo) {
          const itemDate = item.date || item.dateAdded || item.id;
          if (dateFrom && itemDate < dateFrom) matchDateRange = false;
          if (dateTo && itemDate > dateTo) matchDateRange = false;
        }
        
        return matchesSearch && matchesStatus && matchesDifficulty && matchCategory && matchSubcategory && matchDateRange;
      });
      
      filtered = contentManager.sortItems(filtered, sortBy, 'desc');
      
      // Reset to first page when filtering
      currentPage = 1;
      
      renderContent(filtered);
    }

    function updateSubcategoriesPosts() {
      const category = document.getElementById('filterCategory')?.value || '';
      const subcategorySelect = document.getElementById('filterSubcategory');
      
      if (!subcategorySelect) return;
      
      subcategorySelect.innerHTML = '<option value="">All Subcategories</option>';
      
      if (category && currentContent) {
        const subcategories = new Set();
        currentContent.forEach(item => {
          if (item.category === category && item.subcategory) {
            subcategories.add(item.subcategory);
          }
        });
        
        [...subcategories].sort().forEach(sub => {
          const option = document.createElement('option');
          option.value = sub;
          option.textContent = sub;
          subcategorySelect.appendChild(option);
        });
      }
    }

    async function loadStatistics() {
      const data = await contentManager.loadContent(CONTENT_TYPE);
      const items = contentManager.getItemsFromData(data, CONTENT_TYPE);
      
      // Basic counts
      document.getElementById('totalPosts').textContent = items.length;
      
      // Status breakdown
      const published = items.filter(i => i.status === 'published').length;
      const drafts = items.filter(i => i.status === 'draft').length;
      const scheduled = items.filter(i => i.status === 'scheduled').length;
      document.getElementById('publishedPosts').textContent = published;
      document.getElementById('draftPosts').textContent = drafts;
      document.getElementById('scheduledPosts').textContent = scheduled;
      
      // Difficulty distribution
      document.getElementById('beginnerCount').textContent = items.filter(i => i.difficulty === 'beginner').length;
      document.getElementById('intermediateCount').textContent = items.filter(i => i.difficulty === 'intermediate').length;
      document.getElementById('advancedCount').textContent = items.filter(i => i.difficulty === 'advanced').length;
      document.getElementById('expertCount').textContent = items.filter(i => i.difficulty === 'expert').length;
      
      // Categories
      document.getElementById('totalCategories').textContent = new Set(items.map(item => item.category)).size;
      
      // Words and reading time
      const totalWords = items.reduce((sum, item) => sum + (item.wordCount || 0), 0);
      document.getElementById('totalWords').textContent = totalWords.toLocaleString();
      
      const avgReadTime = items.length > 0 ? Math.round(items.reduce((sum, item) => sum + (item.readTime || 0), 0) / items.length) : 0;
      document.getElementById('avgReadTime').textContent = avgReadTime;
      
      // Total views
      const totalViews = items.reduce((sum, item) => sum + (item.views || 0), 0);
      document.getElementById('totalViews').textContent = totalViews.toLocaleString();
      
      // Content types breakdown
      const contentTypes = {};
      items.forEach(item => {
        const type = item.contentType || 'other';
        contentTypes[type] = (contentTypes[type] || 0) + 1;
      });
      
      const contentTypesDiv = document.getElementById('contentTypesBreakdown');
      contentTypesDiv.innerHTML = Object.entries(contentTypes).map(([type, count]) => `
        <div style="padding: 10px; background: #f5f5f5; border-radius: 8px; text-align: center;">
          <div style="font-size: 20px; font-weight: 700; color: #8B0000;">${count}</div>
          <div style="font-size: 11px; color: #666; text-transform: capitalize;">${type.replace('-', ' ')}</div>
        </div>
      `).join('');
      
      // Top categories
      const categoryCounts = {};
      items.forEach(item => {
        const cat = item.category || 'Uncategorized';
        categoryCounts[cat] = (categoryCounts[cat] || 0) + 1;
      });
      
      const topCats = Object.entries(categoryCounts)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 10);
      
      const topCatsDiv = document.getElementById('topCategories');
      topCatsDiv.innerHTML = topCats.map(([cat, count]) => `
        <div style="display: flex; justify-content: space-between; padding: 10px; background: #f5f5f5; border-radius: 8px; margin-bottom: 8px;">
          <span style="color: #333; font-weight: 600;">${cat}</span>
          <span style="color: #8B0000; font-weight: 700;">${count} posts</span>
        </div>
      `).join('');
    }

    async function deletePost(id) {
      const post = currentContent.find(p => p.id === id);
      if (!post) return;
      
      const confirmMessage = `üóëÔ∏è Delete "${post.title}"?\n\nThis will delete:\n- Post data from JSON\n- Markdown file (if exists)\n\nThis action cannot be undone!`;
      
      if (confirm(confirmMessage)) {
        try {
          // Delete from JSON
          await contentManager.deleteContent(CONTENT_TYPE, id);
          
          // Try to delete the markdown file
          try {
            const mdPath = post.markdownFile || post.contentPath || `Content Studio/written-posts/${id}.md`;
            await contentManager.deleteMarkdownFile(mdPath);
          } catch (mdError) {
            console.warn('Markdown file not found or already deleted:', mdError);
          }
          
          alert('‚úÖ Post deleted successfully!');
          loadManageContent();
          loadDashboardStats();
        } catch (err) {
          alert('‚ùå Delete failed: ' + err.message);
        }
      }
    }

    // ==================== THUMBNAIL/IMAGE REPLACEMENT & DELETION ====================
    let editThumbnailFileToUpload = null;

    function handleEditThumbnailSelect(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      // Validate file type
      if (!file.type.startsWith('image/')) {
        alert('‚ùå Please select an image file only!');
        event.target.value = '';
        return;
      }
      
      // Validate file size (max 5MB for images)
      const maxSize = 5 * 1024 * 1024;
      if (file.size > maxSize) {
        alert(`‚ùå Image too large: ${(file.size / 1024 / 1024).toFixed(2)}MB\nMaximum size: 5MB`);
        event.target.value = '';
        return;
      }
      
      editThumbnailFileToUpload = file;
      
      // Show preview
      const reader = new FileReader();
      reader.onload = (e) => {
        const previewImg = document.getElementById('edit-thumbnailPreviewImg');
        previewImg.src = e.target.result;
        document.getElementById('edit-thumbnailPreview').style.display = 'block';
      };
      reader.readAsDataURL(file);
    }

    function removeEditThumbnailSelection() {
      editThumbnailFileToUpload = null;
      document.getElementById('edit-thumbnailFile').value = '';
      document.getElementById('edit-thumbnailPreview').style.display = 'none';
    }

    async function deletePostThumbnail() {
      const postId = document.getElementById('editPostId').value;
      const post = currentContent.find(p => p.id === postId);
      
      if (!post) return;
      
      if (!confirm(`üóëÔ∏è Delete thumbnail for "${post.title}"?\n\nThis will remove the image from GitHub storage.\nThe post will remain without a thumbnail.`)) {
        return;
      }
      
      try {
        delete post.thumbnail;
        delete post.thumbnailPath;
        delete post.thumbnailUrl;
        await contentManager.updateContent(CONTENT_TYPE, postId, post);
        alert('‚úÖ Thumbnail marked for deletion!\n\n‚ö†Ô∏è Remember to delete the actual file from GitHub repository.');
        document.getElementById('edit-currentThumbnailPath').textContent = 'No thumbnail';
        loadManageContent();
      } catch (error) {
        alert('‚ùå Failed to delete thumbnail: ' + error.message);
      }
    }

    async function deletePostMarkdownFile() {
      const postId = document.getElementById('editPostId').value;
      const post = currentContent.find(p => p.id === postId);
      
      if (!post) return;
      
      const mdPath = post.markdownFile || post.contentPath || `Content Studio/written-posts/${postId}.md`;
      
      if (!confirm(`üóëÔ∏è Delete markdown file?\n\nFile: ${mdPath}\n\nThis will remove the .md file from GitHub storage.\nThe post JSON data will remain.`)) {
        return;
      }
      
      try {
        await contentManager.deleteMarkdownFile(mdPath);
        delete post.markdownFile;
        delete post.contentPath;
        await contentManager.updateContent(CONTENT_TYPE, postId, post);
        alert('‚úÖ Markdown file deleted successfully!');
        document.getElementById('edit-currentMarkdownPath').textContent = 'No .md file';
        document.getElementById('editContent').value = '';
        loadManageContent();
      } catch (error) {
        alert('‚ùå Failed to delete markdown file: ' + error.message);
      }
    }
    // ============================================================================

    async function editPost(id) {
      const post = currentContent.find(p => p.id === id);
      if (!post) return;
      
      document.getElementById('editPostId').value = id;
      
      // Find which sector contains this category
      let postSector = '';
      for (const [sector, categories] of Object.entries(CATEGORIES)) {
        if (categories.includes(post.category)) {
          postSector = sector;
          break;
        }
      }
      
      // Set sector first, which will enable and populate category dropdown
      if (postSector) {
        document.getElementById('editCategoryGroup').value = postSector;
        updateCategoriesFromGroup('editCategory', 'edit');
        // Then set the specific category
        setTimeout(() => {
          document.getElementById('editCategory').value = post.category;
        }, 50);
      }
      
      document.getElementById('editTitle').value = post.title;
      document.getElementById('editDescription').value = post.description || post.summary || '';
      document.getElementById('editAuthor').value = post.author || '';
      document.getElementById('editTags').value = (post.tags || []).join(', ');
      
      // New personalized fields
      document.getElementById('editStatus').value = post.status || 'published';
      document.getElementById('editDifficulty').value = post.difficulty || 'intermediate';
      document.getElementById('editContentType').value = post.contentType || 'article';
      document.getElementById('editMetaDescription').value = post.metaDescription || '';
      document.getElementById('editCoAuthors').value = (post.coAuthors || []).join(', ');
      document.getElementById('editKeywords').value = (post.keywords || []).join(', ');
      document.getElementById('editCodeLanguage').value = post.codeLanguage || 'none';
      
      // Load actual markdown file content
      const contentTextarea = document.getElementById('editContent');
      const mdStatusIndicator = document.getElementById('mdFileStatus');
      contentTextarea.value = '‚è≥ Loading markdown file...';
      mdStatusIndicator.innerHTML = '<i class="fas fa-sync fa-spin"></i> Loading from file...';
      
      try {
        // Try to load the actual MD file from storage
        const mdPath = post.markdownFile || post.contentPath || `Content Studio/written-posts/${post.id}.md`;
        const mdContent = await contentManager.loadMarkdownFile(mdPath);
        contentTextarea.value = mdContent || post.content || '';
        contentTextarea.style.borderColor = '#4CAF50';
        mdStatusIndicator.innerHTML = '<i class="fas fa-check-circle" style="color: #4CAF50;"></i> Loaded from: ' + mdPath;
        setTimeout(() => { contentTextarea.style.borderColor = ''; }, 2000);
      } catch (error) {
        console.log('Could not load MD file, using stored content:', error);
        contentTextarea.value = post.content || '';
        mdStatusIndicator.innerHTML = '<i class="fas fa-exclamation-triangle" style="color: #FF9800;"></i> Using stored content (file not found)';
      }
      
      // Audience checkboxes
      const audiences = post.audience || [];
      ['students', 'professionals', 'researchers', 'hobbyists', 'educators', 'general'].forEach(aud => {
        const checkbox = document.querySelector(`#editModal input[name="editAudience"][value="${aud}"]`);
        if (checkbox) checkbox.checked = audiences.includes(aud);
      });
      
      // Show current thumbnail path
      const thumbnailPathSpan = document.getElementById('edit-currentThumbnailPath');
      if (thumbnailPathSpan) {
        thumbnailPathSpan.textContent = post.thumbnailPath || post.thumbnail || post.thumbnailUrl || 'No thumbnail';
      }
      
      // Reset thumbnail input and preview
      if (document.getElementById('edit-thumbnailFile')) {
        document.getElementById('edit-thumbnailFile').value = '';
        document.getElementById('edit-thumbnailPreview').style.display = 'none';
      }
      
      // Show current markdown file path
      const mdPathSpan = document.getElementById('edit-currentMarkdownPath');
      if (mdPathSpan) {
        const mdPath = post.markdownFile || post.contentPath || `Content Studio/written-posts/${post.id}.md`;
        mdPathSpan.textContent = mdPath;
      }
      
      loadCategories().then(() => {
        document.getElementById('editCategory').value = post.category;
      });
      
      document.getElementById('editModal').classList.add('active');
    }

    function closeEditModal() {
      document.getElementById('editModal').classList.remove('active');
    }

    document.getElementById('editForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const id = document.getElementById('editPostId').value;
      
      // Get selected audiences
      const selectedAudiences = Array.from(document.querySelectorAll('#editModal input[name="editAudience"]:checked'))
        .map(cb => cb.value);
      
      const updatedPost = {
        id: id,
        title: document.getElementById('editTitle').value,
        category: document.getElementById('editCategory').value,
        content: document.getElementById('editContent').value,
        description: document.getElementById('editDescription').value,
        author: document.getElementById('editAuthor').value,
        tags: document.getElementById('editTags').value.split(',').map(t => t.trim()).filter(t => t),
        // New personalized fields
        status: document.getElementById('editStatus').value,
        difficulty: document.getElementById('editDifficulty').value,
        contentType: document.getElementById('editContentType').value,
        metaDescription: document.getElementById('editMetaDescription').value,
        coAuthors: document.getElementById('editCoAuthors').value.split(',').map(a => a.trim()).filter(a => a),
        keywords: document.getElementById('editKeywords').value.split(',').map(k => k.trim()).filter(k => k),
        codeLanguage: document.getElementById('editCodeLanguage').value,
        audience: selectedAudiences,
        date: new Date().toISOString()
      };
      
      try {
        // Check if new thumbnail was selected
        if (editThumbnailFileToUpload) {
          if (!confirm('üì§ Upload new thumbnail image?\n\nThis will replace the existing thumbnail in GitHub storage.\n\nContinue?')) {
            return;
          }
          
          try {
            const category = document.getElementById('editCategory').value;
            const fileName = editThumbnailFileToUpload.name;
            const fileExtension = fileName.split('.').pop();
            const thumbnailPath = `Content Storage/written-posts/${category}/${id}/thumbnail.${fileExtension}`;
            
            // Upload thumbnail to GitHub
            await contentManager.uploadFile(thumbnailPath, editThumbnailFileToUpload, `Upload thumbnail: ${fileName} for post ${id}`);
            
            // Update post with new thumbnail path
            updatedPost.thumbnailPath = thumbnailPath;
            updatedPost.thumbnailUrl = `https://raw.githubusercontent.com/Akhinoor14/A3KM-Studio/main/${thumbnailPath}`;
            
            alert('‚úÖ Thumbnail uploaded successfully!');
            editThumbnailFileToUpload = null;
          } catch (uploadError) {
            alert('‚ùå Failed to upload thumbnail: ' + uploadError.message);
            return;
          }
        }
        
        await contentManager.updateContent(CONTENT_TYPE, id, updatedPost);
        
        // Also save the markdown file content if it was edited
        const mdContent = document.getElementById('editContent').value;
        if (mdContent && mdContent.trim()) {
          try {
            const post = currentContent.find(p => p.id === id);
            const mdPath = post.markdownFile || post.contentPath || `Content Studio/written-posts/${id}.md`;
            await contentManager.saveMarkdownFile(mdPath, mdContent);
          } catch (mdError) {
            console.warn('Could not save markdown file:', mdError);
          }
        }
        
        alert('‚úÖ Post updated successfully!');
        closeEditModal();
        loadManageContent();
        loadStatistics(); // Refresh statistics
      } catch (error) {
        alert('‚ùå Update failed: ' + error.message);
      }
    });

    // Export posts function
    function exportPosts() {
      if (currentContent.length === 0) {
        alert('‚ö†Ô∏è No posts to export!');
        return;
      }
      
      const exportData = currentContent.map(post => ({
        ID: post.id,
        Title: post.title,
        Category: post.category,
        Status: post.status || 'published',
        Difficulty: post.difficulty || 'intermediate',
        'Content Type': post.contentType || 'article',
        Author: post.author || '',
        'Co-Authors': (post.coAuthors || []).join('; '),
        Tags: (post.tags || []).join('; '),
        Keywords: (post.keywords || []).join('; '),
        Audience: (post.audience || []).join('; '),
        'Word Count': post.wordCount || 0,
        'Read Time': (post.readTime || 0) + ' min',
        Views: post.views || 0,
        Date: post.date || ''
      }));
      
      // Convert to CSV
      const headers = Object.keys(exportData[0]);
      const csvContent = [
        headers.join(','),
        ...exportData.map(row => headers.map(h => `"${row[h]}"`).join(','))
      ].join('\n');
      
      // Download
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `written-posts-export-${new Date().toISOString().split('T')[0]}.csv`;
      link.click();
      
      alert(`‚úÖ Exported ${currentContent.length} posts successfully!`);
    }
    
    // Export posts function
    function exportPosts() {
      if (currentContent.length === 0) {
        alert('‚ö†Ô∏è No posts to export!');
        return;
      }
      
      const exportData = currentContent.map(post => ({
        ID: post.id,
        Title: post.title,
        Category: post.category,
        Status: post.status || 'published',
        Difficulty: post.difficulty || 'intermediate',
        'Content Type': post.contentType || 'article',
        Author: post.author || '',
        'Co-Authors': (post.coAuthors || []).join('; '),
        Tags: (post.tags || []).join('; '),
        Keywords: (post.keywords || []).join('; '),
        Audience: (post.audience || []).join('; '),
        'Word Count': post.wordCount || 0,
        'Read Time': (post.readTime || 0) + ' min',
        Views: post.views || 0,
        Date: post.date || ''
      }));
      
      // Convert to CSV
      const headers = Object.keys(exportData[0]);
      const csvContent = [
        headers.join(','),
        ...exportData.map(row => headers.map(h => `"${row[h]}"`).join(','))
      ].join('\n');
      
      // Download
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `written-posts-export-${new Date().toISOString().split('T')[0]}.csv`;
      link.click();
      
      alert(`‚úÖ Exported ${currentContent.length} posts successfully!`);
    }

    // JSON Editor Functions
    async function loadJSONEditor() {
      try {
        const data = await contentManager.loadContent(CONTENT_TYPE);
        document.getElementById('jsonEditor').value = JSON.stringify(data, null, 2);
      } catch (error) {
        document.getElementById('jsonEditor').value = '// Error loading JSON: ' + error.message;
        console.error('JSON load error:', error);
      }
    }

    function validateJSON() {
      const editor = document.getElementById('jsonEditor');
      try {
        JSON.parse(editor.value);
        alert('‚úÖ JSON is valid!');
      } catch (error) {
        alert('‚ùå JSON Syntax Error:\n' + error.message);
      }
    }

    function formatJSON() {
      const editor = document.getElementById('jsonEditor');
      try {
        const parsed = JSON.parse(editor.value);
        editor.value = JSON.stringify(parsed, null, 2);
        alert('‚úÖ JSON formatted successfully!');
      } catch (error) {
        alert('‚ùå Cannot format invalid JSON:\n' + error.message);
      }
    }

    function downloadJSON() {
      const editor = document.getElementById('jsonEditor');
      const blob = new Blob([editor.value], { type: 'application/json' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `posts-backup-${new Date().toISOString().split('T')[0]}.json`;
      link.click();
      alert('‚úÖ JSON downloaded successfully!');
    }

    function importJSON(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const parsed = JSON.parse(e.target.result);
          document.getElementById('jsonEditor').value = JSON.stringify(parsed, null, 2);
          alert('‚úÖ JSON imported successfully! Click "Save Changes" to apply.');
        } catch (error) {
          alert('‚ùå Invalid JSON file:\n' + error.message);
        }
      };
      reader.readAsText(file);
    }

    async function saveToGitHub() {
      const editor = document.getElementById('jsonEditor');
      if (!editor.value) {
        alert('‚ö†Ô∏è No JSON data to save!');
        return;
      }
      
      try {
        const parsed = JSON.parse(editor.value);
        await contentManager.saveContent(CONTENT_TYPE, parsed);
        alert('‚úÖ Changes saved to GitHub successfully!');
        loadDashboardStats(); // Refresh stats
      } catch (error) {
        alert('‚ùå Save failed:\n' + error.message);
        console.error('Save error:', error);
      }
    }
    
    // Select all posts function
    function selectAllPosts() {
      const checkboxes = document.querySelectorAll('.post-checkbox');
      const allChecked = Array.from(checkboxes).every(cb => cb.checked);
      checkboxes.forEach(cb => {
        cb.checked = !allChecked;
      });
      updateBulkToolbar();
    }
    
    // Bulk delete function
    async function bulkDelete() {
      const selectedCheckboxes = document.querySelectorAll('.post-checkbox:checked');
      if (selectedCheckboxes.length === 0) {
        alert('‚ö†Ô∏è No posts selected!');
        return;
      }
      
      if (!confirm(`üóëÔ∏è Delete ${selectedCheckboxes.length} selected posts? This cannot be undone!`)) {
        return;
      }
      
      try {
        for (const checkbox of selectedCheckboxes) {
          await contentManager.deleteContent(CONTENT_TYPE, checkbox.value);
        }
        alert(`‚úÖ Deleted ${selectedCheckboxes.length} posts successfully!`);
        loadManageContent();
        loadDashboardStats();
        loadStatistics();
      } catch (error) {
        alert('‚ùå Bulk delete failed: ' + error.message);
      }
    }

    // Initialize on page load
    window.addEventListener('DOMContentLoaded', async () => {
      await loadCategories();
      await loadDashboardStats();
      
      // Add checkbox event listeners dynamically
      document.addEventListener('change', (e) => {
        if (e.target.classList.contains('post-checkbox')) {
          updateBulkToolbar();
        }
      });
    });
    
    // Override loadDashboardStats to add Content Hub sync
    const originalLoadDashboardStats = loadDashboardStats;
    loadDashboardStats = async function() {
      await originalLoadDashboardStats();
      
      // Sync with Content Hub after loading stats
      try {
        const data = await contentManager.loadContent(CONTENT_TYPE);
        const posts = data.posts || [];
        if (typeof ContentHubSync !== 'undefined') {
          ContentHubSync.syncFromData('posts', posts.length);
        }
      } catch (error) {
        console.error('Failed to sync with Content Hub:', error);
      }
    };
  </script>
  <script src="content-hub-sync.js"></script>
  <script src="../../Optimization/navbar-autohide.js"></script>
</body>
</html>
