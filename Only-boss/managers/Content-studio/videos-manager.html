<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Educational Videos Manager - A3KM Studio</title>
  <link rel="stylesheet" href="../../../Optimization/mobile-universal.css">
  <script src="../../../Optimization/mobile-universal.js" defer></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #1a1a1a; background-image: linear-gradient(rgba(200, 0, 0, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(200, 0, 0, 0.05) 1px, transparent 1px); background-size: 100px 100px; min-height: 100vh; padding: 0; }
    .container { display: flex; min-height: 100vh; background: white; }
    .sidebar { width: 280px; background: linear-gradient(180deg, #1a1a1a 0%, #2d2d2d 100%); padding: 0; position: sticky; top: 0; height: 100vh; overflow-y: auto; border-right: 4px solid #8B0000; }
    .sidebar-header { background: linear-gradient(135deg, #8B0000, #C80000); padding: 30px 20px; color: white; }
    .sidebar-header h1 { font-size: 22px; margin-bottom: 5px; }
    .sidebar-header p { font-size: 12px; opacity: 0.9; }
    .sidebar-nav { padding: 20px 0; }
    .tab-item { display: flex; align-items: center; gap: 12px; padding: 15px 25px; color: #ccc; cursor: pointer; transition: all 0.3s; border-left: 4px solid transparent; font-weight: 600; font-size: 14px; }
    .tab-item:hover { background: rgba(139, 0, 0, 0.1); color: white; }
    .tab-item.active { background: rgba(139, 0, 0, 0.2); color: white; border-left-color: #8B0000; }
    .quick-stats { padding: 20px; background: rgba(139, 0, 0, 0.1); margin: 20px; border-radius: 10px; }
    .quick-stats h3 { color: #ccc; font-size: 12px; text-transform: uppercase; margin-bottom: 15px; letter-spacing: 1px; }
    .stat-item { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; color: #fff; }
    .stat-value { font-weight: 700; color: #8B0000; font-size: 18px; }
    .main-content { flex: 1; background: #f8f9fa; padding: 40px; overflow-y: auto; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; background: white; padding: 25px 30px; border-radius: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .back-btn { background: rgba(139, 0, 0, 0.1); border: 2px solid #8B0000; padding: 10px 20px; border-radius: 10px; color: #8B0000; font-weight: 600; cursor: pointer; text-decoration: none; }
    .back-btn:hover { background: #8B0000; color: white; }
    h1 { color: #8B0000; font-size: 32px; margin-bottom: 10px; }
    .tabs { display: flex; gap: 10px; margin-bottom: 30px; border-bottom: 2px solid #e0e0e0; }
    .tab { padding: 12px 24px; background: transparent; border: none; color: #666; font-weight: 600; cursor: pointer; border-bottom: 3px solid transparent; }
    .tab.active { color: #8B0000; border-bottom-color: #8B0000; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .form-group { margin-bottom: 20px; }
    label { display: block; margin-bottom: 8px; color: #333; font-weight: 600; font-size: 14px; }
    input, select, textarea { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 14px; font-family: inherit; }
    input:focus, select:focus, textarea:focus { outline: none; border-color: #8B0000; }
    textarea { resize: vertical; min-height: 100px; }
    .btn-primary { padding: 15px 30px; background: linear-gradient(135deg, #8B0000, #C80000); color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; width: 100%; margin-top: 20px; }
    .file-upload-label { display: flex; align-items: center; justify-content: center; padding: 40px; border: 2px dashed #8B0000; border-radius: 10px; cursor: pointer; background: #fff5f5; }
    .content-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
    .content-card { border: 2px solid #e0e0e0; border-radius: 12px; overflow: hidden; transition: all 0.3s; }
    .content-card:hover { border-color: #8B0000; box-shadow: 0 4px 12px rgba(139, 0, 0, 0.2); }
    .card-thumbnail { width: 100%; height: 150px; object-fit: cover; background: linear-gradient(135deg, #8B0000, #C80000); }
    .card-body { padding: 15px; }
    .card-title { font-weight: 600; color: #333; margin-bottom: 8px; }
    .card-meta { font-size: 11px; color: #999; margin-bottom: 10px; }
    .card-actions { display: flex; gap: 8px; }
    .card-actions button { flex: 1; padding: 8px; border: 1px solid #e0e0e0; background: white; border-radius: 6px; cursor: pointer; font-size: 12px; }
    .card-actions button:hover { background: #8B0000; color: white; border-color: #8B0000; }
    .search-bar { display: flex; gap: 10px; margin-bottom: 20px; }
    .search-bar input { flex: 1; }
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px; }
    .stat-card { background: linear-gradient(135deg, #8B0000, #C80000); color: white; padding: 20px; border-radius: 12px; text-align: center; }
    .stat-card h3 { font-size: 32px; margin-bottom: 5px; }
    .progress { margin-top: 20px; display: none; }
    .progress.active { display: block; }
    .progress-bar { width: 100%; height: 8px; background: #f0f0f0; border-radius: 4px; overflow: hidden; margin-bottom: 10px; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, #8B0000, #C80000); width: 0%; transition: width 0.3s; }
    .progress-text { text-align: center; color: #8B0000; font-size: 14px; font-weight: 600; }
    .success-message { background: #4caf50; color: white; padding: 15px; border-radius: 10px; margin-top: 20px; display: none; text-align: center; }
    .success-message.active { display: block; }
    .youtube-toggle { display: flex; align-items: center; gap: 10px; margin-bottom: 20px; padding: 15px; background: #f5f5f5; border-radius: 10px; }
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; overflow-y: auto; }
    .modal.active { display: block; }
    .modal-content { max-width: 800px; margin: 40px auto; background: white; border-radius: 20px; padding: 40px; position: relative; }
    .modal-close { position: absolute; top: 20px; right: 20px; background: #f44336; color: white; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 20px; }
    .modal-close:hover { background: #d32f2f; }
    .bulk-actions { display: flex; gap: 10px; margin-bottom: 20px; align-items: center; padding: 15px; background: white; border-radius: 10px; }
    .bulk-actions button { padding: 10px 20px; border: 2px solid #8B0000; background: white; color: #8B0000; border-radius: 8px; cursor: pointer; font-weight: 600; }
    .bulk-actions button:hover { background: #8B0000; color: white; }
    .bulk-actions .selected-count { color: #8B0000; font-weight: 700; margin-left: auto; }
    .content-card input[type="checkbox"] { position: absolute; top: 10px; left: 10px; width: 20px; height: 20px; cursor: pointer; z-index: 10; }
    .content-card { position: relative; }
    .pagination { display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 30px; }
    .pagination button { padding: 10px 20px; border: 2px solid #8B0000; background: white; color: #8B0000; border-radius: 8px; cursor: pointer; font-weight: 600; }
    .pagination button:hover:not(:disabled) { background: #8B0000; color: white; }
    .pagination button:disabled { opacity: 0.5; cursor: not-allowed; border-color: #ccc; color: #ccc; }
    .pagination .page-info { color: #666; font-weight: 600; }
    .video-badge { display: inline-block; padding: 4px 8px; border-radius: 5px; font-size: 11px; font-weight: 600; margin-right: 5px; }
    .badge-youtube { background: #ff0000; color: white; }
    .badge-uploaded { background: #4caf50; color: white; }
    .badge-duration { background: #2196f3; color: white; }
    .badge-views { background: #ff9800; color: white; }
    .filter-group { display: flex; gap: 10px; margin-bottom: 20px; }
    .filter-group select { padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; flex: 1; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1>ğŸ“ Educational Videos Manager</h1>
        <p style="color: #666;">Manage course videos and tutorials</p>
      </div>
      <a href="content-hub.html" class="back-btn">â† Back to Hub</a>
    </div>

    <div class="tabs">
      <button class="tab active" onclick="switchTab('upload')">ğŸ“¤ Upload</button>
      <button class="tab" onclick="switchTab('manage')">ğŸ“‹ Manage</button>
      <button class="tab" onclick="switchTab('stats')">ğŸ“Š Statistics</button>
    </div>

    <!-- UPLOAD TAB -->
    <div id="uploadTab" class="tab-content active">
      <form id="uploadForm">
        <div class="form-group">
          <label>Category</label>
          <select id="category" required>
            <option value="">Loading categories...</option>
          </select>
        </div>

        <div class="form-group">
          <label>Video Title</label>
          <input type="text" id="title" placeholder="Enter video title..." required>
        </div>

        <div class="youtube-toggle">
          <input type="checkbox" id="isYoutube">
          <label for="isYoutube" style="margin: 0;">This is a YouTube video</label>
        </div>

        <div class="form-group" id="youtubeUrlGroup" style="display: none;">
          <label>YouTube URL</label>
          <input type="url" id="youtubeUrl" placeholder="https://youtu.be/VIDEO_ID or https://www.youtube.com/watch?v=VIDEO_ID">
        </div>

        <div class="form-group" id="videoFileGroup">
          <label>Video File</label>
          <input type="file" id="videoFile" accept="video/*" style="display: none;">
          <label for="videoFile" class="file-upload-label">
            ğŸ¬ Choose video file
          </label>
          <div id="fileInfo" style="margin-top: 10px; color: #666; font-size: 14px;"></div>
        </div>

        <div class="form-group">
          <label>Description</label>
          <textarea id="description" placeholder="Video description..." rows="3" required></textarea>
        </div>

        <div class="form-group">
          <label>Duration (MM:SS or HH:MM:SS)</label>
          <input type="text" id="duration" placeholder="18:45 or 1:30:20" required pattern="^\d{1,2}:\d{2}(:\d{2})?$">
          <small style="color: #999; font-size: 12px;">Format: Minutes:Seconds or Hours:Minutes:Seconds</small>
        </div>

        <div class="form-group">
          <label>Language</label>
          <select id="language" required>
            <option value="bn">ğŸ‡§ğŸ‡© Bengali (à¦¬à¦¾à¦‚à¦²à¦¾)</option>
            <option value="en" selected>ğŸ‡¬ğŸ‡§ English</option>
            <option value="bn-en">ğŸ‡§ğŸ‡©ğŸ‡¬ğŸ‡§ Bengali-English Mix</option>
            <option value="hi">ğŸ‡®ğŸ‡³ Hindi (à¤¹à¤¿à¤¨à¥à¤¦à¥€)</option>
          </select>
        </div>

        <div class="form-group">
          <label>Tags (comma-separated)</label>
          <input type="text" id="tags" placeholder="programming, python, tutorial">
        </div>

        <div class="form-group">
          <label>Thumbnail (Auto-fetched for YouTube)</label>
          <input type="file" id="thumbnail" accept="image/*" style="display: none;">
          <label for="thumbnail" class="file-upload-label">
            ğŸ–¼ï¸ Choose thumbnail image
          </label>
          <div id="thumbnailInfo" style="margin-top: 10px; color: #666; font-size: 14px;"></div>
        </div>

        <button type="submit" class="btn-primary">ğŸ“¤ Upload Video</button>

        <div class="progress" id="progress">
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
          <div class="progress-text" id="progressText">Processing...</div>
        </div>

        <div class="success-message" id="successMessage">
          âœ… Video uploaded successfully!
        </div>
      </form>
    </div>

    <!-- MANAGE TAB -->
    <div id="manageTab" class="tab-content">
      <div class="bulk-actions">
        <button onclick="selectAll()">âœ… Select All</button>
        <button onclick="deselectAll()">âŒ Deselect All</button>
        <button onclick="bulkDelete()" style="background: #f44336; color: white; border-color: #f44336;">ğŸ—‘ï¸ Delete Selected</button>
        <span class="selected-count">Selected: <span id="selectedCount">0</span></span>
      </div>
      
      <div class="filter-group">
        <input type="text" id="searchInput" placeholder="ğŸ” Search videos..." onkeyup="filterContent()">
        <select id="filterLanguage" onchange="filterContent()">
          <option value="">All Languages</option>
          <option value="bn">ğŸ‡§ğŸ‡© Bengali</option>
          <option value="en">ğŸ‡¬ğŸ‡§ English</option>
          <option value="bn-en">ğŸ‡§ğŸ‡©ğŸ‡¬ğŸ‡§ Mixed</option>
          <option value="hi">ğŸ‡®ğŸ‡³ Hindi</option>
        </select>
        <select id="sortBy" onchange="filterContent()">
          <option value="date">Newest First</option>
          <option value="title">Title A-Z</option>
          <option value="views">Most Viewed</option>
          <option value="duration">By Duration</option>
        </select>
      </div>
      
      <div class="content-grid" id="contentGrid">
        <p style="text-align: center; padding: 40px; color: #999;">Loading videos...</p>
      </div>
      
      <div class="pagination">
        <button id="prevPage" onclick="changePage(-1)">â† Previous</button>
        <span class="page-info">Page <span id="currentPage">1</span> of <span id="totalPages">1</span></span>
        <button id="nextPage" onclick="changePage(1)">Next â†’</button>
      </div>
    </div>

    <!-- STATISTICS TAB -->
    <div id="statsTab" class="tab-content">
      <div class="stats-grid">
        <div class="stat-card">
          <h3 id="totalVideos">0</h3>
          <p>Total Videos</p>
        </div>
        <div class="stat-card">
          <h3 id="totalCategories">0</h3>
          <p>Categories</p>
        </div>
        <div class="stat-card">
          <h3 id="totalSize">0 MB</h3>
          <p>Total Size</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Modal -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeEditModal()">Ã—</button>
      <h2 style="color: #8B0000; margin-bottom: 20px;">âœï¸ Edit Video</h2>
      <form id="editForm">
        <input type="hidden" id="editVideoId">
        
        <div class="form-group">
          <label>Category</label>
          <select id="editCategory" required>
            <option value="">Loading categories...</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>Video Title</label>
          <input type="text" id="editTitle" required>
        </div>
        
        <div class="form-group">
          <label>Description</label>
          <textarea id="editDescription" rows="3" required></textarea>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
          <div class="form-group">
            <label>Duration (MM:SS)</label>
            <input type="text" id="editDuration" placeholder="18:45" pattern="^\d{1,2}:\d{2}(:\d{2})?$" required>
          </div>
          <div class="form-group">
            <label>Views</label>
            <input type="number" id="editViews" min="0" value="0">
          </div>
        </div>
        
        <div class="form-group">
          <label>Language</label>
          <select id="editLanguage" required>
            <option value="bn">ğŸ‡§ğŸ‡© Bengali (à¦¬à¦¾à¦‚à¦²à¦¾)</option>
            <option value="en">ğŸ‡¬ğŸ‡§ English</option>
            <option value="bn-en">ğŸ‡§ğŸ‡©ğŸ‡¬ğŸ‡§ Bengali-English Mix</option>
            <option value="hi">ğŸ‡®ğŸ‡³ Hindi (à¤¹à¤¿à¤¨à¥à¤¦à¥€)</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>YouTube URL</label>
          <input type="url" id="editYoutubeUrl" placeholder="https://youtu.be/VIDEO_ID">
        </div>
        
        <div class="form-group">
          <label>Tags (comma-separated)</label>
          <input type="text" id="editTags" placeholder="programming, python, tutorial">
        </div>
        
        <button type="submit" class="btn-primary">ğŸ’¾ Update Video</button>
      </form>
    </div>
  </div>

  <script src="svg-generator.js"></script>
  <script src="github-content-uploader.js"></script>
  <script src="content-manager.js"></script>
  <script src="thumbnail-handler.js"></script>
  <script>
    const GITHUB_TOKEN = 'YOUR_GITHUB_TOKEN_HERE';
    const CONTENT_TYPE = 'educational-videos';
    
    const svgGenerator = new SVGCoverGenerator();
    const thumbnailHandler = new ThumbnailHandler();
    const githubUploader = new GitHubContentUploader({
      token: GITHUB_TOKEN,
      owner: 'Akhinoor14',
      repo: 'A3KM-Studio',
      onProgress: (data) => { document.getElementById('progressFill').style.width = '60%'; },
      onError: (error) => alert('Error: ' + error.error)
    });
    
    const contentManager = new ContentManager(githubUploader);
    let currentContent = [];
    let filteredContent = [];
    let selectedVideos = new Set();
    let currentPage = 1;
    const ITEMS_PER_PAGE = 12;

    async function loadCategories() {
      try {
        const data = await contentManager.loadContent(CONTENT_TYPE);
        const categorySelect = document.getElementById('category');
        categorySelect.innerHTML = '<option value="">Select category...</option>';
        if (data.categoryGroups && Array.isArray(data.categoryGroups)) {
          data.categoryGroups.forEach(group => {
            if (group.categories) {
              group.categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                categorySelect.appendChild(option);
              });
            }
          });
        }
      } catch (error) {
        console.error('Failed to load categories:', error);
      }
    }

    document.getElementById('isYoutube').addEventListener('change', function() {
      const isYoutube = this.checked;
      document.getElementById('youtubeUrlGroup').style.display = isYoutube ? 'block' : 'none';
      document.getElementById('videoFileGroup').style.display = isYoutube ? 'none' : 'block';
    });

    document.getElementById('videoFile').addEventListener('change', function() {
      const file = this.files[0];
      if (file) {
        document.getElementById('fileInfo').textContent = `ğŸ¬ ${file.name} (${contentManager.formatFileSize(file.size)})`;
      }
    });

    document.getElementById('thumbnail').addEventListener('change', function() {
      const file = this.files[0];
      if (file) {
        document.getElementById('thumbnailInfo').textContent = `ğŸ–¼ï¸ ${file.name} (${contentManager.formatFileSize(file.size)})`;
      }
    });

    document.getElementById('uploadForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      // Validate GitHub token
      if (GITHUB_TOKEN === 'YOUR_GITHUB_TOKEN_HERE' || !GITHUB_TOKEN) {
        alert('âŒ Please set your GitHub token first!');
        return;
      }
      
      const progress = document.getElementById('progress');
      const progressFill = document.getElementById('progressFill');
      const progressText = document.getElementById('progressText');
      const successMessage = document.getElementById('successMessage');
      progress.classList.add('active');
      successMessage.classList.remove('active');
      
      try {
        const category = document.getElementById('category').value;
        const title = document.getElementById('title').value;
        const description = document.getElementById('description').value;
        const author = document.getElementById('author').value;
        const tags = document.getElementById('tags').value.split(',').map(t => t.trim());
        const isYoutube = document.getElementById('isYoutube').checked;
        const youtubeUrl = document.getElementById('youtubeUrl').value;
        const videoFile = document.getElementById('videoFile').files[0];
        const thumbnailFile = document.getElementById('thumbnail').files[0];
        
        progressText.textContent = 'Checking for duplicates...';
        progressFill.style.width = '20%';
        const duplicateCheck = await contentManager.checkDuplicates(CONTENT_TYPE, title, category);
        if (duplicateCheck.isDuplicate && !confirm(`âš ï¸ Duplicate found. Upload anyway?`)) {
          progress.classList.remove('active');
          return;
        }
        
        progressText.textContent = 'Generating cover...';
        progressFill.style.width = '40%';
        const coverSVG = await svgGenerator.generateCover(category, 0);
        const contentId = `video-${Date.now()}`;
        
        let youtubeId = null;
        if (isYoutube && youtubeUrl) {
          progressText.textContent = 'Extracting YouTube ID...';
          progressFill.style.width = '50%';
          const match = youtubeUrl.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\s]+)/);
          youtubeId = match ? match[1] : null;
        }
        
        progressText.textContent = 'Uploading to GitHub...';
        progressFill.style.width = '70%';
        const uploadResult = await githubUploader.uploadCompleteContent({
          contentType: CONTENT_TYPE,
          category: category,
          contentId: contentId,
          title: title,
          description: description,
          tags: tags,
          author: author,
          contentFile: videoFile,
          thumbnailFile: thumbnailFile,
          coverSVG: coverSVG,
          youtubeId: youtubeId,
          metadata: {
            duration: document.getElementById('duration').value,
            language: document.getElementById('language').value,
            views: 0,
            youtubeUrl: youtubeUrl,
            videoId: youtubeId
          }
        });
        
        contentManager.createBackup(CONTENT_TYPE, uploadResult);
        contentManager.addToHistory({
          action: 'upload',
          contentType: CONTENT_TYPE,
          contentId: contentId,
          title: title,
          timestamp: new Date().toISOString()
        });
        
        progressFill.style.width = '100%';
        progressText.textContent = 'Complete!';
        progress.classList.remove('active');
        successMessage.classList.add('active');
        setTimeout(() => { this.reset(); successMessage.classList.remove('active'); }, 3000);
        
      } catch (error) {
        progress.classList.remove('active');
        alert(`âŒ Upload failed: ${error.message}`);
      }
    });

    function switchTab(tabName) {
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab').forEach(btn => btn.classList.remove('active'));
      document.getElementById(tabName + 'Tab').classList.add('active');
      event.target.classList.add('active');
      if (tabName === 'manage') { loadManageContent(); resetPagination(); }
      if (tabName === 'stats') loadStatistics();
    }
    
    function resetPagination() {
      currentPage = 1;
      selectedVideos.clear();
      updateSelectedCount();
    }

    async function loadManageContent() {
      const grid = document.getElementById('contentGrid');
      grid.innerHTML = '<p style="text-align: center; padding: 40px; color: #999;">Loading...</p>';
      try {
        const data = await contentManager.loadContent(CONTENT_TYPE);
        currentContent = contentManager.getItemsFromData(data, CONTENT_TYPE);
        renderContent(currentContent);
      } catch (error) {
        grid.innerHTML = '<p style="text-align: center; padding: 40px; color: #f44336;">Failed to load</p>';
      }
    }

    function renderContent(items) {
      const grid = document.getElementById('contentGrid');
      filteredContent = items;
      
      if (items.length === 0) {
        grid.innerHTML = '<p style="text-align: center; padding: 40px; color: #999;">No videos found</p>';
        updatePaginationControls(0);
        return;
      }
      
      // Pagination
      const totalPages = Math.ceil(items.length / ITEMS_PER_PAGE);
      const startIdx = (currentPage - 1) * ITEMS_PER_PAGE;
      const endIdx = startIdx + ITEMS_PER_PAGE;
      const pageItems = items.slice(startIdx, endIdx);
      
      grid.innerHTML = '';
      pageItems.forEach(item => {
        const isSelected = selectedVideos.has(item.id);
        const card = document.createElement('div');
        card.className = 'content-card';
        
        const badges = [];
        if (item.youtubeUrl || item.videoId) badges.push('<span class="video-badge badge-youtube">ğŸ“º YouTube</span>');
        else badges.push('<span class="video-badge badge-uploaded">ğŸ“ Uploaded</span>');
        if (item.duration) badges.push(`<span class="video-badge badge-duration">â±ï¸ ${item.duration}</span>`);
        if (item.views > 0) badges.push(`<span class="video-badge badge-views">ğŸ‘ï¸ ${item.views}</span>`);
        if (item.language) {
          const langMap = {bn: 'ğŸ‡§ğŸ‡©', en: 'ğŸ‡¬ğŸ‡§', 'bn-en': 'ğŸ‡§ğŸ‡©ğŸ‡¬ğŸ‡§', hi: 'ğŸ‡®ğŸ‡³'};
          badges.push(`<span class="video-badge" style="background: #607d8b;">${langMap[item.language] || 'ğŸŒ'} ${item.language.toUpperCase()}</span>`);
        }
        
        card.innerHTML = `
          <input type="checkbox" ${isSelected ? 'checked' : ''} onchange="toggleSelect('${item.id}')">
          <img src="${item.thumbnail || item.coverImage || `https://img.youtube.com/vi/${item.videoId}/mqdefault.jpg`}" class="card-thumbnail" onerror="this.style.background='linear-gradient(135deg, #8B0000, #C80000)'">
          <div class="card-body">
            <div style="margin-bottom: 8px;">${badges.join(' ')}</div>
            <div class="card-title">${item.title}</div>
            <div class="card-meta">
              ğŸ“ ${item.category}<br>
              ğŸ¬ ${item.videoId || 'Local Video'}<br>
              ğŸ• ${contentManager.formatDate(item.date)}
            </div>
            <div class="card-actions">
              <button onclick="editVideo('${item.id}')" style="font-size: 14px;">âœï¸ Edit</button>
              <button onclick="deleteVideo('${item.id}')" style="font-size: 14px; color: #f44336;">ğŸ—‘ï¸ Delete</button>
            </div>
          </div>
        `;
        grid.appendChild(card);
      });
      
      updatePaginationControls(totalPages);
    }
    
    function updatePaginationControls(totalPages) {
      document.getElementById('currentPage').textContent = currentPage;
      document.getElementById('totalPages').textContent = totalPages;
      document.getElementById('prevPage').disabled = currentPage === 1;
      document.getElementById('nextPage').disabled = currentPage >= totalPages || totalPages === 0;
    }
    
    function changePage(delta) {
      const totalPages = Math.ceil(filteredContent.length / ITEMS_PER_PAGE);
      const newPage = currentPage + delta;
      if (newPage >= 1 && newPage <= totalPages) {
        currentPage = newPage;
        renderContent(filteredContent);
      }
    }

    function filterContent() {
      const query = document.getElementById('searchInput').value.toLowerCase();
      const sortBy = document.getElementById('sortBy').value;
      const language = document.getElementById('filterLanguage').value;
      
      let filtered = currentContent.filter(item => {
        const matchSearch = !query || 
          item.title.toLowerCase().includes(query) ||
          item.description?.toLowerCase().includes(query) ||
          item.category.toLowerCase().includes(query) ||
          (item.tags && item.tags.some(tag => tag.toLowerCase().includes(query)));
        
        const matchLanguage = !language || item.language === language;
        
        return matchSearch && matchLanguage;
      });
      
      // Sort
      filtered.sort((a, b) => {
        if (sortBy === 'date') return new Date(b.date) - new Date(a.date);
        if (sortBy === 'title') return a.title.localeCompare(b.title);
        if (sortBy === 'views') return (b.views || 0) - (a.views || 0);
        if (sortBy === 'duration') {
          const getDurationSeconds = (dur) => {
            const parts = dur.split(':').map(Number);
            return parts.length === 2 ? parts[0]*60 + parts[1] : parts[0]*3600 + parts[1]*60 + parts[2];
          };
          return getDurationSeconds(b.duration || '0:0') - getDurationSeconds(a.duration || '0:0');
        }
        return 0;
      });
      
      currentPage = 1;
      renderContent(filtered);
    }

    async function loadStatistics() {
      try {
        const data = await contentManager.loadContent(CONTENT_TYPE);
        const items = contentManager.getItemsFromData(data, CONTENT_TYPE);
        document.getElementById('totalVideos').textContent = items.length;
        const categories = new Set(items.map(item => item.category));
        document.getElementById('totalCategories').textContent = categories.size;
        const totalSize = items.reduce((sum, item) => sum + (item.fileSize || 0), 0);
        document.getElementById('totalSize').textContent = contentManager.formatFileSize(totalSize);
      } catch (error) {
        console.error('Failed to load stats:', error);
      }
    }

    function toggleSelect(id) {
      if (selectedVideos.has(id)) {
        selectedVideos.delete(id);
      } else {
        selectedVideos.add(id);
      }
      updateSelectedCount();
    }
    
    function selectAll() {
      const startIdx = (currentPage - 1) * ITEMS_PER_PAGE;
      const endIdx = startIdx + ITEMS_PER_PAGE;
      const pageItems = filteredContent.slice(startIdx, endIdx);
      pageItems.forEach(item => selectedVideos.add(item.id));
      updateSelectedCount();
      renderContent(filteredContent);
    }
    
    function deselectAll() {
      selectedVideos.clear();
      updateSelectedCount();
      renderContent(filteredContent);
    }
    
    function updateSelectedCount() {
      document.getElementById('selectedCount').textContent = selectedVideos.size;
    }
    
    async function bulkDelete() {
      if (selectedVideos.size === 0) {
        alert('âš ï¸ No videos selected!');
        return;
      }
      
      const confirmed = confirm(`âš ï¸ Delete ${selectedVideos.size} video(s)?\n\nThis action cannot be undone!`);
      if (!confirmed) return;
      
      const progressText = document.getElementById('progressText');
      const progressFill = document.getElementById('progressFill');
      const progress = document.getElementById('progress');
      
      progress.classList.add('active');
      progressText.textContent = `Deleting 0/${selectedVideos.size}...`;
      
      let deleted = 0;
      const videosToDelete = Array.from(selectedVideos);
      
      for (const id of videosToDelete) {
        try {
          await contentManager.deleteContent(CONTENT_TYPE, id);
          deleted++;
          progressFill.style.width = `${(deleted / videosToDelete.length) * 100}%`;
          progressText.textContent = `Deleting ${deleted}/${videosToDelete.length}...`;
        } catch (err) {
          console.error('Delete failed:', err);
        }
      }
      
      progress.classList.remove('active');
      selectedVideos.clear();
      updateSelectedCount();
      alert(`âœ… Deleted ${deleted} video(s)!`);
      loadManageContent();
    }
    
    function deleteVideo(id) {
      const video = currentContent.find(v => v.id === id);
      const title = video ? video.title : 'this video';
      
      if (confirm(`âš ï¸ Delete "${title}"?\n\nThis action cannot be undone!`)) {
        contentManager.deleteContent(CONTENT_TYPE, id)
          .then(() => { alert('âœ… Video deleted successfully!'); loadManageContent(); })
          .catch(err => alert('âŒ Delete failed: ' + err.message));
      }
    }

    function editVideo(id) {
      const video = currentContent.find(v => v.id === id);
      if (!video) return;
      
      document.getElementById('editVideoId').value = id;
      document.getElementById('editTitle').value = video.title;
      document.getElementById('editDescription').value = video.description || '';
      document.getElementById('editDuration').value = video.duration || '';
      document.getElementById('editViews').value = video.views || 0;
      document.getElementById('editLanguage').value = video.language || 'en';
      document.getElementById('editYoutubeUrl').value = video.youtubeUrl || '';
      document.getElementById('editTags').value = (video.tags || []).join(', ');
      
      loadCategories().then(() => {
        document.getElementById('editCategory').value = video.category;
      });
      
      document.getElementById('editModal').classList.add('active');
    }

    function closeEditModal() {
      document.getElementById('editModal').classList.remove('active');
    }

    document.getElementById('editForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const id = document.getElementById('editVideoId').value;
      const originalVideo = currentContent.find(v => v.id === id);
      
      const youtubeUrl = document.getElementById('editYoutubeUrl').value;
      let videoId = originalVideo.videoId;
      if (youtubeUrl) {
        const match = youtubeUrl.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\s]+)/);
        videoId = match ? match[1] : videoId;
      }
      
      const updatedVideo = {
        ...originalVideo,
        id: id,
        title: document.getElementById('editTitle').value,
        category: document.getElementById('editCategory').value,
        description: document.getElementById('editDescription').value,
        duration: document.getElementById('editDuration').value,
        views: parseInt(document.getElementById('editViews').value) || 0,
        language: document.getElementById('editLanguage').value,
        youtubeUrl: youtubeUrl,
        videoId: videoId,
        tags: document.getElementById('editTags').value.split(',').map(t => t.trim()).filter(t => t),
        date: originalVideo.date
      };
      
      try {
        await contentManager.updateContent(CONTENT_TYPE, id, updatedVideo);
        alert('âœ… Video updated successfully!');
        closeEditModal();
        loadManageContent();
      } catch (error) {
        alert('âŒ Update failed: ' + error.message);
      }
    });

    window.addEventListener('DOMContentLoaded', loadCategories);
  </script>
  <script src="../../Optimization/navbar-autohide.js"></script>
</body>
</html>
