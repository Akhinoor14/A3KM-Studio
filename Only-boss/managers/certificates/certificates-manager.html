<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="../../../images/favicon.svg">
  
  <title>Certificates Manager - A3KM Studio</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="../../../Optimization/mobile-universal.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="../../../Optimization/mobile-universal.js" defer></script>
  
  <!-- Mobile Optimization Styles -->
  <link rel="stylesheet" href="../../mobile/only-boss-global-mobile.css">
  <link rel="stylesheet" href="../../mobile/manager-mobile.css">
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #1a1a1a; background-image: linear-gradient(rgba(139, 0, 0, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(139, 0, 0, 0.05) 1px, transparent 1px); background-size: 100px 100px; min-height: 100vh; }
    .container { display: flex; min-height: 100vh; background: white; }
    
    /* Sidebar */
    .sidebar { width: 280px; background: linear-gradient(180deg, #1a1a1a 0%, #2d2d2d 100%); padding: 0; position: sticky; top: 0; height: 100vh; overflow-y: auto; border-right: 4px solid #8B0000; }
    .sidebar-header { background: linear-gradient(135deg, #8B0000, #C80000); padding: 30px 20px; color: white; }
    .sidebar-header h1 { font-size: 22px; margin-bottom: 5px; }
    .sidebar-header p { font-size: 12px; opacity: 0.9; }
    .sidebar-nav { padding: 20px 0; }
    .tab-item { display: flex; align-items: center; gap: 12px; padding: 15px 25px; color: #ccc; cursor: pointer; transition: all 0.3s; border-left: 4px solid transparent; font-weight: 600; font-size: 14px; }
    .tab-item:hover { background: rgba(139, 0, 0, 0.1); color: white; }
    .tab-item.active { background: rgba(139, 0, 0, 0.2); color: white; border-left-color: #8B0000; }
    .quick-stats { padding: 20px; background: rgba(139, 0, 0, 0.1); margin: 20px; border-radius: 10px; }
    .quick-stats h3 { color: #ccc; font-size: 12px; text-transform: uppercase; margin-bottom: 15px; letter-spacing: 1px; }
    .stat-item { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; color: #fff; }
    .stat-value { font-weight: 700; color: #8B0000; font-size: 18px; }
    
    /* Main Content */
    .main-content { flex: 1; background: #f8f9fa; padding: 40px; overflow-y: auto; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; background: white; padding: 25px 30px; border-radius: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .back-btn { background: rgba(139, 0, 0, 0.1); border: 2px solid #8B0000; padding: 10px 20px; border-radius: 10px; color: #8B0000; font-weight: 600; cursor: pointer; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; }
    .back-btn:hover { background: #8B0000; color: white; }
    h1 { color: #8B0000; font-size: 32px; margin-bottom: 10px; }
    
    /* Tabs */
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    
    /* Form */
    .form-group { margin-bottom: 20px; }
    label { display: block; margin-bottom: 8px; color: #333; font-weight: 600; font-size: 14px; }
    input, select, textarea { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 14px; font-family: inherit; }
    input:focus, select:focus, textarea:focus { outline: none; border-color: #8B0000; }
    textarea { resize: vertical; min-height: 100px; }
    .btn-primary { padding: 15px 30px; background: linear-gradient(135deg, #8B0000, #C80000); color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; width: 100%; margin-top: 20px; }
    .btn-primary:hover { opacity: 0.9; }
    
    /* Bulk Actions */
    .bulk-actions { display: flex; gap: 10px; margin-bottom: 20px; align-items: center; padding: 15px; background: white; border-radius: 10px; }
    .bulk-actions button { padding: 10px 20px; border: 2px solid #8B0000; background: white; color: #8B0000; border-radius: 8px; cursor: pointer; font-weight: 600; }
    .bulk-actions button:hover { background: #8B0000; color: white; }
    .bulk-actions .selected-count { color: #8B0000; font-weight: 700; margin-left: auto; }
    
    /* Certificate Grid */
    .content-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
    .cert-card { position: relative; border: 2px solid #e0e0e0; border-radius: 12px; overflow: hidden; transition: all 0.3s; background: white; }
    .cert-card:hover { border-color: #8B0000; box-shadow: 0 4px 12px rgba(139, 0, 0, 0.2); }
    .cert-card input[type="checkbox"] { position: absolute; top: 10px; left: 10px; width: 20px; height: 20px; cursor: pointer; z-index: 10; }
    .cert-thumbnail { width: 100%; height: 180px; object-fit: cover; background: linear-gradient(135deg, #8B0000, #C80000); }
    .cert-body { padding: 15px; }
    .cert-title { font-weight: 600; color: #333; margin-bottom: 8px; font-size: 16px; }
    .cert-meta { font-size: 12px; color: #666; margin-bottom: 10px; line-height: 1.6; }
    .cert-badges { display: flex; gap: 5px; flex-wrap: wrap; margin-bottom: 10px; }
    .badge { padding: 4px 8px; border-radius: 12px; font-size: 10px; font-weight: 600; text-transform: uppercase; }
    .badge-verified { background: #4caf50; color: white; }
    .badge-featured { background: #ff9800; color: white; }
    .badge-category { background: #2196f3; color: white; }
    .cert-actions { display: flex; gap: 8px; }
    .btn-edit { flex: 1; padding: 8px; background: #2196f3; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; }
    .btn-delete { flex: 1; padding: 8px; background: #f44336; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; }
    .btn-edit:hover { background: #1976d2; }
    .btn-delete:hover { background: #d32f2f; }
    
    /* Pagination */
    .pagination { display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 30px; padding: 20px; background: white; border-radius: 10px; }
    .pagination button { padding: 10px 20px; border: 2px solid #8B0000; background: white; color: #8B0000; border-radius: 8px; cursor: pointer; font-weight: 600; }
    .pagination button:hover:not(:disabled) { background: #8B0000; color: white; }
    .pagination button:disabled { opacity: 0.5; cursor: not-allowed; border-color: #ccc; color: #ccc; }
    .pagination .page-info { color: #666; font-weight: 600; }
    
    /* Stats Grid */
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px; }
    .stat-card { background: linear-gradient(135deg, #8B0000, #C80000); color: white; padding: 20px; border-radius: 12px; text-align: center; }
    .stat-card h3 { font-size: 32px; margin-bottom: 5px; }
    .stat-card p { font-size: 14px; opacity: 0.9; }
    
    /* Modal */
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; overflow-y: auto; }
    .modal.active { display: block; animation: fadeIn 0.3s; }
    .modal-content { max-width: 900px; margin: 40px auto; background: white; border-radius: 20px; padding: 40px; position: relative; box-shadow: 0 20px 60px rgba(0,0,0,0.5); }
    .modal-close { position: absolute; top: 20px; right: 20px; background: #f44336; color: white; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 20px; transition: all 0.3s; }
    .modal-close:hover { background: #d32f2f; transform: rotate(90deg); }
    .modal h2 { color: #8B0000; font-size: 1.8rem; margin-bottom: 25px; }
    
    /* JSON Editor */
    .json-editor-container { display: flex; flex-direction: column; gap: 15px; }
    .json-actions { display: flex; gap: 10px; }
    .json-actions button { padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s; border: 2px solid; }
    .btn-validate { background: rgba(33, 150, 243, 0.1); border-color: #2196F3; color: #2196F3; }
    .btn-validate:hover { background: #2196F3; color: white; }
    .btn-format { background: rgba(255, 152, 0, 0.1); border-color: #FF9800; color: #FF9800; }
    .btn-format:hover { background: #FF9800; color: white; }
    .btn-save-json { background: rgba(76, 175, 80, 0.1); border-color: #4CAF50; color: #4CAF50; }
    .btn-save-json:hover { background: #4CAF50; color: white; }
    #jsonEditor { min-height: 500px; font-family: 'Consolas', 'Monaco', monospace; font-size: 13px; line-height: 1.6; }
    
    /* Progress */
    .progress { margin-top: 20px; display: none; }
    .progress.active { display: block; }
    .progress-bar { width: 100%; height: 8px; background: #f0f0f0; border-radius: 4px; overflow: hidden; margin-bottom: 10px; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, #8B0000, #C80000); width: 0%; transition: width 0.3s; }
    .progress-text { text-align: center; color: #8B0000; font-size: 14px; font-weight: 600; }
    
    /* File Upload */
    .file-upload-area { border: 2px dashed #8B0000; border-radius: 12px; padding: 40px; text-align: center; cursor: pointer; transition: all 0.3s; background: rgba(139, 0, 0, 0.02); }
    .file-upload-area:hover { border-color: #C80000; background: rgba(139, 0, 0, 0.05); }
    .file-upload-area.drag-over { border-color: #C80000; background: rgba(139, 0, 0, 0.15); transform: scale(1.02); }
    .file-upload-area i { font-size: 3rem; color: #8B0000; margin-bottom: 15px; }
    .file-upload-area p { color: #666; margin-bottom: 10px; }
    .file-upload-area input[type="file"] { display: none; }
    
    /* Advanced Filters */
    .filters-section { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; padding: 20px; background: white; border-radius: 10px; }
    .filter-group { display: flex; flex-direction: column; gap: 8px; }
    .filter-group label { font-weight: 600; color: #333; font-size: 13px; }
    .filter-group select, .filter-group input { padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; }
    .filter-group select:focus, .filter-group input:focus { border-color: #8B0000; outline: none; }
    .filter-actions { display: flex; gap: 10px; align-items: flex-end; }
    .btn-filter { padding: 10px 20px; background: #8B0000; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; }
    .btn-filter:hover { background: #C80000; }
    .btn-reset { background: #666; }
    .btn-reset:hover { background: #888; }
    
    /* Preview Modal */
    .preview-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 10000; overflow-y: auto; }
    .preview-modal.active { display: flex; align-items: center; justify-content: center; animation: fadeIn 0.3s; }
    .preview-content { max-width: 90%; max-height: 90vh; position: relative; }
    .preview-content img { max-width: 100%; max-height: 85vh; border-radius: 10px; box-shadow: 0 10px 50px rgba(0,0,0,0.5); }
    .preview-close { position: absolute; top: -40px; right: 0; background: #8B0000; color: white; border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 20px; }
    .preview-close:hover { background: #C80000; transform: rotate(90deg); transition: all 0.3s; }
    .preview-info { position: absolute; bottom: -60px; left: 0; right: 0; text-align: center; color: white; font-size: 14px; }
    
    /* Chart Container */
    .chart-container { max-width: 500px; margin: 0 auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  </style>
</head>
<body>
  <div class="container">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <h1>üéì Certificates Manager</h1>
        <p>Professional Certificates System</p>
      </div>
      <div class="sidebar-nav">
        <div class="tab-item active" onclick="switchTab('dashboard')">üìä Dashboard</div>
        <div class="tab-item" onclick="switchTab('upload')">üì§ Upload Certificate</div>
        <div class="tab-item" onclick="switchTab('manage')">üìã Manage Certificates</div>
        <div class="tab-item" onclick="switchTab('stats')">üìà Statistics</div>
        <div class="tab-item" onclick="switchTab('json')">‚öôÔ∏è JSON Editor</div>
      </div>
      <div class="quick-stats">
        <h3>Quick Stats</h3>
        <div class="stat-item">
          <span>Total Certificates</span>
          <span class="stat-value" id="quickTotal">0</span>
        </div>
        <div class="stat-item">
          <span>Academic</span>
          <span class="stat-value" id="quickAcademic">0</span>
        </div>
        <div class="stat-item">
          <span>Skills</span>
          <span class="stat-value" id="quickSkill">0</span>
        </div>
        <div class="stat-item">
          <span>Medical</span>
          <span class="stat-value" id="quickMedical">0</span>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <div class="header">
        <div>
          <h1>Certificates Manager</h1>
          <p style="color: #666;">Manage academic and professional certifications</p>
        </div>
        <a href="../../dashboard/only-boss-dashboard-redesigned.html" class="back-btn">‚Üê Back to Dashboard</a>
      </div>

      <!-- DASHBOARD TAB -->
      <div id="dashboardTab" class="tab-content active">
        <div class="stats-grid">
          <div class="stat-card">
            <h3 id="dashTotal">0</h3>
            <p>Total Certificates</p>
          </div>
          <div class="stat-card">
            <h3 id="dashAcademic">0</h3>
            <p>Academic</p>
          </div>
          <div class="stat-card">
            <h3 id="dashSkill">0</h3>
            <p>Skills</p>
          </div>
          <div class="stat-card">
            <h3 id="dashMedical">0</h3>
            <p>Medical</p>
          </div>
        </div>
        <div style="background: white; padding: 30px; border-radius: 15px;">
          <h2 style="color: #8B0000; margin-bottom: 20px;">üìö Quick Guide</h2>
          <ul style="line-height: 2; color: #666;">
            <li><strong>Upload Certificate:</strong> Add new certificates with metadata and file upload</li>
            <li><strong>Manage Certificates:</strong> Edit, delete, or organize existing certificates</li>
            <li><strong>Bulk Operations:</strong> Select multiple certificates for bulk actions</li>
            <li><strong>JSON Editor:</strong> Advanced users can directly edit the JSON database</li>
            <li><strong>Statistics:</strong> View comprehensive statistics and analytics</li>
          </ul>
        </div>
      </div>

      <!-- UPLOAD TAB -->
      <div id="uploadTab" class="tab-content">
        <form id="uploadForm">
          <div class="form-group">
            <label>GitHub Personal Access Token *</label>
            <input type="password" id="githubToken" placeholder="Token will be auto-loaded from API Config Manager" required>
            <p style="font-size: 0.85rem; color: #666; margin-top: 5px;">
              Token loaded from: <a href="../shared/api-config-manager.html" target="_blank" style="color: #8B0000;">API Config Manager</a> | 
              <a href="https://github.com/settings/tokens" target="_blank" style="color: #8B0000;">Generate new token</a>
            </p>
            <p id="tokenStatus" style="font-size: 0.85rem; margin-top: 5px;"></p>
          </div>

          <div class="form-group">
            <label>Certificate File *</label>
            <div class="file-upload-area" id="dropZone" onclick="document.getElementById('fileInput').click()">
              <i class="fas fa-cloud-upload-alt"></i>
              <p><strong>Drag & Drop</strong> or Click to upload certificate</p>
              <p style="font-size: 0.85rem;">Supported: PDF, JPG, PNG | Multiple files allowed</p>
              <input type="file" id="fileInput" accept=".pdf,.jpg,.jpeg,.png" multiple onchange="handleFileSelect(event)">
            </div>
            <div id="filePreview" style="margin-top: 15px; padding: 15px; background: #f5f5f5; border-radius: 8px; display: none;"></div>
          </div>

          <div class="form-group">
            <label>Certificate Title *</label>
            <input type="text" id="certTitle" required placeholder="e.g., SSC Certificate">
          </div>

          <div class="form-group">
            <label>Issued By *</label>
            <input type="text" id="certIssuer" required placeholder="e.g., Dinajpur Board">
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div class="form-group">
              <label>Category *</label>
              <select id="certCategory" required onchange="updateSubcategories()">
                <option value="">Select Category</option>
                <option value="Academic">üéì Academic</option>
                <option value="Skill">üèÜ Skills</option>
                <option value="Medical">üè• Medical</option>
              </select>
            </div>
            <div class="form-group">
              <label>Subcategory *</label>
              <select id="certSubcategory" required>
                <option value="">Select Subcategory</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>Issued Date</label>
            <input type="text" id="certDate" placeholder="e.g., 2023">
          </div>

          <div class="form-group">
            <label>Tags (comma-separated)</label>
            <input type="text" id="certTags" placeholder="e.g., education, hsc, science">
          </div>

          <div class="form-group">
            <label>Description</label>
            <textarea id="certDescription" placeholder="Brief description of the certificate"></textarea>
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div class="form-group">
              <label>
                <input type="checkbox" id="certVerified" checked>
                Mark as Verified
              </label>
            </div>
            <div class="form-group">
              <label>
                <input type="checkbox" id="certFeatured">
                Mark as Featured
              </label>
            </div>
          </div>

          <button type="submit" class="btn-primary">
            <i class="fas fa-check"></i>
            Upload Certificate
          </button>

          <div class="progress" id="progressContainer">
            <div class="progress-bar">
              <div class="progress-fill" id="progressBarFill"></div>
            </div>
            <div class="progress-text" id="progressText">Processing...</div>
          </div>
        </form>
      </div>

      <!-- MANAGE TAB -->
      <div id="manageTab" class="tab-content">
        <!-- Advanced Filters -->
        <div class="filters-section">
          <div class="filter-group">
            <label>üîç Search</label>
            <input type="text" id="searchManage" placeholder="Search certificates..." onkeyup="applyFilters()">
          </div>
          <div class="filter-group">
            <label>üìÅ Category</label>
            <select id="filterCategory" onchange="applyFilters()">
              <option value="">All Categories</option>
              <option value="Academic">üéì Academic</option>
              <option value="Skill">üèÜ Skills</option>
              <option value="Medical">üè• Medical</option>
            </select>
          </div>
          <div class="filter-group">
            <label>üìÇ Subcategory</label>
            <select id="filterSubcategory" onchange="applyFilters()">
              <option value="">All Subcategories</option>
            </select>
          </div>
          <div class="filter-group">
            <label>üìÖ From Date</label>
            <input type="date" id="filterDateFrom" onchange="applyFilters()">
          </div>
          <div class="filter-group">
            <label>üìÖ To Date</label>
            <input type="date" id="filterDateTo" onchange="applyFilters()">
          </div>
          <div class="filter-group">
            <label>üîÄ Sort By</label>
            <select id="sortBy" onchange="applyFilters()">
              <option value="date-desc">Newest First</option>
              <option value="date-asc">Oldest First</option>
              <option value="title-asc">Title (A-Z)</option>
              <option value="title-desc">Title (Z-A)</option>
              <option value="category">Category</option>
            </select>
          </div>
          <div class="filter-actions">
            <button class="btn-filter btn-reset" onclick="resetFilters()">üîÑ Reset</button>
          </div>
        </div>

        <div class="bulk-actions">
          <button onclick="selectAll()">‚úì Select All</button>
          <button onclick="deselectAll()">‚úó Deselect All</button>
          <button onclick="bulkDelete()">üóëÔ∏è Delete Selected</button>
          <span class="selected-count">Selected: <span id="selectedCount">0</span> | Showing: <span id="showingCount">0</span></span>
        </div>

        <div id="certificatesList" class="content-grid">
          <!-- Certificates will be loaded here -->
        </div>

        <div class="pagination" id="pagination">
          <button onclick="prevPage()">‚Üê Previous</button>
          <span class="page-info">Page <span id="currentPage">1</span> of <span id="totalPages">1</span></span>
          <button onclick="nextPage()">Next ‚Üí</button>
        </div>
      </div>

      <!-- STATISTICS TAB -->
      <div id="statsTab" class="tab-content">
        <div class="stats-grid">
          <div class="stat-card">
            <h3 id="statTotal">0</h3>
            <p>Total Certificates</p>
          </div>
          <div class="stat-card">
            <h3 id="statAcademic">0</h3>
            <p>Academic</p>
          </div>
          <div class="stat-card">
            <h3 id="statSkill">0</h3>
            <p>Skills</p>
          </div>
          <div class="stat-card">
            <h3 id="statMedical">0</h3>
            <p>Medical</p>
          </div>
          <div class="stat-card">
            <h3 id="statFeatured">0</h3>
            <p>Featured</p>
          </div>
          <div class="stat-card">
            <h3 id="statVerified">0</h3>
            <p>Verified</p>
          </div>
        </div>
        
        <div style="margin-top: 40px;">
          <h2 style="color: #8B0000; text-align: center; margin-bottom: 30px;">üìä Category Distribution</h2>
          <div class="chart-container">
            <canvas id="categoryChart"></canvas>
          </div>
        </div>
        
        <div style="margin-top: 40px;">
          <h2 style="color: #8B0000; text-align: center; margin-bottom: 30px;">üìà Monthly Upload Timeline</h2>
          <div class="chart-container" style="max-width: 800px;">
            <canvas id="timelineChart"></canvas>
          </div>
        </div>
      </div>

      <!-- JSON EDITOR TAB -->
      <div id="jsonTab" class="tab-content">
        <h2 style="color: #8B0000; font-size: 1.8rem; margin-bottom: 20px;">‚öôÔ∏è JSON Editor</h2>
        <p style="color: #666; margin-bottom: 20px;">‚ö†Ô∏è <strong>Advanced Users Only:</strong> Direct JSON manipulation. Invalid JSON will break the system!</p>
        
        <div class="json-editor-container">
          <div class="json-actions">
            <button class="btn-validate" onclick="validateJSON()">‚úì Validate JSON</button>
            <button class="btn-format" onclick="formatJSON()">‚ú® Format JSON</button>
            <button class="btn-save-json" onclick="saveJSON()">üíæ Save Changes</button>
          </div>
          <textarea id="jsonEditor" placeholder="Loading JSON data..."></textarea>
        </div>
      </div>
    </div>
  </div>

  <!-- Preview Modal -->
  <div id="previewModal" class="preview-modal" onclick="closePreview(event)">
    <div class="preview-content">
      <button class="preview-close" onclick="closePreview(event)">√ó</button>
      <img id="previewImage" src="" alt="Certificate Preview">
      <div class="preview-info">
        <strong id="previewTitle"></strong><br>
        <span id="previewMeta"></span>
      </div>
    </div>
  </div>

  <!-- Edit Modal -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeEditModal()">√ó</button>
      <h2>‚úèÔ∏è Edit Certificate</h2>
      <form id="editForm">
        <input type="hidden" id="editCertId">
        <input type="hidden" id="editCertCategory">
        
        <div class="form-group">
          <label>Certificate Title</label>
          <input type="text" id="editTitle" required>
        </div>

        <div class="form-group">
          <label>Issued By</label>
          <input type="text" id="editIssuer" required>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
          <div class="form-group">
            <label>Category</label>
            <select id="editCategorySelect" onchange="updateEditSubcategories()">
              <option value="Academic">üéì Academic</option>
              <option value="Skill">üèÜ Skills</option>
              <option value="Medical">üè• Medical</option>
            </select>
          </div>
          <div class="form-group">
            <label>Subcategory</label>
            <select id="editSubcategory"></select>
          </div>
        </div>

        <div class="form-group">
          <label>Issued Date</label>
          <input type="text" id="editDate">
        </div>

        <div class="form-group">
          <label>Tags</label>
          <input type="text" id="editTags">
        </div>

        <div class="form-group">
          <label>Description</label>
          <textarea id="editDescription"></textarea>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
          <div class="form-group">
            <label>
              <input type="checkbox" id="editVerified">
              Verified
            </label>
          </div>
          <div class="form-group">
            <label>
              <input type="checkbox" id="editFeatured">
              Featured
            </label>
          </div>
        </div>

        <button type="submit" class="btn-primary">üíæ Save Changes</button>
      </form>
    </div>
  </div>

  <script src="../Content-studio/github-content-uploader.js"></script>
  <script src="certificates-manager.js"></script>
  <script>
    // Load GitHub token from localStorage on page load
    document.addEventListener('DOMContentLoaded', () => {
      const githubToken = localStorage.getItem('github_token') || '';
      const tokenInput = document.getElementById('githubToken');
      const tokenStatus = document.getElementById('tokenStatus');
      
      if (githubToken) {
        tokenInput.value = githubToken;
        tokenStatus.innerHTML = '‚úÖ <span style="color: #28a745;">Token loaded successfully (' + githubToken.length + ' chars)</span>';
        console.log('‚úÖ Certificate Manager: GitHub token loaded from localStorage');
      } else {
        tokenStatus.innerHTML = '‚ö†Ô∏è <span style="color: #dc3545;">No token found - <a href="../shared/api-config-manager.html" style="color: #8B0000;">Set token here</a></span>';
        console.warn('‚ö†Ô∏è Certificate Manager: No GitHub token in localStorage');
        
        // Show prompt to user
        setTimeout(() => {
          const userChoice = confirm(
            '‚ö†Ô∏è GitHub Token Not Found!\n\n' +
            'Certificate Manager requires a GitHub token to upload files.\n\n' +
            'Click OK to go to API Config Manager and set your token.\n' +
            'Click Cancel to enter token manually.'
          );
          if (userChoice) {
            window.location.href = '../shared/api-config-manager.html';
          }
        }, 1000);
      }
    });
    
    // Additional UI Functions
    const ITEMS_PER_PAGE = 12;
    let currentPage = 1;
    let selectedCerts = new Set();
    let allCertificates = [];
    let filteredCertificates = [];
    let categoryChart = null;
    let timelineChart = null;

    // Subcategory mappings
    const subcategories = {
      Academic: ['PSC', 'JSC', 'SSC', 'HSC', 'BSc', 'MSc', 'PhD', 'Other'],
      Skill: ['Programming', 'Design', 'AI Tools', 'Languages', 'Soft Skills', 'Other'],
      Medical: ['Vaccination', 'Reports', 'Legal', 'Other']
    };

    // Note: This switchTab helper loads content when tabs are switched
    function loadTabContent(tabName) {
      if (tabName === 'manage') { loadManageContent(); resetPagination(); }
      if (tabName === 'stats') loadStatistics();
      if (tabName === 'dashboard') loadDashboard();
      if (tabName === 'json') loadJSONEditor();
    }

    function resetPagination() {
      currentPage = 1;
      selectedCerts.clear();
      updateSelectedCount();
    }

    function loadDashboard() {
      if (!certificatesData) return;
      const stats = certificatesData.stats || {};
      document.getElementById('dashTotal').textContent = stats.totalCertificates || 0;
      document.getElementById('dashAcademic').textContent = stats.academicCount || 0;
      document.getElementById('dashSkill').textContent = stats.skillCount || 0;
      document.getElementById('dashMedical').textContent = stats.medicalCount || 0;
      
      // Update quick stats
      document.getElementById('quickTotal').textContent = stats.totalCertificates || 0;
      document.getElementById('quickAcademic').textContent = stats.academicCount || 0;
      document.getElementById('quickSkill').textContent = stats.skillCount || 0;
      document.getElementById('quickMedical').textContent = stats.medicalCount || 0;
    }

    function loadManageContent() {
      if (!certificatesData) return;
      
      allCertificates = [];
      Object.keys(certificatesData.categories).forEach(categoryKey => {
        const category = certificatesData.categories[categoryKey];
        if (category.certificates) {
          category.certificates.forEach(cert => {
            allCertificates.push({...cert, categoryKey});
          });
        }
      });
      
      filteredCertificates = [...allCertificates];
      updateSubcategoryFilter();
      displayPage(currentPage);
    }
    
    // Advanced Filters
    function applyFilters() {
      const search = document.getElementById('searchManage').value.toLowerCase();
      const category = document.getElementById('filterCategory').value;
      const subcategory = document.getElementById('filterSubcategory').value;
      const dateFrom = document.getElementById('filterDateFrom').value;
      const dateTo = document.getElementById('filterDateTo').value;
      const sortBy = document.getElementById('sortBy').value;
      
      filteredCertificates = allCertificates.filter(cert => {
        // Search filter
        if (search && !cert.title.toLowerCase().includes(search) && 
            !cert.issuedBy.toLowerCase().includes(search) &&
            !cert.category.toLowerCase().includes(search)) {
          return false;
        }
        
        // Category filter
        if (category && cert.category !== category) return false;
        
        // Subcategory filter
        if (subcategory && cert.subcategory !== subcategory) return false;
        
        // Date range filter
        if (dateFrom || dateTo) {
          const certYear = parseInt(cert.issuedDate);
          if (dateFrom && certYear < new Date(dateFrom).getFullYear()) return false;
          if (dateTo && certYear > new Date(dateTo).getFullYear()) return false;
        }
        
        return true;
      });
      
      // Sort
      filteredCertificates.sort((a, b) => {
        switch(sortBy) {
          case 'date-asc': return parseInt(a.issuedDate) - parseInt(b.issuedDate);
          case 'date-desc': return parseInt(b.issuedDate) - parseInt(a.issuedDate);
          case 'title-asc': return a.title.localeCompare(b.title);
          case 'title-desc': return b.title.localeCompare(a.title);
          case 'category': return a.category.localeCompare(b.category);
          default: return 0;
        }
      });
      
      currentPage = 1;
      displayPage(currentPage);
      document.getElementById('showingCount').textContent = filteredCertificates.length;
    }
    
    function resetFilters() {
      document.getElementById('searchManage').value = '';
      document.getElementById('filterCategory').value = '';
      document.getElementById('filterSubcategory').value = '';
      document.getElementById('filterDateFrom').value = '';
      document.getElementById('filterDateTo').value = '';
      document.getElementById('sortBy').value = 'date-desc';
      applyFilters();
    }
    
    function updateSubcategoryFilter() {
      const category = document.getElementById('filterCategory').value;
      const subcategorySelect = document.getElementById('filterSubcategory');
      
      subcategorySelect.innerHTML = '<option value="">All Subcategories</option>';
      
      if (category && subcategories[category]) {
        subcategories[category].forEach(sub => {
          const option = document.createElement('option');
          option.value = sub;
          option.textContent = sub;
          subcategorySelect.appendChild(option);
        });
      }
    }
    
    document.getElementById('filterCategory').addEventListener('change', updateSubcategoryFilter);

    function displayPage(page) {
      const start = (page - 1) * ITEMS_PER_PAGE;
      const end = start + ITEMS_PER_PAGE;
      const pageCerts = filteredCertificates.slice(start, end);
      
      const container = document.getElementById('certificatesList');
      container.innerHTML = '';
      
      if (pageCerts.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #666; padding: 40px; grid-column: 1/-1;">No certificates found.</p>';
        return;
      }
      
      pageCerts.forEach(cert => {
        const card = document.createElement('div');
        card.className = 'cert-card';
        card.innerHTML = `
          <input type="checkbox" onchange="toggleSelection('${cert.id}')" ${selectedCerts.has(cert.id) ? 'checked' : ''}>
          <img src="https://raw.githubusercontent.com/Akhinoor14/A3KM-Studio/main/About me/${cert.filePath}" 
               class="cert-thumbnail" 
               onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' viewBox=\\'0 0 200 200\\'%3E%3Crect fill=\\'%238B0000\\' width=\\'200\\' height=\\'200\\'/%3E%3Ctext x=\\'50%25\\' y=\\'50%25\\' fill=\\'white\\' text-anchor=\\'middle\\' dy=\\'.3em\\' font-size=\\'60\\'%3Eüéì%3C/text%3E%3C/svg%3E'">
          <div class="cert-body">
            <div class="cert-title">${cert.title}</div>
            <div class="cert-meta">
              <i class="fas fa-building"></i> ${cert.issuedBy}<br>
              <i class="fas fa-calendar"></i> ${cert.issuedDate}<br>
              <i class="fas fa-folder"></i> ${cert.category} / ${cert.subcategory}
            </div>
            <div class="cert-badges">
              ${cert.verified ? '<span class="badge badge-verified">‚úì Verified</span>' : ''}
              ${cert.featured ? '<span class="badge badge-featured">‚òÖ Featured</span>' : ''}
              <span class="badge badge-category">${cert.category}</span>
            </div>
            <div class="cert-actions">
              <button class="btn-edit" onclick="editCertificate('${cert.id}', '${cert.categoryKey}')">
                <i class="fas fa-edit"></i> Edit
              </button>
              <button class="btn-delete" onclick="deleteCertificateConfirm('${cert.id}', '${cert.categoryKey}')">
                <i class="fas fa-trash"></i> Delete
              </button>
              <button class="btn-edit" onclick="previewCertificate('${cert.id}', '${cert.categoryKey}')" style="flex: 1; background: #4caf50;">
                <i class="fas fa-eye"></i> View
              </button>
            </div>
          </div>
        `;
        container.appendChild(card);
      });
      
      updatePaginationUI();
    }

    function updatePaginationUI() {
      const totalPages = Math.ceil(filteredCertificates.length / ITEMS_PER_PAGE);
      document.getElementById('currentPage').textContent = currentPage;
      document.getElementById('totalPages').textContent = totalPages;
      
      const prevBtn = document.querySelector('.pagination button:first-child');
      const nextBtn = document.querySelector('.pagination button:last-child');
      prevBtn.disabled = currentPage === 1;
      nextBtn.disabled = currentPage === totalPages || totalPages === 0;
    }

    function prevPage() {
      if (currentPage > 1) {
        currentPage--;
        displayPage(currentPage);
      }
    }

    function nextPage() {
      const totalPages = Math.ceil(filteredCertificates.length / ITEMS_PER_PAGE);
      if (currentPage < totalPages) {
        currentPage++;
        displayPage(currentPage);
      }
    }
    
    // Preview Certificate
    function previewCertificate(id, category) {
      const cert = certificatesData.categories[category].certificates.find(c => c.id === id);
      if (!cert) return;
      
      const modal = document.getElementById('previewModal');
      const img = document.getElementById('previewImage');
      const title = document.getElementById('previewTitle');
      const meta = document.getElementById('previewMeta');
      
      img.src = `https://raw.githubusercontent.com/Akhinoor14/A3KM-Studio/main/About me/${cert.filePath}`;
      title.textContent = cert.title;
      meta.textContent = `${cert.issuedBy} ‚Ä¢ ${cert.issuedDate} ‚Ä¢ ${cert.category}`;
      
      modal.classList.add('active');
    }
    
    function closePreview(event) {
      if (event.target.id === 'previewModal' || event.target.classList.contains('preview-close')) {
        document.getElementById('previewModal').classList.remove('active');
      }
    }

    function toggleSelection(id) {
      if (selectedCerts.has(id)) {
        selectedCerts.delete(id);
      } else {
        selectedCerts.add(id);
      }
      updateSelectedCount();
    }

    function selectAll() {
      filteredCertificates.forEach(cert => selectedCerts.add(cert.id));
      displayPage(currentPage);
      updateSelectedCount();
    }

    function deselectAll() {
      selectedCerts.clear();
      displayPage(currentPage);
      updateSelectedCount();
    }

    function updateSelectedCount() {
      document.getElementById('selectedCount').textContent = selectedCerts.size;
    }

    function bulkDelete() {
      if (selectedCerts.size === 0) {
        alert('‚ö†Ô∏è No certificates selected');
        return;
      }
      
      if (!confirm(`‚ö†Ô∏è Delete ${selectedCerts.size} certificate(s)? This cannot be undone!`)) {
        return;
      }
      
      const token = prompt('Enter your GitHub token to confirm:');
      if (!token) return;
      
      // Delete selected certificates
      selectedCerts.forEach(id => {
        Object.keys(certificatesData.categories).forEach(categoryKey => {
          const index = certificatesData.categories[categoryKey].certificates.findIndex(c => c.id === id);
          if (index > -1) {
            certificatesData.categories[categoryKey].certificates.splice(index, 1);
          }
        });
      });
      
      updateStatsData();
      
      const uploader = initializeGitHub(token);
      saveCertificatesToGitHub(uploader).then(() => {
        alert('‚úÖ Certificates deleted successfully!');
        selectedCerts.clear();
        loadManageContent();
        loadDashboard();
      }).catch(error => {
        alert('‚ùå Failed to delete: ' + error.message);
      });
    }

    function filterCertificates() {
      applyFilters(); // Use new advanced filters
    }
    
    function deleteCertificateConfirm(id, category) {
      deleteCertificate(id, category);
    }

    function editCertificate(id, category) {
      const cert = certificatesData.categories[category].certificates.find(c => c.id === id);
      if (!cert) return;
      
      document.getElementById('editCertId').value = cert.id;
      document.getElementById('editCertCategory').value = category;
      document.getElementById('editTitle').value = cert.title;
      document.getElementById('editIssuer').value = cert.issuedBy;
      document.getElementById('editCategorySelect').value = cert.category;
      updateEditSubcategories();
      setTimeout(() => {
        document.getElementById('editSubcategory').value = cert.subcategory;
      }, 100);
      document.getElementById('editDate').value = cert.issuedDate;
      document.getElementById('editTags').value = cert.tags.join(', ');
      document.getElementById('editDescription').value = cert.description || '';
      document.getElementById('editVerified').checked = cert.verified;
      document.getElementById('editFeatured').checked = cert.featured;
      
      document.getElementById('editModal').classList.add('active');
    }

    function closeEditModal() {
      document.getElementById('editModal').classList.remove('active');
    }

    function updateEditSubcategories() {
      const category = document.getElementById('editCategorySelect').value;
      const subcategorySelect = document.getElementById('editSubcategory');
      
      subcategorySelect.innerHTML = '<option value="">Select Subcategory</option>';
      
      if (category && subcategories[category]) {
        subcategories[category].forEach(sub => {
          const option = document.createElement('option');
          option.value = sub;
          option.textContent = sub;
          subcategorySelect.appendChild(option);
        });
      }
    }

    document.getElementById('editForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const token = prompt('Enter your GitHub token to save changes:');
      if (!token) return;
      
      const id = document.getElementById('editCertId').value;
      const oldCategory = document.getElementById('editCertCategory').value;
      const newCategory = document.getElementById('editCategorySelect').value;
      
      const certIndex = certificatesData.categories[oldCategory].certificates.findIndex(c => c.id === id);
      if (certIndex === -1) return;
      
      const cert = certificatesData.categories[oldCategory].certificates[certIndex];
      
      cert.title = document.getElementById('editTitle').value;
      cert.issuedBy = document.getElementById('editIssuer').value;
      cert.category = newCategory;
      cert.subcategory = document.getElementById('editSubcategory').value;
      cert.issuedDate = document.getElementById('editDate').value;
      cert.tags = document.getElementById('editTags').value.split(',').map(t => t.trim()).filter(t => t);
      cert.description = document.getElementById('editDescription').value;
      cert.verified = document.getElementById('editVerified').checked;
      cert.featured = document.getElementById('editFeatured').checked;
      
      if (oldCategory !== newCategory) {
        certificatesData.categories[oldCategory].certificates.splice(certIndex, 1);
        if (!certificatesData.categories[newCategory]) {
          certificatesData.categories[newCategory] = {
            displayName: `${newCategory} Certificates`,
            icon: 'fa-certificate',
            description: `${newCategory} certificates`,
            certificates: []
          };
        }
        certificatesData.categories[newCategory].certificates.push(cert);
      }
      
      updateStatsData();
      
      const uploader = initializeGitHub(token);
      await saveCertificatesToGitHub(uploader);
      
      closeEditModal();
      alert('‚úÖ Certificate updated successfully!');
      loadManageContent();
      loadDashboard();
    });

    function loadStatistics() {
      if (!certificatesData) return;
      const stats = certificatesData.stats || {};
      document.getElementById('statTotal').textContent = stats.totalCertificates || 0;
      document.getElementById('statAcademic').textContent = stats.academicCount || 0;
      document.getElementById('statSkill').textContent = stats.skillCount || 0;
      document.getElementById('statMedical').textContent = stats.medicalCount || 0;
      document.getElementById('statFeatured').textContent = stats.featuredCount || 0;
      document.getElementById('statVerified').textContent = stats.verifiedCount || 0;
      
      // Render charts
      renderCategoryChart();
      renderTimelineChart();
    }
    
    function renderCategoryChart() {
      const ctx = document.getElementById('categoryChart');
      if (!ctx) return;
      
      const stats = certificatesData.stats || {};
      const data = {
        labels: ['Academic', 'Skills', 'Medical'],
        datasets: [{
          data: [
            stats.academicCount || 0,
            stats.skillCount || 0,
            stats.medicalCount || 0
          ],
          backgroundColor: ['#8B0000', '#C80000', '#FF6B6B'],
          borderWidth: 2,
          borderColor: '#fff'
        }]
      };
      
      if (categoryChart) categoryChart.destroy();
      
      categoryChart = new Chart(ctx, {
        type: 'pie',
        data: data,
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: { position: 'bottom', labels: { font: { size: 14 }, padding: 15 } },
            title: { display: false }
          }
        }
      });
    }
    
    function renderTimelineChart() {
      const ctx = document.getElementById('timelineChart');
      if (!ctx) return;
      
      // Count certificates by month
      const monthCounts = {};
      Object.keys(certificatesData.categories).forEach(categoryKey => {
        const category = certificatesData.categories[categoryKey];
        if (category.certificates) {
          category.certificates.forEach(cert => {
            const year = cert.issuedDate || '2023';
            monthCounts[year] = (monthCounts[year] || 0) + 1;
          });
        }
      });
      
      const sortedYears = Object.keys(monthCounts).sort();
      const data = {
        labels: sortedYears,
        datasets: [{
          label: 'Certificates',
          data: sortedYears.map(year => monthCounts[year]),
          backgroundColor: 'rgba(139, 0, 0, 0.2)',
          borderColor: '#8B0000',
          borderWidth: 2,
          fill: true,
          tension: 0.4
        }]
      };
      
      if (timelineChart) timelineChart.destroy();
      
      timelineChart = new Chart(ctx, {
        type: 'line',
        data: data,
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: { display: false },
            title: { display: false }
          },
          scales: {
            y: { beginAtZero: true, ticks: { stepSize: 1 } }
          }
        }
      });
    }

    async function loadJSONEditor() {
      try {
        document.getElementById('jsonEditor').value = JSON.stringify(certificatesData, null, 2);
      } catch (error) {
        alert(`‚ùå Failed to load JSON: ${error.message}`);
      }
    }

    function validateJSON() {
      try {
        const jsonText = document.getElementById('jsonEditor').value;
        JSON.parse(jsonText);
        alert('‚úÖ JSON is valid!');
      } catch (error) {
        alert(`‚ùå Invalid JSON: ${error.message}`);
      }
    }

    function formatJSON() {
      try {
        const jsonText = document.getElementById('jsonEditor').value;
        const parsed = JSON.parse(jsonText);
        document.getElementById('jsonEditor').value = JSON.stringify(parsed, null, 2);
        alert('‚ú® JSON formatted successfully!');
      } catch (error) {
        alert(`‚ùå Cannot format invalid JSON: ${error.message}`);
      }
    }

    async function saveJSON() {
      try {
        const jsonText = document.getElementById('jsonEditor').value;
        const parsed = JSON.parse(jsonText);
        
        if (!confirm('‚ö†Ô∏è This will overwrite the entire certificates-data.json file. Are you absolutely sure?')) {
          return;
        }
        
        const token = prompt('Enter your GitHub token to save:');
        if (!token) return;
        
        certificatesData = parsed;
        const uploader = initializeGitHub(token);
        await saveCertificatesToGitHub(uploader);
        alert('‚úÖ JSON saved successfully!');
        loadManageContent();
        loadDashboard();
      } catch (error) {
        alert(`‚ùå Save failed: ${error.message}`);
      }
    }

    function handleFileSelect(event) {
      selectedFile = event.target.files[0];
      const preview = document.getElementById('filePreview');
      
      if (selectedFile) {
        preview.style.display = 'block';
        preview.innerHTML = `
          <strong>Selected File:</strong> ${selectedFile.name}<br>
          <strong>Size:</strong> ${(selectedFile.size / 1024).toFixed(2)} KB<br>
          <strong>Type:</strong> ${selectedFile.type}
        `;
        
        // Show count if multiple files
        if (event.target.files.length > 1) {
          preview.innerHTML += `<br><strong>üìÅ Multiple Files:</strong> ${event.target.files.length} files selected (First file will be uploaded)`;
        }
      }
    }
    
    // Drag & Drop Functionality
    const dropZone = document.getElementById('dropZone');
    
    dropZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      e.stopPropagation();
      dropZone.classList.add('drag-over');
    });
    
    dropZone.addEventListener('dragleave', (e) => {
      e.preventDefault();
      e.stopPropagation();
      dropZone.classList.remove('drag-over');
    });
    
    dropZone.addEventListener('drop', (e) => {
      e.preventDefault();
      e.stopPropagation();
      dropZone.classList.remove('drag-over');
      
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        // Set to file input
        const fileInput = document.getElementById('fileInput');
        fileInput.files = files;
        
        // Trigger preview
        handleFileSelect({ target: { files } });
      }
    });

    function updateSubcategories() {
      const category = document.getElementById('certCategory').value;
      const subcategorySelect = document.getElementById('certSubcategory');
      
      subcategorySelect.innerHTML = '<option value="">Select Subcategory</option>';
      
      if (category && subcategories[category]) {
        subcategories[category].forEach(sub => {
          const option = document.createElement('option');
          option.value = sub;
          option.textContent = sub;
          subcategorySelect.appendChild(option);
        });
      }
    }

    // Note: switchTab function is in certificates-manager.js - no duplicate needed here

    // Initialize on load
    window.addEventListener('DOMContentLoaded', () => {
      loadDashboard();
    });
  </script>
</body>
</html>
