<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- Universal Mobile Optimization System -->
    <link rel="stylesheet" href="../../../Optimization/mobile-universal.css">
    <script src="../../../Optimization/mobile-universal.js" defer></script>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="../../../images/favicon.svg">
    
    <title>Backup & Restore - A3KM Studio</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Mobile Optimization Styles -->
    <link rel="stylesheet" href="../../mobile/only-boss-global-mobile.css">
    <link rel="stylesheet" href="../../mobile/manager-mobile.css">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { background: white; border-radius: 20px; padding: 30px; margin-bottom: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); }
        .header h1 { color: #333; font-size: 28px; display: flex; align-items: center; gap: 15px; margin-bottom: 5px; }
        .header p { color: #666; }
        .section { background: white; border-radius: 15px; padding: 25px; margin-bottom: 25px; box-shadow: 0 5px 20px rgba(0,0,0,0.15); }
        .section-title { font-size: 20px; font-weight: 600; color: #333; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; padding-bottom: 15px; border-bottom: 2px solid #f5576c; }
        .btn { padding: 12px 24px; border: none; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s; display: inline-flex; align-items: center; gap: 8px; }
        .btn-primary { background: linear-gradient(135deg, #f093fb, #f5576c); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(245, 87, 108, 0.4); }
        .btn-success { background: #4caf50; color: white; }
        .btn-success:hover { background: #45a049; }
        .btn-danger { background: #f44336; color: white; }
        .btn-danger:hover { background: #da190b; }
        .btn-secondary { background: #9e9e9e; color: white; }
        .btn-secondary:hover { background: #757575; }
        .btn-group { display: flex; gap: 10px; flex-wrap: wrap; }
        .input-group { margin: 15px 0; }
        .input-group label { display: block; font-weight: 500; color: #333; margin-bottom: 8px; }
        .input-group input, .input-group select, .input-group textarea { width: 100%; padding: 10px 15px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; }
        .input-group input:focus, .input-group select:focus, .input-group textarea:focus { outline: none; border-color: #f5576c; background: #fff5f7; }
        .progress-bar { width: 100%; height: 6px; background: #e0e0e0; border-radius: 3px; margin: 15px 0; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #f093fb, #f5576c); width: 0%; transition: width 0.3s; }
        .status-message { padding: 12px 15px; border-radius: 8px; margin-top: 15px; font-weight: 500; }
        .status-success { background: #d4edda; color: #155724; border-left: 4px solid #28a745; }
        .status-error { background: #f8d7da; color: #721c24; border-left: 4px solid #f5576c; }
        .status-info { background: #d1ecf1; color: #0c5460; border-left: 4px solid #17a2b8; }
        .backup-list { max-height: 400px; overflow-y: auto; }
        .backup-item { background: #f5f5f5; padding: 15px; border-radius: 8px; margin: 10px 0; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid #f5576c; }
        .backup-info h4 { color: #333; margin-bottom: 5px; }
        .backup-info small { color: #999; }
        .backup-actions { display: flex; gap: 10px; }
        .backup-actions button { padding: 6px 12px; font-size: 12px; }
        table { width: 100%; border-collapse: collapse; }
        thead { background: #f5f5f5; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #e0e0e0; }
        th { font-weight: 600; color: #333; }
        tr:hover { background: #fafafa; }
        .warning-box { background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px; padding: 15px; margin: 15px 0; }
        .warning-box strong { color: #856404; }
        
        /* Help System Styles */
        .help-toggle { position: fixed; top: 20px; right: 20px; background: linear-gradient(135deg, #dc3545, #c82333); color: white; border: none; border-radius: 50px; padding: 12px 24px; font-size: 14px; font-weight: 600; cursor: pointer; z-index: 1001; box-shadow: 0 5px 20px rgba(220, 53, 69, 0.3); transition: all 0.3s; display: flex; align-items: center; gap: 8px; }
        .help-toggle:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(220, 53, 69, 0.4); }
        .help-section { display: none; position: fixed; top: 0; right: 0; width: 450px; max-width: 90vw; height: 100vh; background: white; box-shadow: -5px 0 30px rgba(0,0,0,0.3); z-index: 1000; overflow-y: auto; padding: 30px; animation: slideInRight 0.3s; }
        .help-section.active { display: block; }
        .help-section h2 { color: #333; font-size: 24px; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }
        .help-section .subtitle { color: #666; font-size: 14px; margin-bottom: 25px; }
        .purpose-box { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 20px; border-radius: 15px; margin-bottom: 25px; }
        .purpose-box h3 { font-size: 18px; margin-bottom: 10px; }
        .purpose-box p { font-size: 14px; line-height: 1.6; opacity: 0.95; }
        .help-card { background: #f8f9fa; border-left: 4px solid #f5576c; border-radius: 10px; padding: 20px; margin-bottom: 20px; }
        .help-card h3 { color: #333; font-size: 16px; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
        .help-card p { color: #666; font-size: 14px; line-height: 1.6; margin-bottom: 10px; }
        .help-card ul { color: #666; font-size: 14px; line-height: 1.8; padding-left: 20px; }
        .help-card ul li { margin-bottom: 8px; }
        .help-card code { background: #e9ecef; padding: 2px 8px; border-radius: 4px; font-size: 12px; color: #e83e8c; }
        .help-close { position: absolute; top: 30px; right: 30px; background: none; border: none; font-size: 28px; cursor: pointer; color: #999; transition: color 0.3s; }
        .help-close:hover { color: #dc3545; }
        @keyframes slideInRight { from { transform: translateX(100%); } to { transform: translateX(0); } }
        
        /* Enhanced Backup Features */
        .size-estimator { background: #e3f2fd; border: 2px solid #1976d2; border-radius: 10px; padding: 15px; margin: 15px 0; }
        .size-estimator h4 { color: #1976d2; margin-bottom: 10px; font-size: 16px; }
        .size-breakdown { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin-top: 10px; }
        .size-item { background: white; padding: 10px; border-radius: 6px; text-align: center; }
        .size-item strong { display: block; font-size: 18px; color: #1976d2; }
        .size-item span { font-size: 12px; color: #666; }
        
        /* Progress Modal */
        .progress-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; align-items: center; justify-content: center; }
        .progress-modal.show { display: flex; }
        .progress-content { background: white; border-radius: 20px; padding: 40px; max-width: 500px; width: 90%; text-align: center; }
        .progress-content h3 { color: #333; margin-bottom: 20px; }
        .progress-circle { width: 120px; height: 120px; margin: 20px auto; position: relative; }
        .progress-number { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 32px; font-weight: bold; color: #f5576c; }
        
        /* Comparison Table */
        .comparison-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .comparison-table th { background: #f093fb; color: white; padding: 12px; }
        .comparison-table td { padding: 10px; border: 1px solid #e0e0e0; }
        .diff-added { background: #d4edda; color: #155724; }
        .diff-removed { background: #f8d7da; color: #721c24; }
        .diff-unchanged { background: #f8f9fa; color: #666; }
        
        /* Storage Chart */
        .storage-chart-container { margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 10px; }
        .storage-bar { width: 100%; height: 30px; background: #e0e0e0; border-radius: 15px; overflow: hidden; position: relative; }
        .storage-fill { height: 100%; background: linear-gradient(90deg, #f093fb, #f5576c); transition: width 0.5s; }
        .storage-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; font-weight: bold; font-size: 12px; }
        
        /* Auto-backup Toggle */
        .toggle-switch { position: relative; display: inline-block; width: 60px; height: 30px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .toggle-slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 30px; }
        .toggle-slider:before { position: absolute; content: ""; height: 22px; width: 22px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .toggle-slider { background-color: #4caf50; }
        input:checked + .toggle-slider:before { transform: translateX(30px); }
        
        @media (max-width: 768px) {
            .btn-group { flex-direction: column; }
            .btn { width: 100%; justify-content: center; }
            .backup-item { flex-direction: column; align-items: flex-start; }
            .backup-actions { width: 100%; margin-top: 10px; }
            .help-section { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Help Toggle Button -->
        <button class="help-toggle" onclick="toggleHelp()">
            <i class="fas fa-question-circle"></i> ‡¶∏‡¶æ‡¶π‡¶æ‡¶Ø‡ßç‡¶Ø / Help
        </button>

        <!-- Help Section -->
        <div class="help-section" id="helpSection">
            <button class="help-close" onclick="toggleHelp()">√ó</button>
            
            <h2><i class="fas fa-book"></i> ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ó‡¶æ‡¶á‡¶° / Usage Guide</h2>
            <p class="subtitle">Backup & Restore System ‡¶è‡¶∞ ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡ßá‡¶∂‡¶ø‡¶ï‡¶æ</p>

            <!-- Purpose Box -->
            <div class="purpose-box">
                <h3>üéØ ‡¶Æ‡ßÇ‡¶≤ ‡¶â‡¶¶‡ßç‡¶¶‡ßá‡¶∂‡ßç‡¶Ø / Original Purpose</h3>
                <p><strong>Bangla:</strong> ‡¶è‡¶ü‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ website data (content, settings, media, projects) ‡¶è‡¶∞ secure backup ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßá ‡¶è‡¶¨‡¶Ç ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡¶Æ‡¶Ø‡¶º restore ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡ßÅ‡¶¨‡¶ø‡¶ß‡¶æ ‡¶¶‡ßá‡¶Ø‡¶º‡•§</p>
                <p><strong>English:</strong> Secure your website data with automatic backups and restore functionality. Create complete backups or select specific data categories.</p>
            </div>

            <!-- Help Cards -->
            <div class="help-card">
                <h3><i class="fas fa-rocket"></i> ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶∂‡ßÅ‡¶∞‡ßÅ / Quick Start</h3>
                <p><strong>Bangla - Backup ‡¶§‡ßà‡¶∞‡¶ø:</strong></p>
                <ul>
                    <li>Backup Name ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® (optional)</li>
                    <li>‡¶Ø‡ßá data backup ‡¶ï‡¶∞‡¶¨‡ßá‡¶® ‡¶∏‡ßá‡¶ó‡ßÅ‡¶≤‡ßã checkbox ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá select ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li>"Create Backup" button ‡¶è click ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li>Backup automatically save ‡¶π‡¶Ø‡¶º‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá</li>
                </ul>
                <p><strong>English - Restore:</strong> Select backup from history ‚Üí Click "Restore" ‚Üí Confirm ‚Üí Data restored!</p>
            </div>

            <div class="help-card">
                <h3><i class="fas fa-shield-alt"></i> Backup Types</h3>
                <p><strong>Bangla:</strong></p>
                <ul>
                    <li><strong>Full Backup:</strong> ‡¶∏‡¶¨ checkboxes select ‡¶ï‡¶∞‡ßÅ‡¶® - ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ website data backup ‡¶π‡¶¨‡ßá</li>
                    <li><strong>Selective Backup:</strong> ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü categories select ‡¶ï‡¶∞‡ßÅ‡¶® (e.g., ‡¶∂‡ßÅ‡¶ß‡ßÅ Content ‡¶¨‡¶æ Settings)</li>
                    <li><strong>Quick Backup:</strong> ‡¶∏‡¶¨ checkbox checked ‡¶∞‡ßá‡¶ñ‡ßá ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø "Create Backup" click ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                </ul>
                <p><strong>Backup Categories:</strong></p>
                <ul>
                    <li>üìö Content (Books, Videos, Papers, Posts)</li>
                    <li>‚öôÔ∏è Site Settings (Colors, API keys, configurations)</li>
                    <li>üñºÔ∏è Media Library (Images, PDFs, documents)</li>
                    <li>üéì Certificates (Academic, Skill, Medical)</li>
                    <li>üîß Projects (Arduino, MATLAB, SolidWorks)</li>
                    <li>üìä Analytics Data (Statistics, activity logs)</li>
                </ul>
            </div>

            <div class="help-card">
                <h3><i class="fas fa-history"></i> Backup History Management</h3>
                <p><strong>Bangla:</strong></p>
                <ul>
                    <li><strong>View Backups:</strong> "Backup History" section ‡¶è ‡¶∏‡¶¨ previous backups ‡¶¶‡ßá‡¶ñ‡¶¨‡ßá‡¶®</li>
                    <li><strong>Restore:</strong> ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã backup ‡¶è‡¶∞ "Restore" button click ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li><strong>Download:</strong> "Download" button ‡¶è click ‡¶ï‡¶∞‡ßá JSON file ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá save ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li><strong>Delete:</strong> ‡¶™‡ßÅ‡¶∞‡ßã‡¶®‡ßã backup delete ‡¶ï‡¶∞‡¶§‡ßá "Delete" button ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li><strong>Clear All:</strong> ‡¶∏‡¶¨ backup history clear ‡¶ï‡¶∞‡¶§‡ßá "Clear All Backup History" button</li>
                </ul>
                <p><strong>English:</strong> Each backup shows date, size, and included data categories.</p>
            </div>

            <div class="help-card">
                <h3><i class="fas fa-upload"></i> Restore Process</h3>
                <p><strong>Bangla - ‡¶ï‡ßÄ‡¶≠‡¶æ‡¶¨‡ßá Restore ‡¶ï‡¶∞‡¶¨‡ßá‡¶®:</strong></p>
                <ul>
                    <li><strong>Method 1 (From History):</strong> Backup History ‡¶•‡ßá‡¶ï‡ßá backup select ‡¶ï‡¶∞‡ßá "Restore" click ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li><strong>Method 2 (From File):</strong> "Restore from File" section ‡¶è JSON file upload ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li>‚ö†Ô∏è <strong>Warning:</strong> Restore ‡¶ï‡¶∞‡¶≤‡ßá current data replace ‡¶π‡¶Ø‡¶º‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá</li>
                    <li>üí° <strong>Pro Tip:</strong> Restore ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá ‡¶®‡¶§‡ßÅ‡¶® backup ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                </ul>
                <p><strong>Restore Steps:</strong></p>
                <ul>
                    <li>1Ô∏è‚É£ Create current data backup (safety)</li>
                    <li>2Ô∏è‚É£ Select backup to restore</li>
                    <li>3Ô∏è‚É£ Click "Restore" and confirm</li>
                    <li>4Ô∏è‚É£ Wait for success message</li>
                    <li>5Ô∏è‚É£ Refresh page to see restored data</li>
                </ul>
            </div>

            <div class="help-card">
                <h3><i class="fas fa-file-export"></i> Export Individual Data</h3>
                <p><strong>Bangla:</strong></p>
                <ul>
                    <li>"Export Data" section ‡¶è ‡¶Ø‡¶æ‡¶®</li>
                    <li>‡¶Ø‡ßá data export ‡¶ï‡¶∞‡¶¨‡ßá‡¶® ‡¶∏‡ßá‡¶á button click ‡¶ï‡¶∞‡ßÅ‡¶® (Books, Videos, Settings, etc.)</li>
                    <li>JSON file download ‡¶π‡¶Ø‡¶º‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá</li>
                    <li>‡¶è‡¶á files ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶è‡¶ï‡¶ü‡¶ø specific category ‡¶è‡¶∞ data contain ‡¶ï‡¶∞‡ßá</li>
                </ul>
                <p><strong>Use Case:</strong> ‡¶Ø‡¶ñ‡¶® ‡¶∂‡ßÅ‡¶ß‡ßÅ specific data (e.g., ‡¶∂‡ßÅ‡¶ß‡ßÅ Books ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶∂‡ßÅ‡¶ß‡ßÅ Settings) backup/share ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®‡•§</p>
            </div>

            <div class="help-card">
                <h3><i class="fas fa-code-branch"></i> Backup Comparison</h3>
                <p><strong>Bangla:</strong></p>
                <ul>
                    <li>‡¶¶‡ßÅ‡¶ü‡¶ø backup select ‡¶ï‡¶∞‡ßÅ‡¶® dropdown ‡¶•‡ßá‡¶ï‡ßá</li>
                    <li>"Compare Backups" button click ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li>System automatically ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá ‡¶ï‡ßÄ data changed ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</li>
                    <li>‡¶è‡¶ü‡¶ø ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá progress track ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶® (‡¶ï‡¶§‡¶ü‡¶æ content add ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá)</li>
                </ul>
                <p><strong>English:</strong> Compare two backups to see what data was added, modified, or removed.</p>
            </div>

            <div class="help-card">
                <h3><i class="fas fa-lightbulb"></i> ‡¶™‡ßç‡¶∞‡ßã ‡¶ü‡¶ø‡¶™‡¶∏ / Pro Tips</h3>
                <ul>
                    <li>üìÜ ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∏‡¶™‡ßç‡¶§‡¶æ‡¶π‡ßá ‡¶è‡¶ï‡¶¨‡¶æ‡¶∞ full backup ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li>üíæ Important backups external storage ‡¶è save ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li>üìù Backup name ‡¶è date ‡¶è‡¶¨‡¶Ç purpose ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® (e.g., "Before Major Update - 2024-01-15")</li>
                    <li>üîÑ Restore ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá ‡¶∏‡¶¨‡¶∏‡¶Æ‡¶Ø‡¶º current data backup ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li>üóÇÔ∏è ‡¶™‡ßÅ‡¶∞‡ßã‡¶®‡ßã unnecessary backups regularly delete ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li>‚òÅÔ∏è Backups Google Drive/Dropbox ‡¶è sync ‡¶ï‡¶∞‡ßá ‡¶∞‡¶æ‡¶ñ‡ßÅ‡¶®</li>
                    <li>üîí Backup files secure location ‡¶è ‡¶∞‡¶æ‡¶ñ‡ßÅ‡¶® (password-protected folder)</li>
                </ul>
            </div>

            <div class="help-card">
                <h3><i class="fas fa-exclamation-triangle"></i> ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶® / Troubleshooting</h3>
                <p><strong>Backup ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶ö‡ßç‡¶õ‡ßá ‡¶®‡¶æ?</strong></p>
                <ul>
                    <li>Browser console (F12) ‡¶ñ‡ßÅ‡¶≤‡ßá error check ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li>LocalStorage space ‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶Ü‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ verify ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li>‡¶Ö‡¶®‡ßç‡¶§‡¶§ ‡¶è‡¶ï‡¶ü‡¶ø checkbox select ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶® ‡¶ï‡¶ø‡¶®‡¶æ check ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                </ul>
                <p><strong>Restore ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶õ‡ßá ‡¶®‡¶æ?</strong></p>
                <ul>
                    <li>Backup file ‡¶ü‡¶ø corrupt ‡¶®‡ßá‡¶á ‡¶ï‡¶ø‡¶®‡¶æ check ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li>JSON format valid ‡¶ï‡¶ø‡¶®‡¶æ verify ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li>Page refresh ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ try ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                </ul>
                <p><strong>Backup file ‡¶ñ‡ßÅ‡¶¨ ‡¶¨‡¶°‡¶º?</strong></p>
                <ul>
                    <li>Selective backup ‡¶ï‡¶∞‡ßÅ‡¶® (only necessary data)</li>
                    <li>‡¶™‡ßÅ‡¶∞‡ßã‡¶®‡ßã unused content delete ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li>Media files compress ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                </ul>
            </div>
        </div>

        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-shield-alt"></i> Backup & Restore System</h1>
            <p>Secure your data with automatic backups and restore functionality</p>
        </div>

        <!-- Create Backup Section -->
        <div class="section">
            <div class="section-title">
                <i class="fas fa-cloud-upload-alt"></i> Create New Backup
            </div>
            <p style="color: #666; margin-bottom: 20px;">Create a complete backup of all your website data including content, settings, media, and configuration files.</p>
            
            <div class="input-group">
                <label for="backupName">Backup Name (optional)</label>
                <input type="text" id="backupName" placeholder="e.g., Website Backup - 2024-01-15" value="">
            </div>

            <div class="input-group">
                <label>Select Data to Backup</label>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 10px;">
                    <label style="display: flex; align-items: center; gap: 10px; font-weight: 400; cursor: pointer;">
                        <input type="checkbox" id="backupContent" checked> Content (Books, Videos, Papers)
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; font-weight: 400; cursor: pointer;">
                        <input type="checkbox" id="backupSettings" checked> Site Settings
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; font-weight: 400; cursor: pointer;">
                        <input type="checkbox" id="backupMedia" checked> Media Library
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; font-weight: 400; cursor: pointer;">
                        <input type="checkbox" id="backupCerts" checked> Certificates
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; font-weight: 400; cursor: pointer;">
                        <input type="checkbox" id="backupProjects" checked> Projects
                    </label>
                    <label style="display: flex; align-items: center; gap: 10px; font-weight: 400; cursor: pointer;">
                        <input type="checkbox" id="backupAnalytics" checked> Analytics Data
                    </label>
                </div>
            </div>

            <div class="warning-box">
                <strong><i class="fas fa-exclamation-triangle"></i> Note:</strong> Backup includes all localStorage data. File size depends on content volume.
            </div>
            
            <!-- Size Estimator -->
            <div class="size-estimator" id="sizeEstimator" style="display: none;">
                <h4><i class="fas fa-calculator"></i> Estimated Backup Size</h4>
                <div class="size-breakdown" id="sizeBreakdown"></div>
                <div style="margin-top: 10px; text-align: center;">
                    <strong style="font-size: 20px; color: #f5576c;">Total: <span id="totalSize">0</span> KB</strong>
                </div>
            </div>
            
            <!-- Auto-Backup Settings -->
            <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0; display: flex; align-items: center; justify-content: space-between;">
                <div>
                    <strong><i class="fas fa-clock"></i> Auto-Backup (Every 24 hours)</strong>
                    <p style="font-size: 12px; color: #856404; margin: 5px 0 0 0;">Automatically create backups daily</p>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="autoBackupToggle" onchange="toggleAutoBackup()">
                    <span class="toggle-slider"></span>
                </label>
            </div>

            <div class="btn-group">
                <button class="btn btn-primary" onclick="calculateBackupSize()">
                    <i class="fas fa-calculator"></i> Calculate Size
                </button>
                <button class="btn btn-primary" onclick="createBackup()">
                    <i class="fas fa-download"></i> Create & Download Backup
                </button>
                <button class="btn btn-success" onclick="previewBackupData()">
                    <i class="fas fa-eye"></i> Preview Data
                </button>
            </div>
            <div id="backupStatus"></div>
        </div>

        <!-- Restore Backup Section -->
        <div class="section">
            <div class="section-title">
                <i class="fas fa-cloud-download-alt"></i> Restore from Backup
            </div>
            <p style="color: #666; margin-bottom: 20px;">Upload a previously saved backup file to restore your website data.</p>

            <div class="input-group">
                <label for="restoreFile">Select Backup File (.json)</label>
                <input type="file" id="restoreFile" accept=".json" style="padding: 15px; cursor: pointer;">
            </div>

            <div class="warning-box">
                <strong><i class="fas fa-exclamation-triangle"></i> Warning:</strong> Restoring will overwrite current data. Create a backup before restoring.
            </div>

            <div class="btn-group">
                <button class="btn btn-success" onclick="restoreBackup()">
                    <i class="fas fa-redo"></i> Restore Backup
                </button>
                <button class="btn btn-secondary" onclick="document.getElementById('restoreFile').click()">
                    <i class="fas fa-folder-open"></i> Choose File
                </button>
            </div>
            <div id="restoreStatus"></div>
        </div>

        <!-- Backup History Section -->
        <div class="section">
            <div class="section-title">
                <i class="fas fa-history"></i> Backup History
            </div>
            <p style="color: #666; margin-bottom: 20px;" id="historyInfo">No backups found. Create your first backup to get started.</p>
            
            <!-- Storage Usage Chart -->
            <div class="storage-chart-container">
                <h4 style="margin-bottom: 10px; color: #333;"><i class="fas fa-database"></i> Storage Usage</h4>
                <div class="storage-bar">
                    <div class="storage-fill" id="storageFill" style="width: 0%;"></div>
                    <div class="storage-text" id="storageText">0 KB / 10 MB</div>
                </div>
                <p style="font-size: 12px; color: #666; margin-top: 8px;">LocalStorage limit: ~10MB per domain</p>
            </div>

            <div class="backup-list" id="backupHistory"></div>

            <div style="margin-top: 20px; display: flex; gap: 10px;">
                <button class="btn btn-success" onclick="exportAllBackups()" style="flex: 1;">
                    <i class="fas fa-file-archive"></i> Export All Backups
                </button>
                <button class="btn btn-danger" onclick="clearAllBackups()" style="flex: 1;">
                    <i class="fas fa-trash"></i> Clear All History
                </button>
            </div>
        </div>

        <!-- Data Export Section -->
        <div class="section">
            <div class="section-title">
                <i class="fas fa-file-export"></i> Export Data
            </div>
            <p style="color: #666; margin-bottom: 20px;">Export individual data categories as JSON files.</p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                <button class="btn btn-secondary" onclick="exportData('books-pdfs')" style="flex: 1;">
                    <i class="fas fa-book"></i> Export Books
                </button>
                <button class="btn btn-secondary" onclick="exportData('educational-videos')" style="flex: 1;">
                    <i class="fas fa-video"></i> Export Videos
                </button>
                <button class="btn btn-secondary" onclick="exportData('research-papers')" style="flex: 1;">
                    <i class="fas fa-file-pdf"></i> Export Papers
                </button>
                <button class="btn btn-secondary" onclick="exportData('written-posts')" style="flex: 1;">
                    <i class="fas fa-pen"></i> Export Posts
                </button>
                <button class="btn btn-secondary" onclick="exportData('a3km_site_settings')" style="flex: 1;">
                    <i class="fas fa-cog"></i> Export Settings
                </button>
                <button class="btn btn-secondary" onclick="exportData('a3km_media_library')" style="flex: 1;">
                    <i class="fas fa-image"></i> Export Media
                </button>
            </div>
        </div>

        <!-- Backup Comparison Section -->
        <div class="section">
            <div class="section-title">
                <i class="fas fa-code-branch"></i> Backup Comparison
            </div>
            <p style="color: #666; margin-bottom: 20px;">Compare two backups to see what data changed.</p>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px;">
                <div class="input-group">
                    <label for="compareBackup1">First Backup</label>
                    <select id="compareBackup1"></select>
                </div>
                <div class="input-group">
                    <label for="compareBackup2">Second Backup</label>
                    <select id="compareBackup2"></select>
                </div>
            </div>

            <button class="btn btn-primary" onclick="compareBackups()" style="width: 100%;">
                <i class="fas fa-project-diagram"></i> Compare Backups
            </button>

            <div id="comparisonResult" style="margin-top: 20px;"></div>
        </div>
    </div>

    <script src="../../shared/github-token-manager.js"></script>
    <script>
        let tokenManager = null;
        const BACKUPS_KEY = 'a3km_backups_history';
        const STORAGE_KEYS = {
            'books-pdfs': 'content_books-pdfs',
            'educational-videos': 'content_educational-videos',
            'research-papers': 'content_research-papers',
            'written-posts': 'content_written-posts',
            'video-content': 'content_video-content',
            'a3km_site_settings': 'a3km_site_settings',
            'a3km_media_library': 'a3km_media_library',
            'a3km_certificates': 'a3km_certificates',
            'projects': 'projects',
            'analytics': 'analyticsData'
        };

        // Toggle help section
        function toggleHelp() {
            const helpSection = document.getElementById('helpSection');
            helpSection.classList.toggle('active');
        }

        document.addEventListener('DOMContentLoaded', () => {
            tokenManager = typeof GitHubTokenManager !== 'undefined' ? new GitHubTokenManager() : null;
            loadBackupHistory();
            updateStorageUsage();
            loadAutoBackupSettings();
            
            document.getElementById('restoreFile').addEventListener('change', e => {
                if (e.target.files[0]) {
                    document.getElementById('restoreFile').style.borderColor = '#4caf50';
                }
            });
            
            // Show/hide size estimator when checkboxes change
            document.querySelectorAll('[id^="backup"]').forEach(checkbox => {
                checkbox.addEventListener('change', () => {
                    const anyChecked = Array.from(document.querySelectorAll('[id^="backup"]')).some(cb => cb.checked);
                    if (anyChecked) {
                        calculateBackupSize();
                    }
                });
            });
            
            // Live update every 4 seconds
            setInterval(() => {
                loadBackupHistory();
                updateStorageUsage();
            }, 4000);
            
            // Check auto-backup schedule
            checkAutoBackup();
            setInterval(checkAutoBackup, 60000); // Check every minute
        });

        function calculateBackupSize() {
            let totalSize = 0;
            const breakdown = {};
            const estimator = document.getElementById('sizeEstimator');
            const breakdownEl = document.getElementById('sizeBreakdown');
            
            if (document.getElementById('backupContent').checked) {
                let contentSize = 0;
                contentSize += (localStorage.getItem(STORAGE_KEYS['books-pdfs']) || '').length;
                contentSize += (localStorage.getItem(STORAGE_KEYS['educational-videos']) || '').length;
                contentSize += (localStorage.getItem(STORAGE_KEYS['research-papers']) || '').length;
                contentSize += (localStorage.getItem(STORAGE_KEYS['written-posts']) || '').length;
                breakdown['Content'] = contentSize;
                totalSize += contentSize;
            }
            if (document.getElementById('backupSettings').checked) {
                const settingsSize = (localStorage.getItem(STORAGE_KEYS['a3km_site_settings']) || '').length;
                breakdown['Settings'] = settingsSize;
                totalSize += settingsSize;
            }
            if (document.getElementById('backupMedia').checked) {
                const mediaSize = (localStorage.getItem(STORAGE_KEYS['a3km_media_library']) || '').length;
                breakdown['Media'] = mediaSize;
                totalSize += mediaSize;
            }
            if (document.getElementById('backupCerts').checked) {
                const certsSize = (localStorage.getItem(STORAGE_KEYS['a3km_certificates']) || '').length;
                breakdown['Certificates'] = certsSize;
                totalSize += certsSize;
            }
            if (document.getElementById('backupProjects').checked) {
                const projectsSize = (localStorage.getItem(STORAGE_KEYS['projects']) || '').length;
                breakdown['Projects'] = projectsSize;
                totalSize += projectsSize;
            }
            if (document.getElementById('backupAnalytics').checked) {
                const analyticsSize = (localStorage.getItem('a3km_activity_logs') || '').length;
                breakdown['Analytics'] = analyticsSize;
                totalSize += analyticsSize;
            }
            
            breakdownEl.innerHTML = '';
            Object.entries(breakdown).forEach(([category, size]) => {
                breakdownEl.innerHTML += `<div class="size-item"><strong>${category}:</strong> ${(size/1024).toFixed(2)} KB</div>`;
            });
            
            document.getElementById('totalSize').textContent = `Total: ${(totalSize/1024).toFixed(2)} KB`;
            estimator.style.display = totalSize > 0 ? 'block' : 'none';
        }

        function updateStorageUsage() {
            let totalSize = 0;
            for (let key in localStorage) {
                if (localStorage.hasOwnProperty(key)) {
                    totalSize += (localStorage[key].length + key.length) * 2; // UTF-16
                }
            }
            const usedKB = (totalSize / 1024).toFixed(2);
            const limitKB = 10240; // 10MB
            const percentage = Math.min((usedKB / limitKB) * 100, 100);
            
            const fillEl = document.getElementById('storageFill');
            const textEl = document.getElementById('storageText');
            
            if (fillEl && textEl) {
                fillEl.style.width = percentage + '%';
                textEl.textContent = `${usedKB} KB / ${limitKB / 1024} MB`;
                
                if (percentage > 90) {
                    fillEl.style.background = 'linear-gradient(to right, #ff416c, #ff4b2b)';
                } else if (percentage > 70) {
                    fillEl.style.background = 'linear-gradient(to right, #f093fb, #f5576c)';
                }
            }
        }

        function previewBackupData() {
            const modal = document.createElement('div');
            modal.className = 'progress-modal';
            modal.innerHTML = `
                <div class="progress-content" style="max-width: 600px; max-height: 80vh; overflow-y: auto;">
                    <h3 style="margin-bottom: 20px;">üìã Backup Preview</h3>
                    <div id="previewContent" style="text-align: left; background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; font-family: monospace; font-size: 12px; white-space: pre-wrap; word-break: break-all;"></div>
                    <button onclick="this.parentElement.parentElement.remove()" style="margin-top: 20px; padding: 10px 20px; background: #f5576c; color: white; border: none; border-radius: 5px; cursor: pointer;">Close</button>
                </div>
            `;
            
            const previewData = {};
            if (document.getElementById('backupContent').checked) previewData.content = '...';
            if (document.getElementById('backupSettings').checked) previewData.settings = JSON.parse(localStorage.getItem(STORAGE_KEYS['a3km_site_settings']) || '{}');
            if (document.getElementById('backupMedia').checked) previewData.media = '...';
            if (document.getElementById('backupCerts').checked) previewData.certificates = '...';
            if (document.getElementById('backupProjects').checked) previewData.projects = '...';
            if (document.getElementById('backupAnalytics').checked) previewData.analytics = '...';
            
            modal.querySelector('#previewContent').textContent = JSON.stringify(previewData, null, 2).slice(0, 2000) + '\n\n... (truncated)';
            document.body.appendChild(modal);
        }

        function toggleAutoBackup() {
            const enabled = document.getElementById('autoBackupToggle').checked;
            localStorage.setItem('autoBackupEnabled', enabled);
            if (enabled) {
                localStorage.setItem('lastAutoBackup', new Date().toISOString());
            }
        }

        function loadAutoBackupSettings() {
            const enabled = localStorage.getItem('autoBackupEnabled') === 'true';
            const toggle = document.getElementById('autoBackupToggle');
            if (toggle) toggle.checked = enabled;
        }

        function checkAutoBackup() {
            const enabled = localStorage.getItem('autoBackupEnabled') === 'true';
            if (!enabled) return;
            
            const lastBackupStr = localStorage.getItem('lastAutoBackup');
            if (!lastBackupStr) return;
            
            const lastBackup = new Date(lastBackupStr);
            const now = new Date();
            const hoursSince = (now - lastBackup) / (1000 * 60 * 60);
            
            if (hoursSince >= 24) {
                // Select all checkboxes for full backup
                document.querySelectorAll('[id^="backup"]').forEach(cb => cb.checked = true);
                createBackup();
                localStorage.setItem('lastAutoBackup', now.toISOString());
            }
        }

        function exportAllBackups() {
            const backups = JSON.parse(localStorage.getItem(BACKUPS_KEY) || '[]');
            if (backups.length === 0) {
                alert('No backups to export');
                return;
            }
            
            const archive = {
                exportedAt: new Date().toISOString(),
                backupCount: backups.length,
                backups: backups
            };
            
            const dataStr = JSON.stringify(archive, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `all-backups-${Date.now()}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }

        function showProgressModal(message) {
            const modal = document.createElement('div');
            modal.id = 'progressModal';
            modal.className = 'progress-modal';
            modal.innerHTML = `
                <div class="progress-content">
                    <div class="progress-circle">
                        <div class="progress-value">0%</div>
                    </div>
                    <p style="margin-top: 20px;">${message}</p>
                </div>
            `;
            document.body.appendChild(modal);
            
            let progress = 0;
            const interval = setInterval(() => {
                progress += 10;
                if (progress <= 100) {
                    modal.querySelector('.progress-value').textContent = progress + '%';
                } else {
                    clearInterval(interval);
                }
            }, 100);
        }

        function hideProgressModal() {
            const modal = document.getElementById('progressModal');
            if (modal) modal.remove();
        }

        function createBackup() {
            const backupName = document.getElementById('backupName').value || `Backup - ${new Date().toLocaleString()}`;
            const statusEl = document.getElementById('backupStatus');
            
            showProgressModal('Creating backup...');
            
            setTimeout(() => {
                try {
                    const backupData = {
                        name: backupName,
                        timestamp: new Date().toISOString(),
                        version: '1.0',
                        categories: [],
                        data: {}
                    };

                    // Collect selected data
                    if (document.getElementById('backupContent').checked) {
                        backupData.categories.push('Content');
                        backupData.data.books = localStorage.getItem(STORAGE_KEYS['books-pdfs']);
                        backupData.data.videos = localStorage.getItem(STORAGE_KEYS['educational-videos']);
                        backupData.data.papers = localStorage.getItem(STORAGE_KEYS['research-papers']);
                        backupData.data.posts = localStorage.getItem(STORAGE_KEYS['written-posts']);
                    }
                    if (document.getElementById('backupSettings').checked) {
                        backupData.categories.push('Settings');
                        backupData.data.settings = localStorage.getItem(STORAGE_KEYS['a3km_site_settings']);
                    }
                    if (document.getElementById('backupMedia').checked) {
                        backupData.categories.push('Media');
                        backupData.data.media = localStorage.getItem(STORAGE_KEYS['a3km_media_library']);
                    }
                    if (document.getElementById('backupCerts').checked) {
                        backupData.categories.push('Certificates');
                        backupData.data.certificates = localStorage.getItem(STORAGE_KEYS['a3km_certificates']);
                    }
                    if (document.getElementById('backupProjects').checked) {
                        backupData.categories.push('Projects');
                        backupData.data.projects = localStorage.getItem(STORAGE_KEYS['projects']);
                    }
                    if (document.getElementById('backupAnalytics').checked) {
                        backupData.categories.push('Analytics');
                        backupData.data.analytics = localStorage.getItem('a3km_activity_logs');
                    }

                    // Save full backup data to history
                    const backupSize = JSON.stringify(backupData).length;
                    const backups = JSON.parse(localStorage.getItem(BACKUPS_KEY) || '[]');
                    const backupId = Date.now();
                    
                    backups.push({
                        name: backupName,
                        timestamp: new Date().toISOString(),
                        size: backupSize,
                        id: backupId,
                        categories: backupData.categories,
                        data: backupData
                    });
                    localStorage.setItem(BACKUPS_KEY, JSON.stringify(backups));

                    // Download
                    const dataStr = JSON.stringify(backupData, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(dataBlob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `a3km-backup-${Date.now()}.json`;
                    link.click();
                    URL.revokeObjectURL(url);

                    hideProgressModal();
                    statusEl.innerHTML = `<div class="status-message status-success"><i class="fas fa-check-circle"></i> ‚úÖ Backup created successfully! (${(backupSize/1024).toFixed(2)} KB)</div>`;
                    loadBackupHistory();
                    updateStorageUsage();
                    document.getElementById('backupName').value = '';
                } catch (error) {
                    hideProgressModal();
                    statusEl.innerHTML = `<div class="status-message status-error"><i class="fas fa-times-circle"></i> ‚ùå Error: ${error.message}</div>`;
                }
            }, 1000);
        }

        function restoreBackup() {
            const file = document.getElementById('restoreFile').files[0];
            const statusEl = document.getElementById('restoreStatus');

            if (!file) {
                statusEl.innerHTML = '<div class="status-message status-error"><i class="fas fa-times-circle"></i> Please select a backup file</div>';
                return;
            }

            const reader = new FileReader();
            reader.onload = e => {
                try {
                    const backup = JSON.parse(e.target.result);
                    
                    if (!confirm(`Restore backup "${backup.name}"? This will overwrite current data.`)) return;

                    // Restore data
                    Object.entries(backup.data).forEach(([key, value]) => {
                        if (value) {
                            const storageKey = Object.values(STORAGE_KEYS).find(k => k.includes(key)) || key;
                            localStorage.setItem(storageKey, value);
                        }
                    });

                    statusEl.innerHTML = '<div class="status-message status-success"><i class="fas fa-check-circle"></i> Backup restored successfully! Page will reload...</div>';
                    setTimeout(() => location.reload(), 2000);
                } catch (error) {
                    statusEl.innerHTML = `<div class="status-message status-error"><i class="fas fa-times-circle"></i> Invalid backup file: ${error.message}</div>`;
                }
            };
            reader.readAsText(file);
        }

        function loadBackupHistory() {
            const backups = JSON.parse(localStorage.getItem(BACKUPS_KEY) || '[]');
            const container = document.getElementById('backupHistory');
            const selectEls = [document.getElementById('compareBackup1'), document.getElementById('compareBackup2')];

            container.innerHTML = '';
            selectEls.forEach(el => el.innerHTML = '');

            if (backups.length === 0) {
                document.getElementById('historyInfo').textContent = 'No backups found. Create your first backup to get started.';
                return;
            }

            document.getElementById('historyInfo').textContent = `${backups.length} backup(s) found`;
            
            backups.reverse().forEach((backup, idx) => {
                const date = new Date(backup.timestamp);
                const sizeKB = (backup.size / 1024).toFixed(2);

                container.innerHTML += `
                    <div class="backup-item">
                        <div class="backup-info">
                            <h4>${backup.name}</h4>
                            <small>${date.toLocaleString()} ‚Ä¢ ${sizeKB} KB</small>
                        </div>
                        <div class="backup-actions">
                            <button class="btn btn-secondary" onclick="downloadBackup(${backup.id})">
                                <i class="fas fa-download"></i> Download
                            </button>
                            <button class="btn btn-danger" onclick="deleteBackup(${backup.id})">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                `;

                selectEls.forEach(el => {
                    el.innerHTML += `<option value="${backup.id}">${backup.name}</option>`;
                });
            });
        }

        function deleteBackup(id) {
            if (!confirm('Delete this backup?')) return;
            const backups = JSON.parse(localStorage.getItem(BACKUPS_KEY) || '[]');
            const filtered = backups.filter(b => b.id !== id);
            localStorage.setItem(BACKUPS_KEY, JSON.stringify(filtered));
            loadBackupHistory();
        }

        function clearAllBackups() {
            if (!confirm('Delete all backups? This cannot be undone.')) return;
            localStorage.removeItem(BACKUPS_KEY);
            loadBackupHistory();
            document.getElementById('historyInfo').textContent = 'No backups found. Create your first backup to get started.';
        }

        function exportData(category) {
            const key = STORAGE_KEYS[category] || category;
            const data = localStorage.getItem(key);
            
            if (!data) {
                alert(`No data found for ${category}`);
                return;
            }

            const dataBlob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `${category}-export-${Date.now()}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }

        function compareBackups() {
            const id1 = parseInt(document.getElementById('compareBackup1').value);
            const id2 = parseInt(document.getElementById('compareBackup2').value);
            const resultEl = document.getElementById('comparisonResult');

            if (!id1 || !id2) {
                resultEl.innerHTML = '<div class="status-message status-error">Please select two backups to compare</div>';
                return;
            }

            const backups = JSON.parse(localStorage.getItem(BACKUPS_KEY) || '[]');
            const backup1 = backups.find(b => b.id === id1);
            const backup2 = backups.find(b => b.id === id2);

            if (!backup1 || !backup2) {
                resultEl.innerHTML = '<div class="status-message status-error">Backups not found</div>';
                return;
            }

            const date1 = new Date(backup1.timestamp).toLocaleDateString();
            const date2 = new Date(backup2.timestamp).toLocaleDateString();
            const sizeDiff = ((backup2.size - backup1.size) / 1024).toFixed(2);
            const timeDiff = Math.abs(new Date(backup2.timestamp) - new Date(backup1.timestamp)) / (1000 * 60 * 60 * 24);

            let categoriesComparison = '<ul style="text-align: left; margin-top: 10px;">';
            const allCategories = new Set([...backup1.categories || [], ...backup2.categories || []]);
            allCategories.forEach(cat => {
                const inB1 = backup1.categories?.includes(cat);
                const inB2 = backup2.categories?.includes(cat);
                if (inB1 && inB2) {
                    categoriesComparison += `<li class="diff-unchanged">‚úì ${cat} (Both)</li>`;
                } else if (inB1) {
                    categoriesComparison += `<li class="diff-removed">- ${cat} (Only in Backup 1)</li>`;
                } else {
                    categoriesComparison += `<li class="diff-added">+ ${cat} (Only in Backup 2)</li>`;
                }
            });
            categoriesComparison += '</ul>';

            resultEl.innerHTML = `
                <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; margin-top: 20px;">
                    <h3>üìä Comparison Results</h3>
                    <table class="comparison-table" style="width: 100%; margin-top: 15px;">
                        <tr>
                            <th>Property</th>
                            <th>Backup 1</th>
                            <th>Backup 2</th>
                        </tr>
                        <tr>
                            <td>Name</td>
                            <td>${backup1.name}</td>
                            <td>${backup2.name}</td>
                        </tr>
                        <tr>
                            <td>Date</td>
                            <td>${date1}</td>
                            <td>${date2}</td>
                        </tr>
                        <tr>
                            <td>Size</td>
                            <td>${(backup1.size/1024).toFixed(2)} KB</td>
                            <td>${(backup2.size/1024).toFixed(2)} KB</td>
                        </tr>
                        <tr>
                            <td colspan="3" style="text-align: center; padding-top: 10px;"><strong>Size Difference:</strong> ${sizeDiff > 0 ? '+' : ''}${sizeDiff} KB</td>
                        </tr>
                        <tr>
                            <td colspan="3" style="text-align: center;"><strong>Time Difference:</strong> ${timeDiff.toFixed(1)} days</td>
                        </tr>
                    </table>
                    <div style="margin-top: 20px;">
                        <h4>Categories Comparison:</h4>
                        ${categoriesComparison}
                    </div>
                </div>
            `;
        }

        function downloadBackup(id) {
            const backups = JSON.parse(localStorage.getItem(BACKUPS_KEY) || '[]');
            const backup = backups.find(b => b.id === id);
            
            if (!backup) {
                alert('‚ùå Backup not found');
                return;
            }

            if (!backup.data) {
                alert('‚ö†Ô∏è Backup data not available. This might be an old backup format.');
                return;
            }

            const dataStr = JSON.stringify(backup.data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `${backup.name.replace(/[^a-z0-9]/gi, '-')}-${backup.id}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
