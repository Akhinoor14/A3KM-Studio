<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- Universal Mobile Optimization System -->
    <link rel="stylesheet" href="../../../Optimization/mobile-universal.css">
    <script src="../../../Optimization/mobile-universal.js" defer></script>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="../../../images/favicon.svg">
    
    <title>Media Library - A3KM Studio</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Mobile Optimization Styles -->
    <link rel="stylesheet" href="../../mobile/only-boss-global-mobile.css">
    <link rel="stylesheet" href="../../mobile/manager-mobile.css">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1600px; margin: 0 auto; }
        .header { background: white; border-radius: 20px; padding: 30px; margin-bottom: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); }
        .header h1 { color: #333; font-size: 32px; display: flex; align-items: center; gap: 15px; margin-bottom: 5px; }
        .header p { color: #666; }
        .controls { background: white; border-radius: 15px; padding: 25px; margin-bottom: 30px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); display: flex; gap: 15px; flex-wrap: wrap; align-items: center; }
        .search-box { flex: 1; min-width: 250px; position: relative; }
        .search-box input { width: 100%; padding: 12px 15px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 14px; }
        .search-box input:focus { outline: none; border-color: #667eea; }
        .btn { padding: 12px 24px; border: none; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 8px; }
        .btn-primary { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4); }
        .btn-secondary { background: white; color: #667eea; border: 2px solid #667eea; }
        .btn-secondary:hover { background: #667eea; color: white; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .stat-card { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 15px; text-align: center; }
        .stat-card h3 { font-size: 28px; margin-bottom: 5px; }
        .stat-card p { opacity: 0.9; font-size: 12px; }
        .media-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; }
        .media-card { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 5px 20px rgba(0,0,0,0.1); transition: all 0.3s; }
        .media-card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .media-preview { width: 100%; height: 150px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; font-size: 40px; overflow: hidden; }
        .media-preview img { width: 100%; height: 100%; object-fit: cover; }
        .media-info { padding: 15px; }
        .media-name { font-weight: 600; color: #333; font-size: 13px; margin-bottom: 8px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .media-meta { display: flex; justify-content: space-between; font-size: 11px; color: #999; margin-bottom: 10px; }
        .media-actions { display: flex; gap: 8px; }
        .media-btn { flex: 1; padding: 6px; border: none; border-radius: 6px; font-size: 11px; cursor: pointer; transition: all 0.2s; }
        .media-btn-copy { background: #e3f2fd; color: #1976d2; }
        .media-btn-copy:hover { background: #1976d2; color: white; }
        .media-btn-delete { background: #ffebee; color: #d32f2f; }
        .media-btn-delete:hover { background: #d32f2f; color: white; }
        .empty-state { text-align: center; padding: 60px 20px; background: white; border-radius: 15px; }
        .empty-state i { font-size: 80px; color: #ccc; margin-bottom: 20px; }
        .empty-state p { color: #999; font-size: 16px; margin-bottom: 20px; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center; }
        .modal.show { display: flex; }
        .modal-content { background: white; border-radius: 20px; padding: 40px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto; }
        .modal-header { font-size: 24px; font-weight: 600; margin-bottom: 20px; color: #333; display: flex; align-items: center; gap: 10px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; color: #333; font-weight: 600; margin-bottom: 8px; font-size: 14px; }
        .form-group input, .form-group textarea, .form-group select { width: 100%; padding: 10px 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; }
        .form-group input:focus, .form-group textarea:focus { outline: none; border-color: #667eea; }
        .alert { padding: 15px 20px; border-radius: 10px; margin-bottom: 20px; display: none; }
        .alert.show { display: block; animation: slideDown 0.3s; }
        .alert-success { background: #d4edda; color: #155724; border-left: 4px solid #28a745; }
        .alert-error { background: #f8d7da; color: #721c24; border-left: 4px solid #dc3545; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .filter-tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .filter-btn { padding: 8px 16px; background: white; border: 2px solid #e0e0e0; border-radius: 20px; cursor: pointer; font-size: 13px; transition: all 0.3s; }
        .filter-btn.active { background: #667eea; color: white; border-color: #667eea; }
        
        /* Drag-Drop Zone Styles */
        .drag-drop-zone { border: 3px dashed #667eea; border-radius: 15px; padding: 60px 20px; text-align: center; background: rgba(102, 126, 234, 0.05); margin-bottom: 30px; transition: all 0.3s; cursor: pointer; }
        .drag-drop-zone:hover { background: rgba(102, 126, 234, 0.1); border-color: #764ba2; }
        .drag-drop-zone.drag-over { background: rgba(102, 126, 234, 0.2); border-color: #28a745; transform: scale(1.02); }
        .drag-drop-zone i { font-size: 60px; color: #667eea; margin-bottom: 20px; }
        .drag-drop-zone h3 { color: #333; font-size: 22px; margin-bottom: 10px; }
        .drag-drop-zone p { color: #666; font-size: 14px; }
        .drag-drop-zone input[type="file"] { display: none; }
        .file-preview-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 15px; margin-top: 20px; }
        .file-preview-item { background: white; border-radius: 10px; padding: 15px; text-align: center; position: relative; }
        .file-preview-item img { width: 100%; height: 80px; object-fit: cover; border-radius: 8px; margin-bottom: 10px; }
        .file-preview-item .file-name { font-size: 11px; color: #666; word-break: break-word; }
        .file-preview-item .remove-btn { position: absolute; top: 5px; right: 5px; background: #dc3545; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; font-size: 12px; }
        .upload-progress { margin-top: 20px; display: none; }
        .upload-progress.active { display: block; }
        .progress-bar-container { width: 100%; height: 10px; background: #e0e0e0; border-radius: 5px; overflow: hidden; margin-top: 10px; }
        .progress-bar-fill { height: 100%; background: linear-gradient(90deg, #667eea, #764ba2); transition: width 0.3s; }
        
        /* Bulk Selection Styles */
        .bulk-actions-bar { background: #fff3cd; border: 2px solid #ffc107; border-radius: 10px; padding: 15px 20px; margin-bottom: 20px; display: none; align-items: center; gap: 15px; }
        .bulk-actions-bar.active { display: flex; }
        .bulk-actions-bar span { color: #856404; font-weight: 600; }
        .media-checkbox { position: absolute; top: 10px; left: 10px; width: 20px; height: 20px; cursor: pointer; z-index: 10; }
        .media-card { position: relative; }
        .media-card.selected { border: 3px solid #667eea; }
        .media-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(102, 126, 234, 0.9); display: none; align-items: center; justify-content: center; gap: 10px; z-index: 5; }
        .media-card:hover .media-overlay { display: flex; }
        .overlay-btn { background: white; color: #667eea; border: none; border-radius: 50%; width: 45px; height: 45px; cursor: pointer; font-size: 18px; transition: all 0.3s; }
        .overlay-btn:hover { background: #667eea; color: white; transform: scale(1.1); }
        
        /* Image Editor Modal */
        .editor-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; }
        .editor-modal.show { display: flex; align-items: center; justify-content: center; }
        .editor-content { background: white; border-radius: 20px; padding: 30px; max-width: 900px; width: 95%; max-height: 90vh; overflow-y: auto; }
        .editor-canvas-container { text-align: center; margin: 20px 0; background: #f0f0f0; padding: 20px; border-radius: 10px; }
        #editorCanvas { max-width: 100%; height: auto; border: 2px solid #e0e0e0; }
        .editor-controls { display: flex; gap: 10px; flex-wrap: wrap; margin: 20px 0; }
        .editor-btn { padding: 10px 20px; border: none; border-radius: 8px; background: #667eea; color: white; cursor: pointer; font-size: 13px; transition: all 0.3s; }
        .editor-btn:hover { background: #764ba2; }
        .editor-slider-group { margin: 15px 0; }
        .editor-slider-group label { display: block; margin-bottom: 8px; color: #333; font-weight: 600; }
        .editor-slider { width: 100%; }
        
        /* Preview Modal */
        .preview-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 1500; align-items: center; justify-content: center; }
        .preview-modal.show { display: flex; }
        .preview-modal img { max-width: 90%; max-height: 90vh; border-radius: 10px; }
        .preview-close { position: absolute; top: 30px; right: 30px; background: white; color: #333; border: none; border-radius: 50%; width: 50px; height: 50px; font-size: 24px; cursor: pointer; }
        
        /* Sort & Filter Controls */
        .sort-control { display: flex; align-items: center; gap: 10px; }
        .sort-control label { color: #333; font-weight: 600; font-size: 14px; }
        
        /* Help System Styles */
        .help-toggle { position: fixed; top: 20px; right: 20px; background: linear-gradient(135deg, #dc3545, #c82333); color: white; border: none; border-radius: 50px; padding: 12px 24px; font-size: 14px; font-weight: 600; cursor: pointer; z-index: 1001; box-shadow: 0 5px 20px rgba(220, 53, 69, 0.3); transition: all 0.3s; display: flex; align-items: center; gap: 8px; }
        .help-toggle:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(220, 53, 69, 0.4); }
        .help-section { display: none; position: fixed; top: 0; right: 0; width: 450px; max-width: 90vw; height: 100vh; background: white; box-shadow: -5px 0 30px rgba(0,0,0,0.3); z-index: 1000; overflow-y: auto; padding: 30px; animation: slideInRight 0.3s; }
        .help-section.active { display: block; }
        .help-section h2 { color: #333; font-size: 24px; margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }
        .help-section .subtitle { color: #666; font-size: 14px; margin-bottom: 25px; }
        .purpose-box { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 15px; margin-bottom: 25px; }
        .purpose-box h3 { font-size: 18px; margin-bottom: 10px; }
        .purpose-box p { font-size: 14px; line-height: 1.6; opacity: 0.95; }
        .help-card { background: #f8f9fa; border-left: 4px solid #667eea; border-radius: 10px; padding: 20px; margin-bottom: 20px; }
        .help-card h3 { color: #333; font-size: 16px; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
        .help-card p { color: #666; font-size: 14px; line-height: 1.6; margin-bottom: 10px; }
        .help-card ul { color: #666; font-size: 14px; line-height: 1.8; padding-left: 20px; }
        .help-card ul li { margin-bottom: 8px; }
        .help-close { position: absolute; top: 30px; right: 30px; background: none; border: none; font-size: 28px; cursor: pointer; color: #999; transition: color 0.3s; }
        .help-close:hover { color: #dc3545; }
        @keyframes slideInRight { from { transform: translateX(100%); } to { transform: translateX(0); } }
        @media (max-width: 768px) { .help-section { width: 100%; } }
    </style>
</head>
<body>
    <div class="container">
        <!-- Help Toggle Button -->
        <button class="help-toggle" onclick="toggleHelp()">
            <i class="fas fa-question-circle"></i> ‡¶∏‡¶æ‡¶π‡¶æ‡¶Ø‡ßç‡¶Ø / Help
        </button>

        <!-- Help Section -->
        <div class="help-section" id="helpSection">
            <button class="help-close" onclick="toggleHelp()">√ó</button>
            
            <h2><i class="fas fa-book"></i> ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ó‡¶æ‡¶á‡¶° / Usage Guide</h2>
            <p class="subtitle">Media Library Manager ‡¶è‡¶∞ ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡ßá‡¶∂‡¶ø‡¶ï‡¶æ</p>

            <!-- Purpose Box -->
            <div class="purpose-box">
                <h3>üéØ ‡¶Æ‡ßÇ‡¶≤ ‡¶â‡¶¶‡ßç‡¶¶‡ßá‡¶∂‡ßç‡¶Ø / Original Purpose</h3>
                <p><strong>Bangla:</strong> ‡¶è‡¶ü‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ website ‡¶è‡¶∞ ‡¶∏‡¶¨ images, PDFs ‡¶è‡¶¨‡¶Ç documents ‡¶è‡¶ï‡¶∏‡¶æ‡¶•‡ßá upload, organize ‡¶è‡¶¨‡¶Ç manage ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶è‡¶ï‡¶ü‡¶ø centralized library‡•§</p>
                <p><strong>English:</strong> A centralized library to upload, organize, and manage all your website images, PDFs, and documents in one place.</p>
            </div>

            <!-- Help Cards -->
            <div class="help-card">
                <h3><i class="fas fa-rocket"></i> ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶∂‡ßÅ‡¶∞‡ßÅ / Quick Start</h3>
                <p><strong>Bangla:</strong></p>
                <ul>
                    <li>Drag-drop zone ‡¶è file drag ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶Ö‡¶•‡¶¨‡¶æ click ‡¶ï‡¶∞‡ßá select ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li>Multiple files ‡¶è‡¶ï‡¶∏‡¶æ‡¶•‡ßá select ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®</li>
                    <li>"Upload" button ‡¶è click ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li>Files automatically organize ‡¶π‡¶Ø‡¶º‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá</li>
                </ul>
                <p><strong>English:</strong> Drag files to upload zone OR click to browse ‚Üí Select files ‚Üí Upload ‚Üí Done!</p>
            </div>

            <div class="help-card">
                <h3><i class="fas fa-cloud-upload-alt"></i> Drag-Drop Upload</h3>
                <p><strong>Bangla:</strong></p>
                <ul>
                    <li><strong>‡¶è‡¶ï‡¶ü‡¶ø file:</strong> File ‡¶ü‡¶ø drag ‡¶ï‡¶∞‡ßá ‡¶®‡ßÄ‡¶≤ box ‡¶è drop ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li><strong>‡¶è‡¶ï‡¶æ‡¶ß‡¶ø‡¶ï files:</strong> ‡¶∏‡¶¨ files select ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶∏‡¶æ‡¶•‡ßá drag-drop ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li><strong>Supported formats:</strong> JPG, PNG, GIF, PDF, DOC, DOCX, TXT</li>
                    <li><strong>Max size:</strong> ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø file 10MB ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§</li>
                </ul>
                <p><strong>English:</strong> Supports images (JPG, PNG, GIF), PDFs, and documents. Max 10MB per file.</p>
            </div>

            <div class="help-card">
                <h3><i class="fas fa-search"></i> Search & Filter</h3>
                <p><strong>Bangla:</strong></p>
                <ul>
                    <li><strong>Search box:</strong> File name ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá search ‡¶ï‡¶∞‡ßÅ‡¶® (real-time)</li>
                    <li><strong>Type filter:</strong> "All Types" dropdown ‡¶•‡ßá‡¶ï‡ßá Images/PDFs/Documents select ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li><strong>Quick filters:</strong> Tab ‡¶ó‡ßÅ‡¶≤‡ßã click ‡¶ï‡¶∞‡ßá category ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ filter ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                </ul>
                <p><strong>English:</strong> Use search box for file names, dropdown for type filtering.</p>
            </div>

            <div class="help-card">
                <h3><i class="fas fa-tasks"></i> Bulk Operations</h3>
                <p><strong>Bangla:</strong></p>
                <ul>
                    <li>Multiple files select ‡¶ï‡¶∞‡¶§‡ßá checkbox ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li>"Bulk Delete" button ‡¶è click ‡¶ï‡¶∞‡ßá ‡¶∏‡¶¨ selected files delete ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li>Ctrl/Cmd key hold ‡¶ï‡¶∞‡ßá multiple select ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®</li>
                </ul>
                <p><strong>English:</strong> Select multiple files using checkboxes ‚Üí Bulk Delete button ‚Üí Confirm.</p>
            </div>

            <div class="help-card">
                <h3><i class="fas fa-copy"></i> URL Copy & Usage</h3>
                <p><strong>Bangla:</strong></p>
                <ul>
                    <li>‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã file ‡¶è‡¶∞ "Copy" button ‡¶è click ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li>File URL clipboard ‡¶è copy ‡¶π‡¶Ø‡¶º‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá</li>
                    <li>‡¶è‡¶á URL ‡¶Ö‡¶®‡ßç‡¶Ø page ‡¶è image/link ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá use ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®</li>
                </ul>
                <p><strong>English:</strong> Click "Copy" button ‚Üí URL copied to clipboard ‚Üí Use in your pages.</p>
            </div>

            <div class="help-card">
                <h3><i class="fas fa-lightbulb"></i> ‡¶™‡ßç‡¶∞‡ßã ‡¶ü‡¶ø‡¶™‡¶∏ / Pro Tips</h3>
                <ul>
                    <li>üìÅ Files ‡¶è‡¶∞ meaningful names ‡¶¶‡¶ø‡¶® (e.g., "project-thumbnail.jpg")</li>
                    <li>üñºÔ∏è Images upload ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá optimize ‡¶ï‡¶∞‡ßÅ‡¶® (TinyPNG.com)</li>
                    <li>üé® Consistent naming convention follow ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li>üìä Regularly unused files delete ‡¶ï‡¶∞‡ßÅ‡¶® storage save ‡¶ï‡¶∞‡¶§‡ßá</li>
                    <li>üíæ Important files ‡¶è‡¶∞ backup ‡¶∞‡¶æ‡¶ñ‡ßÅ‡¶®</li>
                </ul>
            </div>

            <div class="help-card">
                <h3><i class="fas fa-exclamation-triangle"></i> ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶® / Troubleshooting</h3>
                <p><strong>File upload ‡¶π‡¶ö‡ßç‡¶õ‡ßá ‡¶®‡¶æ?</strong></p>
                <ul>
                    <li>File size 10MB ‡¶è‡¶∞ ‡¶®‡¶ø‡¶ö‡ßá ‡¶ï‡¶ø‡¶®‡¶æ check ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li>Supported format ‡¶ï‡¶ø‡¶®‡¶æ verify ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li>Browser console (F12) ‡¶è error check ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                </ul>
                <p><strong>Preview ‡¶¶‡ßá‡¶ñ‡¶æ‡¶ö‡ßç‡¶õ‡ßá ‡¶®‡¶æ?</strong></p>
                <ul>
                    <li>Image file corrupt ‡¶®‡ßá‡¶á ‡¶ï‡¶ø‡¶®‡¶æ check ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li>Browser cache clear ‡¶ï‡¶∞‡ßá try ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                    <li>Page refresh ‡¶ï‡¶∞‡ßÅ‡¶®</li>
                </ul>
            </div>
        </div>

        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-image"></i> Media Library Manager</h1>
            <p>Upload, organize and manage all website images and documents</p>
        </div>

        <!-- Alert -->
        <div id="alert" class="alert"></div>

        <!-- Drag-Drop Upload Zone -->
        <div class="drag-drop-zone" id="dropZone" onclick="document.getElementById('bulkFileInput').click()">
            <i class="fas fa-cloud-upload-alt"></i>
            <h3>Drag & Drop Files Here</h3>
            <p>or click to browse ‚Ä¢ Supports JPG, PNG, GIF, PDF, DOC (Max 10MB each)</p>
            <input type="file" id="bulkFileInput" multiple accept="image/*,.pdf,.doc,.docx,.txt">
        </div>

        <!-- File Preview Grid (before upload) -->
        <div id="filePreviewContainer" style="display: none;">
            <h3 style="color: white; margin-bottom: 15px;">Selected Files:</h3>
            <div class="file-preview-grid" id="filePreviewGrid"></div>
            <div style="margin-top: 20px; display: flex; gap: 15px;">
                <button class="btn btn-primary" onclick="uploadAllFiles()">
                    <i class="fas fa-upload"></i> Upload All Files
                </button>
                <button class="btn btn-secondary" onclick="clearFileSelection()">
                    <i class="fas fa-times"></i> Clear Selection
                </button>
            </div>
            <div class="upload-progress" id="uploadProgress">
                <p style="color: white; margin-bottom: 10px;">Uploading... <span id="progressText">0%</span></p>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="progressBarFill" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Bulk Actions Bar -->
        <div class="bulk-actions-bar" id="bulkActionsBar">
            <span><i class="fas fa-check-square"></i> <span id="selectedCount">0</span> files selected</span>
            <button class="btn btn-secondary" onclick="selectAllMedia()" style="padding: 8px 16px; font-size: 13px;">
                <i class="fas fa-check-double"></i> Select All
            </button>
            <button class="btn btn-secondary" onclick="deselectAllMedia()" style="padding: 8px 16px; font-size: 13px;">
                <i class="fas fa-times"></i> Deselect All
            </button>
            <button class="btn btn-primary" onclick="bulkDeleteSelected()" style="padding: 8px 16px; font-size: 13px; background: #dc3545;">
                <i class="fas fa-trash-alt"></i> Delete Selected
            </button>
        </div>

        <!-- Controls -->
        <div class="controls">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="üîç Search media...">
            </div>
            <button class="btn btn-primary" onclick="openUploadModal()">
                <i class="fas fa-cloud-upload-alt"></i> Upload Media
            </button>
            <select id="filterType" class="btn-secondary" onchange="filterMedia()" style="padding: 12px 15px; border: 2px solid #667eea; background: white; color: #667eea;">
                <option value="">All Types</option>
                <option value="image">Images</option>
                <option value="pdf">PDFs</option>
                <option value="document">Documents</option>
            </select>
            <div class="sort-control">
                <label>Sort:</label>
                <select id="sortBy" onchange="renderMedia()" style="padding: 8px 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 13px;">
                    <option value="newest">Newest First</option>
                    <option value="oldest">Oldest First</option>
                    <option value="name">Name (A-Z)</option>
                    <option value="size">Size (Largest)</option>
                </select>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3 id="totalCount">0</h3>
                <p>Total Files</p>
            </div>
            <div class="stat-card">
                <h3 id="imageCount">0</h3>
                <p>Images</p>
            </div>
            <div class="stat-card">
                <h3 id="pdfCount">0</h3>
                <p>PDFs</p>
            </div>
            <div class="stat-card">
                <h3 id="totalSize">0MB</h3>
                <p>Total Size</p>
            </div>
        </div>

        <!-- Media Grid -->
        <div id="mediaContainer" class="media-grid">
            <div class="empty-state">
                <i class="fas fa-inbox"></i>
                <p>No media files yet. Upload your first file!</p>
            </div>
        </div>
    </div>

    <!-- Upload Modal -->
    <div id="uploadModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <i class="fas fa-upload"></i> Upload Media
            </div>
            
            <div class="form-group">
                <label>Select File</label>
                <input type="file" id="fileInput" accept="image/*,.pdf">
                <small style="color: #999; margin-top: 5px; display: block;">JPG, PNG, PDF (Max 10MB)</small>
            </div>

            <div class="form-group">
                <label>File Name</label>
                <input type="text" id="fileName" placeholder="e.g., solidworks-assembly">
            </div>

            <div class="form-group">
                <label>Category</label>
                <select id="category">
                    <option value="general">General</option>
                    <option value="projects">Projects</option>
                    <option value="certificates">Certificates</option>
                    <option value="portfolio">Portfolio</option>
                    <option value="tutorials">Tutorials</option>
                </select>
            </div>

            <div class="form-group">
                <label>Description</label>
                <textarea id="fileDescription" placeholder="Brief description..."></textarea>
            </div>

            <div style="display: flex; gap: 10px;">
                <button class="btn btn-primary" onclick="uploadFile()" style="flex: 1;">
                    <i class="fas fa-check"></i> Upload
                </button>
                <button class="btn btn-secondary" onclick="closeUploadModal()" style="flex: 1;">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
        </div>
    </div>

    <script src="../shared/github-token-manager.js"></script>
    <script src="../Content-studio/github-content-uploader.js"></script>
    <script src="../../shared/github-token-manager.js"></script>
    <script>
        const MEDIA_KEY = 'a3km_media_library';
        let mediaLibrary = [];
        let tokenManager = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            tokenManager = typeof GitHubTokenManager !== 'undefined' ? new GitHubTokenManager() : null;
            loadMediaLibrary();
            renderMedia();
            updateStats();
            
            // Live update every 3 seconds
            setInterval(() => {
                if (localStorage.getItem(MEDIA_KEY)) {
                    loadMediaLibrary();
                    renderMedia();
                    updateStats();
                }
            }, 3000);
        });

        // Load media from localStorage
        function loadMediaLibrary() {
            const saved = localStorage.getItem(MEDIA_KEY);
            mediaLibrary = saved ? JSON.parse(saved) : [];
            updateStats();
        }

        // Save media to localStorage
        function saveMediaLibrary() {
            localStorage.setItem(MEDIA_KEY, JSON.stringify(mediaLibrary));
        }

        // Render media grid
        function renderMedia() {
            const container = document.getElementById('mediaContainer');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filterType = document.getElementById('filterType').value;
            const sortBy = document.getElementById('sortBy').value;

            let filtered = mediaLibrary.filter(m => {
                const matchSearch = m.name.toLowerCase().includes(searchTerm);
                const matchFilter = !filterType || m.type === filterType;
                return matchSearch && matchFilter;
            });

            // Sort
            switch(sortBy) {
                case 'newest':
                    filtered.sort((a, b) => new Date(b.uploaded) - new Date(a.uploaded));
                    break;
                case 'oldest':
                    filtered.sort((a, b) => new Date(a.uploaded) - new Date(b.uploaded));
                    break;
                case 'name':
                    filtered.sort((a, b) => a.name.localeCompare(b.name));
                    break;
                case 'size':
                    filtered.sort((a, b) => parseFloat(b.size) - parseFloat(a.size));
                    break;
            }

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="grid-column: 1/-1;">
                        <i class="fas fa-search"></i>
                        <p>No media files found</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filtered.map(media => `
                <div class="media-card" data-id="${media.id}">
                    <input type="checkbox" class="media-checkbox" onchange="toggleMediaSelection('${media.id}')">
                    <div class="media-preview">
                        ${media.type === 'image' ? `<img src="${media.url}" alt="${media.name}" onclick="previewImage('${media.url}', '${media.name}')">` : 
                          media.type === 'pdf' ? '<i class="fas fa-file-pdf" style="color: #d32f2f;"></i>' :
                          '<i class="fas fa-file" style="color: #999;"></i>'}
                    </div>
                    <div class="media-overlay">
                        ${media.type === 'image' ? `<button class="overlay-btn" onclick="openImageEditor('${media.id}', '${media.url}')" title="Edit"><i class="fas fa-edit"></i></button>` : ''}
                        <button class="overlay-btn" onclick="previewImage('${media.url}', '${media.name}')" title="View"><i class="fas fa-eye"></i></button>
                        <button class="overlay-btn" onclick="downloadMedia('${media.url}', '${media.name}')" title="Download"><i class="fas fa-download"></i></button>
                    </div>
                    <div class="media-info">
                        <div class="media-name" title="${media.name}">${media.name}</div>
                        <div class="media-meta">
                            <span>${media.size}MB</span>
                            <span>${new Date(media.uploaded).toLocaleDateString()}</span>
                        </div>
                        <div class="media-actions">
                            <button class="media-btn media-btn-copy" onclick="copyUrl('${media.url}')">
                                <i class="fas fa-copy"></i> Copy
                            </button>
                            <button class="media-btn media-btn-delete" onclick="deleteMedia('${media.id}')">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Open upload modal
        function openUploadModal() {
            document.getElementById('uploadModal').classList.add('show');
        }

        // Close upload modal
        function closeUploadModal() {
            document.getElementById('uploadModal').classList.remove('show');
            document.getElementById('fileInput').value = '';
            document.getElementById('fileName').value = '';
            document.getElementById('fileDescription').value = '';
        }

        // Upload file
        function uploadFile() {
            const fileInput = document.getElementById('fileInput');
            const fileName = document.getElementById('fileName').value;
            const category = document.getElementById('category').value;
            const description = document.getElementById('fileDescription').value;

            if (!fileInput.files[0]) {
                showAlert('‚ö†Ô∏è Please select a file', 'error');
                return;
            }

            if (!fileName) {
                showAlert('‚ö†Ô∏è Please enter a file name', 'error');
                return;
            }

            const file = fileInput.files[0];
            
            // Validate file size (10MB max)
            if (file.size > 10 * 1024 * 1024) {
                showAlert('‚ùå File too large! Maximum size is 10MB', 'error');
                return;
            }
            
            // Validate file type
            const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 'text/plain'];
            if (!allowedTypes.includes(file.type)) {
                showAlert('‚ùå Unsupported file type! Allowed: JPG, PNG, GIF, PDF, DOC, DOCX, TXT', 'error');
                return;
            }

            const reader = new FileReader();

            reader.onload = (e) => {
                const mediaItem = {
                    id: Date.now() + Math.random(),
                    name: fileName,
                    category: category,
                    description: description,
                    type: file.type.includes('image') ? 'image' : file.type.includes('pdf') ? 'pdf' : 'document',
                    size: (file.size / 1024 / 1024).toFixed(2),
                    url: e.target.result,
                    uploaded: new Date().toISOString()
                };

                mediaLibrary.push(mediaItem);
                saveMediaLibrary();
                renderMedia();
                updateStats();
                showAlert('‚úÖ Media uploaded successfully!', 'success');
                closeUploadModal();
            };

            reader.onerror = () => {
                showAlert('‚ùå Error reading file. Please try again.', 'error');
            };

            reader.readAsDataURL(file);
        }.then(() => {
                showAlert('‚úÖ URL copied to clipboard!', 'success');
            }).catch(() => {
                showAlert('‚ùå Failed to copy URL', 'error');
            }
        // Copy URL
        funcconst media = mediaLibrary.find(m => m.id.toString() === id.toString());
            const fileName = media ? media.name : 'this file';
            
            if (confirm(`Delete "${fileName}"?\n\nThis action cannot be undone.`)) {
                mediaLibrary = mediaLibrary.filter(m => m.id.toString() !== id.toString());
                saveMediaLibrary();
                renderMedia();
                updateStats();
                showAlert('‚úÖ Media deleted successfully
        function deleteMedia(id) {
            if (confirm('Are you sure you want to delete this media?')) {
                mediaLibrary = mediaLibrary.filter(m => m.id !== id);
                saveMediaLibrary();
                renderMedia();
                updateStats();
                showAlert('Media deleted!', 'success');
            }
        }

        // Filter media
        function filterMedia() {
            renderMedia();
        }

        // Update stats
        function updateStats() {
            const total = mediaLibrary.length;
            const images = mediaLibrary.filter(m => m.type === 'image').length;
            const pdfs = mediaLibrary.filter(m => m.type === 'pdf').length;
            const totalSize = (mediaLibrary.reduce((sum, m) => sum + parseFloat(m.size), 0)).toFixed(2);

            document.getElementById('totalCount').textContent = total;
            document.getElementById('imageCount').textContent = images;
            document.getElementById('pdfCount').textContent = pdfs;
            document.getElementById('totalSize').textContent = totalSize + 'MB';
        }

        // Search
        document.getElementById('searchInput').addEventListener('keyup', renderMedia);

        // Show alert
        function showAlert(message, type) {
            const alert = document.getElementById('alert');
            alert.textContent = message;
            alert.className = `alert show alert-${type}`;
            setTimeout(() => alert.classList.remove('show'), 3000);
        }

        // ===== NEW: Drag-Drop Upload Functionality =====
        
        let selectedFiles = [];

        // Toggle help section
        function toggleHelp() {
            const helpSection = document.getElementById('helpSection');
            helpSection.classList.toggle('active');
        }

        // Setup drag-drop zone
        const dropZone = document.getElementById('dropZone');
        const bulkFileInput = document.getElementById('bulkFileInput');

        // Prevent default drag behaviors
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, preventDefaults, false);
            document.body.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        // Highlight drop zone when dragging over
        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, () => {
                dropZone.classList.add('drag-over');
            }, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, () => {
                dropZone.classList.remove('drag-over');
            }, false);
        });

        // Handle dropped files
        dropZone.addEventListener('drop', (e) => {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles(files);
        });

        // Handle file input change
        bulkFileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        // Handle selected files
        function handleFiles(files) {
            selectedFiles = [...files];
            
            if (selectedFiles.length === 0) return;

            // Show preview container
            document.getElementById('filePreviewContainer').style.display = 'block';
            
            // Render preview
            const previewGrid = document.getElementById('filePreviewGrid');
            previewGrid.innerHTML = '';

            selectedFiles.forEach((file, index) => {
                const previewItem = document.createElement('div');
                previewItem.className = 'file-preview-item';

                if (file.type.startsWith('image/')) {
                    const img = document.createElement('img');
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        img.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                    previewItem.appendChild(img);
                } else {
                    const icon = document.createElement('i');
                    icon.className = file.type.includes('pdf') ? 'fas fa-file-pdf' : 'fas fa-file';
                    icon.style.fontSize = '40px';
                    icon.style.color = file.type.includes('pdf') ? '#d32f2f' : '#999';
                    previewItem.appendChild(icon);
                }

                const fileName = document.createElement('div');
                fileName.className = 'file-name';
                fileName.textContent = file.name;
                previewItem.appendChild(fileName);

                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove-btn';
                removeBtn.innerHTML = '√ó';
                removeBtn.onclick = () => removeFileFromSelection(index);
                previewItem.appendChild(removeBtn);

                previewGrid.appendChild(previewItem);
            });
        }

        // Remove file from selection
        function removeFileFromSelection(index) {
            selectedFiles.splice(index, 1);
            if (selectedFiles.length === 0) {
                clearFileSelection();
            } else {
                handleFiles(selectedFiles);
            }
        }

        // Clear file selection
        function clearFileSelection() {
            selectedFiles = [];
            bulkFileInput.value = '';
            document.getElementById('filePreviewContainer').style.display = 'none';
            document.getEle‚ö†Ô∏è No files selected', 'error');
                return;
            }
            
            // Validate all files before uploading
            const invalidFiles = [];
            selectedFiles.forEach(file => {
                if (file.size > 10 * 1024 * 1024) {
                    invalidFiles.push(`${file.name} (too large: ${(file.size / 1024 / 1024).toFixed(2)}MB)`);
                }
            });
            
            if (invalidFiles.length > 0) {
                showAlert(`‚ùå Cannot upload:\n${invalidFiles.join('\n')}\n\nMax file size: 10MB`ogress').classList.remove('active');
        }

        // Upload all selected files
        function uploadAllFiles() {
            if (selectedFiles.length === 0) {
                showAlert('No files selected', 'error');
                return;
            }

            const uploadProgress = document.getElementById('uploadProgress');
            const progressBarFill = document.getElementById('progressBarFill');
            const progressText = document.getElementById('progressText');

            uploadProgress.classList.add('active');

            let uploadedCount = 0;
            const totalFiles = selectedFiles.length;

            selectedFiles.forEach((file, index) => {
                const reader = new FileReader();

                reader.onload = (e) => {
                    const mediaItem = {
                        id: Date.now() + Math.random() + index,
                        name: file.name,
                        category: '‚úÖ ${totalFiles} file(s) uploaded successfully!`, 'success');
                        
                        setTimeout(() => {
                            clearFileSelection();
                        }, 1500);
                    }
                };
                
                reader.onerror = () => {
                    showAlert(`‚ùå Error uploading ${file.name}`, 'error');   uploaded: new Date().toISOString()
                    };

                    mediaLibrary.push(mediaItem);
                    uploadedCount++;

                    const progress = Math.round((uploadedCount / totalFiles) * 100);
                    progressBarFill.style.width = progress + '%';
                    progressText.textContent = progress + '%';

                    if (uploadedCount === totalFiles) {
                        saveMediaLibrary();
                        renderMedia();
                        updateStats();
                        showAlert(`${totalFiles} file(s) uploaded successfully!`, 'success');
                        
                        setTimeout(() => {
                            clearFileSelection();
                        }, 1500);
                    }
                };

                reader.readAsDataURL(file);
            });
        }
        
        // ===== Bulk Selection & Operations =====
        
        let selectedMediaIds = new Set();
        
        function toggleMediaSelection(id) {
            const checkbox = event.target;
            const card = document.querySelector(`[data-id="${id}"]`);
            
            if (checkbox.checked) {
                selectedMediaIds.add(id);
                card.classList.add('selected');
            } else {
                selectedMediaIds.delete(id);
                card.classList.remove('selected');
            }
            
            updateBulkActionsBar();
        }
        
        function updateBulkActionsBar() {
            const bar = document.getElementById('bulkActionsBar');
            const count = document.getElementById('selectedCount');
            
            count.textContent = selectedMediaIds.size;
            
            if (selectedMediaIds.size > 0) {
                bar.classList.add('active');
            } else {
                bar.classList.remove('active');
            }
        }
        
        function selectAllMedia() {
            document.querySelectorAll('.media-checkbox').forEach(checkbox => {
                checkbox.checked = true;
                const card = checkbox.closest('.media-card');
                const id = card.getAttribute('data-id');
                selectedMediaIds.add(id);
                card.classList.add('selected');
            });
            updateBulkActionsBar();
        }
        
        function deselectAllMedia() {
            document.querySelectorAll('.media-checkbox').forEach(checkbox => {
                checkbox.checked = false;
                const card = checkbox.closest('.media-card');
                card.classList.remove('selected');
            });
            selectedMediaIds.clear();
            updateBulkActionsBar();
        }
        
        function bulkDeleteSelected() {
            if (selectedMediaIds.size === 0) return;
            
            if (confirm(`Delete ${selectedMediaIds.size} selected file(s)? This cannot be undone.`)) {
                mediaLibrary = mediaLibrary.filter(m => !selectedMediaIds.has(m.id.toString()));
                saveMediaLibrary();
                renderMedia();
                updateStats();
                selectedMediaIds.clear();
                updateBulkActionsBar();
                showAlert(`${selectedMediaIds.size} file(s) deleted!`, 'success');
            }
        }
        
        // ===== Image Preview Modal =====
        
        function previewImage(url, name) {
            const modal = document.createElement('div');
            modal.className = 'preview-modal show';
            modal.innerHTML = `
                <button class="preview-close" onclick="this.parentElement.remove()">√ó</button>
                <img src="${url}" alt="${name}">
            `;
            document.body.appendChild(modal);
            
            // Close on background click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }
        
        // ===== Download Media =====
        
        function downloadMedia(url, name) {
            const a = document.createElement('a');
            a.href = url;
            a.download = name;
            a.click();
            showAlert('Download started!', 'success');
        }
        
        // ===== Image Editor =====
        
        let currentEditorImageId = null;
        let editorCanvas = null;
        let editorCtx = null;
        let originalImageData = null;
        
        function openImageEditor(id, url) {
            currentEditorImageId = id;
            
            // Create editor modal
            const editorModal = document.createElement('div');
            editorModal.className = 'editor-modal show';
            editorModal.id = 'imageEditorModal';
            editorModal.innerHTML = `
                <div class="editor-content">
                    <div class="modal-header">
                        <i class="fas fa-magic"></i> Image Editor
                        <button onclick="closeImageEditor()" style="position: absolute; right: 20px; top: 20px; background: none; border: none; font-size: 28px; cursor: pointer; color: #999;">&times;</button>
                    </div>
                    
                    <div class="editor-canvas-container">
                        <canvas id="editorCanvas"></canvas>
                    </div>
                    
                    <div class="editor-controls">
                        <button class="editor-btn" onclick="applyFilter('grayscale')"><i class="fas fa-adjust"></i> Grayscale</button>
                        <button class="editor-btn" onclick="applyFilter('sepia')"><i class="fas fa-sun"></i> Sepia</button>
                        <button class="editor-btn" onclick="applyFilter('invert')"><i class="fas fa-exchange-alt"></i> Invert</button>
                        <button class="editor-btn" onclick="applyFilter('blur')"><i class="fas fa-water"></i> Blur</button>
                        <button class="editor-btn" onclick="rotateImage(90)"><i class="fas fa-redo"></i> Rotate 90¬∞</button>
                        <button class="editor-btn" onclick="flipImage('horizontal')"><i class="fas fa-arrows-alt-h"></i> Flip H</button>
                        <button class="editor-btn" onclick="flipImage('vertical')"><i class="fas fa-arrows-alt-v"></i> Flip V</button>
                        <button class="editor-btn" onclick="resetImage()"><i class="fas fa-undo"></i> Reset</button>
                    </div>
                    
                    <div class="editor-slider-group">
                        <label>Brightness: <span id="brightnessValue">0</span></label>
                        <input type="range" class="editor-slider" id="brightnessSlider" min="-100" max="100" value="0" oninput="adjustBrightness(this.value)">
                    </div>
                    
                    <div class="editor-slider-group">
                        <label>Contrast: <span id="contrastValue">100</span>%</label>
                        <input type="range" class="editor-slider" id="contrastSlider" min="0" max="200" value="100" oninput="adjustContrast(this.value)">
                    </div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 20px;">
                        <button class="btn btn-primary" onclick="saveEditedImage()" style="flex: 1;">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                        <button class="btn btn-secondary" onclick="closeImageEditor()" style="flex: 1;">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(editorModal);
            
            // Load image to canvas
            editorCanvas = document.getElementById('editorCanvas');
            editorCtx = editorCanvas.getContext('2d');
            
            const img = new Image();
            img.crossOrigin = 'anonymous';
            img.onload = function() {
                editorCanvas.width = img.width;
                editorCanvas.height = img.height;
                editorCtx.drawImage(img, 0, 0);
                originalImageData = editorCtx.getImageData(0, 0, editorCanvas.width, editorCanvas.height);
            };
            img.src = url;
        }
        
        function closeImageEditor() {
            const modal = document.getElementById('imageEditorModal');
            if (modal) modal.remove();
            currentEditorImageId = null;
        }
        
        function applyFilter(filterType) {
            if (!originalImageData) return;
            
            editorCtx.putImageData(originalImageData, 0, 0);
            const imageData = editorCtx.getImageData(0, 0, editorCanvas.width, editorCanvas.height);
            const data = imageData.data;
            
            for (let i = 0; i < data.length; i += 4) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];
                
                switch(filterType) {
                    case 'grayscale':
                        const gray = 0.299 * r + 0.587 * g + 0.114 * b;
                        data[i] = data[i + 1] = data[i + 2] = gray;
                        break;
                    case 'sepia':
                        data[i] = Math.min(255, (r * 0.393) + (g * 0.769) + (b * 0.189));
                        data[i + 1] = Math.min(255, (r * 0.349) + (g * 0.686) + (b * 0.168));
                        data[i + 2] = Math.min(255, (r * 0.272) + (g * 0.534) + (b * 0.131));
                        break;
                    case 'invert':
                        data[i] = 255 - r;
                        data[i + 1] = 255 - g;
                        data[i + 2] = 255 - b;
                        break;
                }
            }
            
            editorCtx.putImageData(imageData, 0, 0);
        }
        
        function adjustBrightness(value) {
            document.getElementById('brightnessValue').textContent = value;
            if (!originalImageData) return;
            
            editorCtx.putImageData(originalImageData, 0, 0);
            const imageData = editorCtx.getImageData(0, 0, editorCanvas.width, editorCanvas.height);
            const data = imageData.data;
            const brightness = parseInt(value);
            
            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.min(255, Math.max(0, data[i] + brightness));
                data[i + 1] = Math.min(255, Math.max(0, data[i + 1] + brightness));
                data[i + 2] = Math.min(255, Math.max(0, data[i + 2] + brightness));
            }
            
            editorCtx.putImageData(imageData, 0, 0);
        }
        
        function adjustContrast(value) {
            document.getElementById('contrastValue').textContent = value;
            if (!originalImageData) return;
            
            editorCtx.putImageData(originalImageData, 0, 0);
            const imageData = editorCtx.getImageData(0, 0, editorCanvas.width, editorCanvas.height);
            const data = imageData.data;
            const contrast = parseFloat(value) / 100;
            const factor = (259 * (contrast * 255 + 255)) / (255 * (259 - contrast * 255));
            
            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.min(255, Math.max(0, factor * (data[i] - 128) + 128));
                data[i + 1] = Math.min(255, Math.max(0, factor * (data[i + 1] - 128) + 128));
                data[i + 2] = Math.min(255, Math.max(0, factor * (data[i + 2] - 128) + 128));
            }
            
            editorCtx.putImageData(imageData, 0, 0);
        }
        
        function rotateImage(degrees) {
            if (!editorCanvas) return;
            
            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            
            if (degrees === 90 || degrees === 270) {
                tempCanvas.width = editorCanvas.height;
                tempCanvas.height = editorCanvas.width;
            } else {
                tempCanvas.width = editorCanvas.width;
                tempCanvas.height = editorCanvas.height;
            }
            
            tempCtx.translate(tempCanvas.width / 2, tempCanvas.height / 2);
            tempCtx.rotate((degrees * Math.PI) / 180);
            tempCtx.drawImage(editorCanvas, -editorCanvas.width / 2, -editorCanvas.height / 2);
            
            editorCanvas.width = tempCanvas.width;
            editorCanvas.height = tempCanvas.height;
            editorCtx.drawImage(tempCanvas, 0, 0);
            
            originalImageData = editorCtx.getImageData(0, 0, editorCanvas.width, editorCanvas.height);
        }
        
        function flipImage(direction) {
            if (!editorCanvas) return;
            
            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            tempCanvas.width = editorCanvas.width;
            tempCanvas.height = editorCanvas.height;
            
            tempCtx.save();
            if (direction === 'horizontal') {
                tempCtx.scale(-1, 1);
                tempCtx.drawImage(editorCanvas, -editorCanvas.width, 0);
            } else {
                tempCtx.scale(1, -1);
                tempCtx.drawImage(editorCanvas, 0, -editorCanvas.height);
            }
            tempCtx.restore();
            
            editorCtx.clearRect(0, 0, editorCanvas.width, editorCanvas.height);
            editorCtx.drawImage(tempCanvas, 0, 0);
            
            originalImageData = editorCtx.getImageData(0, 0, editorCanvas.width, editorCanvas.height);
        }
        
        function resetImage() {
            if (originalImageData) {
                editorCtx.putImageData(originalImageData, 0, 0);
                document.getElementById('brightnessSlider').value = 0;
                document.getElementById('contrastSlider').value = 100;
                document.getElementById('brightnessValue').textContent = '0';
                document.getElementById('contrastValue').textContent = '100';
            }
        }
        
        function saveEditedImage() {
            if (!editorCanvas || !currentEditorImageId) return;
            
            const editedUrl = editorCanvas.toDataURL('image/png');
            const mediaItem = mediaLibrary.find(m => m.id.toString() === currentEditorImageId);
            
            if (mediaItem) {
                mediaItem.url = editedUrl;
                mediaItem.edited = new Date().toISOString();
                saveMediaLibrary();
                renderMedia();
                showAlert('Image saved successfully!', 'success');
                closeImageEditor();
            }
        }
    </script>
</body>
</html>
