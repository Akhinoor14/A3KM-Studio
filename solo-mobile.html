<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <title>Solo Projects - SOLIDWORKS Mobile</title>
  <link rel="icon" href="favicon.svg" type="image/svg+xml" />
  
  <link rel="stylesheet" href="styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="mobile-clean.css" />
  <link rel="stylesheet" href="solo-mobile.css" />
  <link rel="stylesheet" href="shared/model-viewer.css" />
  
  <style>
    body { 
      background: linear-gradient(135deg, #0a0a0a 0%, #15051a 100%); 
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
    }
    
    .navbar { display: none !important; }
    
    .mobile-header {
      position: fixed; top: 0; left: 0; right: 0; height: 60px;
      background: rgba(50, 0, 70, 0.98); border-bottom: 2px solid rgba(138, 43, 226, 0.4);
      display: flex; align-items: center; padding: 0 12px; gap: 12px; z-index: 1000;
      backdrop-filter: blur(15px);
      will-change: transform;
      transform: translateZ(0);
    }
    
    .mobile-back-btn {
      width: 44px; height: 44px; display: flex; align-items: center; justify-content: center;
      background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 50%; color: #fff; font-size: 1.2rem; cursor: pointer; transition: all 0.2s;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    
    .mobile-back-btn:active { transform: scale(0.95); }
    
    .mobile-header-title { flex: 1; font-size: 1.1rem; font-weight: 700; color: #fff; }
    
    .mobile-content { 
      margin-top: 60px; 
      padding: 16px; 
      min-height: calc(100vh - 60px);
      contain: layout style paint;
    }
    
    .solo-3d-preview-container,
    .lazy-3d {
      will-change: transform;
      transform: translateZ(0);
      contain: layout style paint;
    }
    
    .solo-file-item {
      contain: layout style;
    }
  </style>
</head>
<body>

  <header class="mobile-header">
    <button class="mobile-back-btn" onclick="window.location.href='solidworks-mobile.html'">
      <i class="fas fa-arrow-left"></i>
    </button>
    <div class="mobile-header-title">
      <span>üéØ Solo Projects</span>
    </div>
  </header>

  <main class="mobile-content">
    
    <div class="solo-info-card">
      <div class="solo-info-icon">üéØ</div>
      <h2 class="solo-info-title">Solo Projects</h2>
      <p class="solo-info-desc">Personal creations and experiments</p>
    </div>
    
    <button class="solo-github-btn" onclick="window.open('https://github.com/Akhinoor14/SOLIDWORKS-Projects/tree/main/Solo%20Projects', '_blank')">
      <i class="fab fa-github"></i>
      <span>View on GitHub</span>
      <i class="fas fa-external-link-alt"></i>
    </button>
    
    <div id="solo-projects-grid">
      <div class="solo-loading">
        <i class="fas fa-spinner fa-spin"></i>
        <p>Loading Solo Projects...</p>
      </div>
    </div>
    
  </main>

  <script src="shared/model-viewer.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="github-proxy-config.js"></script>
  <script src="github-fetch-patch.js"></script>
  <script src="github-sync.js"></script>
  <script src="realtime-github-sync.js"></script>
  <script src="auto-refresh.js"></script>
  
  <script>
    console.log('üéØ Solo Projects Mobile Page Loaded');
    
    let expandedProjects = new Set();
    let realtimeSync = null;
    
    // Initialize real-time sync system
    if (typeof RealTimeGitHubSync !== 'undefined') {
      realtimeSync = new RealTimeGitHubSync('Akhinoor14', 'SOLIDWORKS-Projects');
      realtimeSync.startRealTimeSync();
      console.log('üîÑ Real-time GitHub sync activated');
      
      window.addEventListener('github-sync-update', () => {
        console.log('üÜï GitHub update detected, reloading...');
        loadSoloProjects();
      });
    }
    
    async function loadSoloProjects() {
      const grid = document.getElementById('solo-projects-grid');
      
      // Show loading state
      grid.innerHTML = `
        <div class="solo-loading">
          <i class="fas fa-spinner fa-spin"></i>
          <p>Loading Solo Projects...</p>
        </div>
      `;
      
      try {
        // Try both "Solo Projects" and "Solo-Projects" folder names
        let url = 'https://api.github.com/repos/Akhinoor14/SOLIDWORKS-Projects/contents/Solo%20Projects';
        let response = await fetch(url);
        
        // If not found, try with hyphen
        if (!response.ok && response.status === 404) {
          console.log('‚ö†Ô∏è Solo Projects not found, trying Solo-Projects...');
          url = 'https://api.github.com/repos/Akhinoor14/SOLIDWORKS-Projects/contents/Solo-Projects';
          response = await fetch(url);
        }
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        
        // Check if data has error message
        if (data.message) {
          throw new Error(data.message);
        }
        
        console.log(`‚úÖ Loaded ${data.length} items`);
        
        const projects = data.filter(item => item.type === 'dir');
        
        // Check if no projects found
        if (projects.length === 0) {
          grid.innerHTML = `
            <div class="solo-error">
              <i class="fas fa-folder-open"></i>
              <p>No Solo Projects found</p>
              <p style="font-size: 0.85rem; opacity: 0.7; margin-top: 8px;">
                Projects will appear here once uploaded
              </p>
            </div>
          `;
          return;
        }
        
        let html = '<div class="solo-projects-list">';
        
        // Lazy load - don't fetch summaries upfront for speed
        for (const project of projects) {
          html += `
            <div class="solo-project-wrapper" data-project="${project.name}">
              <div class="solo-project-header" data-project="${project.name}">
                <div class="solo-project-header-left">
                  <div class="solo-project-icon">üéØ</div>
                  <div class="solo-project-info">
                    <h3 class="solo-project-title">${project.name}</h3>
                    <p class="solo-project-subtitle">Click to view files</p>
                  </div>
                </div>
                <i class="fas fa-chevron-down solo-expand-icon"></i>
              </div>
              <div class="solo-project-content" data-project="${project.name}" style="display: none;">
                <div class="solo-loading-mini">
                  <i class="fas fa-spinner fa-spin"></i>
                  <span>Loading files...</span>
                </div>
              </div>
            </div>
          `;
        }
        
        html += '</div>';
        grid.innerHTML = html;
        
        document.querySelectorAll('.solo-project-header').forEach(header => {
          header.addEventListener('click', () => {
            const projectName = header.dataset.project;
            toggleProjectExpand(projectName);
          });
        });
        
      } catch (error) {
        console.error('‚ùå Error loading Solo Projects:', error);
        grid.innerHTML = `
          <div class="solo-error">
            <i class="fas fa-exclamation-triangle"></i>
            <p>Failed to load Solo Projects</p>
            <p style="font-size: 0.85rem; opacity: 0.7; margin-top: 8px;">
              ${error.message || 'Please check your connection and try again'}
            </p>
            <button onclick="loadSoloProjects()" style="margin-top: 12px;">
              <i class="fas fa-redo"></i> Retry
            </button>
          </div>
        `;
      }
    }
    
    async function toggleProjectExpand(projectName) {
      const wrapper = document.querySelector(`.solo-project-wrapper[data-project="${projectName}"]`);
      if (!wrapper) {
        console.error('Wrapper not found for:', projectName);
        return;
      }
      
      const header = wrapper.querySelector('.solo-project-header');
      const content = wrapper.querySelector('.solo-project-content');
      const icon = header.querySelector('.solo-expand-icon');
      
      if (!content || !icon) {
        console.error('Content or icon not found');
        return;
      }
      
      if (expandedProjects.has(projectName)) {
        expandedProjects.delete(projectName);
        content.style.display = 'none';
        icon.classList.remove('expanded');
      } else {
        expandedProjects.add(projectName);
        content.style.display = 'block';
        icon.classList.add('expanded');
        
        if (content.querySelector('.solo-loading-mini')) {
          await loadProjectContent(projectName, content);
        }
      }
    }
    
    async function loadProjectContent(projectName, contentDiv) {
      try {
        // Try both folder name formats with proper encoding
        let url = `https://api.github.com/repos/Akhinoor14/SOLIDWORKS-Projects/contents/Solo%20Projects/${encodeURIComponent(projectName)}`;
        let response = await fetch(url);
        
        if (!response.ok && response.status === 404) {
          url = `https://api.github.com/repos/Akhinoor14/SOLIDWORKS-Projects/contents/Solo-Projects/${encodeURIComponent(projectName)}`;
          response = await fetch(url);
        }
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        
        const files = data.filter(item => item.type === 'file');
        
        let html = '';
        
        // Add ZIP Download Button at top
        html += `
          <div class="solo-project-actions" style="padding: 12px 16px; background: rgba(0,0,0,0.2); border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; gap: 8px; align-items: center;">
            <button onclick="downloadProjectZip('${projectName}', '${url}')" class="solo-zip-download-btn" style="flex: 1; padding: 10px 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 8px; color: #fff; font-size: 0.9rem; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: transform 0.2s ease;">
              <i class="fas fa-download"></i>
              <span>Download All (ZIP)</span>
            </button>
            <a href="${url.replace('/contents/', '/tree/main/')}" target="_blank" class="solo-github-link-btn" style="padding: 10px 16px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; color: rgba(255,255,255,0.8); font-size: 0.9rem; cursor: pointer; display: flex; align-items: center; justify-content: center; text-decoration: none;">
              <i class="fab fa-github"></i>
            </a>
          </div>
        `;
        
        // Check for Question/Problem files (PDF, images with 'problem' in name)
        const questionFiles = files.filter(f => 
          (/\.(pdf|png|jpg|jpeg)$/i.test(f.name) && /(question|problem)/i.test(f.name)) ||
          f.name.toLowerCase().includes('problem')
        );
        
        if (questionFiles.length > 0) {
          html += `
            <div class="solo-question-card">
              <div class="solo-question-header">
                <span class="solo-question-icon">üí°</span>
                <div class="solo-question-info">
                  <h4 class="solo-question-title">Problems</h4>
                  <p class="solo-question-meta">${questionFiles.length} file${questionFiles.length !== 1 ? 's' : ''}</p>
                </div>
              </div>
              <div class="solo-question-files">
          `;
          
          questionFiles.forEach(file => {
            const fileType = getFileType(file.name);
            const fileSize = formatSize(file.size);
            const isPDF = /\.pdf$/i.test(file.name);
            const isImage = /\.(png|jpg|jpeg)$/i.test(file.name);
            const is3D = /\.(glb|gltf)$/i.test(file.name);
            const escapedName = file.name.replace(/'/g, "\\'");
            
            html += `
              <div class="solo-file-item ${is3D ? 'has-3d-preview' : ''}" data-file-type="${is3D ? '3d' : 'file'}">
                ${is3D ? `
                <div class="solo-3d-preview-container lazy-3d" data-model-src="${file.download_url}" data-model-title="${escapedName}" style="cursor: pointer; position: relative; background: rgba(0,0,0,0.5); min-height: 180px; display: flex; align-items: center; justify-content: center;">
                  <div class="preview-placeholder" style="position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; color: rgba(255,255,255,0.5);">
                    <i class="fas fa-cube" style="font-size: 2rem; margin-bottom: 8px; opacity: 0.5;"></i>
                    <span style="font-size: 0.85rem;">Tap to preview</span>
                  </div>
                </div>
                ` : ''}
                <div class="solo-file-info">
                  <span class="solo-file-badge solo-badge-question">${fileType}</span>
                  <span class="solo-file-name">${file.name}</span>
                  <span class="solo-file-size">${fileSize}</span>
                </div>
                <div class="solo-file-actions">
                  ${is3D ? `<button class="solo-file-btn view" data-model-src="${file.download_url}" data-model-title="${escapedName}" title="View 3D Model">
                    <i class="fas fa-cube"></i>
                  </button>` : ''}
                  ${isPDF ? `<button class="solo-file-btn view" onclick="viewPDF('${file.download_url}', '${escapedName}')">
                    <i class="fas fa-eye"></i>
                  </button>` : ''}
                  ${isImage ? `<button class="solo-file-btn view" onclick="viewImage('${file.download_url}', '${file.name}')">
                    <i class="fas fa-eye"></i>
                  </button>` : ''}
                  <a href="${file.download_url}" class="solo-file-btn download" download>
                    <i class="fas fa-download"></i>
                  </a>
                  <a href="${file.html_url}" class="solo-file-btn github" target="_blank">
                    <i class="fab fa-github"></i>
                  </a>
                </div>
              </div>
            `;
          });
          
          html += `
              </div>
            </div>
          `;
        }
        
        // Render CAD files (including 3D models)
        const cadFiles = files.filter(f => 
          /\.(sldprt|sldasm|slddrw|glb|gltf)$/i.test(f.name) && 
          !questionFiles.includes(f)
        );
        
        if (cadFiles.length > 0) {
          html += '<div class="solo-files-list">';
          
          cadFiles.forEach(file => {
            const fileType = getFileType(file.name);
            const fileSize = formatSize(file.size);
            const is3D = /\.(glb|gltf)$/i.test(file.name);
            const escapedName = file.name.replace(/'/g, "\\'");
            
            html += `
              <div class="solo-file-item ${is3D ? 'has-3d-preview' : ''}" data-file-type="${is3D ? '3d' : 'file'}">
                ${is3D ? `
                <div class="solo-3d-preview-container lazy-3d" data-model-src="${file.download_url}" data-model-title="${escapedName}" style="cursor: pointer; position: relative; background: rgba(0,0,0,0.5); min-height: 180px; display: flex; align-items: center; justify-content: center;">
                  <div class="preview-placeholder" style="position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; color: rgba(255,255,255,0.5);">
                    <i class="fas fa-cube" style="font-size: 2rem; margin-bottom: 8px; opacity: 0.5;"></i>
                    <span style="font-size: 0.85rem;">Tap to preview</span>
                  </div>
                </div>
                ` : ''}
                <div class="solo-file-info">
                  <span class="solo-file-badge">${fileType}</span>
                  <span class="solo-file-name">${file.name}</span>
                  <span class="solo-file-size">${fileSize}</span>
                </div>
                <div class="solo-file-actions">
                  ${is3D ? `<button class="solo-file-btn view" data-model-src="${file.download_url}" data-model-title="${escapedName}" title="View 3D Model">
                    <i class="fas fa-cube"></i>
                  </button>` : ''}
                  <a href="${file.download_url}" class="solo-file-btn download" download>
                    <i class="fas fa-download"></i>
                  </a>
                  <a href="${file.html_url}" class="solo-file-btn github" target="_blank">
                    <i class="fab fa-github"></i>
                  </a>
                </div>
              </div>
            `;
          });
          
          html += '</div>';
        }
        
        contentDiv.innerHTML = html;
        
      } catch (error) {
        console.error(`‚ùå Error loading ${projectName}:`, error);
        contentDiv.innerHTML = `
          <div class="solo-error-mini">
            <i class="fas fa-exclamation-triangle"></i>
            <span>Failed to load files</span>
            <span style="font-size: 0.8rem; opacity: 0.6; display: block; margin-top: 4px;">
              ${error.message || 'Connection error'}
            </span>
          </div>
        `;
      }
    }
    
    function getFileType(filename) {
      const ext = filename.split('.').pop().toUpperCase();
      if (ext === 'SLDPRT') return 'SLDPRT';
      if (ext === 'SLDASM') return 'SLDASM';
      if (ext === 'SLDDRW') return 'SLDDRW';
      if (ext === 'GLB') return '3D-GLB';
      if (ext === 'GLTF') return '3D-GLTF';
      if (ext === 'PDF') return 'PDF';
      return ext;
    }
    
    function formatSize(bytes) {
      if (bytes < 1024) return bytes + ' B';
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
      return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
    }
    
    // PDF Viewer function
    function viewPDF(url, filename) {
      const modal = document.createElement('div');
      modal.className = 'solo-pdf-modal';
      modal.innerHTML = `
        <div class="solo-pdf-overlay" onclick="this.parentElement.remove()"></div>
        <div class="solo-pdf-container">
          <div class="solo-pdf-header">
            <h3>${filename}</h3>
            <button onclick="this.closest('.solo-pdf-modal').remove()">
              <i class="fas fa-times"></i>
            </button>
          </div>
          <iframe src="${url}" class="solo-pdf-viewer"></iframe>
        </div>
      `;
      document.body.appendChild(modal);
    }
    
    // Download all files as ZIP
    async function downloadProjectZip(projectName, projectUrl) {
      try {
        // Show loading indicator
        const button = event.target.closest('button');
        const originalHTML = button.innerHTML;
        button.disabled = true;
        button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating ZIP...';
        
        // Fetch project files
        const response = await fetch(projectUrl);
        const files = await response.json();
        
        // Create ZIP
        const zip = new JSZip();
        const folder = zip.folder(projectName);
        
        // Download and add each file to ZIP
        let completed = 0;
        const totalFiles = files.filter(f => f.type === 'file').length;
        
        for (const file of files) {
          if (file.type === 'file') {
            try {
              const fileResponse = await fetch(file.download_url);
              const fileBlob = await fileResponse.blob();
              folder.file(file.name, fileBlob);
              completed++;
              button.innerHTML = `<i class="fas fa-spinner fa-spin"></i> ${completed}/${totalFiles}`;
            } catch (err) {
              console.warn(`Failed to add ${file.name}:`, err);
            }
          }
        }
        
        // Generate ZIP
        button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating ZIP...';
        const zipBlob = await zip.generateAsync({ type: 'blob' });
        
        // Download ZIP
        const url = URL.createObjectURL(zipBlob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${projectName}.zip`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        // Reset button
        button.disabled = false;
        button.innerHTML = '<i class="fas fa-check"></i> Downloaded!';
        setTimeout(() => {
          button.innerHTML = originalHTML;
        }, 2000);
        
      } catch (error) {
        console.error('ZIP download error:', error);
        alert('Failed to create ZIP file. Please try again.');
        const button = event.target.closest('button');
        button.disabled = false;
        button.innerHTML = '<i class="fas fa-download"></i> Download All (ZIP)';
      }
    }
    
    // Image Viewer function
    function viewImage(url, filename) {
      const modal = document.createElement('div');
      modal.className = 'solo-image-modal';
      modal.innerHTML = `
        <div class="solo-image-overlay" onclick="this.parentElement.remove()"></div>
        <div class="solo-image-container">
          <div class="solo-image-header">
            <h3>${filename}</h3>
            <button onclick="this.closest('.solo-image-modal').remove()">
              <i class="fas fa-times"></i>
            </button>
          </div>
          <div class="solo-image-content">
            <img src="${url}" alt="${filename}" />
          </div>
        </div>
      `;
      document.body.appendChild(modal);
    }
    
    // Lazy load 3D previews using Intersection Observer (OPTIMIZED)
    let lazy3DObserver = null;
    
    function initLazy3DPreviews() {
      // Disconnect previous observer if exists
      if (lazy3DObserver) {
        lazy3DObserver.disconnect();
      }
      
      const lazy3DContainers = document.querySelectorAll('.lazy-3d:not(.loaded)');
      
      if (!lazy3DContainers.length) {
        console.log('üì¶ No 3D previews to load');
        return;
      }
      
      console.log(`üéØ Initializing lazy load for ${lazy3DContainers.length} 3D previews`);
      
      lazy3DObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const container = entry.target;
            
            // Skip if already loaded
            if (container.classList.contains('loaded')) {
              return;
            }
            
            const modelSrc = container.getAttribute('data-model-src');
            if (!modelSrc) return;
            
            console.log('üì¶ Loading 3D preview:', modelSrc);
            
            // Mark as loaded immediately to prevent duplicate loads
            container.classList.add('loaded');
            
            // Create minimal model-viewer for preview
            const modelViewer = document.createElement('model-viewer');
            modelViewer.setAttribute('src', modelSrc);
            modelViewer.setAttribute('alt', '3D Model Preview');
            modelViewer.setAttribute('camera-controls', '');
            modelViewer.setAttribute('disable-zoom', '');
            modelViewer.setAttribute('interaction-prompt', 'none');
            modelViewer.setAttribute('loading', 'lazy');
            modelViewer.setAttribute('reveal', 'manual');
            modelViewer.style.cssText = 'width: 100%; height: 100%; position: absolute; top: 0; left: 0;';
            
            // Remove placeholder on load
            modelViewer.addEventListener('load', () => {
              const placeholder = container.querySelector('.preview-placeholder');
              if (placeholder) {
                placeholder.style.transition = 'opacity 0.3s ease';
                placeholder.style.opacity = '0';
                setTimeout(() => placeholder.remove(), 300);
              }
              console.log('‚úÖ 3D preview loaded');
            });
            
            // Handle errors
            modelViewer.addEventListener('error', (e) => {
              console.error('‚ùå 3D preview load error:', e);
              const placeholder = container.querySelector('.preview-placeholder');
              if (placeholder) {
                placeholder.innerHTML = '<i class="fas fa-exclamation-triangle"></i><span>Load failed</span>';
                placeholder.style.color = '#ff6b6b';
              }
            });
            
            container.appendChild(modelViewer);
            
            // Reveal the model after a short delay
            setTimeout(() => {
              if (modelViewer.dismissPoster) {
                modelViewer.dismissPoster();
              }
            }, 500);
            
            // Unobserve after loading
            lazy3DObserver.unobserve(container);
          }
        });
      }, {
        root: null,
        rootMargin: '150px', // Load a bit before entering viewport
        threshold: 0.1
      });
      
      // Observe all lazy 3D containers
      lazy3DContainers.forEach(container => {
        lazy3DObserver.observe(container);
      });
    }
    
    // Handle 3D model viewer clicks (delegated event handling)
    function setup3DViewerHandlers() {
      // Remove old listener if exists
      if (window._solo3DClickHandler) {
        document.removeEventListener('click', window._solo3DClickHandler);
      }
      
      // Create new handler
      window._solo3DClickHandler = function(e) {
        // Check for view button click
        const btn = e.target.closest('.solo-file-btn.view[data-model-src]');
        const container = e.target.closest('.solo-3d-preview-container[data-model-src]');
        
        if (btn || container) {
          e.preventDefault();
          e.stopPropagation();
          
          const element = btn || container;
          const src = element.getAttribute('data-model-src');
          const title = element.getAttribute('data-model-title') || 'Solo 3D Model';
          
          if (!src || typeof openModelViewer !== 'function') return;
          
          // Find parent project to get all 3D files for navigation
          const projectContent = element.closest('.solo-project-content');
          if (projectContent) {
            const all3DElements = projectContent.querySelectorAll('[data-model-src]');
            const models = [];
            let currentIndex = 0;
            
            all3DElements.forEach((el, idx) => {
              const modelSrc = el.getAttribute('data-model-src');
              const modelTitle = el.getAttribute('data-model-title') || `3D Model ${idx + 1}`;
              
              if (modelSrc) {
                // Check if this is the clicked model
                if (modelSrc === src) {
                  currentIndex = models.length;
                }
                
                models.push({
                  src: modelSrc,
                  title: modelTitle
                });
              }
            });
            
            // Open with navigation
            openModelViewer({
              src,
              title,
              models: models.length > 1 ? models : [],
              currentIndex,
              ar: true
            });
          } else {
            // Fallback: single model without navigation
            openModelViewer({ src, title, ar: true });
          }
          
          return;
        }
      };
      
      document.addEventListener('click', window._solo3DClickHandler);
      console.log('‚úÖ 3D viewer click handlers set up');
    }
    
    // Wrap original loadSoloProjects
    const originalLoadSoloProjects = loadSoloProjects;
    loadSoloProjects = async function() {
      await originalLoadSoloProjects();
      
      // Initialize 3D systems after content loads
      setTimeout(() => {
        initLazy3DPreviews();
        setup3DViewerHandlers();
        console.log('üöÄ Solo 3D system initialized');
      }, 200);
    };
    
    // Start on DOMContentLoaded
    document.addEventListener('DOMContentLoaded', loadSoloProjects);
  </script>

</body>
</html>
